{"version":3,"file":"mind.umd.js","sources":["../src/utils/index.ts","../src/utils/dom.ts","../src/utils/svg.ts","../painter/index.foreignObject.js","../src/interact.ts","../src/nodeOperation.ts","../src/customLink.ts","../src/linkDiv.ts","../src/mouse.ts","../src/i18n.ts","../src/plugin/contextMenu.ts","../src/plugin/sidebar.ts","../src/plugin/toolBar.ts","../src/plugin/nodeMenu.ts","../src/plugin/nodeDraggable.ts","../src/plugin/keypress.ts","../src/plugin/mobileMenu.ts","../src/utils/pubsub.ts","../src/iconfont/iconfont.js","../src/index.ts"],"sourcesContent":["import { NodeObj } from '../index'\n\nexport function encodeHTML(s) {\n  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;')\n}\n\nexport const isMobile = (): boolean =>\n  /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n    navigator.userAgent\n  )\n\nexport const rgbHex = (rgb) => {\n  return rgb.replace(\n    /\\brgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/g,\n    function($0, $1, $2, $3) {\n      return '#' + ('0' + Number($1).toString(16)).substr(-2) + ('0' + Number($2).toString(16)).substr(-2) + ('0' + Number($3).toString(16)).substr(-2)\n    })\n}\n\nexport const getObjById = function(id: string, data: NodeObj) {\n  data = data || this.nodeData\n  if (data.id === id) {\n    return data\n  } else if (data.children && data.children.length) {\n    for (let i = 0; i < data.children.length; i++) {\n      const res = getObjById(id, data.children[i])\n      if (res) return res\n    }\n  } else {\n    return null\n  }\n}\n\nexport const addParentLink = (data: NodeObj, parent?: NodeObj) => {\n  data.parent = parent\n  if (data.children) {\n    for (let i = 0; i < data.children.length; i++) {\n      addParentLink(data.children[i], data)\n    }\n  }\n}\n\nexport function refreshIds(data: NodeObj) {\n  data.id = generateUUID()\n  if (data.children) {\n    for (let i = 0; i < data.children.length; i++) {\n      refreshIds(data.children[i])\n    }\n  }\n}\n\nexport const throttle = (fn: (any) => void, wait: number) => {\n  var pre = Date.now()\n  return function() {\n    var context = this\n    var args = arguments\n    var now = Date.now()\n    if (now - pre >= wait) {\n      fn.apply(context, args)\n      pre = Date.now()\n    }\n  }\n}\n\nexport function getArrowPoints(p3x: number, p3y: number, p4x: number, p4y: number) {\n  const deltay = p4y - p3y\n  const deltax = p3x - p4x\n  let angle = (Math.atan(Math.abs(deltay) / Math.abs(deltax)) / 3.14) * 180\n  if (deltax < 0 && deltay > 0) {\n    angle = 180 - angle\n  }\n  if (deltax < 0 && deltay < 0) {\n    angle = 180 + angle\n  }\n  if (deltax > 0 && deltay < 0) {\n    angle = 360 - angle\n  }\n  const arrowLength = 20\n  const arrowAngle = 30\n  var a1 = angle + arrowAngle\n  const a2 = angle - arrowAngle\n  return {\n    x1: p4x + Math.cos((Math.PI * a1) / 180) * arrowLength,\n    y1: p4y - Math.sin((Math.PI * a1) / 180) * arrowLength,\n    x2: p4x + Math.cos((Math.PI * a2) / 180) * arrowLength,\n    y2: p4y - Math.sin((Math.PI * a2) / 180) * arrowLength,\n  }\n}\n\nexport function calcP1(fromData, p2x, p2y) {\n  let x, y\n  const k = (fromData.cy - p2y) / (p2x - fromData.cx)\n  if (k > fromData.h / fromData.w || k < -fromData.h / fromData.w) {\n    if (fromData.cy - p2y < 0) {\n      x = fromData.cx - fromData.h / 2 / k\n      y = fromData.cy + fromData.h / 2\n    } else {\n      x = fromData.cx + fromData.h / 2 / k\n      y = fromData.cy - fromData.h / 2\n    }\n  } else {\n    // console.log('斜率', k)\n    // console.log('fromData.cx-x', fromData.cx - p2x)\n    if (fromData.cx - p2x < 0) {\n      x = fromData.cx + fromData.w / 2\n      y = fromData.cy - (fromData.w * k) / 2\n    } else {\n      x = fromData.cx - fromData.w / 2\n      y = fromData.cy + (fromData.w * k) / 2\n    }\n  }\n  return {\n    x,\n    y,\n  }\n}\n\nexport function calcP4(toData, p3x, p3y) {\n  let x, y\n  const k = (toData.cy - p3y) / (p3x - toData.cx)\n  if (k > toData.h / toData.w || k < -toData.h / toData.w) {\n    if (toData.cy - p3y < 0) {\n      x = toData.cx - toData.h / 2 / k\n      y = toData.cy + toData.h / 2\n    } else {\n      x = toData.cx + toData.h / 2 / k\n      y = toData.cy - toData.h / 2\n    }\n  } else {\n    // console.log('斜率', k)\n    // console.log('toData.cx-x', toData.cx - p3x)\n    if (toData.cx - p3x < 0) {\n      x = toData.cx + toData.w / 2\n      y = toData.cy - (toData.w * k) / 2\n    } else {\n      x = toData.cx - toData.w / 2\n      y = toData.cy + (toData.w * k) / 2\n    }\n  }\n  return {\n    x,\n    y,\n  }\n}\n\nexport function generateUUID(): string {\n  return (\n    new Date().getTime().toString(16) + Math.random().toString(16).substr(2)\n  ).substr(2, 16)\n}\n\nexport function generateNewObj(): NodeObj {\n  const id = generateUUID()\n  return {\n    topic: this.newTopicName || 'new node',\n    id,\n  }\n}\n\nexport function generateNewSummaryObj(): NodeObj {\n  const id = generateUUID()\n  return {\n    topic: this.newTopicName || 'new node',\n    id,\n    type:'summary',\n    summary:{\n      topicId:id,\n      range:this.currentSummaryNodeArr.map(val=>val.nodeObj.id)\n    }\n  }\n}\n\nexport function generateNewLink(from, to) {\n  const id = generateUUID()\n  return {\n    id,\n    name: '',\n    from,\n    to,\n    delta1: { x: 0, y: -100 },\n    delta2: { x: 0, y: -100 },\n  }\n}\n\nexport function checkMoveValid(from: NodeObj, to: NodeObj) {\n  let valid = true\n  while (to.parent) {\n    if (to.parent === from) {\n      valid = false\n      break\n    }\n    to = to.parent\n  }\n  return valid\n}\n\nexport function getObjSibling(obj: NodeObj): NodeObj {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  if (index + 1 >= childrenList.length) {\n    // 最后一个\n    return null\n  } else {\n    return childrenList[index + 1]\n  }\n}\n\nexport function moveUpObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  const t = childrenList[index]\n  if (index === 0) {\n    childrenList[index] = childrenList[childrenList.length - 1]\n    childrenList[childrenList.length - 1] = t\n  } else {\n    childrenList[index] = childrenList[index - 1]\n    childrenList[index - 1] = t\n  }\n}\n\nexport function moveDownObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  const t = childrenList[index]\n  if (index === childrenList.length - 1) {\n    childrenList[index] = childrenList[0]\n    childrenList[0] = t\n  } else {\n    childrenList[index] = childrenList[index + 1]\n    childrenList[index + 1] = t\n  }\n}\n\nexport function removeNodeObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index, 1)\n  return childrenList.length\n}\n\nexport function insertNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index + 1, 0, newObj)\n}\n\nexport function insertBeforeNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index, 0, newObj)\n}\n\nexport function insertParentNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList[index] = newObj\n  newObj.children = [obj]\n}\n\nexport function moveNodeObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  if (to.children) to.children.push(from)\n  else to.children = [from]\n}\n\nexport function moveNodeBeforeObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  const childrenList = to.parent.children\n  let toIndex = 0\n  for (let i = 0; i < childrenList.length; i++) {\n    if (childrenList[i] === to) {\n      toIndex = i\n      break\n    }\n  }\n  childrenList.splice(toIndex, 0, from)\n}\n\nexport function moveNodeAfterObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  const childrenList = to.parent.children\n  let toIndex = 0\n  for (let i = 0; i < childrenList.length; i++) {\n    if (childrenList[i] === to) {\n      toIndex = i\n      break\n    }\n  }\n  childrenList.splice(toIndex + 1, 0, from)\n}\n\nexport const dragMoveHelper = {\n  afterMoving: false, // 区别click事件\n  mousedown: false,\n  lastX: null,\n  lastY: null,\n  onMove(e, container) {\n    if (this.mousedown) {\n      this.afterMoving = true\n      if (!this.lastX) {\n        this.lastX = e.pageX\n        this.lastY = e.pageY\n        return\n      }\n      const deltaX = this.lastX - e.pageX\n      const deltaY = this.lastY - e.pageY\n      container.scrollTo(\n        container.scrollLeft + deltaX,\n        container.scrollTop + deltaY\n      )\n      this.lastX = e.pageX\n      this.lastY = e.pageY\n    }\n  },\n  clear() {\n    this.afterMoving = false\n    this.mousedown = false\n    this.lastX = null\n    this.lastY = null\n  },\n}\n\nexport function LinkDragMoveHelper(dom) {\n  this.dom = dom\n  this.mousedown = false\n  this.lastX = null\n  this.lastY = null\n}\n\nLinkDragMoveHelper.prototype.init = function(map, cb) {\n  this.handleMouseMove = e => {\n    e.stopPropagation()\n    if (this.mousedown) {\n      if (!this.lastX) {\n        this.lastX = e.pageX\n        this.lastY = e.pageY\n        return\n      }\n      const deltaX = this.lastX - e.pageX\n      const deltaY = this.lastY - e.pageY\n      cb(deltaX, deltaY)\n      this.lastX = e.pageX\n      this.lastY = e.pageY\n    }\n  }\n  this.handleMouseDown = e => {\n    e.stopPropagation()\n    this.mousedown = true\n  }\n  this.handleClear = e => {\n    e.stopPropagation()\n    this.clear()\n  }\n  map.addEventListener('mousemove', this.handleMouseMove)\n  map.addEventListener('mouseleave', this.handleClear)\n  map.addEventListener('mouseup', this.handleClear)\n  this.dom.addEventListener('mousedown', this.handleMouseDown)\n}\n\nLinkDragMoveHelper.prototype.destory = function(map) {\n  map.removeEventListener('mousemove', this.handleMouseMove)\n  map.removeEventListener('mouseleave', this.handleClear)\n  map.removeEventListener('mouseup', this.handleClear)\n  this.dom.removeEventListener('mousedown', this.handleMouseDown)\n}\n\nLinkDragMoveHelper.prototype.clear = function() {\n  this.mousedown = false\n  this.lastX = null\n  this.lastY = null\n}\n","import { node } from 'canvg/dist/presets'\nimport { LEFT, RIGHT, SIDE } from '../const'\nimport MindElixir, { NodeObj } from '../index'\nimport { expandNodeChild, getHeightFromRootToAnotherNode, getWidthFromRootToAnotherNode } from '../interact'\nimport { addChild } from '../nodeOperation'\nimport { encodeHTML, getArrowPoints } from '../utils/index'\nexport type Top = HTMLElement\nexport type Group = HTMLElement\n\nexport interface Topic extends HTMLElement {\n  nodeObj?: NodeObj\n}\n\nexport interface Expander extends HTMLElement {\n  expanded?: boolean\n}\n\n// DOM manipulation\nconst $d = document\nexport const findEle = (id: string, instance?) => {\n  const scope = instance ? instance.mindElixirBox : $d\n  return scope.querySelector(`[data-nodeid=me${id}]`)\n}\n\nfunction resizeNode(widthControll:HTMLElement,tpc:Topic,anotherWidthControll:HTMLElement){\n  widthControll.onpointerdown=eDown=>{\n    if(!tpc.classList.contains('selected')) return\n    const startX=eDown.clientX\n    const width=tpc.clientWidth-Number(getComputedStyle(tpc).paddingLeft.replace('px',''))-Number(getComputedStyle(tpc).paddingRight.replace('px',''))\n    widthControll.onpointermove=eMove=>{\n      const endX=eMove.clientX\n      tpc.style.width=(width+endX-startX).toString()+'px'\n      widthControll.style.height=anotherWidthControll.style.height=tpc.clientHeight.toString()+'px'\n      //保存样式\n      if(!tpc.nodeObj.style) tpc.nodeObj.style={}\n      tpc.nodeObj.style.width=tpc.style.width\n      //设置宽度控制条的高度\n      tpc.nodeObj.style.controllWidth=widthControll.style.height\n      //更新图片的宽度和高度 \n      eMove.preventDefault()\n    }\n    widthControll.setPointerCapture(eDown.pointerId)\n    eDown.preventDefault()\n  }\n  widthControll.onpointerup=eUp=>{\n    widthControll.onpointermove=null\n    widthControll.releasePointerCapture(eUp.pointerId)\n    this?.linkDiv?.()\n  }\n}\nexport const shapeTpc = function(tpc: Topic, nodeObj: NodeObj) {\n  \n  const widthControllRight=$d.createElement('widthControllRight')\n  const widthControllLeft=$d.createElement('widthControllLeft')\n\n  tpc.textContent = nodeObj.topic\n  //放在textContent之后，因为会清除子节点\n  if(this?.widthControll){\n    resizeNode.call(this,widthControllLeft,tpc,widthControllRight)\n    resizeNode.call(this,widthControllRight,tpc,widthControllLeft)\n    tpc.appendChild(widthControllRight)\n    tpc.appendChild(widthControllLeft)\n  }\n  \n  if (nodeObj.style) {\n    tpc.style.color = nodeObj.style.color || '#2c3e50'\n    tpc.style.background = nodeObj.style.background?nodeObj.style.background:nodeObj?.parent?.root?'#ffffff':'inherit'\n    if(/[a-z]/i.test(nodeObj.style.fontSize))\n      tpc.style.fontSize = nodeObj.style.fontSize\n    else\n      tpc.style.fontSize = nodeObj.style.fontSize + 'px'\n    tpc.style.fontWeight = nodeObj.style.fontWeight || 'normal'\n    tpc.style.width= nodeObj.style.width || 'fit-content'\n    widthControllLeft.style.height=widthControllRight.style.height=nodeObj.style.controllWidth || '29px'\n  }\n\n  // TODO allow to add online image\n  if (nodeObj.image) {\n    const images=nodeObj.image\n    images.forEach(val=>{\n      const imgContainer = $d.createElement('img')\n      imgContainer.className='image'\n      imgContainer.src = val.url\n      imgContainer.style.width = val.width + 'px'\n      imgContainer.style.height = val.height + 'px'\n      imgContainer.style.display = 'block'\n      tpc.appendChild(imgContainer)\n    })\n  }\n  \n  if (nodeObj.hyperLink) {\n    const linkContainer =$d.createElement('a')\n    linkContainer.className = 'hyper-link'\n    linkContainer.target = '_blank'\n    // linkContainer.innerText = '🔗'\n    linkContainer.innerHTML='<svg t=\"1662346495524\" style=\"font-size:20px;margin-left: 3px\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2372\" width=\"22\" height=\"22\"><path d=\"M573.44 640a187.68 187.68 0 0 1-132.8-55.36L416 560l45.28-45.28 24.64 24.64a124.32 124.32 0 0 0 170.08 5.76l1.44-1.28a49.44 49.44 0 0 0 4-3.84l101.28-101.28a124.16 124.16 0 0 0 0-176l-1.92-1.92a124.16 124.16 0 0 0-176 0l-51.68 51.68a49.44 49.44 0 0 0-3.84 4l-20 24.96-49.92-40L480 276.32a108.16 108.16 0 0 1 8.64-9.28l51.68-51.68a188.16 188.16 0 0 1 266.72 0l1.92 1.92a188.16 188.16 0 0 1 0 266.72l-101.28 101.28a112 112 0 0 1-8.48 7.84 190.24 190.24 0 0 1-125.28 48z\" fill=\"#002fa7\" p-id=\"2373\"></path><path d=\"M350.72 864a187.36 187.36 0 0 1-133.28-55.36l-1.92-1.92a188.16 188.16 0 0 1 0-266.72l101.28-101.28a112 112 0 0 1 8.48-7.84 188.32 188.32 0 0 1 258.08 7.84L608 464l-45.28 45.28-24.64-24.64A124.32 124.32 0 0 0 368 478.88l-1.44 1.28a49.44 49.44 0 0 0-4 3.84l-101.28 101.28a124.16 124.16 0 0 0 0 176l1.92 1.92a124.16 124.16 0 0 0 176 0l51.68-51.68a49.44 49.44 0 0 0 3.84-4l20-24.96 50.08 40-20.8 25.12a108.16 108.16 0 0 1-8.64 9.28l-51.68 51.68A187.36 187.36 0 0 1 350.72 864z\" fill=\"#002fa7\" p-id=\"2374\"></path></svg>'\n    linkContainer.href = nodeObj.hyperLink\n    tpc.appendChild(linkContainer)\n  }\n  if (nodeObj.remark) {\n    const content=$d.createElement('div')\n    content.className='content hidden'\n    content.textContent=nodeObj.remark\n    const remarkContainer = $d.createElement('div')\n    remarkContainer.className = 'remark'\n    remarkContainer.innerHTML = `<svg t=\"1659682144612\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2580\" width=\"200\" height=\"200\"><path d=\"M625.728 57.472c19.264 0 34.688 6.848 48.128 20.16l208.96 207.04c14.272 13.12 21.568 29.568 21.568 49.28v504.576c0 71.808-56.256 127.744-128.576 127.744H252.16c-72.128 0-128.576-55.68-128.576-127.744V184.704c0-71.68 56.256-127.232 128.576-127.232z m-34.304 76.8H252.16c-30.144 0-51.776 21.376-51.776 50.432v653.824c0 29.44 21.888 50.944 51.776 50.944h523.648c30.016 0 51.84-21.632 51.84-50.944l-0.128-464.512H687.488A96 96 0 0 1 591.936 287.36l-0.448-9.216V134.208zM665.6 704a38.4 38.4 0 0 1 0 76.8H294.4a38.4 38.4 0 0 1 0-76.8h371.2z m0-192a38.4 38.4 0 0 1 0 76.8H294.4a38.4 38.4 0 0 1 0-76.8h371.2z m-192-192a38.4 38.4 0 1 1 0 76.8H294.4a38.4 38.4 0 1 1 0-76.8h179.2z m181.824-152.512v110.592a32 32 0 0 0 26.24 31.488l5.76 0.512h111.872L655.424 167.424z\" p-id=\"2581\"></path></svg>`\n    let delayTask\n    // 鼠标移入内容\n    content.onmouseover=()=>{\n      clearTimeout(delayTask)\n    }\n    //鼠标移入按钮\n    remarkContainer.onmouseover=()=>{\n      content.classList.remove('hidden')\n    }\n    //鼠标移出内容\n    content.onmouseleave=()=>{\n      delayTask=setTimeout(()=>{\n        if(!content.classList.contains('hidden')){\n          content.classList.add('hidden')\n        }\n      },300)\n    }\n    //鼠标移出按钮\n    remarkContainer.onmouseleave=()=>{\n      delayTask=setTimeout(()=>{\n        if(!content.classList.contains('hidden')){\n          content.classList.add('hidden')\n        }\n      },300)\n    }\n    remarkContainer.appendChild(content)\n    tpc.appendChild(remarkContainer)\n  }\n  if (nodeObj.icons) {\n    const iconsContainer = $d.createElement('span')\n    iconsContainer.className = 'icons'\n    iconsContainer.innerHTML = nodeObj.icons\n    .filter(icon=> icon!=='').map(icon => `<span>${encodeHTML(icon)}</span>`)\n      .join('')\n    tpc.appendChild(iconsContainer)\n  }\n\n  if (nodeObj.linkJump) {\n    nodeObj.linkJump.forEach(val => {\n      const button = document.createElement('a')\n      button.className=\"linkJump\"\n      button.title=val.title\n      button.innerHTML='<svg t=\"1661493526135\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2220\" width=\"16\" height=\"16\"><path d=\"M1001.175714 593.762001L700.806246 293.324796a76.091491 76.091491 0 0 0-107.566725 0 76.023754 76.023754 0 0 0 0 107.544146l171.713884 171.826779H152.653982v-115.288769a76.046333 76.046333 0 0 0-152.115245 0v152.092666c0 6.931777 2.145012 13.253918 3.951338 19.621218-1.806326 6.389879-3.951339 12.644283-3.951338 19.621218a76.068912 76.068912 0 0 0 76.046333 76.068912h686.020111L593.239521 894.131468a76.046333 76.046333 0 1 0 107.566725 107.566726L1001.175714 701.328726a76.091491 76.091491 0 0 0 0-107.566725z\" fill=\"#1296db\" p-id=\"2221\"></path></svg>'\n      button.onclick=()=>{  \n        moveToNode.call(this,val.toId)\n      }\n      tpc.appendChild(button)\n    });\n  }\n  if (nodeObj.tags) {\n    const tagsContainer = $d.createElement('div')\n    tagsContainer.className = 'tags'\n    tagsContainer.innerHTML = nodeObj.tags\n      .filter(tag=> tag!=='').map(tag => `<span>${encodeHTML(tag)}</span>`)\n      .join('')\n    tpc.appendChild(tagsContainer)\n  }\n}\n\nexport function moveToNode(id:string){\n  let toNode=this.container.querySelector(`tpc[data-nodeid=me${id}]`)\n  if(!toNode){\n    findUnExpandedParent(this.nodeData,id)\n    this.layout()\n    this.linkDiv()\n    toNode=this.container.querySelector(`tpc[data-nodeid=me${id}]`)\n  }\n  // this.container.scrollTo(\n  //   10000 - this.container.offsetWidth / 2 + getWidthFromRootToAnotherNode(this.container,toNode),\n  //   10000 - this.container.offsetHeight / 2 - getHeightFromRootToAnotherNode(this.container,toNode)\n  // )\n  toNode.scrollIntoView({block:'center',behavior:'smooth'})\n  toNode.className='blink'\n  setTimeout(() => {\n    toNode.classList.remove('blink')\n  }, 3000);\n}\n\nfunction findUnExpandedParent(node,toId){\n  if(node.id===toId){\n    return true\n  }\n  let flag=false\n  for(const val of (node.children||[])){\n    if(findUnExpandedParent(val,toId)) flag=true\n  }\n  if(flag) node.expanded=true\n  return flag\n}\n\nexport const createGroup = function(nodeObj: NodeObj, omitChildren?: boolean) {\n  const grp: Group = $d.createElement('GRP')\n  const top: Top = this.createTop(nodeObj)\n  grp.appendChild(top)\n  if (!omitChildren && nodeObj.children && nodeObj.children.length > 0) {\n    top.appendChild(createExpander(nodeObj.expanded))\n    if (nodeObj.expanded !== false) {\n      const [children,smyChild] = this.createChildren(nodeObj.children)\n      grp.appendChild(children)\n      // if(smyChild){\n      //   smyChild.forEach(val => {\n      //     grp.appendChild(val)\n      //   });\n      // }\n    }\n  }\n  return { grp, top }\n}\n\nexport const createSummary = function(nodeObj: NodeObj, omitChildren?: boolean) {\n  const smy:HTMLElement = $d.createElement('SMY')\n  const top: Top = this.createTop(nodeObj)\n  smy.appendChild(top)\n  if (!omitChildren && nodeObj.children && nodeObj.children.length > 0) {\n    top.appendChild(createExpander(nodeObj.expanded))\n    if (nodeObj.expanded !== false) {\n      const [children,smyChild] = this.createChildren(nodeObj.children)\n      // if(smyChild){\n      //   smyChild.forEach(val => {\n      //     smy.appendChild(val)\n      //   });\n      // }\n    }\n  }\n  return { smy, top }\n}\n\nexport const createTop = function(nodeObj: NodeObj): Top {\n  const top = $d.createElement('t')\n  const tpc = this.createTopic(nodeObj)\n  shapeTpc.call(this,tpc, nodeObj)\n  top.appendChild(tpc)\n  return top\n}\n\nexport const createTopic = function(nodeObj: NodeObj): Topic {\n  const topic: Topic = $d.createElement('tpc')\n  topic.nodeObj = nodeObj\n  topic.dataset.nodeid = 'me' + nodeObj.id\n  topic.draggable = this.draggable\n  return topic\n}\n\nexport function selectText(div: HTMLElement) {\n  const range = $d.createRange()\n  range.selectNodeContents(div)\n  const getSelection = window.getSelection()\n  if (getSelection) {\n    getSelection.removeAllRanges()\n    getSelection.addRange(range)\n  }\n}\n\n\nexport function createInputDiv(tpc: Topic) {\n  console.time('createInputDiv')\n  if (!tpc) return\n  let div = $d.createElement('div')\n  const origin = tpc.childNodes[0].textContent as string\n  tpc.appendChild(div)\n  div.id = 'input-box'\n  // div.innerHTML=origin.replace(/<div(([\\s\\S])*?)<\\/div>/, '').replace('🔗','')\n  div.contentEditable = 'true'\n  div.spellcheck = false\n  div.textContent = origin\n  if(tpc.nodeObj.image){\n    const images=tpc.nodeObj.image\n    images.forEach(val=>{\n      const imgContainer = $d.createElement('img')\n      imgContainer.src = val.url\n      imgContainer.style.width = val.width + 'px'\n      imgContainer.style.display = 'block'\n      div.appendChild(imgContainer)\n    })\n  }\n  div.style.cssText = `min-width:${tpc.offsetWidth - 22}px;min-height:${tpc.clientHeight-16}px`\n  if(tpc.nodeObj?.style?.width){\n    div.style.width='auto'\n  }\n  if(tpc.nodeObj?.style?.color==='#ffffff'||(tpc.nodeObj?.id==='root'&&!tpc.nodeObj?.style?.color)){\n    div.style.color='#2c3e50'\n  }\n  if (this.direction === LEFT) div.style.right = '0'\n  div.focus()\n  selectText(div)\n  this.inputDiv = div\n\n  this.bus.fire('operation', {\n    name: 'beginEdit',\n    obj: tpc.nodeObj,\n  })\n\n  div.addEventListener('keydown', e => {\n    e.stopPropagation()\n    const key = e.key\n    // console.log(e, key)\n    if (key === 'Enter' || key === 'Tab') {\n      // keep wrap for shift enter\n      if (e.shiftKey) return\n\n      e.preventDefault()\n      this.inputDiv.blur()\n      this.map.focus()\n    }\n  })\n  div.addEventListener('blur', () => {\n    if (!div) return // 防止重复blur\n    const node = tpc.nodeObj\n    const topic = div.textContent!.trim()\n    //添加图片支持\n    //去除节点缩放鼠标移动的监听\n    node.image=[]\n    div.childNodes.forEach((val)=>{\n      if(val.nodeName==='IMG'){\n          // console.log('宽度  ',div.clientWidth)\n          node.image.push({\n            url:(val as HTMLImageElement).src,\n            width:(val as HTMLImageElement).width,\n            height:(val as HTMLImageElement).height,\n          })\n      }\n    })\n    if (topic === '' && node.image.length===0) node.topic = origin\n    else node.topic = topic\n    div.remove()\n    this.inputDiv = div = null\n    // TODO 优化\n    if (topic === origin && node.image.length===0) return // 没有修改不做处理\n    tpc.childNodes[0].textContent = node.topic\n    //更新宽度控制条的高度\n    const widthControllLeft=tpc.querySelector('widthControllRight') as HTMLElement\n    const widthControllRight=tpc.querySelector('widthControllRight') as HTMLElement\n    if(!node.style) node.style={}\n    node.style.controllWidth=widthControllLeft.style.height=widthControllRight.style.height=tpc.clientHeight.toString()+'px'\n    //记录节点宽度\n    // node.style.width=tpc.clientWidth-Number(getComputedStyle(tpc).paddingLeft.replace('px',''))-Number(getComputedStyle(tpc).paddingRight.replace('px',''))+1+'px'\n    delete node.style.width\n\n    this.shapeTpc(tpc,node)\n    this.linkDiv()\n    //时间分片，待优化\n    updateLinkJumpTitle.call(this,this.nodeData,node.id,node.topic)\n    this.bus.fire('operation', {\n      name: 'finishEdit',\n      obj: node,\n      origin,\n    })\n  })\n  console.timeEnd('createInputDiv')\n}\n\n\nfunction updateLinkJumpTitle(node:NodeObj,id,topic){\n  node?.linkJump?.forEach(({toId},index)=>{\n    if(toId===id){\n      node.linkJump[index].title=topic\n      const button=this.container.querySelector(`tpc[data-nodeid=me${node.id}] .linkJump`)\n      button.title=topic\n    }\n  })\n  for(const val of (node.children||[])){\n    updateLinkJumpTitle.call(this,val,id,topic)\n  }\n}\n\nexport const createExpander = function(expanded: boolean | undefined): Expander {\n  const expander: Expander = $d.createElement('epd')\n  // 包含未定义 expanded 的情况，未定义视为展开\n  expander.innerText = expanded !== false ? '-' : '+'\n  expander.expanded = expanded !== false\n  expander.className = expanded !== false ? 'minus' : ''\n  return expander\n}\n\n/**\n * traversal data and generate dom structure of mind map\n * @ignore\n * @param {object} data node data object\n * @param {object} container node container(mostly primary node)\n * @param {number} direction primary node direction\n * @return {ChildrenElement} children element.\n */\nexport function createChildren(data: NodeObj[], container?: HTMLElement, direction?) {\n  let chldr: HTMLElement\n  if (container) {\n    chldr = container\n  } else {\n    chldr = $d.createElement('children')\n  }\n  let smyEle=[]\n  for (let i = 0; i < data.length; i++) {\n    const nodeObj = data[i]\n    if(nodeObj?.type==='summary'){\n      const {smy} =this.createSummary(nodeObj)\n      if (nodeObj.children && nodeObj.children.length > 0) {\n        if(nodeObj.expanded !== false){\n          const [children,smyChild]= this.createChildren(nodeObj.children)\n          smy.appendChild(children)\n          if(smyChild){\n            smyChild.forEach(val => {\n              smy.appendChild(val)\n          });\n        }\n        }\n        \n      }\n      smyEle.push(smy)\n      continue\n    }\n    const grp = $d.createElement('GRP')\n    if (direction === LEFT) {\n      grp.className = 'lhs'\n    } else if (direction === RIGHT) {\n      grp.className = 'rhs'\n    } else if (direction === SIDE) {\n      if (nodeObj.direction === LEFT) {\n        grp.className = 'lhs'\n      } else if (nodeObj.direction === RIGHT) {\n        grp.className = 'rhs'\n      }\n    }\n    const top = this.createTop(nodeObj)\n    if (nodeObj.children && nodeObj.children.length > 0) {\n      top.appendChild(createExpander(nodeObj.expanded))\n      grp.appendChild(top)\n      if (nodeObj.expanded !== false) {\n        const [children,smy] = this.createChildren(nodeObj.children)\n        grp.appendChild(children)\n        if(smy){\n          smy.forEach(val => {\n            if(!grp.children?.[2]){\n              grp.appendChild($d.createElement('smychildren'))\n            }\n            grp.children[2].appendChild(val)\n          });\n        }\n      }\n    } else {\n      grp.appendChild(top)\n    }\n    chldr.appendChild(grp)\n  }\n  return [chldr,smyEle]    \n}\n\n// Set primary nodes' direction and invoke createChildren()\nexport function layout() {\n  console.time('layout')\n  this.root.innerHTML = ''\n  this.box.innerHTML = ''\n  const tpc = this.createTopic(this.nodeData)\n  shapeTpc.call(this,tpc, this.nodeData) // shape root tpc\n  tpc.draggable = false\n  this.root.appendChild(tpc)\n\n  const primaryNodes: NodeObj[] = this.nodeData.children\n  if (!primaryNodes || primaryNodes.length === 0) return\n  if (this.direction === SIDE) {\n    // initiate direction of primary nodes\n    let lcount = 0\n    let rcount = 0\n    primaryNodes.map(node => {\n      if (node.direction === undefined) {\n        if (lcount <= rcount) {\n          node.direction = LEFT\n          lcount += 1\n        } else {\n          node.direction = RIGHT\n          rcount += 1\n        }\n      } else {\n        if (node.direction === LEFT) {\n          lcount += 1\n        } else {\n          rcount += 1\n        }\n      }\n    })\n  }\n  this.createChildren(this.nodeData.children, this.box, this.direction)\n  console.timeEnd('layout')\n}\n","const $d = document\nconst svgNS = 'http://www.w3.org/2000/svg'\nexport const createMainPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', '#555')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-width', '1')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  return path\n}\n\nexport const createLinkSvg = function(klass: string) {\n  const svg = $d.createElementNS(svgNS, 'svg')\n  svg.setAttribute('class', klass)\n  return svg\n}\n\nexport const createSvgPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('stroke', '#F6A04D')\n  path.setAttribute('stroke-width', '3')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  return path\n}\n\nexport const createLine = function(x1: number, y1: number, x2: number, y2: number) {\n  const line = $d.createElementNS(svgNS, 'line')\n  line.setAttribute('x1', x1.toString())\n  line.setAttribute('y1', y1.toString())\n  line.setAttribute('x2', x2.toString())\n  line.setAttribute('y2', y2.toString())\n  line.setAttribute('stroke', '#bbb')\n  line.setAttribute('fill', 'none')\n  line.setAttribute('stroke-width', '2')\n  return line\n}\n\nexport const createPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', '#555')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('stroke-width', '1')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  // adding translate(0.5,-0.5) can fix render error on windows, but i still dunno why\n  return path\n}\n\nexport const createWidthControll = function(d: string) {\n  const g = $d.createElementNS(svgNS, 'g')\n  const left =$d.createElementNS(svgNS, 'rect')\n  const right =$d.createElementNS(svgNS, 'rect')\n  left.setAttribute('width','7')\n  left.setAttribute('height','30')\n  left.setAttribute('opacity','0')\n  left.setAttribute('style','cursor: ew-resize;')\n  left.setAttribute('x','22')\n  g.appendChild(right)\n  g.appendChild(left)\n  // adding translate(0.5,-0.5) can fix render error on windows, but i still dunno why\n  return g\n}\ninterface CustomSvg extends SVGElement{\n  linkObj?:object\n}\nexport const createSvgGroup = function(d: string, arrowd: string):CustomSvg {\n  const g = $d.createElementNS(svgNS, 'g')\n  const path = $d.createElementNS(svgNS, 'path')\n  const arrow = $d.createElementNS(svgNS, 'path')\n  arrow.setAttribute('d', arrowd)\n  arrow.setAttribute('stroke', 'rgb(235, 95, 82)')\n  arrow.setAttribute('fill', 'none')\n  arrow.setAttribute('stroke-linecap', 'cap')\n  arrow.setAttribute('stroke-width', '2')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', 'rgb(235, 95, 82)')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'cap')\n  path.setAttribute('stroke-width', '2')\n\n  g.appendChild(path)\n  g.appendChild(arrow)\n  return g\n}\n","import { Canvg } from 'canvg';\nlet $d = document\nlet maxTop = 10000\nlet maxBottom = 10000\nlet maxLeft = 10000\nlet maxRight = 10000\nlet imgPadding = 40\nlet head = `<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">`\n\nfunction init(){\n  maxTop = 10000\n  maxBottom = 10000\n  maxLeft = 10000\n  maxRight = 10000\n  imgPadding = 40\n}\n\nfunction generateSvgDom() {\n  init()\n  let primaryNodes = $d.querySelectorAll('.mindbox > grp, root')\n  let svgContent = ''\n  for (let i = 0; i < primaryNodes.length; i++) {\n    let primaryNode = primaryNodes[i]\n    let rect = primaryNode.getBoundingClientRect()\n    let top = primaryNode.offsetTop\n    let bottom = top + rect.height\n    let left = primaryNode.offsetLeft\n    let right = left + rect.width\n    // console.log(top, bottom, left, right)\n    if (top < maxTop) {\n      maxTop = top\n    }\n    if (bottom > maxBottom) {\n      maxBottom = bottom\n    }\n    if (left < maxLeft) {\n      maxLeft = left\n    }\n    if (right > maxRight) {\n      maxRight = right\n    }\n    svgContent += PrimaryToSvg(primaryNode)\n  }\n  console.log(maxTop, maxBottom, maxLeft, maxRight)\n  svgContent += RootToSvg()\n  // 需要添加图片边缘padding\n  let svgHeight = maxBottom - maxTop + imgPadding * 2\n  let svgWidth = maxRight - maxLeft + imgPadding * 2\n  let svgFile = createSvg(svgHeight, svgWidth)\n  svgContent =\n    `<rect x=\"0\" y=\"0\" width=\"${svgWidth}\" height=\"${svgHeight}\" fill=\"#f6f6f6\"></rect>` +\n    svgContent\n  svgFile.innerHTML = svgContent\n  // document.body.append(svgFile)\n  return svgFile\n}\n\nexport function getHeightAndWidth() {\n  $d=this.container\n  init()\n  let primaryNodes = $d.querySelectorAll('.mindbox > grp, root')\n  let svgContent = ''\n  for (let i = 0; i < primaryNodes.length; i++) {\n    let primaryNode = primaryNodes[i]\n    let rect = primaryNode.getBoundingClientRect()\n    let top = primaryNode.offsetTop\n    let bottom = top + rect.height\n    let left = primaryNode.offsetLeft\n    let right = left + rect.width\n    // console.log(top, bottom, left, right)\n    if (top < maxTop) {\n      maxTop = top\n    }\n    if (bottom > maxBottom) {\n      maxBottom = bottom\n    }\n    if (left < maxLeft) {\n      maxLeft = left\n    }\n    if (right > maxRight) {\n      maxRight = right\n    }\n    svgContent += PrimaryToSvg(primaryNode)\n  }\n  console.log(maxTop, maxBottom, maxLeft, maxRight)\n  let svgHeight = maxBottom - maxTop\n  let svgWidth = maxRight - maxLeft\n  console.log('svgHeight',svgHeight)\n  return [svgHeight+5,svgWidth+5]\n}\n\nfunction createSvg(height, width) {\n  let svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n  svg.setAttribute('height', height)\n  svg.setAttribute('width', width)\n  svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg')\n  svg.setAttribute('version', '1.2')\n  svg.setAttribute('xlink', 'http://www.w3.org/1999/xlink')\n  return svg\n}\n\nfunction RootToSvg() {\n  let root = document.querySelector('root')\n  let rootTpc = document.querySelector('root > tpc')\n  let rect = rootTpc.getBoundingClientRect()\n  let tpcStyle = getComputedStyle(rootTpc)\n  let t = rootTpc.parentNode\n  let top = 0\n  let left = 0\n  let nodeObj = document.querySelector('root > tpc').nodeObj\n  let tStyle = getComputedStyle(t)\n  let rootOffsetY = root.offsetTop - maxTop\n  let rootOffsetX = root.offsetLeft - maxLeft\n  let topicOffsetLeft =\n  left + parseInt(tStyle.paddingLeft) + parseInt(rect.paddingLeft)\n  let topicOffsetTop =\n  top +\n  parseInt(tStyle.paddingTop) +\n  parseInt(rect.paddingTop) +\n  parseInt(rect.fontSize)\n  let topicOffsetTopTop =\n  top +\n  parseInt(tStyle.paddingTop) +\n  parseInt(rect.paddingTop)\n  let svg2ndEle = document.querySelector('.svg2nd')\n\n  // render tags\n  let tags = ''\n  if (nodeObj.tags && nodeObj.tags.length) {\n    let tagsEle = rootTpc.querySelectorAll('.tags > span')\n    for (let i = 0; i < tagsEle.length; i++) {\n      let tag = tagsEle[i]\n      let tagRect = tag.getBoundingClientRect()\n      tags += `<rect x=\"${topicOffsetLeft}\" y=\"${\n        topicOffsetTop + 4\n        }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n        tagRect.height\n        }\" style=\"fill: #d6f0f8;\"></rect>\n        <foreignObject x=\"${topicOffsetLeft}\" y=\"${\n          topicOffsetTop + 4\n          }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n          tagRect.height\n          }\" > \n          <div sytle=\"font-size:12px\">${tag.innerHTML}</div>\n        </foreignObject>\n      `\n    }\n  }\n  let icons = ''\n  if (nodeObj.icons && nodeObj.icons.length) {\n    let iconsEle = rootTpc.querySelectorAll('.icons > span')\n    for (let i = 0; i < iconsEle.length; i++) {\n      let icon = iconsEle[i]\n      let iconRect = icon.getBoundingClientRect()\n      icons += `\n      <tspan>${icon.innerHTML}</tspan>`\n    }\n  }\n  //render images\n  let images = ''\n  if (nodeObj.image && nodeObj.image.length) {\n    let imagesEle = tpc.querySelectorAll('.image')\n    for (let i = 0; i < imagesEle.length; i++) {\n      let image = imagesEle[i]\n      let imageRect = image.getBoundingClientRect()\n      images += `${image.outerHTML}`\n    }\n  }\n\n  let svg2nd = `<g transform=\"translate(${imgPadding - maxLeft}, ${\n    imgPadding - maxTop\n    })\">${svg2ndEle.innerHTML}</g>`\n  // return (\n    svg2nd +=\n    `<g id=\"root\" transform=\"translate(${rootOffsetX + imgPadding}, ${\n    rootOffsetY + imgPadding\n    })\">\n      <rect x=\"${left}\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${\n    rect.width\n    }\" height=\"${rect.height}\" style=\"fill: #00aaff;\"></rect>\n      <foreignObject x=\"${left + 15}\" y=\"${\n        top + 10\n        }\" width=\"${tpcStyle.width}\" height=\"${tpcStyle.height}\" \">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"padding:0;margin:0;font-family:微软雅黑;font-size:${tpcStyle.fontSize};font-weight:${tpcStyle.fontWeight};color:${tpcStyle.color};word-break: break-all;line-height: 1\">\n        ${nodeObj.topic}\n        ${icons}\n        ${images}\n      </div>\n      </foreignObject>\n      ${tags}\n  </g>`\n  // )\n  let topiclinks=$d.querySelector('.topiclinks')\n  if(topiclinks){\n    svg2nd+=`<g transform=\"translate(${imgPadding - maxLeft}, ${\n      imgPadding - maxTop\n    })\">${topiclinks.innerHTML}</g>`\n  }\n  return svg2nd\n}\n\nfunction PrimaryToSvg(primaryNode) {\n  let topics = primaryNode.querySelectorAll('tpc')\n  let primaryNodeOffsetY = primaryNode.offsetTop - maxTop\n  let primaryNodeOffsetX = primaryNode.offsetLeft - maxLeft\n\n  let svg = ''\n  let svg3rd = primaryNode.querySelector('.svg3rd')\n  svg += `<g transform=\"translate(${primaryNodeOffsetX + imgPadding}, ${\n    primaryNodeOffsetY + imgPadding\n    })\">`\n  svg += svg3rd ? svg3rd.innerHTML : ''\n  for (let i = 0; i < topics.length; i++) {\n    let tpc = topics[i]\n    let t = tpc.parentNode\n    let nodeObj = tpc.nodeObj\n    if (nodeObj.root) { continue }\n    let tpcRect = tpc.getBoundingClientRect()\n    let top = t.offsetTop\n    let left = t.offsetLeft\n    let tpcStyle = getComputedStyle(tpc)\n    let tStyle = getComputedStyle(t)\n    let topicOffsetLeft =\n      left + parseInt(tStyle.paddingLeft) + parseInt(tpcStyle.paddingLeft)\n    let topicOffsetTop =\n      top +\n      parseInt(tStyle.paddingTop) +\n      parseInt(tpcStyle.paddingTop) +\n      parseInt(tpcStyle.fontSize)\n    let topicOffsetTopTop =\n      top +\n      parseInt(tStyle.paddingTop) +\n      parseInt(tpcStyle.paddingTop)\n    // style render\n    let border = ''\n    if (tpcStyle.borderWidth != '0px') {\n      border = `<rect x=\"${left + 15}\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${\n        tpcRect.width\n        }\" height=\"${\n        tpcRect.height\n        }\" style=\"fill: rgba(0,0,0,0); stroke:#444;stroke-width:1px;\"></rect>`\n    }\n    let backgroundColor = ''\n    if (tpcStyle.backgroundColor != 'rgba(0, 0, 0, 0)') {\n      backgroundColor = `<rect x=\"${\n        left + 15\n        }\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${tpcRect.width}\" height=\"${\n        tpcRect.height\n        }\" style=\"fill: ${tpcStyle.backgroundColor};\"></rect>`\n    }\n    // render tags\n    let tags = ''\n    if (nodeObj.tags && nodeObj.tags.length) {\n      let tagsEle = tpc.querySelectorAll('.tags > span')\n      for (let i = 0; i < tagsEle.length; i++) {\n        let tag = tagsEle[i]\n        let tagRect = tag.getBoundingClientRect()\n        tags += `<rect x=\"${topicOffsetLeft}\" y=\"${\n          topicOffsetTop + 4\n          }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n          tagRect.height\n          }\" style=\"fill: #d6f0f8;\"></rect>\n          <foreignObject x=\"${topicOffsetLeft}\" y=\"${\n            topicOffsetTop + 4\n            }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n            tagRect.height\n            }\" > \n            <div sytle=\"font-size:12px\">${tag.innerHTML}</div>\n          </foreignObject>`\n      }\n    }\n    let icons = ''\n    if (nodeObj.icons && nodeObj.icons.length) {\n      let iconsEle = tpc.querySelectorAll('.icons > span')\n      for (let i = 0; i < iconsEle.length; i++) {\n        let icon = iconsEle[i]\n        let iconRect = icon.getBoundingClientRect()\n        icons += `\n        <tspan>${icon.innerHTML}</tspan>`\n      }\n    }\n      //render images\n    let images = ''\n    if (nodeObj.image && nodeObj.image.length) {\n      let imagesEle = tpc.querySelectorAll('.image')\n      for (let i = 0; i < imagesEle.length; i++) {\n        let image = imagesEle[i]\n        let imageRect = image.getBoundingClientRect()\n        images += `${image.outerHTML}`\n      }\n    }\n    // render every single node\n    svg += `<g id=\"${nodeObj.id}\">\n      ${border}\n      ${backgroundColor}\n      <foreignObject  x=\"${topicOffsetLeft}\" y=\"${topicOffsetTopTop}\" width=\"${tpcStyle.width}\" height=\"${tpcStyle.height}\">\n      <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"padding:0;margin:0;font-family:微软雅黑;font-size:${tpcStyle.fontSize};font-weight:${tpcStyle.fontWeight};color:${tpcStyle.color};word-break: break-all;line-height: 1\">\n        ${nodeObj.topic}\n        ${icons}\n        ${images}\n      </div>\n      </foreignObject>\n      ${tags}\n  </g>`\n  }\n  svg += '</g>'\n  return svg\n}\n\nexport let exportSvg = function () {\n  let svgFile = generateSvgDom()\n  let dlUrl = URL.createObjectURL(\n    new Blob([head + svgFile.outerHTML.replace(/&nbsp;/g, ' ')])\n  )\n  let a = document.createElement('a')\n  a.href = dlUrl\n  a.download = 'me-mindmap.svg'\n  a.click()\n}\n\nexport let exportSvgDom = function (instance=this, fileName='default') {\n  // if (!instance) throw new Error('Mind-elixir instance is not presented. ---> exportSvg(instance, fileName)') \n  // initVar()\n  $d = instance.container\n  let svgFile = generateSvgDom()\n  return svgFile\n}\n\nexport let exportPng = async function () {\n  let svgFile = generateSvgDom()\n  const canvas = document.createElement('canvas')\n  canvas.style.display = 'none'\n  const ctx = canvas.getContext('2d')\n  // Canvg do not support foreignObject\n  let v = await Canvg.fromString(\n    ctx,\n    head + svgFile.outerHTML.replace(/&nbsp;/g, ' ')\n  )\n  v.start()\n  let imgURL = canvas.toDataURL('image/png')\n  let a = document.createElement('a')\n  a.href = imgURL\n  a.download = 'me-mindmap.png'\n  a.click()\n}\n\n\nexport default {\n  exportSvg, exportPng\n}","import { node } from 'canvg/dist/presets'\nimport { MindElixirInstance, NodeObj } from '.'\nimport { getHeightAndWidth } from '../painter/index.foreignObject'\nimport { MindElixirData } from './index.lite'\nimport { findEle } from './utils/dom'\n/**\n * @exports -\n * workaround for jsdoc\n */\n/**\n * @exports MapInteraction\n * @namespace MapInteraction\n */\nfunction getData(instance) {\n  return instance.isFocusMode ? instance.nodeDataBackup : instance.nodeData\n}\n\ninterface ISummaryNode{\n  NodeObj\n}\n/**\n * @function\n * @instance\n * @name selectNode\n * @memberof MapInteraction\n * @description Select a node and add solid border to it.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n */\nexport const selectNode = function(targetElement, isNewNode, clickEvent) {\n  if (!targetElement) return\n  console.time('selectNode')\n  if (typeof targetElement === 'string') {\n    return this.selectNode(findEle(targetElement))\n  }\n  // if ((this.currentNode&&!this.ctrlRepeat)||this.currentNode?.nodeObj.id===targetElement?.nodeObj.id) this.currentNode.className = ''\n  // else targetElement.className = 'selected'\\\n  if(this.ctrlRepeat){\n    // let flag=false\n    // this.currentSummaryNodeArr=this.currentSummaryNodeArr??[]\n    // this.currentSummaryNodeArr=this.currentSummaryNodeArr.filter(node=>{\n    //   if(node.nodeObj.id===targetElement.nodeObj.id){\n    //     flag=true\n    //     return false\n    //   }else{\n    //     return true\n    //   }\n    // })\n    // if(!flag){\n    //   this.currentSummaryNodeArr.push(targetElement)\n    //   targetElement.className='selected'\n    // }else{\n    //   targetElement.className=''\n    // }\n    if(targetElement.className==='selected'){\n      targetElement.className=''\n    }else{\n      targetElement.className='selected'\n    }\n    console.log(this.currentSummaryNodeArr)\n  }else{\n    // this.currentSummaryNodeArr=[targetElement]\n    if (this.currentNode) this.currentNode.className = ''\n    targetElement.className = 'selected'\n  }\n  if(this?.widthControll){\n    const widthControllRight=targetElement.querySelector('widthControllRight')\n    widthControllRight.className='width-controll-right'\n    const widthControllLeft=targetElement.querySelector('widthControllLeft')\n    widthControllLeft.className='width-controll-left'\n  }\n  this.currentNode = targetElement\n  if (isNewNode) {\n    this.bus.fire('selectNewNode', targetElement.nodeObj, clickEvent)\n  } else {\n    this.bus.fire('selectNode', targetElement.nodeObj, clickEvent)\n  }\n  console.timeEnd('selectNode')\n}\nexport const unselectNode = function() {\n  if (this.currentNode) {\n    this.currentNode.className = ''\n    if(this.widthControll){\n      const widthControllRight=this.currentNode.querySelector('widthControllRight')\n      widthControllRight.className=''\n      const widthControllLeft=this.currentNode.querySelector('widthControllLeft')\n      widthControllLeft.className=''\n    }\n  }\n  this.currentNode = null\n  this.bus.fire('unselectNode')\n}\nexport const selectNextSibling = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const sibling = this.currentNode.parentElement.parentElement.nextSibling\n  let target: HTMLElement\n  const grp = this.currentNode.parentElement.parentElement\n  if (grp.className === 'rhs' || grp.className === 'lhs') {\n    const siblingList = this.mindElixirBox.querySelectorAll('.' + grp.className)\n    const i = Array.from(siblingList).indexOf(grp)\n    if (i + 1 < siblingList.length) {\n      target = siblingList[i + 1].firstChild.firstChild\n    } else {\n      return false\n    }\n  } else if (sibling) {\n    target = sibling.firstChild.firstChild\n  } else {\n    return false\n  }\n  this.selectNode(target)\n  return true\n}\nexport const selectPrevSibling = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const sibling = this.currentNode.parentElement.parentElement.previousSibling\n  let target\n  const grp = this.currentNode.parentElement.parentElement\n  if (grp.className === 'rhs' || grp.className === 'lhs') {\n    const siblingList = this.mindElixirBox.querySelectorAll('.' + grp.className)\n    const i = Array.from(siblingList).indexOf(grp)\n    if (i - 1 >= 0) {\n      target = siblingList[i - 1].firstChild.firstChild\n    } else {\n      return false\n    }\n  } else if (sibling) {\n    target = sibling.firstChild.firstChild\n  } else {\n    return false\n  }\n  this.selectNode(target)\n  return true\n}\nexport const selectFirstChild = function() {\n  if (!this.currentNode) return\n  const children = this.currentNode.parentElement.nextSibling\n  if (children && children.firstChild) {\n    const target = children.firstChild.firstChild.firstChild\n    this.selectNode(target)\n  }\n}\nexport const selectParent = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const parent = this.currentNode.parentElement.parentElement.parentElement\n    .previousSibling\n  if (parent) {\n    const target = parent.firstChild\n    this.selectNode(target)\n  }\n}\n/**\n * @function\n * @instance\n * @name getAllDataString\n * @description Get all node data as string.\n * @memberof MapInteraction\n * @return {string}\n */\nexport const getAllDataString = function() {\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n  }\n  return JSON.stringify(data, (k, v) => {\n    if (k === 'parent') return undefined\n    if (k === 'from') return v.nodeObj.id\n    if (k === 'to') return v.nodeObj.id\n    return v\n  })\n}\n/**\n * @function\n * @instance\n * @name getAllData\n * @description Get all node data as object.\n * @memberof MapInteraction\n * @return {Object}\n */\nexport const getAllData = function(): object {\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n  }\n  return JSON.parse(\n    JSON.stringify(data, (k, v) => {\n      if (k === 'parent') return undefined\n      if (k === 'from') return v.nodeObj.id\n      if (k === 'to') return v.nodeObj.id\n      return v\n    })\n  )\n}\n\n/**\n * @function\n * @instance\n * @name getAllDataWithAutoHide\n * @description Get all the data of automatically hidden third-level nodes\n * @memberof MapInteraction\n * @return {Object}\n */\n\nexport function autoHide(nodeData:NodeObj,cnt,deep){\n  if(cnt<deep){\n    nodeData.expanded=true\n  }else{\n    nodeData.expanded=false\n  }\n  for(const val of (nodeData.children||[])){\n    autoHide(val,cnt+1,deep)\n  }\n}\ntype data = {\n  [key: string]: any;\n  nodeData: string;\n};\n\nexport const getAllDataWithAutoHide = function(): data {\n  const expandDeep=Number(this.container.querySelector('.numberSelection').value)||2\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n    height:getHeightAndWidth.call(this),\n    expandDeep\n  }\n  autoHide(data.nodeData,0,expandDeep)\n  return JSON.parse(\n    JSON.stringify(data, (k, v) => {\n      if (k === 'parent') return undefined\n      if (k === 'from') return v.nodeObj.id\n      if (k === 'to') return v.nodeObj.id\n      return v\n    })\n  )\n}\n\n/**\n * @function\n * @instance\n * @name getAllDataMd\n * @description Get all node data as markdown.\n * @memberof MapInteraction\n * @return {String}\n */\nexport const getAllDataMd = function():string {\n  const data = getData(this)\n  let mdString = '# ' + data.topic + '\\n\\n'\n  function writeMd(children, deep) {\n    for (let i = 0; i < children.length; i++) {\n      if (deep <= 6) {\n        mdString += ''.padStart(deep, '#') + ' ' + children[i].topic + '\\n\\n'\n      } else {\n        mdString +=\n          ''.padStart(deep - 7, '\\t') + '- ' + children[i].topic + '\\n'\n      }\n      if (children[i].children) {\n        writeMd(children[i].children, deep + 1)\n      }\n    }\n  }\n  writeMd(data.children, 2)\n  return mdString\n}\n\n/**\n * @function\n * @instance\n * @name enableEdit\n * @memberof MapInteraction\n */\nexport const enableEdit = function() {\n  this.editable = true\n}\n\n/**\n * @function\n * @instance\n * @name disableEdit\n * @memberof MapInteraction\n */\nexport const disableEdit = function() {\n  this.editable = false\n}\n\n/**\n * @function\n * @instance\n * @name scale\n * @description Change the scale of the mind map.\n * @memberof MapInteraction\n * @param {number}\n */\nexport const scale = function(scaleVal) {\n  this.scaleVal = scaleVal\n  this.map.style.transform = 'scale(' + scaleVal + ')'\n}\n\nfunction getRootWidth(node:HTMLElement){\n  const root=node.querySelector('root')as HTMLElement\n  return root.offsetWidth||150\n}\nfunction getRootHeight(node:HTMLElement){\n  const root=node.querySelector('root')as HTMLElement\n  return root.offsetHeight||150\n}\n\nfunction getHeightDistance(a:HTMLElement,b:HTMLElement){\n  const aHeight=a?.getBoundingClientRect()?.top||0\n  const bHeight=b?.getBoundingClientRect()?.top||aHeight\n  return Math.abs(aHeight-bHeight)\n}\n\nfunction getWidthDistance(a:HTMLElement,b:HTMLElement){\n  const aWidth=a?.getBoundingClientRect()?.left||0\n  const bWidth=b?.getBoundingClientRect()?.left||aWidth\n  return Math.abs(aWidth-bWidth)\n}\n\nexport function getHeightFromRootToAnotherNode(node:HTMLElement,anotherNode:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  return getHeightDistance(tpc,anotherNode)\n}\n\nexport function getWidthFromRootToAnotherNode(node:HTMLElement,anotherNode:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  return getWidthDistance(tpc,anotherNode)\n}\n\nfunction getHeightFromRootToChild(node:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  const childTpc=node.querySelector('.map-canvas children grp')as HTMLElement\n  return getHeightDistance(tpc,childTpc)\n}\n/**\n * @function\n * @instance\n * @name toCenter\n * @description Reset position of the map to center.\n * @memberof MapInteraction\n */\nexport const toCenter = function() {\n  this.container.scrollTo(\n    10000 - this.container.offsetWidth / 2,\n    10000 - this.container.offsetHeight / 2\n  )\n}\n\n/**\n * @function\n * @instance\n * @name toCenter\n * @description Reset position of the map to top left.\n * @memberof MapInteraction\n */\n export const toTopLeft = function() {\n  if(this.nodeData?.children.length>0){\n    this.container.scrollTo(\n      10000 - getRootWidth(this.container)/2-10,\n      10000 - getRootHeight(this.container)/2-getHeightFromRootToChild(this.container)-5\n    )\n  }else{\n    this.container.scrollTo(\n      10000 - this.container.offsetWidth / 2,\n      10000 - this.container.offsetHeight / 2\n    )\n  }\n  \n}\n\nexport const install = function(plugin) {\n  plugin(this)\n}\n/**\n * @function\n * @instance\n * @name focusNode\n * @description Enter focus mode, set the target element as root.\n * @memberof MapInteraction\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n */\nexport const focusNode = function(tpcEl) {\n  if (tpcEl.nodeObj.root) return\n  if (this.tempDirection === null) {\n    this.tempDirection = this.direction\n  }\n  if (!this.isFocusMode) {\n    this.nodeDataBackup = this.nodeData // help reset focus mode\n    this.isFocusMode = true\n  }\n  this.nodeData = tpcEl.nodeObj\n  this.nodeData.root = true\n  this.initRight()\n}\n/**\n * @function\n * @instance\n * @name cancelFocus\n * @description Exit focus mode.\n * @memberof MapInteraction\n */\nexport const cancelFocus = function() {\n  this.isFocusMode = false\n  if (this.tempDirection !== null) {\n    delete this.nodeData.root\n    this.nodeData = this.nodeDataBackup\n    this.direction = this.tempDirection\n    this.tempDirection = null\n    this.init()\n  }\n}\n/**\n * @function\n * @instance\n * @name initLeft\n * @description Child nodes will distribute on the left side of the root node.\n * @memberof MapInteraction\n */\nexport const initLeft = function() {\n  this.direction = 0\n  this.init()\n}\n/**\n * @function\n * @instance\n * @name initRight\n * @description Child nodes will distribute on the right side of the root node.\n * @memberof MapInteraction\n */\nexport const initRight = function() {\n  this.direction = 1\n  this.init()\n}\n/**\n * @function\n * @instance\n * @name initSide\n * @description Child nodes will distribute on both left and right side of the root node.\n * @memberof MapInteraction\n */\nexport const initSide = function() {\n  this.direction = 2\n  this.init()\n}\n\n/**\n * @function\n * @instance\n * @name setLocale\n * @memberof MapInteraction\n */\nexport const setLocale = function(locale) {\n  this.locale = locale\n  this.init()\n}\n\nexport const expandNode = function(el, isExpand) {\n  const node = el.nodeObj\n  if (typeof isExpand === 'boolean') {\n    node.expanded = isExpand\n  } else if (node.expanded !== false) {\n    node.expanded = false\n  } else {\n    node.expanded = true\n    expandNodeChild(node)\n  }\n  // TODO 在此函数构造 html 结构，而非调用 layout\n  this.layout()\n  // linkDiv 已实现只更新特定主节点\n  this.linkDiv()\n  this.bus.fire('expandNode', node)\n}\n\n/**\n * @function\n * @instance\n * @name refresh\n * @description Refresh mind map, you can use it after modified `this.nodeData`\n * @memberof MapInteraction\n */\nexport const refresh = function() {\n  // add parent property to every node\n  this.addParentLink(this.nodeData)\n  // create dom element for every node\n  this.layout()\n  // generate links between nodes\n  this.linkDiv()\n}\n\n/**\n * 一键展开子主题\n * @param nodeData \n */\n export function expandNodeChild(nodeData:NodeObj){\n  nodeData.expanded=true\n  for(const val of (nodeData.children||[])){\n    expandNodeChild(val)\n  }\n}","import type { NodeElement, NodeObj } from './index'\n\nimport {\n  moveNodeObj,\n  removeNodeObj,\n  insertNodeObj,\n  insertBeforeNodeObj,\n  insertParentNodeObj,\n  checkMoveValid,\n  addParentLink,\n  moveUpObj,\n  moveDownObj,\n  moveNodeBeforeObj,\n  moveNodeAfterObj,\n  refreshIds,\n} from './utils/index'\nimport { findEle, createExpander, shapeTpc } from './utils/dom'\nimport { rgbHex } from './utils/index'\nimport { LEFT, RIGHT, SIDE } from './const'\nconst $d = document\n\n/**\n * @exports NodeOperation\n * @namespace NodeOperation\n */\nexport const updateNodeStyle = function(object) {\n  if (!object.style) return\n  const nodeEle = findEle(object.id, this)\n  const origin = {\n    color: nodeEle.style.color && rgbHex(nodeEle.style.color),\n    background: nodeEle.style.background && rgbHex(nodeEle.style.background),\n    fontSize: nodeEle.style.fontSize && nodeEle.style.fontSize + 'px',\n    fontWeight: nodeEle.style.fontWeight,\n  }\n  nodeEle.style.color = object.style.color\n  nodeEle.style.background = object.style.background\n  nodeEle.style.fontSize = object.style.fontSize + 'px'\n  nodeEle.style.fontWeight = object.style.fontWeight || 'normal'\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editStyle',\n    obj: object,\n    origin,\n  })\n}\n\nexport const updateNodeTags = function(object, tags) {\n  if (!tags) return\n  const oldVal = object.tags\n  if(tags.length===0)\n    delete object.tags\n  else\n    object.tags = tags\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editTags',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeIcons = function(object, icons) {\n  if (!icons) return\n  const oldVal = object.icons\n  object.icons = icons\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editIcons',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeHyperLink = function(object, hyperLink) {\n  if (hyperLink==null||hyperLink==undefined) return\n  const oldVal = object.hyperLink\n  const hyperLinkArr=hyperLink.split(',')\n  object.linkJump=object.linkJump?.filter(link=>{\n    return hyperLinkArr.find(val=>val===link.title)?true:false\n  })\n  if(object.linkJump?.length===0) delete object.linkJump\n  object.hyperLink = hyperLinkArr.filter(link=>{\n    return link!==''&&!object.linkJump?.find(val=>val.title===link)\n  })\n  if(object.hyperLink?.length===0) delete object.hyperLink\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editHyperLink',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeRemark = function(object, remark) {\n  if (remark==null||remark==undefined) return\n  const oldVal = object.remark\n  object.remark = remark\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editRemark',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\n// export const updateNodeImage = function(object, image) {\n//   if (!image) return\n//   const oldVal = object.image\n//   object.image = image\n//   const nodeEle = findEle(object.id)\n//   shapeTpc(nodeEle, object)\n//   this.linkDiv()\n//   this.bus.fire('operation', {\n//     name: 'editImage',\n//     obj: object,\n//     origin: oldVal,\n//   })\n// }\n\nexport const updateNodeSvgChart = function() {\n  // TODO\n}\n\n/**\n * @function\n * @instance\n * @name insertSibling\n * @memberof NodeOperation\n * @description Create a sibling node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertSibling(E('bd4313fbac40284b'))\n */\nexport const insertSibling = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    this.addChild()\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n  const t = nodeEle.parentElement\n  console.time('insertSibling_DOM')\n\n  const { grp, top } = this.createGroup(newNodeObj)\n\n  const children = t.parentNode.parentNode\n  children.insertBefore(grp, t.parentNode.nextSibling)\n  if (children.className === 'mindbox') {\n    this.processPrimaryNode(grp, newNodeObj)\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertSibling_DOM')\n  this.bus.fire('operation', {\n    name: 'insertSibling',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name insertBefore\n * @memberof NodeOperation\n * @description Create a sibling node before the selected node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertBefore(E('bd4313fbac40284b'))\n */\nexport const insertBefore = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    this.addChild()\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertBeforeNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n  const t = nodeEle.parentElement\n  console.time('insertSibling_DOM')\n\n  const { grp, top } = this.createGroup(newNodeObj)\n\n  const children = t.parentNode.parentNode\n  children.insertBefore(grp, t.parentNode)\n  if (children.className === 'mindbox') {\n    this.processPrimaryNode(grp, newNodeObj)\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertSibling_DOM')\n  this.bus.fire('operation', {\n    name: 'insertSibling',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name insertParent\n * @memberof NodeOperation\n * @description Create a parent node of the selected node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertParent(E('bd4313fbac40284b'))\n */\nexport const insertParent = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertParentNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n\n  const grp0 = nodeEle.parentElement.parentElement\n  console.time('insertParent_DOM')\n  const { grp, top } = this.createGroup(newNodeObj, true)\n  top.appendChild(createExpander(true))\n  const children0 = grp0.parentNode\n  grp0.insertAdjacentElement('afterend', grp)\n\n  const c = $d.createElement('children')\n  c.appendChild(grp0)\n\n  top.insertAdjacentElement('afterend', c)\n\n  if (children0.className === 'mindbox') {\n    grp.className = grp0.className // l/rhs\n    grp0.className = ''\n    grp0.querySelector('.svg3rd').remove()\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertParent_DOM')\n  this.bus.fire('operation', {\n    name: 'insertParent',\n    obj: newNodeObj,\n  })\n}\n\nexport const addSummaryFunction = function(nodeEle,node){\n  if (!nodeEle) return undefined\n  \n  // this.layout()\n  // nodeEle = findEle(nodeEle.nodeObj.id)\n  const nodeObj = nodeEle.nodeObj\n  const newNodeObj = node || this.generateNewSummaryObj()\n  nodeObj.parent.children.push(newNodeObj)\n  addParentLink(this.nodeData)\n  const top = nodeEle.parentNode.parentNode.parentNode.parentNode\n  const { smy, top: newTop } = this.createSummary(newNodeObj)\n  if(!top.children?.['smychildren']){\n    const smychildren=$d.createElement('smychildren')\n    smychildren.setAttribute('name','smychildren')\n    top.appendChild(smychildren)\n  }\n  top.children['smychildren'].appendChild(smy)\n  this.layout()\n  this.linkDiv()\n  return { newTop, newNodeObj }\n}\n\nexport const addChildFunction = function(nodeEle, node) { \n  if (!nodeEle) return undefined\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.expanded === false) {\n    this.expandNode(nodeEle, true)\n    // dom had resetted\n    nodeEle = findEle(nodeObj.id)\n  }\n  const newNodeObj = node || this.generateNewObj()\n  if (nodeObj.children) nodeObj.children.push(newNodeObj)\n  else nodeObj.children = [newNodeObj]\n  addParentLink(this.nodeData)\n\n  const top = nodeEle.parentElement\n\n  const { grp, top: newTop } = this.createGroup(newNodeObj)\n\n  if (top.tagName === 'T') {\n    if (top.children[1]) {\n      top.nextSibling.appendChild(grp)\n    } else {\n      const c = $d.createElement('children')\n      c.appendChild(grp)\n      top.appendChild(createExpander(true))\n      top.insertAdjacentElement('afterend', c)\n    }\n    this.layout()\n    this.linkDiv(grp.offsetParent)\n  } else if (top.tagName === 'ROOT') {\n    this.processPrimaryNode(grp, newNodeObj)\n    top.nextSibling.appendChild(grp)\n    this.linkDiv()\n  }\n  return { newTop, newNodeObj }\n}\n\nexport const addSummary = function(el: NodeElement, node: NodeObj) {\n  console.time('addSummary')\n  const parentIndex={}\n  const selectedArr=[]\n  this.container.querySelectorAll('tpc.selected').forEach(value=>{\n    parentIndex[value.nodeObj.parent.id]??(parentIndex[value.nodeObj.parent.id]=selectedArr.length)\n    selectedArr[parentIndex[value.nodeObj.parent.id]]=selectedArr[parentIndex[value.nodeObj.parent.id]]??[]\n    selectedArr[parentIndex[value.nodeObj.parent.id]].push(value)\n  })\n  console.log(selectedArr)\n  selectedArr.forEach(val=>{\n    const nodeEle = val[0] || this.currentNode\n    this.currentSummaryNodeArr=val\n    if (!nodeEle) return\n    if(nodeEle?.parentElement?.parentElement?.parentElement?.className=='mindbox') return\n    const { newTop, newNodeObj } = addSummaryFunction.call(this, nodeEle, node)\n    console.timeEnd('addSummary')\n    if (!node) {\n      this.createInputDiv(newTop.children[0])\n    }\n    this.selectNode(newTop.children[0], true)\n    this.bus.fire('operation', {\n      name: 'addSummary',\n      obj: newNodeObj,\n    })\n  })\n\n}\n\n/**\n * @function\n * @instance\n * @name addChild\n * @memberof NodeOperation\n * @description Create a child node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * addChild(E('bd4313fbac40284b'))\n */\nexport const addChild = function(el: NodeElement, node: NodeObj) {\n  console.time('addChild')\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const { newTop, newNodeObj } = addChildFunction.call(this, nodeEle, node)\n  console.timeEnd('addChild')\n  if (!node) {\n    this.createInputDiv(newTop.children[0])\n  }\n  this.selectNode(newTop.children[0], true)\n  this.bus.fire('operation', {\n    name: 'addChild',\n    obj: newNodeObj,\n  })\n}\n// uncertain link disappear sometimes??\n// TODO while direction = SIDE, move up won't change the direction of primary node\n\n/**\n * @function\n * @instance\n * @name copyNode\n * @memberof NodeOperation\n * @description Copy node to another node.\n * @param {TargetElement} node - Target element return by E('...'), default value: currentTarget.\n * @param {TargetElement} to - The target(as parent node) you want to copy to.\n * @example\n * copyNode(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const copyNode = function(node: NodeElement, to: NodeElement) {\n  console.time('copyNode')\n  const deepCloneObj = JSON.parse(\n    JSON.stringify(node.nodeObj, (k, v) => {\n      if (k === 'parent') return undefined\n      return v\n    })\n  )\n  refreshIds(deepCloneObj)\n  const { newNodeObj } = addChildFunction.call(this, to, deepCloneObj)\n  console.timeEnd('copyNode')\n  this.bus.fire('operation', {\n    name: 'copyNode',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveUpNode\n * @memberof NodeOperation\n * @description Move the target node up.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * moveUpNode(E('bd4313fbac40284b'))\n */\nexport const moveUpNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const grp = nodeEle.parentNode.parentNode\n  const obj = nodeEle.nodeObj\n  moveUpObj(obj)\n  grp.parentNode.insertBefore(grp, grp.previousSibling)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveUpNode',\n    obj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveDownNode\n * @memberof NodeOperation\n * @description Move the target node down.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * moveDownNode(E('bd4313fbac40284b'))\n */\nexport const moveDownNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const grp = nodeEle.parentNode.parentNode\n  const obj = nodeEle.nodeObj\n  moveDownObj(obj)\n  if (grp.nextSibling) {\n    grp.insertAdjacentElement('beforebegin', grp.nextSibling)\n  } else {\n    grp.parentNode.prepend(grp)\n  }\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveDownNode',\n    obj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name removeNode\n * @memberof NodeOperation\n * @description Remove the target node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * removeNode(E('bd4313fbac40284b'))\n */\nexport const removeNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    throw new Error('Can not remove root node')\n  }\n  const index = nodeObj.parent.children.findIndex(node => node === nodeObj)\n  const next = nodeObj.parent.children[index + 1]\n  const originSiblingId = next && next.id\n\n  const childrenLength = removeNodeObj(nodeObj)\n  const t = nodeEle.parentNode\n  if (t.tagName === 'ROOT') {\n    return\n  }\n  if (childrenLength === 0) {\n    // remove epd when children length === 0\n    const parentT = t.parentNode.parentNode.previousSibling\n    // root doesn't have epd\n    if (parentT.tagName !== 'ROOT') {\n      parentT.children[1].remove()\n    }\n    this.selectParent()\n  } else {\n    // select sibling automatically\n    const success = this.selectPrevSibling()\n    if (!success) this.selectNextSibling()\n  }\n  for (const prop in this.linkData) {\n    // MAYBEBUG should traversal all children node\n    const link = this.linkData[prop]\n    if (link.from === t.firstChild || link.to === t.firstChild) {\n      this.removeLink(\n        this.mindElixirBox.querySelector(\n          `[data-linkid=${this.linkData[prop].id}]`\n        )\n      )\n    }\n  }\n  // remove GRP\n  t.parentNode.remove()\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'removeNode',\n    obj: nodeObj,\n    originSiblingId,\n    originParentId: nodeObj.parent.id,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveNode\n * @memberof NodeOperation\n * @description Move a node to another node (as child node).\n * @param {TargetElement} from - The target you want to move.\n * @param {TargetElement} to - The target(as parent node) you want to move to.\n * @example\n * moveNode(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNode = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  if (toObj.expanded === false) {\n    this.expandNode(to, true)\n    from = findEle(fromObj.id)\n    to = findEle(toObj.id)\n  }\n  if (!checkMoveValid(fromObj, toObj)) {\n    console.warn('Invalid move')\n    return\n  }\n  console.time('moveNode')\n  moveNodeObj(fromObj, toObj)\n  addParentLink(this.nodeData) // update parent property\n  const fromTop = from.parentElement\n  const fromChilren = fromTop.parentNode.parentNode\n  const toTop = to.parentElement\n  if (fromChilren.className === 'mindbox') {\n    // clear svg group of primary node\n    fromTop.parentNode.lastChild.remove()\n  } else if (fromTop.parentNode.className === 'mindbox') {\n    fromTop.style.cssText = '' // clear style\n  }\n  if (toTop.tagName === 'T') {\n    if (fromChilren.className === 'mindbox') {\n      // clear direaction class of primary node\n      fromTop.parentNode.className = ''\n    }\n    if (toTop.children[1]) {\n      // expander exist\n      toTop.nextSibling.appendChild(fromTop.parentNode)\n    } else {\n      // expander not exist, no child\n      const c = $d.createElement('children')\n      c.appendChild(fromTop.parentNode)\n      toTop.appendChild(createExpander(true))\n      toTop.parentElement.insertBefore(c, toTop.nextSibling)\n    }\n  } else if (toTop.tagName === 'ROOT') {\n    this.processPrimaryNode(fromTop.parentNode, fromObj)\n    toTop.nextSibling.appendChild(fromTop.parentNode)\n  }\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNode',\n    obj: { fromObj, toObj, originParentId },\n  })\n  console.timeEnd('moveNode')\n}\n\n/**\n * @function\n * @instance\n * @name moveNodeBefore\n * @memberof NodeOperation\n * @description Move a node and become previous node of another node.\n * @param {TargetElement} from\n * @param {TargetElement} to\n * @example\n * moveNodeBefore(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNodeBefore = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  moveNodeBeforeObj(fromObj, toObj)\n  addParentLink(this.nodeData)\n  const fromTop = from.parentElement\n  const fromGrp = fromTop.parentNode\n  const toTop = to.parentElement\n  const toGrp = toTop.parentNode\n  const toChilren = toTop.parentNode.parentNode\n  toChilren.insertBefore(fromGrp, toGrp)\n  this.processPrimaryNode(fromTop.parentElement,fromObj)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNodeBefore',\n    obj: { fromObj, toObj, originParentId },\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveNodeAfter\n * @memberof NodeOperation\n * @description Move a node and become next node of another node.\n * @param {TargetElement} from\n * @param {TargetElement} to\n * @example\n * moveNodeAfter(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNodeAfter = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  moveNodeAfterObj(fromObj, toObj)\n  addParentLink(this.nodeData)\n  const fromTop = from.parentElement\n  const fromGrp = fromTop.parentNode\n  const toTop = to.parentElement\n  const toGrp = toTop.parentNode\n  const toChilren = toTop.parentNode.parentNode\n  toChilren.insertBefore(fromGrp, toGrp.nextSibling)\n  this.processPrimaryNode(fromTop.parentElement,fromObj)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNodeAfter',\n    obj: { fromObj, toObj, originParentId },\n  })\n}\n\n/**\n * @function\n * @instance\n * @name beginEdit\n * @memberof NodeOperation\n * @description Begin to edit the target node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * beginEdit(E('bd4313fbac40284b'))\n */\nexport const beginEdit = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  this.createInputDiv(nodeEle)\n}\n\nexport const setNodeTopic = function(tpc, topic) {\n  tpc.childNodes[0].textContent = topic\n  tpc.nodeObj.topic = topic\n  this.linkDiv()\n}\n\n// Judge L or R\nexport function processPrimaryNode(primaryNode, obj) {\n  if (this.direction === LEFT) {\n    primaryNode.className = 'lhs'\n  } else if (this.direction === RIGHT) {\n    primaryNode.className = 'rhs'\n  } else if (this.direction === SIDE) {\n    const l = $d.querySelectorAll('.lhs').length\n    const r = $d.querySelectorAll('.rhs').length\n    if (l <= r) {\n      primaryNode.className = 'lhs'\n      obj.direction = LEFT\n    } else {\n      primaryNode.className = 'rhs'\n      obj.direction = RIGHT\n    }\n  }\n}\n","import {\n  LinkDragMoveHelper,\n  generateUUID,\n  getArrowPoints,\n  calcP1,\n  calcP4,\n} from './utils/index'\nimport { createSvgGroup } from './utils/svg'\n\n// TODO Link label\nexport const createLink = function(from, to, isInitPaint, obj) {\n  const map = this.map.getBoundingClientRect()\n  if (!from || !to) {\n    return // not expand\n  }\n  const pfrom = from.getBoundingClientRect()\n  const pto = to.getBoundingClientRect()\n  const fromCenterX = (pfrom.x + pfrom.width / 2 - map.x) / this.scaleVal\n  const fromCenterY = (pfrom.y + pfrom.height / 2 - map.y) / this.scaleVal\n  const toCenterX = (pto.x + pto.width / 2 - map.x) / this.scaleVal\n  const toCenterY = (pto.y + pto.height / 2 - map.y) / this.scaleVal\n\n  let p2x, p2y, p3x, p3y\n  if (isInitPaint) {\n    p2x = fromCenterX + obj.delta1.x\n    p2y = fromCenterY + obj.delta1.y\n    p3x = toCenterX + obj.delta2.x\n    p3y = toCenterY + obj.delta2.y\n  } else {\n    if ((fromCenterY + toCenterY) / 2 - fromCenterY <= pfrom.height / 2) {\n      // the situation that two div is too close\n      p2x = (pfrom.x + pfrom.width - map.x) / this.scaleVal + 100\n      p2y = fromCenterY\n      p3x = (pto.x + pto.width - map.x) / this.scaleVal + 100\n      p3y = toCenterY\n    } else {\n      p2x = (fromCenterX + toCenterX) / 2\n      p2y = (fromCenterY + toCenterY) / 2\n      p3x = (fromCenterX + toCenterX) / 2\n      p3y = (fromCenterY + toCenterY) / 2\n    }\n  }\n\n  const fromData = {\n    cx: fromCenterX,\n    cy: fromCenterY,\n    w: pfrom.width,\n    h: pfrom.height,\n  }\n  const toData = {\n    cx: toCenterX,\n    cy: toCenterY,\n    w: pto.width,\n    h: pto.height,\n  }\n\n  const p1 = calcP1(fromData, p2x, p2y)\n  const p1x = p1.x\n  const p1y = p1.y\n\n  const p4 = calcP4(toData, p3x, p3y)\n  const p4x = p4.x\n  const p4y = p4.y\n\n  const arrowPoint = getArrowPoints(p3x, p3y, p4x, p4y)\n\n  // TODO link lable\n  // const halfx = p1x / 8 + (p2x * 3) / 8 + (p3x * 3) / 8 + p4x / 8\n  // const halfy = p1y / 8 + (p2y * 3) / 8 + (p3y * 3) / 8 + p4y / 8\n\n  const newSvgGroup = createSvgGroup(\n    `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`,\n    `M ${arrowPoint.x1} ${arrowPoint.y1} L ${p4x} ${p4y} L ${arrowPoint.x2} ${arrowPoint.y2}`\n  )\n\n  let newLinkObj\n  if (isInitPaint) {\n    newLinkObj = {\n      id: obj.id,\n      label: '',\n      from,\n      to,\n      delta1: {\n        x: p2x - fromCenterX,\n        y: p2y - fromCenterY,\n      },\n      delta2: {\n        x: p3x - toCenterX,\n        y: p3y - toCenterY,\n      },\n    }\n    // overwrite\n    this.linkData[obj.id] = newLinkObj\n    newSvgGroup.linkObj = newLinkObj\n    newSvgGroup.dataset.linkid = obj.id\n  } else {\n    newLinkObj = {\n      id: generateUUID(),\n      label: '',\n      from,\n      to,\n      delta1: {\n        x: p2x - fromCenterX,\n        y: p2y - fromCenterY,\n      },\n      delta2: {\n        x: p3x - toCenterX,\n        y: p3y - toCenterY,\n      },\n    }\n    // new\n    this.linkData[newLinkObj.id] = newLinkObj\n    newSvgGroup.linkObj = newLinkObj\n    newSvgGroup.dataset.linkid = newLinkObj.id\n    this.currentLink = newSvgGroup\n  }\n  this.linkSvgGroup.appendChild(newSvgGroup)\n  if (!isInitPaint) { this.showLinkController(p2x, p2y, p3x, p3y, newLinkObj, fromData, toData) }\n}\n\nexport const removeLink = function(linkSvg) {\n  let link\n  if (linkSvg) {\n    link = linkSvg\n  } else {\n    link = this.currentLink\n  }\n  if (!link) return\n  this.hideLinkController()\n  const id = link.linkObj.id\n  delete this.linkData[id]\n  link.remove()\n  link = null\n}\nexport const selectLink = function(targetElement) {\n  this.currentLink = targetElement\n  const obj = targetElement.linkObj\n  const from = obj.from\n  const to = obj.to\n\n  const map = this.map.getBoundingClientRect()\n  const pfrom = from.getBoundingClientRect()\n  const pto = to.getBoundingClientRect()\n  const fromCenterX = (pfrom.x + pfrom.width / 2 - map.x) / this.scaleVal\n  const fromCenterY = (pfrom.y + pfrom.height / 2 - map.y) / this.scaleVal\n  const toCenterX = (pto.x + pto.width / 2 - map.x) / this.scaleVal\n  const toCenterY = (pto.y + pto.height / 2 - map.y) / this.scaleVal\n\n  const fromData = {\n    cx: fromCenterX,\n    cy: fromCenterY,\n    w: pfrom.width,\n    h: pfrom.height,\n  }\n  const toData = {\n    cx: toCenterX,\n    cy: toCenterY,\n    w: pto.width,\n    h: pto.height,\n  }\n\n  const p2x = fromCenterX + obj.delta1.x\n  const p2y = fromCenterY + obj.delta1.y\n  const p3x = toCenterX + obj.delta2.x\n  const p3y = toCenterY + obj.delta2.y\n\n  this.showLinkController(p2x, p2y, p3x, p3y, obj, fromData, toData)\n}\nexport const hideLinkController = function() {\n  this.linkController.style.display = 'none'\n  this.P2.style.display = 'none'\n  this.P3.style.display = 'none'\n}\nexport const showLinkController = function(\n  p2x,\n  p2y,\n  p3x,\n  p3y,\n  linkObj,\n  fromData,\n  toData\n) {\n  this.linkController.style.display = 'initial'\n  this.P2.style.display = 'initial'\n  this.P3.style.display = 'initial'\n\n  const p1 = calcP1(fromData, p2x, p2y)\n  let p1x = p1.x\n  let p1y = p1.y\n\n  const p4 = calcP4(toData, p3x, p3y)\n  let p4x = p4.x\n  let p4y = p4.y\n\n  this.P2.style.cssText = `top:${p2y}px;left:${p2x}px;`\n  this.P3.style.cssText = `top:${p3y}px;left:${p3x}px;`\n  this.line1.setAttribute('x1', p1x)\n  this.line1.setAttribute('y1', p1y)\n  this.line1.setAttribute('x2', p2x)\n  this.line1.setAttribute('y2', p2y)\n  this.line2.setAttribute('x1', p3x)\n  this.line2.setAttribute('y1', p3y)\n  this.line2.setAttribute('x2', p4x)\n  this.line2.setAttribute('y2', p4y)\n\n  if (this.helper1) {\n    this.helper1.destory(this.map)\n    this.helper2.destory(this.map)\n  }\n\n  this.helper1 = new LinkDragMoveHelper(this.P2)\n  this.helper2 = new LinkDragMoveHelper(this.P3)\n\n  this.helper1.init(this.map, (deltaX, deltaY) => {\n    /**\n     * user will control bezier with p2 & p3\n     * p1 & p4 is depend on p2 & p3\n     */\n    p2x = p2x - deltaX / this.scaleVal\n    p2y = p2y - deltaY / this.scaleVal\n\n    const p1 = calcP1(fromData, p2x, p2y)\n    p1x = p1.x\n    p1y = p1.y\n\n    this.P2.style.top = p2y + 'px'\n    this.P2.style.left = p2x + 'px'\n    this.currentLink.children[0].setAttribute(\n      'd',\n      `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`\n    )\n    this.line1.setAttribute('x1', p1x)\n    this.line1.setAttribute('y1', p1y)\n    this.line1.setAttribute('x2', p2x)\n    this.line1.setAttribute('y2', p2y)\n    linkObj.delta1.x = p2x - fromData.cx\n    linkObj.delta1.y = p2y - fromData.cy\n  })\n\n  this.helper2.init(this.map, (deltaX, deltaY) => {\n    p3x = p3x - deltaX / this.scaleVal\n    p3y = p3y - deltaY / this.scaleVal\n\n    const p4 = calcP4(toData, p3x, p3y)\n    p4x = p4.x\n    p4y = p4.y\n    const arrowPoint = getArrowPoints(p3x, p3y, p4x, p4y)\n\n    this.P3.style.top = p3y + 'px'\n    this.P3.style.left = p3x + 'px'\n    this.currentLink.children[0].setAttribute(\n      'd',\n      `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`\n    )\n    this.currentLink.children[1].setAttribute(\n      'd',\n      `M ${arrowPoint.x1} ${arrowPoint.y1} L ${p4x} ${p4y} L ${arrowPoint.x2} ${arrowPoint.y2}`\n    )\n    this.line2.setAttribute('x1', p3x)\n    this.line2.setAttribute('y1', p3y)\n    this.line2.setAttribute('x2', p4x)\n    this.line2.setAttribute('y2', p4y)\n    linkObj.delta2.x = p3x - toData.cx\n    linkObj.delta2.y = p3y - toData.cy\n  })\n}\n","import { createPath, createMainPath, createLinkSvg, createSvgPath } from './utils/svg'\nimport { findEle, Expander } from './utils/dom'\nimport {\n  SIDE,\n  GAP,\n  TURNPOINT_R,\n  PRIMARY_NODE_HORIZONTAL_GAP,\n  PRIMARY_NODE_VERTICAL_GAP,\n} from './const'\nimport { NodeObj } from '.'\nimport { node } from 'canvg/dist/presets'\n\ninterface rangeMapI{\n  [propName: string]: boolean;\n}\n/**\n * Link nodes with svg,\n * only link specific node if `primaryNode` is present\n *\n * procedure:\n * 1. calculate position of primary nodes\n * 2. layout primary node, generate primary link\n * 3. generate links inside primary node\n * 4. generate custom link\n * @param {object} primaryNode process the specific primary node only\n */\nexport default function linkDiv(primaryNode) {\n  var primaryNodeHorizontalGap = this.primaryNodeHorizontalGap || PRIMARY_NODE_HORIZONTAL_GAP\n  var primaryNodeVerticalGap = this.primaryNodeVerticalGap || PRIMARY_NODE_VERTICAL_GAP\n  console.time('linkDiv')\n  const root = this.root\n  root.style.cssText = `top:${10000 - root.offsetHeight / 2}px;left:${10000 - root.offsetWidth / 2}px;`\n  const primaryNodeList = this.box.children\n  this.svg2nd.innerHTML = ''\n\n  // 1. calculate position of primary nodes\n  let totalHeight = 0\n  let shortSide: string // l or r\n  let shortSideGap = 0 // balance heigt of two side\n  let currentOffsetL = 0 // left side total offset\n  let currentOffsetR = 0 // right side total offset\n  let totalHeightL = 0\n  let totalHeightR = 0\n  let base: number\n\n  if (this.direction === SIDE) {\n    let countL = 0\n    let countR = 0\n    let totalHeightLWithoutGap = 0\n    let totalHeightRWithoutGap = 0\n    for (let i = 0; i < primaryNodeList.length; i++) {\n      const el = primaryNodeList[i]\n      if (el.className === 'lhs') {\n        totalHeightL += el.offsetHeight + primaryNodeVerticalGap\n        totalHeightLWithoutGap += el.offsetHeight\n        countL += 1\n      } else {\n        totalHeightR += el.offsetHeight + primaryNodeVerticalGap\n        totalHeightRWithoutGap += el.offsetHeight\n        countR += 1\n      }\n    }\n    if (totalHeightL > totalHeightR) {\n      base = 10000 - Math.max(totalHeightL) / 2\n      shortSide = 'r'\n      shortSideGap = (totalHeightL - totalHeightRWithoutGap) / (countR - 1)\n    } else {\n      base = 10000 - Math.max(totalHeightR) / 2\n      shortSide = 'l'\n      shortSideGap = (totalHeightR - totalHeightLWithoutGap) / (countL - 1)\n    }\n  } else {\n    for (let i = 0; i < primaryNodeList.length; i++) {\n      const el = primaryNodeList[i]\n      totalHeight += el.offsetHeight + primaryNodeVerticalGap\n    }\n    base = 10000 - totalHeight / 2\n  }\n\n  // 2. layout primary node, generate primary link\n  let primaryPath = ''\n  const alignRight = 10000 - root.offsetWidth / 2 - primaryNodeHorizontalGap+60\n  const alignLeft = 10000 + root.offsetWidth / 2 + primaryNodeHorizontalGap-60\n  for (let i = 0; i < primaryNodeList.length; i++) {\n    let x2, y2\n    const el = primaryNodeList[i]\n    const elOffsetH = el.offsetHeight\n    let xMiddle=root.offsetLeft-10\n    if (el.className === 'lhs') {\n      el.style.top = base + currentOffsetL + 'px'\n      el.style.left = alignRight - el.offsetWidth + 'px'\n      x2 = alignRight - 15 // padding\n      y2 = base + currentOffsetL + elOffsetH / 2\n\n      // https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#path_commands\n      let LEFT = 10000\n      if (this.primaryLinkStyle === 2) {\n        if (this.direction === SIDE) {\n          LEFT = 10000 - root.offsetWidth / 6\n        }\n        if (y2 < 10000) {\n          primaryPath += `M ${LEFT} 10000 V ${y2 + 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT - 20} ${y2} H ${x2}`\n        } else {\n          primaryPath += `M ${LEFT} 10000 V ${y2 - 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT - 20} ${y2} H ${x2}`\n        }\n      } else {\n        primaryPath += `M 10000 10000 H ${xMiddle} V ${y2} H ${x2}`\n      }\n\n      if (shortSide === 'l') {\n        currentOffsetL += elOffsetH + shortSideGap\n      } else {\n        currentOffsetL += elOffsetH + primaryNodeVerticalGap\n      }\n    } else {\n      xMiddle=root.offsetLeft+root.offsetWidth+10\n      el.style.top = base + currentOffsetR + 'px'\n      el.style.left = alignLeft + 'px'\n      x2 = alignLeft + 15 // padding\n      y2 = base + currentOffsetR + elOffsetH / 2\n\n      let LEFT = 10000\n      if (this.primaryLinkStyle === 2) {\n        if (this.direction === SIDE) {\n          LEFT = 10000 + root.offsetWidth / 6\n        }\n        if (y2 < 10000) {\n          primaryPath += `M ${LEFT} 10000 V ${y2 + 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT + 20} ${y2} H ${x2}`\n        } else {\n          primaryPath += `M ${LEFT} 10000 V ${y2 - 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT + 20} ${y2} H ${x2}`\n        }\n      } else {\n        primaryPath += `M 10000 10000 H ${xMiddle} V ${y2} H ${x2}`\n      }\n      if (shortSide === 'r') {\n        currentOffsetR += elOffsetH + shortSideGap\n      } else {\n        currentOffsetR += elOffsetH + primaryNodeVerticalGap\n      }\n    }\n    // set position of expander\n    const expander = el.children[0].children[1]\n    if (expander) {\n      expander.style.top =\n        (expander.parentNode.offsetHeight - expander.offsetHeight) / 2 + 'px'\n      if (el.className === 'lhs') {\n        expander.style.left = -10 + 'px'\n      } else {\n        expander.style.left = expander.parentNode.offsetWidth - 10 + 'px'\n      }\n    }\n  }\n  this.svg2nd.appendChild(createMainPath(primaryPath))\n\n  // 3. generate link inside primary node\n  for (let i = 0; i < primaryNodeList.length; i++) {\n    const el = primaryNodeList[i]\n    if (primaryNode && primaryNode !== primaryNodeList[i]) {\n      continue\n    }\n    if (el.childElementCount) {\n      const svg = createLinkSvg('svg3rd')\n      const svgSMY = createLinkSvg('svg3rd')\n      // svg tag name is lower case\n      // if (el.lastChild.tagName === 'svg') el.lastChild.remove()\n      el.querySelectorAll('.svg3rd').forEach(val => {\n        val.remove()\n      });\n      el.appendChild(svg)     \n      const parent = el.children[0]\n      let children\n      if(el.children?.[2]?.tagName==='SMYCHILDREN'){\n        children = [...el.children[1].children,...el.children[2].children]\n      }   \n      else\n        children = el.children[1].children\n      path = ''\n      smypath = ''\n      loopChildren(children, parent,this.nodeData.children[i],true)\n      svg.appendChild(createPath(path))\n      if(smypath.length>0){\n        el.appendChild(svgSMY)\n        svgSMY.appendChild(createSvgPath(smypath))\n      }  \n    }\n  }\n\n  // 4. generate custom link\n  this.linkSvgGroup.innerHTML = ''\n  for (const prop in this.linkData) {\n    const link = this.linkData[prop]\n    if (typeof link.from === 'string') {\n      this.createLink(findEle(link.from), findEle(link.to), true, link)\n    } else {\n      this.createLink(\n        findEle(link.from.nodeObj.id),\n        findEle(link.to.nodeObj.id),\n        true,\n        link\n      )\n    }\n  }\n  console.timeEnd('linkDiv')\n}\n\nlet path = ''\nlet smypath = ''\n\nfunction loopChildren(children: HTMLElement[], parent: HTMLElement,nodeData:NodeObj,first?: boolean) {\n  let parentOT = parent.offsetTop\n  let parentOL = parent.offsetLeft\n  let parentOW = parent.offsetWidth\n  let parentOH = parent.offsetHeight\n  let isSmyChild=false\n  if(parent.offsetParent.tagName==='SMY'){\n    isSmyChild=true\n    parentOT+=(parent.offsetParent as HTMLElement).offsetTop\n    parentOL+=(parent.offsetParent as HTMLElement).offsetLeft\n    // parentOW+=(parent.offsetParent as HTMLElement).offsetWidth\n    // parentOH+=(parent.offsetParent as HTMLElement).offsetHeight\n  }\n  for (let i = 0; i < children.length; i++) {\n    const child: HTMLElement = children[i] as HTMLElement\n    if(child?.tagName==='SMY'){\n      let firstEl=children[0] as HTMLElement\n      let lastEl=children[i-1] as HTMLElement\n\n      const rangeMap:rangeMapI={}\n      nodeData.children[i].summary.range.forEach(val=>{\n        rangeMap[val]=true\n      })\n      let flag=true\n      for(let j=0;j<i;j++){\n          const key=children[j].children[0].children[0].getAttribute('data-nodeid').slice(2)\n          if(rangeMap[key]){\n            if(flag){\n              flag=false\n              firstEl=children[j]\n            }\n            lastEl=children[j]\n          }\n      }\n      const xfirst=firstEl.offsetLeft+firstEl.offsetWidth+8\n      const yfirst=firstEl.offsetTop+15\n      const ylast=lastEl.offsetTop+lastEl.offsetHeight-5\n      const xlast=lastEl.offsetLeft+lastEl.offsetWidth+8\n      const y=child.offsetTop+(child.children[0] as HTMLElement).offsetTop+(child.children[0] as HTMLElement).offsetHeight\n      let top=child.style.top??0\n      if(typeof top ==='string') top=Number(top.replace('px',''))\n      child.style.top=top+(ylast+yfirst+20)/2-y+'px'\n      smypath+=`M ${xfirst} ${yfirst} H ${xfirst+10} V ${ylast} H${xlast}`\n    }\n    const childT: HTMLElement = child.children[0] as HTMLElement // t tag inside the child dom\n    let childTOT = childT.offsetTop\n    let childTOH = childT.offsetHeight\n    if(isSmyChild){\n      childTOT+=(childT.offsetParent as HTMLElement).offsetTop\n      // childTOH=(childT.offsetParent as HTMLElement).offsetHeight\n    }\n    let y1: number\n    if (first||isSmyChild) {\n      y1 = parentOT + parentOH / 2\n    } else {\n      y1 = parentOT + parentOH\n    }\n    const y2 = childTOT + childTOH\n    let x1: number, x2: number, xMiddle: number\n    const direction = child.offsetParent.className||(child.offsetParent as HTMLElement).offsetParent.className\n    if (direction === 'lhs'&&child?.tagName!=='SMY') {\n      x1 = parentOL + GAP\n      xMiddle = parentOL\n      x2 = parentOL - childT.offsetWidth\n      if (\n        childTOT + childTOH < parentOT + parentOH / 2 + 50 &&\n        childTOT + childTOH > parentOT + parentOH / 2 - 50\n      ) {\n        // 相差+-50内直接直线\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2} H ${x2}`\n      } else if (childTOT + childTOH >= parentOT + parentOH / 2) {\n        // 子底部低于父中点\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      } else {\n        // 子底部高于父中点\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      }\n    } else if (direction === 'rhs'&&child?.tagName!=='SMY') {\n      x1 = parentOL + parentOW - GAP\n      if(isSmyChild){\n        x1+=GAP\n        // y2=y1\n      } \n      xMiddle = parentOL + parentOW\n      x2 = parentOL + parentOW + childT.offsetWidth\n      if (\n        childTOT + childTOH < parentOT + parentOH / 2 + 50 &&\n        childTOT + childTOH > parentOT + parentOH / 2 - 50\n      ) {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2} H ${x2}`\n        \n      } else if (childTOT + childTOH >= parentOT + parentOH / 2) {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      } else {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      }\n    }\n\n    const expander = childT.children[1] as Expander\n    if (expander) {\n      expander.style.top =\n        (childT.offsetHeight - expander.offsetHeight) / 2 + 'px'\n      if (direction === 'lhs') {\n        expander.style.left = -10 + 'px'\n      } else if (direction === 'rhs') {\n        expander.style.left = childT.offsetWidth - 10 + 'px'\n      }\n      // this property is added in the layout phase\n      if (!expander.expanded) continue\n    } else {\n      // expander not exist\n      continue\n    }\n    // traversal\n    let nextChildren\n    if(child.children?.[2]?.tagName==='SMYCHILDREN'){\n      nextChildren=[...child.children[1].children,...child.children[2].children]\n    }else{\n      nextChildren=[...child.children[1].children]\n    }\n    if (nextChildren.length > 0) loopChildren(nextChildren, childT,nodeData.children[i])\n  }\n}\n","import { dragMoveHelper } from './utils/index'\nexport default function(mind) {\n  mind.map.addEventListener('click', e => {\n    // if (dragMoveHelper.afterMoving) return\n    // e.preventDefault() // can cause a tag don't work\n    if (e.target.nodeName === 'EPD') {\n      mind.expandNode(e.target.previousSibling)\n    } else if (\n      e.target.parentElement.nodeName === 'T' ||\n      e.target.parentElement.nodeName === 'ROOT'\n    ) {\n      mind.selectNode(e.target, false, e)\n    } else if (e.target.nodeName === 'path') {\n      if (e.target.parentElement.nodeName === 'g') {\n        mind.selectLink(e.target.parentElement)\n      }\n    } else if (e.target.className === 'circle') {\n      // skip circle\n    } else {\n      mind.unselectNode()    \n      //unselect all nodes\n      mind.container.querySelectorAll('tpc.selected').forEach(element => {\n      element.className=''\n    });\n      mind.hideLinkController()\n    }\n\n  })\n\n  mind.map.addEventListener('dblclick', e => {\n    e.preventDefault()\n    if (!mind.editable) return\n    if (\n      e.target.parentElement.nodeName === 'T' ||\n      e.target.parentElement.nodeName === 'ROOT'\n    ) {\n      mind.beginEdit(e.target)\n    }else if(e.target.className!=='content'){\n      let node = e.target\n      while(node.parentElement){\n        node=node.parentElement\n        if(node.nodeName === 'TPC'){\n          mind.beginEdit(node)\n          break\n        }\n      }\n    }\n  })\n\n  /**\n   * drag and move\n   */\n  mind.map.addEventListener('mousemove', e => {\n    if (!mind.nodeDraggable) {\n      if (e && e.target.className === 'selected') {\n        dragMoveHelper.clear()\n        e.target.draggable = false\n        return\n      }\n    }\n\n    // click trigger mousemove in windows chrome\n    // the 'true' is a string\n    if (e.target.contentEditable !== 'true') {\n      dragMoveHelper.onMove(e, mind.container)\n    }\n  })\n  mind.map.addEventListener('mousedown', e => {\n    if (e.target.contentEditable !== 'true') {\n      dragMoveHelper.afterMoving = false\n      dragMoveHelper.mousedown = true\n    }\n  })\n  mind.map.addEventListener('mouseleave', e => {\n    dragMoveHelper.clear()\n  })\n  mind.map.addEventListener('mouseup', e => {\n    dragMoveHelper.clear()\n  })\n\n  mind.map.addEventListener('wheel', e => {\n    // e.preventDefault()\n  })\n}\n","const cn = {\n  addChild: '插入子节点',\n  addParent: '插入父节点',\n  addSibling: '插入同级节点',\n  removeNode: '删除节点',\n  focus: '专注',\n  cancelFocus: '取消专注',\n  moveUp: '上移',\n  moveDown: '下移',\n  // link: '连接',\n  clickTips: '请点击目标节点',\n\n  font: '文字',\n  background: '背景',\n  tag: '标签',\n  icon: '图标',\n  tagsSeparate: '多个标签半角逗号分隔',\n  iconsSeparate: '多个图标半角逗号分隔',\n  link:'连线',\n  nodeLink:'主题内超链接',\n  hyperlink:'超链接',\n  linkSeparate:'链接地址,多个链接半角逗号分隔',\n  remark:'备注',\n  reamrkSeparate:'内容' ,\n  summary:'概要'\n}\nexport default {\n  cn,\n  zh_CN: cn,\n  zh_TW: {\n    addChild: '插入子節點',\n    addParent: '插入父節點',\n    addSibling: '插入同級節點',\n    removeNode: '刪除節點',\n    focus: '專注',\n    cancelFocus: '取消專注',\n    moveUp: '上移',\n    moveDown: '下移',\n    link: '連接',\n    clickTips: '請點擊目標節點',\n\n    font: '文字',\n    background: '背景',\n    tag: '標簽',\n    icon: '圖標',\n    tagsSeparate: '多個標簽半角逗號分隔',\n    iconsSeparate: '多個圖標半角逗號分隔',\n  },\n  en: {\n    addChild: 'Add child',\n    addParent: 'Add parent',\n    addSibling: 'Add sibling',\n    removeNode: 'Remove node',\n    focus: 'Focus Mode',\n    cancelFocus: 'Cancel Focus Mode',\n    moveUp: 'Move up',\n    moveDown: 'Move down',\n    link: 'Link',\n    clickTips: 'Please click the target node',\n\n    font: 'Font',\n    background: 'Background',\n    tag: 'Tag',\n    icon: 'Icon',\n    tagsSeparate: 'Separate tags by comma',\n    iconsSeparate: 'Separate icons by comma',\n    hyperlink:'hyperlink',\n    linkSeparate:'link address',\n    remark:'remark',\n    reamrkSeparate:'content',\n    summary:'summary',\n    nodeLink:'inner link'\n  },\n  ja: {\n    addChild: '子ノードを追加する',\n    addParent: '親ノードを追加します',\n    addSibling: '兄弟ノードを追加する',\n    removeNode: 'ノードを削除',\n    focus: '集中',\n    cancelFocus: '集中解除',\n    moveUp: '上へ移動',\n    moveDown: '下へ移動',\n    link: 'コネクト',\n    clickTips: 'ターゲットノードをクリックしてください',\n\n    font: 'フォント',\n    background: 'バックグラウンド',\n    tag: 'タグ',\n    icon: 'アイコン',\n    tagsSeparate: '複数タグはカンマ区切り',\n    iconsSeparate: '複数アイコンはカンマ区切り',\n  },\n  pt: {\n    addChild: 'Adicionar item filho',\n    addParent: 'Adicionar item pai',\n    addSibling: 'Adicionar item irmao',\n    removeNode: 'Remover item',\n    focus: 'Modo Foco',\n    cancelFocus: 'Cancelar Modo Foco',\n    moveUp: 'Mover para cima',\n    moveDown: 'Mover para baixo',\n    link: 'Link',\n    clickTips: 'Favor clicar no item alvo',\n\n    font: 'Fonte',\n    background: 'Cor de fundo',\n    tag: 'Tag',\n    icon: 'Icone',\n    tagsSeparate: 'Separe tags por virgula',\n    iconsSeparate: 'Separe icones por virgula',\n  },\n}\n","import i18n from '../i18n'\nimport linkDiv from '../linkDiv'\nimport { shapeTpc } from '../utils/dom'\nimport { encodeHTML } from '../utils/index'\n\nexport default function(mind, option) {\n  const createTips = words => {\n    const div = document.createElement('div')\n    div.innerText = words\n    div.style.cssText = 'position:absolute;bottom:20px;left:50%;transform:translateX(-50%);'\n    return div\n  }\n  const createLi = (id, name, keyname) => {\n    const li = document.createElement('li')\n    li.id = id\n    li.innerHTML = `<span>${encodeHTML(name)}</span><span>${encodeHTML(keyname)}</span>`\n    return li\n  }\n  const locale = i18n[mind.locale] ? mind.locale : 'en'\n\n  const add_child = createLi('cm-add_child', i18n[locale].addChild, 'tab')\n  const add_parent = createLi('cm-add_parent', i18n[locale].addParent, '')\n  const add_sibling = createLi('cm-add_sibling', i18n[locale].addSibling, 'enter')\n  const remove_child = createLi(\n    'cm-remove_child',\n    i18n[locale].removeNode,\n    'delete'\n  )\n  const focus = createLi('cm-fucus', i18n[locale].focus, '')\n  const unfocus = createLi('cm-unfucus', i18n[locale].cancelFocus, '')\n  const up = createLi('cm-up', i18n[locale].moveUp, 'PgUp')\n  const down = createLi('cm-down', i18n[locale].moveDown, 'Pgdn')\n  const link = createLi('cm-link', i18n[locale].link, '')\n  const nodeLink = createLi('cm-nodelink', i18n[locale].nodeLink, '')\n  const summary = createLi('cm-summary', i18n[locale].summary, '')\n\n  const menuUl = document.createElement('ul')\n  menuUl.className = 'menu-list'\n  menuUl.appendChild(add_child)\n  menuUl.appendChild(add_parent)\n  menuUl.appendChild(add_sibling)\n  menuUl.appendChild(remove_child)\n  if (!option || option.focus) {\n    menuUl.appendChild(focus)\n    menuUl.appendChild(unfocus)\n  }\n  menuUl.appendChild(up)\n  menuUl.appendChild(down)\n  if (!option || option.link) {\n    menuUl.appendChild(link)\n    menuUl.appendChild(nodeLink)\n  }\n  menuUl.appendChild(summary)\n  if (option && option.extend) {\n    for (let i = 0; i < option.extend.length; i++) {\n      const item = option.extend[i]\n      const dom = createLi(item.name, item.name, item.key || '')\n      menuUl.appendChild(dom)\n      dom.onclick = e => {\n        item.onclick(e)\n      }\n    }\n  }\n  const menuContainer = document.createElement('cmenu')\n  menuContainer.appendChild(menuUl)\n  menuContainer.hidden = true\n\n  mind.container.append(menuContainer)\n  let isRoot = true\n  mind.container.oncontextmenu = function(e) {\n    e.preventDefault()\n    if (!mind.editable) return\n    // console.log(e.pageY, e.screenY, e.clientY)\n    const target = e.target\n    if (target.tagName === 'TPC') {\n      if (target.parentElement.tagName === 'ROOT') {\n        isRoot = true\n      } else {\n        isRoot = false\n      }\n      if (isRoot) {\n        focus.className = 'disabled'\n        up.className = 'disabled'\n        down.className = 'disabled'\n        add_sibling.className = 'disabled'\n        remove_child.className = 'disabled'\n      } else {\n        focus.className = ''\n        up.className = ''\n        down.className = ''\n        add_sibling.className = ''\n        remove_child.className = ''\n      }\n      mind.selectNode(target)\n      menuContainer.hidden = false\n      const height = menuUl.offsetHeight\n      const width = menuUl.offsetWidth\n      if (height + e.clientY > window.innerHeight) {\n        menuUl.style.top = ''\n        menuUl.style.bottom = '0px'\n      } else {\n        menuUl.style.bottom = ''\n        menuUl.style.top = e.clientY + 15 + 'px'\n      }\n      if (width + e.clientX > window.innerWidth) {\n        menuUl.style.left = ''\n        menuUl.style.right = '0px'\n      } else {\n        menuUl.style.right = ''\n        menuUl.style.left = e.clientX + 10 + 'px'\n      }\n    }\n  }\n\n  menuContainer.onclick = e => {\n    if (e.target === menuContainer) menuContainer.hidden = true\n  }\n\n  add_child.onclick = e => {\n    mind.addChild()\n    menuContainer.hidden = true\n  }\n  summary.onclick = e => {\n    mind.addSummary()\n    menuContainer.hidden = true\n  }\n  add_parent.onclick = e => {\n    mind.insertParent()\n    menuContainer.hidden = true\n  }\n  add_sibling.onclick = e => {\n    if (isRoot) return\n    mind.insertSibling()\n    menuContainer.hidden = true\n  }\n  remove_child.onclick = e => {\n    if (isRoot) return\n    mind.removeNode()\n    menuContainer.hidden = true\n  }\n  focus.onclick = e => {\n    if (isRoot) return\n    mind.focusNode(mind.currentNode)\n    menuContainer.hidden = true\n  }\n  unfocus.onclick = e => {\n    mind.cancelFocus()\n    menuContainer.hidden = true\n  }\n  up.onclick = e => {\n    if (isRoot) return\n    mind.moveUpNode()\n    menuContainer.hidden = true\n  }\n  down.onclick = e => {\n    if (isRoot) return\n    mind.moveDownNode()\n    menuContainer.hidden = true\n  }\n  link.onclick = e => {\n    menuContainer.hidden = true\n    const from = mind.currentNode\n    const tips = createTips(i18n[locale].clickTips)\n    mind.container.appendChild(tips)\n    mind.map.addEventListener(\n      'click',\n      e => {\n        e.preventDefault()\n        tips.remove()\n        if (\n          e.target.parentElement.nodeName === 'T' ||\n          e.target.parentElement.nodeName === 'ROOT'\n        ) {\n          const to =mind.currentNode\n          mind.createLink(from,to)\n        } else {\n          console.log('取消连接')\n        }\n      },\n      {\n        once: true,\n      }\n    )\n  }\n  nodeLink.onclick = e => {\n    menuContainer.hidden = true\n    const from = mind.currentNode\n    const tips = createTips(i18n[locale].clickTips)\n    mind.container.appendChild(tips)\n    mind.map.addEventListener(\n      'click',\n      e => {\n        e.preventDefault()\n        tips.remove()\n        if (\n          e.target.parentElement.nodeName === 'T' ||\n          e.target.parentElement.nodeName === 'ROOT'\n        ) {\n          const to =mind.currentNode\n          if(!from.nodeObj.linkJump) from.nodeObj.linkJump=[]\n          from.nodeObj.linkJump.push({\n              toId:to.nodeObj.id,\n              title:to.nodeObj.topic\n            }\n          )\n          mind.shapeTpc(from,from.nodeObj)\n          mind.linkDiv()\n        } else {\n          console.log('取消连接')\n        }\n      },\n      {\n        once: true,\n      }\n    )\n  }\n}\n","import { NodeObj } from \"..\"\nimport { moveToNode } from \"../utils/dom\"\n\nconst img =`<svg style=\"width: 1.3em;height: 1.3em;fill: currentColor;overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"3464\"><path d=\"M909.061224 684.930612c-5.22449 0-10.44898-2.089796-14.628571-6.269388l-291.526531-291.52653c-4.179592-4.179592-10.971429-4.179592-14.628571 0l-143.673469 143.673469c-9.926531 9.926531-22.987755 15.15102-37.093878 15.151021s-27.167347-5.22449-37.093877-15.151021l-39.183674-39.183673c-4.179592-4.179592-10.971429-4.179592-14.628571 0l-187.036735 187.036734c-8.359184 8.359184-21.420408 8.359184-29.779592 0-8.359184-8.359184-8.359184-21.420408 0-29.779591l187.036735-187.036735c20.37551-20.37551 53.289796-20.37551 73.665306 0l39.183673 39.183673c2.612245 2.612245 5.746939 3.134694 7.314286 3.134694s4.702041-0.522449 7.314286-3.134694l143.673469-143.673469c20.37551-20.37551 53.289796-20.37551 73.665306 0l291.526531 291.526531c8.359184 8.359184 8.359184 21.420408 0 29.779591-3.657143 4.179592-8.881633 6.269388-14.106123 6.269388zM846.367347 867.265306H177.632653c-45.97551 0-83.591837-37.616327-83.591837-83.591837V240.326531c0-45.97551 37.616327-83.591837 83.591837-83.591837h668.734694c45.97551 0 83.591837 37.616327 83.591837 83.591837v543.346938c0 45.97551-37.616327 83.591837-83.591837 83.591837zM177.632653 198.530612c-22.987755 0-41.795918 18.808163-41.795918 41.795919v543.346938c0 22.987755 18.808163 41.795918 41.795918 41.795919h668.734694c22.987755 0 41.795918-18.808163 41.795918-41.795919V240.326531c0-22.987755-18.808163-41.795918-41.795918-41.795919H177.632653zM261.22449 303.020408m-52.244898 0a52.244898 52.244898 0 1 0 104.489796 0 52.244898 52.244898 0 1 0-104.489796 0ZM644.179592 768h-365.714286c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.897959h365.714286c11.493878 0 20.897959 9.404082 20.897959 20.897959s-9.404082 20.897959-20.897959 20.897959zM461.322449 670.82449h-182.857143c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.89796h182.857143c11.493878 0 20.897959 9.404082 20.897959 20.89796s-9.404082 20.897959-20.897959 20.897959z\" p-id=\"3465\"></path></svg>`\n\nfunction queryList(nodeData:NodeObj,cnt:number):string{\n    let res:string=''\n    for(let i =0;i<nodeData.children?.length;i++){\n        // res+=queryList(nodeData.children[i])`\n        res +=`<li class=\"sidebar-links\">${queryList(nodeData.children[i],cnt+1)}</li>`\n    }\n    if(!nodeData?.children||!nodeData.children.length){\n        return `<p class=\"sidebar-title\" id=\"sidebar${nodeData.id}\"><span class=\"arrow\" ${nodeData.topic?'':'style=\"margin-bottom:5px;\"'}\"></span><span>${nodeData.topic?nodeData.topic:img}</span></p>`\n    }else{\n        return `<p class=\"sidebar-title\" id=\"sidebar${nodeData.id}\"><span class=\"arrow ${cnt<2?'down':'right'}\" ${nodeData.topic?'':'style=\"margin-bottom:5px;\"'}></span><span>${nodeData.topic?nodeData.topic:img}</span></p><ul class=\"sidebar-heading open ${cnt<2?'':'hidden'}\">${res}</ul>`\n    }\n    \n}\n\nexport function updateSidebar(mind,sidebar:HTMLElement){\n    const nodeData=mind.nodeData\n    sidebar.innerHTML = `${queryList(nodeData,0)}`\n    sidebar.querySelectorAll('.sidebar-title').forEach((e:HTMLElement)=>{\n        e.onclick=()=>{\n              const down = e.querySelector('.down')\n              const right = e.querySelector('.right')\n              const curActive=mind.container.querySelector('.sidebar-title.active')\n              curActive?.classList.remove('active')\n              if(down){\n                e.parentElement.querySelector('ul').classList.add('hidden')\n                down.classList.replace('down','right')\n              }else if(right){\n                e.parentElement.querySelector('ul').classList.remove('hidden')\n                right.classList.replace('right','down')\n              }\n              e.classList.add('active')\n              moveToNode.call(mind,e.id.replace('sidebar',''))\n        }\n    })\n}\n\nexport default function(mind){\n    const sidebar = document.createElement('sidebar')\n    const nodeData=mind.nodeData\n    sidebar.innerHTML = `${queryList(nodeData,0)}`\n    mind.container.append(sidebar)\n}\n","import { expandNodeChild } from \"../interact\"\nimport { updateSidebar } from \"./sidebar\"\n\nconst createButton = (id, name) => {\n  const button = document.createElement('span')\n  button.id = id\n  button.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\">\n    <use xlink:href=\"#icon-${name}\"></use>\n  </svg>`\n  return button\n}\n\nlet timer = null;\nfunction debounce (fun,wait) {\n  return function () {\n  \tconst argu = arguments;\n  \t// 事件触发，如果之前有等待的事件，则清空计时，重新进行事件等待执行\n    if (timer) {\n      clearTimeout(timer);\n    }\n    timer = setTimeout(function () {\n      fun.apply(this, argu);\n    }, wait);\n  }\n}\n\nfunction createToolBarRBContainer(mind) {\n  const toolBarRBContainer = document.createElement('toolbar')\n  const fc = createButton('fullscreen', 'full')\n  const gc = createButton('toCenter', 'living')\n  const zo = createButton('zoomout', 'move')\n  const zi = createButton('zoomin', 'add')\n  const numberSelection=document.createElement('input')\n  numberSelection.className='numberSelection'\n  numberSelection.type='number'\n  numberSelection.min='2'\n  numberSelection.max='100'\n  numberSelection.step='1'\n  numberSelection.value=mind?.expandDeep?.toString()||'2'\n  numberSelection.oninput=debounce(()=>{\n    const data=mind.getAllDataWithAutoHide()\n    expandNodeChild(data?.nodeData)\n    mind.layout()\n    mind.linkDiv()\n  },300)\n\n  \n  const percentage = document.createElement('span')\n  percentage.innerText = '100%'\n  toolBarRBContainer.appendChild(numberSelection)\n  toolBarRBContainer.appendChild(fc)\n  toolBarRBContainer.appendChild(gc)\n  toolBarRBContainer.appendChild(zo)\n  toolBarRBContainer.appendChild(zi)\n  if (mind.uploadButton) {\n    const uploadButton = createUploadButton(mind)\n    toolBarRBContainer.appendChild(uploadButton)\n  }\n  // toolBarRBContainer.appendChild(percentage)\n  toolBarRBContainer.className = 'rb'\n  fc.onclick = () => {\n    mind.container.requestFullscreen()\n  }\n  gc.onclick = () => {\n    mind.toTopLeft()\n  }\n  zo.onclick = () => {\n    if (mind.scaleVal < 0.6) return\n    mind.scale((mind.scaleVal -= 0.2))\n  }\n  zi.onclick = () => {\n    if (mind.scaleVal > 1.6) return\n    mind.scale((mind.scaleVal += 0.2))\n  }\n  mind.bus.addListener('wheel',e=>{\n    const viewBTop=e.pageY-e.clientY+document.documentElement.clientHeight\n    const mindBTop = mind.container.getBoundingClientRect().top+window.scrollY-mind.container.clientTop+mind.container.clientHeight\n    //bottom 20\n    const offsetTop= mindBTop-viewBTop>0?mindBTop-viewBTop:0\n    const offset=offsetTop+toolBarRBContainer.clientHeight-20\n    if(offset>20&&offset<mind.container.clientHeight-toolBarRBContainer.clientHeight-20)\n      toolBarRBContainer.style.bottom=offset+'px'\n  })\n  return toolBarRBContainer\n}\n\n\nfunction createToolBarLTContainer(mind) {\n  const toolBarLTContainer = document.createElement('toolbar')\n  const menu  = createButton('sidebar', 'menu')\n  const l = createButton('tbltl', 'left')\n  const r = createButton('tbltr', 'right')\n  const s = createButton('tblts', 'side')\n  toolBarLTContainer.appendChild(menu)\n  toolBarLTContainer.appendChild(l)\n  toolBarLTContainer.appendChild(r)\n  toolBarLTContainer.appendChild(s)\n  toolBarLTContainer.className = 'lt'\n\n  \n  menu.onclick=() => {\n    const sidebar =document.querySelector('sidebar')\n    updateSidebar(mind,sidebar as HTMLElement)\n    if(sidebar.classList.contains('selected')){\n      sidebar.removeAttribute('class')\n    }else{\n      sidebar.setAttribute('class','selected')\n    }\n  }\n  l.onclick = () => {\n    mind.initLeft()\n  }\n  r.onclick = () => {\n    mind.initRight()\n  }\n  s.onclick = () => {\n    mind.initSide()\n  }\n  mind.bus.addListener('wheel',e=>{\n    const viewTop=e.pageY-e.clientY\n    const mindTop = mind.container.getBoundingClientRect().top+window.scrollY-mind.container.clientTop\n    const offset=viewTop-mindTop+20\n    if(offset>20&&offset<mind.container.clientHeight-toolBarLTContainer.clientHeight-20)\n      toolBarLTContainer.style.top=offset+'px'\n  })\n  return toolBarLTContainer\n}\n\nfunction createCloseButton(mind){\n  const close = createButton('close','close')\n  close.onclick=()=>{\n    console.log('关闭')\n    mind.bus.fire('close',{})\n  }\n  return close\n}\n\nfunction createUploadButton(mind){\n  const button = document.createElement('span')\n  button.innerHTML = `\n  <form action=\"\" enctype=\"multipart/form-data\" method=\"post\" class=\"fm\">\n    <input type=\"file\" name=\"file\" class=\"selectFile\">\n  </form>\n  <svg t=\"1662362270319\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2591\" width=\"200\" height=\"200\">\n  <path d=\"M324.6592 352.13312c7.1168 0 13.34272-2.66752 18.688-8.00768l141.50656-141.51168v443.2128c0 15.12448 11.5712 26.70592 26.7008 26.70592s26.7008-11.58144 26.7008-26.70592V202.61376l141.50656 141.51168c5.34528 5.34016 12.4672 8.00768 18.688 8.00768 6.23616 0 13.35296-2.66752 18.69312-8.00768 10.68032-10.68032 10.68032-27.59168 0-37.38112l-186.9056-186.89536c-0.88576-0.89088-2.66752-2.66752-4.44416-3.5584-0.88576 0-1.77664-0.89088-1.77664-0.89088-0.896-0.88576-1.78688-0.88576-2.67776-1.77664-0.89088 0-1.77664-0.89088-2.66752-0.89088-0.896 0-1.77664-0.89088-2.66752-0.89088a21.67296 21.67296 0 0 0-10.68032 0c-0.89088 0-1.77664 0.89088-2.66752 0.89088-0.89088 0-1.78176 0.89088-2.67264 0.89088-0.89088 0-1.77664 0.89088-2.66752 1.77664-0.89088 0-1.77664 0.89088-1.77664 0.89088-1.78176 0.89088-2.66752 1.78176-4.4544 3.5584L304.18944 306.74432c-10.68032 10.68032-10.68032 27.59168 0 37.38112 7.1168 5.34016 13.34784 8.00768 20.46976 8.00768z\" fill=\"#333333\" p-id=\"2592\"></path><path d=\"M929.84832 556.83072c-15.1296 0-26.7008 11.5712-26.7008 26.7008v206.47936c0 38.272-31.15008 69.42208-69.41696 69.42208H189.37856c-38.26688 0-69.41696-31.15008-69.41696-69.42208v-206.47936c0-15.1296-11.5712-26.7008-26.7008-26.7008s-26.69568 11.5712-26.69568 26.7008v206.47936c0 67.6352 55.17824 122.81856 122.81856 122.81856h645.23776c67.64544 0 122.82368-55.18336 122.82368-122.81856v-206.47936c-0.896-15.1296-12.4672-26.7008-27.5968-26.7008z\" \n  fill=\"#333333\" p-id=\"2593\"></path>\n  </svg>\n  `\n  const fm = button.children[0];\n  fm.addEventListener(\"change\", e => {\n    mind.bus.fire('upload', fm)\n  })\n  return button\n}\n\n\nexport default function(mind) {\n  mind.container.append(createToolBarRBContainer(mind))\n  mind.container.append(createToolBarLTContainer(mind))\n  mind.closeButton && mind.container.append(createCloseButton(mind))\n}\n","import i18n from '../i18n'\n\nconst createDiv = (id) => {\n  const div = document.createElement('div')\n  div.id = id\n  return div\n}\n\nconst colorList = [\n  '#2c3e50',\n  '#34495e',\n  '#7f8c8d',\n  '#94a5a6',\n  '#bdc3c7',\n  '#ffffff',\n  '#8e44ad',\n  '#9b59b6',\n  '#2980b9',\n  '#3298db',\n  '#c0392c',\n  '#e74c3c',\n  '#d35400',\n  '#f39c11',\n  '#f1c40e',\n  '#17a085',\n  '#27ae61',\n  '#2ecc71',\n]\n\nexport default function(mind) {\n  const locale = i18n[mind.locale] ? mind.locale : 'en'\n  let bgOrFont\n  const styleDiv = createDiv('nm-style')\n  const tagDiv = createDiv('nm-tag')\n  const iconDiv = createDiv('nm-icon')\n  //different from \"linkDiv\" which is aims to link nodes with svg,\n  const linkDiv = createDiv('nm-link')\n  const remarkDiv = createDiv('nm-remark')\n  styleDiv.innerHTML = `\n      <div class=\"nm-fontsize-container\">\n        ${['15', '24', '32']\n    .map(size => {\n      return `<div class=\"size\"  data-size=\"${size}\">\n        <svg class=\"icon\" style=\"width: ${size}px;height: ${size}px\" aria-hidden=\"true\">\n          <use xlink:href=\"#icon-a\"></use>\n        </svg></div>`\n    })\n    .join('')}<div class=\"bold\"><svg class=\"icon\" aria-hidden=\"true\">\n  <use xlink:href=\"#icon-B\"></use>\n  </svg></div>\n      </div>\n      <div class=\"nm-fontcolor-container\">\n        ${colorList\n    .map(color => {\n      return `<div class=\"split6\"><div class=\"palette\" data-color=\"${color}\" style=\"background-color: ${color};\"></div></div>`\n    })\n    .join('')}\n      </div>\n      <div class=\"bof\">\n      <span class=\"font\">${i18n[locale].font}</span>\n      <span class=\"background\">${i18n[locale].background}</span>\n      </div>\n  `\n  tagDiv.innerHTML = `${i18n[locale].tag}<textarea class=\"nm-tag\" tabindex=\"-1\" placeholder=\"${i18n[locale].tagsSeparate}\" /><br>`\n  iconDiv.innerHTML = `${i18n[locale].icon}<textarea class=\"nm-icon\" tabindex=\"-1\" placeholder=\"${i18n[locale].iconsSeparate}\" /><br>`\n  linkDiv.innerHTML = `${i18n[locale].hyperlink}<textarea class=\"nm-link\" tabindex=\"-1\" placeholder=\"${i18n[locale].linkSeparate}\" /><br>`\n  remarkDiv.innerHTML = `${i18n[locale].remark}<textarea class=\"nm-remark\" tabindex=\"-1\" placeholder=\"${i18n[locale].reamrkSeparate}\" /><br>`\n\n  function addDropTextarea(xxxdiv:HTMLElement){\n    xxxdiv.ondblclick=(e)=>{\n      const textarea=document.createElement('textarea')\n      const preTextarea=xxxdiv.children[0] as HTMLTextAreaElement\n      const maxHeight=mind.container.offsetHeight-xxxdiv.offsetTop-60\n      const minHeight=30\n      const getHeight=(curHeight:number)=>{\n        if(curHeight<minHeight){\n          return minHeight\n        }else if(curHeight>maxHeight){\n          return maxHeight\n        }else{\n          return curHeight\n        }\n      }\n      textarea.value=preTextarea.value\n      textarea.style.position='absolute'\n      textarea.style.left=preTextarea.offsetLeft+'px'\n      textarea.style.top=preTextarea.offsetTop-10+'px'\n      textarea.style.height=getHeight(preTextarea.scrollHeight) + 'px'\n      textarea.style.width=preTextarea.offsetWidth+'px'\n      textarea.oninput=(e:Event&{target:HTMLTextAreaElement})=>{\n        let height=e.target.scrollHeight\n        textarea.style.height =getHeight(height) + 'px';\n      }\n      textarea.onblur=e=>{\n        preTextarea.value=textarea.value\n        preTextarea.dispatchEvent(new CustomEvent('change'));\n        textarea.remove()\n      }\n      xxxdiv.appendChild(textarea)\n      textarea.focus()\n    }\n  }\n  addDropTextarea(tagDiv)\n  addDropTextarea(iconDiv)\n  addDropTextarea(linkDiv)\n  addDropTextarea(remarkDiv)\n  const menuContainer = document.createElement('nmenu')\n  menuContainer.innerHTML = `\n  <div class=\"button-container\"><svg class=\"icon\" aria-hidden=\"true\">\n  <use xlink:href=\"#icon-close\"></use>\n  </svg></div>\n  `\n  menuContainer.appendChild(styleDiv)\n  menuContainer.appendChild(tagDiv)\n  menuContainer.appendChild(iconDiv)\n  menuContainer.appendChild(linkDiv) \n  menuContainer.appendChild(remarkDiv)\n  menuContainer.hidden = true\n\n  function clearSelect(klass, remove) {\n    var elems = mind.container.querySelectorAll(klass)\n    ;[].forEach.call(elems, function(el) {\n      el.classList.remove(remove)\n    })\n  }\n\n  mind.container.append(menuContainer)\n  const sizeSelector = menuContainer.querySelectorAll('.size')\n  const bold:HTMLElement = menuContainer.querySelector('.bold')\n  const buttonContainer:HTMLElement = menuContainer.querySelector('.button-container')\n  const fontBtn:HTMLElement = menuContainer.querySelector('.font')\n  const tagInput:HTMLInputElement = mind.container.querySelector('.nm-tag')\n  const iconInput:HTMLInputElement = mind.container.querySelector('.nm-icon')\n  const linkInput:HTMLInputElement = mind.container.querySelector('.nm-link')\n  const remarkInput:HTMLInputElement = mind.container.querySelector('.nm-remark')\n  menuContainer.onclick = e => {\n    if (!mind.currentNode) return\n    const nodeObj = mind.currentNode.nodeObj\n    const target = e.target as HTMLElement\n    if (target.className === 'palette') {\n      if (!nodeObj.style) nodeObj.style = {}\n      clearSelect('.palette', 'nmenu-selected')\n      target.className = 'palette nmenu-selected'\n      if (bgOrFont === 'font') {\n        nodeObj.style.color = target.dataset.color\n      } else if (bgOrFont === 'background') {\n        nodeObj.style.background = target.dataset.color\n      }\n      mind.updateNodeStyle(nodeObj)\n    } else if (target.className === 'background') {\n      clearSelect('.palette', 'nmenu-selected')\n      bgOrFont = 'background'\n      target.className = 'background selected'\n      target.previousElementSibling.className = 'font'\n      if (nodeObj.style && nodeObj.style.background) {\n        menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.background + '\"]'\n        ).className = 'palette nmenu-selected'\n      }\n    } else if (target.className === 'font') {\n      clearSelect('.palette', 'nmenu-selected')\n      bgOrFont = 'font'\n      target.className = 'font selected'\n      target.nextElementSibling.className = 'background'\n      if (nodeObj.style && nodeObj.style.color) {\n        menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.color + '\"]'\n        ).className = 'palette nmenu-selected'\n      }\n    }\n  }\n  Array.from(sizeSelector).map(\n    dom => {\n      (dom as HTMLElement).onclick = e => {\n        if (!mind.currentNode.nodeObj.style) mind.currentNode.nodeObj.style = {}\n        clearSelect('.size', 'size-selected')\n        const size = e.currentTarget as HTMLElement\n        mind.currentNode.nodeObj.style.fontSize = size.dataset.size\n        size.className = 'size size-selected'\n        mind.updateNodeStyle(mind.currentNode.nodeObj)\n      }\n    }\n  )\n  bold.onclick = (e:MouseEvent & { currentTarget: Element}) => {\n    if (!mind.currentNode.nodeObj.style) mind.currentNode.nodeObj.style = {}\n    if (mind.currentNode.nodeObj.style.fontWeight === 'bold') {\n      delete mind.currentNode.nodeObj.style.fontWeight\n      e.currentTarget.className = 'bold'\n      mind.updateNodeStyle(mind.currentNode.nodeObj)\n    } else {\n      mind.currentNode.nodeObj.style.fontWeight = 'bold'\n      e.currentTarget.className = 'bold size-selected'\n      mind.updateNodeStyle(mind.currentNode.nodeObj)\n    }\n  }\n  tagInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      let newTags\n      if(e.target.value==='')\n        newTags=[]\n      else\n        newTags = e.target.value.split(',')\n      mind.updateNodeTags(mind.currentNode.nodeObj, newTags)\n    }\n  }\n  iconInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const newIcons = e.target.value.split(',')\n      mind.updateNodeIcons(mind.currentNode.nodeObj, newIcons)\n    }\n  }\n  linkInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const link = e.target.value\n      mind.updateNodeHyperLink(mind.currentNode.nodeObj, link)\n    }\n  }\n  remarkInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const input = e.target.value\n      mind.updateNodeRemark(mind.currentNode.nodeObj, input)\n    }\n  }\n  let state = 'open'\n  buttonContainer.onclick = e => {\n    if (state === 'open') {\n      state = 'close'\n      menuContainer.className = 'close'\n      buttonContainer.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\"><use xlink:href=\"#icon-menu\"></use></svg>`\n    } else {\n      state = 'open'\n      menuContainer.className = ''\n      buttonContainer.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\"><use xlink:href=\"#icon-close\"></use></svg>`\n    }\n  }\n  mind.bus.addListener('unselectNode', function() {\n    menuContainer.hidden = true\n  })\n  mind.bus.addListener('selectNode', function(nodeObj, clickEvent) {\n    if (!clickEvent) return\n    menuContainer.hidden = false\n    clearSelect('.palette', 'nmenu-selected')\n    clearSelect('.size', 'size-selected')\n    clearSelect('.bold', 'size-selected')\n    bgOrFont = 'font'\n    fontBtn.className = 'font selected'\n    fontBtn.nextElementSibling.className = 'background'\n    if (nodeObj.style) {\n      if (nodeObj.style.fontSize) {\n        const dataSize = menuContainer.querySelector(\n          '.size[data-size=\"' + nodeObj.style.fontSize + '\"]'\n        )\n        if(dataSize) dataSize.className = 'size size-selected'\n      }\n      if (nodeObj.style.fontWeight) { \n        const dataWeight = menuContainer.querySelector('.bold')\n        if(dataWeight) dataWeight.className = 'bold size-selected' \n      }\n      if (nodeObj.style.color) {\n        const dataColor=menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.color + '\"]'\n        )\n        if(dataColor) dataColor.className = 'palette nmenu-selected'\n      }\n    }\n    if (nodeObj.tags) {\n      tagInput.value = nodeObj.tags.join(',')\n    } else {\n      tagInput.value = '' \n    }\n    if (nodeObj.icons) {\n      iconInput.value = nodeObj.icons.join(',')\n    } else {\n      iconInput.value = ''\n    }\n    linkInput.value=''\n    if (nodeObj.hyperLink) {\n      linkInput.value = nodeObj.hyperLink\n    } \n    if(nodeObj.linkJump){\n      if(linkInput.value.length>0) linkInput.value+=','\n      linkInput.value += nodeObj.linkJump.map(val=>val.title).reduce((preVal,curVal,index)=>preVal+(index?',':'')+curVal,'')\n    }\n    if (nodeObj.remark) {\n      remarkInput.value = nodeObj.remark\n    } else {\n      remarkInput.value = ''\n    }\n  })\n}\n","import { dragMoveHelper, throttle } from '../utils/index'\nimport { findEle as E, Topic, Group } from '../utils/dom'\n// https://html.spec.whatwg.org/multipage/dnd.html#drag-and-drop-processing-model\n\nconst $d = document\nconst insertPreview = function(el, insertLocation) {\n  if (!insertLocation) {\n    clearPreview(el)\n    return el\n  }\n  const query = el.getElementsByClassName('insert-preview')\n  const className = `insert-preview ${insertLocation} show`\n  if (query.length > 0) {\n    query[0].className = className\n  } else {\n    const insertPreviewEL = $d.createElement('div')\n    insertPreviewEL.className = className\n    el.appendChild(insertPreviewEL)\n  }\n  return el\n}\n\nconst clearPreview = function(el) {\n  if (!el) return\n  const query = el.getElementsByClassName('insert-preview')\n  for (const queryElement of query || []) {\n    queryElement.remove()\n  }\n}\n\nconst canPreview = function(el:Element, dragged:Topic) {\n  const isContain = dragged.parentNode.parentNode.contains(el)\n  return (\n    el &&\n    el.tagName === 'TPC' &&\n    el !== dragged &&\n    !isContain &&\n    (el as Topic).nodeObj.root !== true\n  )\n}\n\nexport default function(mind) {\n  let dragged: Topic\n  let insertLocation:string\n  let meet: Element\n  const threshold = 12\n\n  mind.map.addEventListener('dragstart', function(e) {\n    dragged = e.target\n    ;(dragged.parentNode.parentNode as Group).style.opacity = '0.5'\n    dragMoveHelper.clear()\n  })\n\n  mind.map.addEventListener('dragend', async function(e: DragEvent) {\n    (e.target as HTMLElement).style.opacity = ''\n    clearPreview(meet)\n    const obj = dragged.nodeObj\n    switch (insertLocation) {\n      case 'before':\n        mind.moveNodeBefore(dragged, meet)\n        mind.selectNode(E(obj.id))\n        break\n      case 'after':\n        mind.moveNodeAfter(dragged, meet)\n        mind.selectNode(E(obj.id))\n        break\n      case 'in':\n        mind.moveNode(dragged, meet)\n        break\n    }\n    ;(dragged.parentNode.parentNode as Group).style.opacity = '1'\n    dragged = null\n  })\n\n  mind.map.addEventListener('dragover', throttle(function(e: DragEvent) {\n    // console.log('drag', e)\n    clearPreview(meet)\n    // minus threshold infer that postion of the cursor is above topic\n    const topMeet = $d.elementFromPoint(\n      e.clientX,\n      e.clientY - threshold\n    )\n    if (canPreview(topMeet, dragged)) {\n      meet = topMeet\n      const y = topMeet.getBoundingClientRect().y\n      if (e.clientY > y + topMeet.clientHeight) {\n        insertLocation = 'after'\n      } else if (e.clientY > y + topMeet.clientHeight / 2) {\n        insertLocation = 'in'\n      }\n    } else {\n      const bottomMeet = $d.elementFromPoint(\n        e.clientX,\n        e.clientY + threshold\n      )\n      if (canPreview(bottomMeet, dragged)) {\n        meet = bottomMeet\n        const y = bottomMeet.getBoundingClientRect().y\n        if (e.clientY < y) {\n          insertLocation = 'before'\n        } else if (e.clientY < y + bottomMeet.clientHeight / 2) {\n          insertLocation = 'in'\n        }\n      } else {\n        insertLocation = meet = null\n      }\n    }\n    if (meet) insertPreview(meet, insertLocation)\n  }, 200))\n}\n","export default function(mind) {\n  const key2func = {\n    13: () => {\n      // enter\n      mind.insertSibling()\n    },\n    9: () => {\n      // tab\n      mind.addChild()\n    },\n    17: e => {\n      // controll\n      mind.ctrlRepeat=true\n      console.log('按下controll')\n    },\n    91: e => {\n      // command\n      mind.ctrlRepeat=true\n      console.log('按下command')\n    },\n    113: () => {\n      // f2\n      mind.beginEdit()\n    },\n    38: () => {\n      // up\n      mind.selectPrevSibling()\n    },\n    40: () => {\n      // down\n      mind.selectNextSibling()\n    },\n    37: () => {\n      // left\n      if (!mind.currentNode) return\n      if (mind.currentNode.offsetParent.offsetParent.className === 'rhs') {\n        mind.selectParent()\n      } else if (\n        mind.currentNode.offsetParent.offsetParent.className === 'lhs' ||\n        mind.currentNode.nodeObj.root\n      ) {\n        mind.selectFirstChild()\n      }\n    },\n    39: () => {\n      // right\n      if (!mind.currentNode) return\n      if (\n        mind.currentNode.offsetParent.offsetParent.className === 'rhs' ||\n        mind.currentNode.nodeObj.root\n      ) {\n        mind.selectFirstChild()\n      } else if (\n        mind.currentNode.offsetParent.offsetParent.className === 'lhs'\n      ) {\n        mind.selectParent()\n      }\n    },\n    33() {\n      // pageUp\n      mind.moveUpNode()\n    },\n    34() {\n      // pageDown\n      mind.moveDownNode()\n    },\n    67(e) {\n      if (e.metaKey || e.ctrlKey) {\n      // ctrl c\n        mind.waitCopy = mind.currentNode\n      }\n    },\n    86(e) {\n      if (!mind.waitCopy) return\n      if (e.metaKey || e.ctrlKey) {\n      // ctrl v\n        mind.copyNode(mind.waitCopy, mind.currentNode)\n        mind.waitCopy = null\n      }\n    },\n    // ctrl z\n    90: e => {\n      if (!mind.allowUndo) return\n      if (e.metaKey || e.ctrlKey) mind.undo()\n    },\n    // ctrl +\n    187: e => {\n      if (e.metaKey || e.ctrlKey) {\n        if (mind.scaleVal > 1.6) return\n        mind.scale((mind.scaleVal += 0.2))\n      }\n    },\n    // ctrl -\n    189: e => {\n      if (e.metaKey || e.ctrlKey) {\n        if (mind.scaleVal < 0.6) return\n        mind.scale((mind.scaleVal -= 0.2))\n      }\n    },\n  }\n  mind.map.onkeydown = e => {\n    // console.log(e)\n    // e.preventDefault()\n    if (!mind.editable) return\n    // console.log(e, e.target)\n    if (e.target !== e.currentTarget) {\n      // input\n      return\n    }\n    if (e.keyCode === 8 || e.keyCode === 46) {\n      // del,backspace\n      if (mind.currentLink) mind.removeLink()\n      else mind.removeNode()\n    } else {\n      key2func[e.keyCode] && key2func[e.keyCode](e)\n    }\n  }\n  mind.map.onkeyup = e => {\n    if (e.keyCode === 17 || e.keyCode === 91) {\n      mind.ctrlRepeat=false\n    }\n  }\n}\n","export default function(mind, option?) {\n  const createLi = (id, name) => {\n    const div = document.createElement('div')\n    div.id = id\n    div.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\">\n    <use xlink:href=\"#icon-${name}\"></use>\n  </svg>`\n    return div\n  }\n\n  const add_child = createLi('cm-add_child', 'zijiedian')\n  const add_sibling = createLi('cm-add_sibling', 'tongjijiedian-')\n  const remove_child = createLi('cm-remove_child', 'shanchu2')\n  // let focus = createLi('cm-fucus', i18n[locale].focus, '')\n  // let unfocus = createLi('cm-unfucus', i18n[locale].cancelFocus, '')\n  const up = createLi('cm-up', 'rising')\n  const down = createLi('cm-down', 'falling')\n  const edit = createLi('cm-edit', 'edit')\n  // let link = createLi('cm-down', i18n[locale].link, '')\n\n  const menuUl = document.createElement('ul')\n  menuUl.className = 'menu-list'\n  // if (!option || option.link) {\n  //   menuUl.appendChild(link)\n  // }\n  if (option && option.extend) {\n    for (let i = 0; i < option.extend.length; i++) {\n      const item = option.extend[i]\n      const dom = createLi(item.name, item.name)\n      menuUl.appendChild(dom)\n      dom.onclick = e => {\n        item.onclick(e)\n      }\n    }\n  }\n  const menuContainer = document.createElement('mmenu')\n  menuContainer.appendChild(add_child)\n  menuContainer.appendChild(add_sibling)\n  menuContainer.appendChild(remove_child)\n  // if (!option || option.focus) {\n  //   menuContainer.appendChild(focus)\n  //   menuContainer.appendChild(unfocus)\n  // }\n  menuContainer.appendChild(up)\n  menuContainer.appendChild(down)\n  menuContainer.appendChild(edit)\n  menuContainer.hidden = true\n\n  mind.container.append(menuContainer)\n  let isRoot = true\n  // mind.container.onclick = function (e) {\n  //   e.preventDefault()\n  //   // console.log(e.pageY, e.screenY, e.clientY)\n  //   let target = e.target\n  //   if (target.tagName === 'TPC') {\n  //     if (target.parentElement.tagName === 'ROOT') {\n  //       isRoot = true\n  //     } else {\n  //       isRoot = false\n  //     }\n  //     // if (isRoot) {\n  //     //   focus.className = 'disabled'\n  //     //   up.className = 'disabled'\n  //     //   down.className = 'disabled'\n  //     //   add_sibling.className = 'disabled'\n  //     //   remove_child.className = 'disabled'\n  //     // } else {\n  //     //   focus.className = ''\n  //     //   up.className = ''\n  //     //   down.className = ''\n  //     //   add_sibling.className = ''\n  //     //   remove_child.className = ''\n  //     // }\n  //     mind.selectNode(target)\n  //     menuContainer.hidden = false\n  //     let height = menuUl.offsetHeight\n  //     let width = menuUl.offsetWidth\n  //     let rect = target.getBoundingClientRect()\n  //     // menuUl.style.top = rect.top - 10 - height + 'px'\n  //     // menuUl.style.left = rect.left - (width - rect.width) / 2 + 'px'\n  //     // menuUl.style.left = e.clientX + 'px'\n  //   }\n  // }\n\n  mind.bus.addListener('unselectNode', function() {\n    menuContainer.hidden = true\n  })\n  mind.bus.addListener('selectNode', function(nodeObj) {\n    menuContainer.hidden = false\n    if (nodeObj.root) {\n      isRoot = true\n    } else {\n      isRoot = false\n    }\n  })\n  menuContainer.onclick = e => {\n    if (e.target === menuContainer) menuContainer.hidden = true\n  }\n\n  add_child.onclick = e => {\n    mind.addChild()\n  }\n  add_sibling.onclick = e => {\n    if (isRoot) return\n    mind.insertSibling()\n  }\n  remove_child.onclick = e => {\n    if (isRoot) return\n    mind.removeNode()\n  }\n  // focus.onclick = e => {\n  //   if (isRoot) return\n  //   mind.focusNode(mind.currentNode)\n  //   menuContainer.hidden = true\n  // }\n  // unfocus.onclick = e => {\n  //   mind.cancelFocus()\n  //   menuContainer.hidden = true\n  // }\n  up.onclick = e => {\n    if (isRoot) return\n    mind.moveUpNode()\n  }\n  down.onclick = e => {\n    if (isRoot) return\n    mind.moveDownNode()\n  }\n  edit.onclick = e => {\n    mind.beginEdit()\n  }\n  // link.onclick = e => {\n  //   let from = mind.currentNode\n  //   mind.map.addEventListener(\n  //     'click',\n  //     e => {\n  //       e.preventDefault()\n  //       if (\n  //         e.target.parentElement.nodeName === 'T' ||\n  //         e.target.parentElement.nodeName === 'ROOT'\n  //       ) {\n  //         mind.createLink(from, mind.currentNode)\n  //       } else {\n  //         console.log('取消连接')\n  //       }\n  //     },\n  //     {\n  //       once: true,\n  //     }\n  //   )\n  // }\n}\n","export default function Bus() {\n  this.handlers = {}\n}\nBus.prototype = {\n  showHandler: function() {\n    console.log(this.handlers)\n  },\n  addListener: function(type, handler) {\n    if (this.handlers[type] === undefined) this.handlers[type] = []\n    this.handlers[type].push(handler)\n  },\n  fire: function(type, ...payload) {\n    if (this.handlers[type] instanceof Array) {\n      var handlers = this.handlers[type]\n      for (var i = 0; i < handlers.length; i++) {\n        handlers[i](...payload)\n      }\n    }\n  },\n  removeListener: function(type, handler) {\n    if (!this.handlers[type]) return\n    var handlers = this.handlers[type]\n    if (!handler) {\n      handlers.length = 0\n    } else if (handlers.length) {\n      for (var i = 0; i < handlers.length; i++) {\n        if (handlers[i] === handler) {\n          this.handlers[type].splice(i, 1)\n        }\n      }\n    }\n  },\n}\n","!function(t){var c,l,a,e,o,i,n='<svg><symbol id=\"icon-edit\" viewBox=\"0 0 1024 1024\"><path d=\"M423.765333 128a42.666667 42.666667 0 0 1 3.2 85.205333L423.765333 213.333333H234.666667a64 64 0 0 0-63.872 60.245334L170.666667 277.333333v512a64 64 0 0 0 60.245333 63.872L234.666667 853.333333h512a64 64 0 0 0 63.872-60.245333L810.666667 789.333333v-189.098666a42.666667 42.666667 0 0 1 85.205333-3.2l0.128 3.2V789.333333a149.333333 149.333333 0 0 1-144.213333 149.248L746.666667 938.666667h-512a149.333333 149.333333 0 0 1-149.248-144.213334L85.333333 789.333333v-512a149.333333 149.333333 0 0 1 144.213334-149.248L234.666667 128h189.098666z m324.949334-53.248a42.666667 42.666667 0 0 1 60.330666 0l150.869334 150.869333a42.666667 42.666667 0 0 1 0 60.330667l-329.386667 329.386667a42.666667 42.666667 0 0 1-29.44 12.458666l-153.386667 2.517334a42.666667 42.666667 0 0 1-43.349333-43.349334l2.56-153.386666a42.666667 42.666667 0 0 1 12.458667-29.44z m30.165333 90.496L491.946667 452.266667l-1.493334 91.989333 92.032-1.493333 286.976-286.976-90.538666-90.538667z\"  ></path></symbol><symbol id=\"icon-rising\" viewBox=\"0 0 1024 1024\"><path d=\"M553.173333 803.84h-64l0.021334-474.581333-224.021334 224-45.269333-45.226667L521.6 206.293333l301.717333 301.696-45.269333 45.269334-224.853333-224.896v475.477333z\"  ></path></symbol><symbol id=\"icon-falling\" viewBox=\"0 0 1024 1024\"><path d=\"M553.173333 238.314667h-64l0.021334 474.602666-224.021334-224-45.269333 45.226667L521.6 835.861333l301.717333-301.717333-45.269333-45.226667-224.853333 224.853334V238.336z\"  ></path></symbol><symbol id=\"icon-shanchu2\" viewBox=\"0 0 1024 1024\"><path d=\"M516.60601807 107.93026734c-82.64382935 0-149.71865844 65.51751709-152.5729065 147.77160644H171.37136841c-21.40603638 0-38.92044068 17.38504028-38.92044068 38.92126465 0 21.40686036 17.38504028 38.92208862 38.92126466 38.92208862h42.94308471v435.40136719c0 81.73498536 55.39828492 148.55026245 123.90106201 148.55026245h348.99444581c68.37341309 0 123.90106201-66.42553711 123.901062-148.55026245V333.80477906h38.92126465c21.40686036 0 38.92126464-17.38586426 38.92126465-38.92208863 0-21.40686036-17.38504028-38.92126464-38.92126465-38.92126465H668.91854859C666.45321656 173.44860839 599.24902344 107.93109131 516.60601807 107.93109131z m-79.65939331 147.77160644c2.85424805-42.16442872 37.2354126-74.85809326 79.78875732-74.85809326s76.93450927 32.82302857 79.39984131 74.85809326H436.94662476z m-98.86047364 589.01165771c-24.2611084 0-50.98754883-31.13717651-50.98754883-75.76693725V333.80477906h450.97036744V769.33551026c0 44.50039673-26.72644043 75.76776123-50.98754884 75.76776122H338.08615112v-0.38973999z m0 0\"  ></path><path d=\"M390.37063599 751.17263794c17.77313232 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.77478027 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.27124023 40.08883667 32.43493653 40.08883667z m117.41308594 0c17.7739563 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.7739563 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.66098023 40.08883667 32.43493653 40.08883667z m123.51049804 0c17.7739563 0 32.43493653-17.7739563 32.43493652-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43493652-40.08966065-17.7739563 0-32.43411255 17.77478027-32.43411255 40.08966065v228.72875976c0 22.18469239 14.14105224 40.08883667 32.43411255 40.08883667z m0 0\"  ></path></symbol><symbol id=\"icon-zijiedian\" viewBox=\"0 0 1024 1024\"><path d=\"M312.208 472c19.568-157.856 153.432-280 315.656-280 175.68 0 318.112 143.272 318.112 320S803.552 832 627.864 832c-162.224 0-296.08-122.144-315.656-280H120a40 40 0 0 1 0-80h192.208zM632 752c132.552 0 240-107.448 240-240 0-132.552-107.448-240-240-240-132.552 0-240 107.448-240 240 0 132.552 107.448 240 240 240z m-40-280v-80a40 40 0 0 1 80 0v80h80a40 40 0 0 1 0 80h-80v80a40 40 0 0 1-80 0v-80h-80a40 40 0 0 1 0-80h80z\"  ></path></symbol><symbol id=\"icon-tongjijiedian-\" viewBox=\"0 0 1024 1024\"><path d=\"M803.84 131.626667H410.24A59.733333 59.733333 0 0 0 350.506667 192v45.226667H199.68a51.626667 51.626667 0 0 0-51.626667 51.626666v465.92a51.626667 51.626667 0 0 0 51.626667 51.626667h187.52v-55.466667h-162.133333a21.333333 21.333333 0 0 1-21.333334-21.333333V313.386667a21.333333 21.333333 0 0 1 21.333334-21.333334h125.653333v64a59.733333 59.733333 0 0 0 59.733333 59.733334h393.386667a59.733333 59.733333 0 0 0 59.733333-59.733334V192a59.733333 59.733333 0 0 0-59.733333-60.373333z m4.266667 224.64a4.266667 4.266667 0 0 1-4.266667 4.266666H410.24a4.266667 4.266667 0 0 1-4.266667-4.266666V192a4.266667 4.266667 0 0 1 4.266667-4.266667h393.6a4.266667 4.266667 0 0 1 4.266667 4.266667zM716.16 749.44h-81.28v-81.493333a27.733333 27.733333 0 0 0-55.466667 0v81.28h-81.493333a27.733333 27.733333 0 1 0 0 55.466666h81.28v81.28a27.733333 27.733333 0 1 0 55.466667 0v-81.066666h81.28a27.733333 27.733333 0 0 0 0-55.466667z\"  ></path></symbol><symbol id=\"icon-close\" viewBox=\"0 0 1024 1024\"><path d=\"M557.312 513.248l265.28-263.904c12.544-12.48 12.608-32.704 0.128-45.248-12.512-12.576-32.704-12.608-45.248-0.128L512.128 467.904l-263.04-263.84c-12.448-12.48-32.704-12.544-45.248-0.064-12.512 12.48-12.544 32.736-0.064 45.28l262.976 263.776L201.6 776.8c-12.544 12.48-12.608 32.704-0.128 45.248a31.937 31.937 0 0 0 22.688 9.44c8.16 0 16.32-3.104 22.56-9.312l265.216-263.808 265.44 266.24c6.24 6.272 14.432 9.408 22.656 9.408a31.94 31.94 0 0 0 22.592-9.344c12.512-12.48 12.544-32.704 0.064-45.248L557.312 513.248z\" fill=\"\" ></path></symbol><symbol id=\"icon-menu\" viewBox=\"0 0 1024 1024\"><path d=\"M109.714 292.571h804.572c21.943 0 36.571-21.942 36.571-43.885 0-14.629-14.628-29.257-36.571-29.257H109.714c-21.943 0-36.571 14.628-36.571 36.571 0 14.629 14.628 36.571 36.571 36.571zM914.286 512H109.714c-21.943 0-36.571 14.629-36.571 36.571 0 14.629 14.628 36.572 36.571 36.572h804.572c21.943 0 36.571-21.943 36.571-43.886 0-14.628-14.628-29.257-36.571-29.257z m0 292.571H109.714c-21.943 0-36.571 14.629-36.571 36.572s14.628 36.571 36.571 36.571h804.572c21.943 0 36.571-21.943 36.571-36.571 0-21.943-14.628-36.572-36.571-36.572z\"  ></path></symbol><symbol id=\"icon-right\" viewBox=\"0 0 1024 1024\"><path d=\"M385 560.69999999L385 738.9c0 36.90000001 26.4 68.5 61.3 68.5l150.2 0c1.5 0 3-0.1 4.5-0.3 10.2 38.7 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-42 0-77.3 28.6-87.5 67.39999999-1.4-0.3-2.9-0.4-4.5-0.39999999L446.3 760.4c-6.8 0-14.3-8.9-14.3-21.49999999l0-427.00000001c0-12.7 7.40000001-21.5 14.30000001-21.5l150.19999999 0c1.5 0 3-0.2 4.5-0.4 10.2 38.8 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.4 0-49.9-40.5-90.6-90.5-90.59999999-42 0-77.3 28.6-87.5 67.39999999-1.4-0.2-2.9-0.4-4.49999999-0.4L446.3 243.3c-34.80000001 0-61.3 31.6-61.3 68.50000001L385 513.7l-79.1 0c-10.4-38.5-45.49999999-67-87.4-67-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c41.79999999 0 77.00000001-28.4 87.4-67L385 560.69999999z\" fill=\"#333333\" ></path></symbol><symbol id=\"icon-left\" viewBox=\"0 0 1024 1024\"><path d=\"M639 463.30000001L639 285.1c0-36.90000001-26.4-68.5-61.3-68.5l-150.2 0c-1.5 0-3 0.1-4.5 0.3-10.2-38.7-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c42 0 77.3-28.6 87.5-67.39999999 1.4 0.3 2.9 0.4 4.5 0.39999999L577.7 263.6c6.8 0 14.3 8.9 14.3 21.49999999l0 427.00000001c0 12.7-7.40000001 21.5-14.30000001 21.5l-150.19999999 0c-1.5 0-3 0.2-4.5 0.4-10.2-38.8-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.4 0 49.9 40.5 90.6 90.5 90.59999999 42 0 77.3-28.6 87.5-67.39999999 1.4 0.2 2.9 0.4 4.49999999 0.4L577.7 780.7c34.80000001 0 61.3-31.6 61.3-68.50000001L639 510.3l79.1 0c10.4 38.5 45.49999999 67 87.4 67 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-41.79999999 0-77.00000001 28.4-87.4 67L639 463.30000001z\" fill=\"#333333\" ></path></symbol><symbol id=\"icon-side\" viewBox=\"0 0 1024 1024\"><path d=\"M851.91168 328.45312c-59.97056 0-108.6208 48.47104-108.91264 108.36992l-137.92768 38.4a109.14304 109.14304 0 0 0-63.46752-46.58688l1.39264-137.11872c47.29344-11.86816 82.31936-54.66624 82.31936-105.64096 0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.76288-108.91776 108.91776c0 49.18784 32.60928 90.75712 77.38368 104.27392l-1.41312 138.87488a109.19936 109.19936 0 0 0-63.50336 48.55808l-138.93632-39.48544 0.01024-0.72704c0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.75776-108.91776 108.91776c0 60.15488 48.76288 108.91264 108.91776 108.91264 39.3984 0 73.91232-20.92032 93.03552-52.2496l139.19232 39.552-0.00512 0.2304c0 25.8304 9.00096 49.5616 24.02816 68.23424l-90.14272 132.63872a108.7488 108.7488 0 0 0-34.2528-5.504c-60.15488 0-108.91776 48.768-108.91776 108.91776 0 60.16 48.76288 108.91776 108.91776 108.91776 60.16 0 108.92288-48.75776 108.92288-108.91776 0-27.14624-9.9328-51.968-26.36288-71.04l89.04704-131.03104a108.544 108.544 0 0 0 37.6832 6.70208 108.672 108.672 0 0 0 36.48512-6.272l93.13792 132.57216a108.48256 108.48256 0 0 0-24.69888 69.0688c0 60.16 48.768 108.92288 108.91776 108.92288 60.16 0 108.91776-48.76288 108.91776-108.92288 0-60.14976-48.75776-108.91776-108.91776-108.91776a108.80512 108.80512 0 0 0-36.69504 6.3488l-93.07136-132.48a108.48768 108.48768 0 0 0 24.79616-72.22784l136.09984-37.888c18.99008 31.93856 53.84192 53.3504 93.69088 53.3504 60.16 0 108.92288-48.75776 108.92288-108.91264-0.00512-60.15488-48.77312-108.92288-108.92288-108.92288z\"  ></path></symbol><symbol id=\"icon-B\" viewBox=\"0 0 1024 1024\"><path d=\"M98.067692 65.457231H481.28c75.854769 0 132.411077 3.150769 169.668923 9.452307 37.336615 6.301538 70.656 19.534769 100.036923 39.620924 29.459692 20.007385 53.956923 46.710154 73.570462 80.029538 19.692308 33.398154 29.459692 70.734769 29.459692 112.167385 0 44.898462-12.130462 86.094769-36.233846 123.588923a224.886154 224.886154 0 0 1-98.461539 84.283077c58.368 17.092923 103.266462 46.08 134.695385 87.04 31.350154 40.96 47.025231 89.088 47.025231 144.462769 0 43.638154-10.082462 86.016-30.404923 127.212308-20.243692 41.196308-47.891692 74.043077-83.02277 98.697846-35.052308 24.654769-78.296615 39.778462-129.732923 45.449846-32.295385 3.465846-110.119385 5.671385-233.472 6.537846H98.067692V65.457231z m193.536 159.507692V446.621538h126.818462c75.460923 0 122.328615-1.024 140.603077-3.229538 33.083077-3.938462 59.155692-15.36 78.139077-34.343385 18.904615-18.904615 28.435692-43.874462 28.435692-74.830769 0-29.696-8.192-53.720615-24.497231-72.310154-16.384-18.510769-40.644923-29.696-72.940307-33.634461-19.140923-2.205538-74.279385-3.308308-165.415385-3.308308h-111.064615z m0 381.243077v256.315077h179.2c69.710769 0 113.979077-1.969231 132.726154-5.907692 28.750769-5.198769 52.145231-17.959385 70.262154-38.281847 18.116923-20.243692 27.096615-47.340308 27.096615-81.368615 0-28.750769-6.931692-53.169231-20.873846-73.255385a118.232615 118.232615 0 0 0-60.494769-43.795692c-26.387692-9.137231-83.574154-13.705846-171.638154-13.705846H291.603692z\"  ></path></symbol><symbol id=\"icon-a\" viewBox=\"0 0 1024 1024\"><path d=\"M757.76 665.6q0 20.48 1.536 34.304t7.68 22.016 18.944 12.288 34.304 4.096q-3.072 25.6-15.36 44.032-11.264 16.384-33.28 29.696t-62.976 13.312q-11.264 0-20.48-0.512t-17.408-2.56l-6.144-2.048-1.024 0q-4.096-1.024-10.24-4.096-2.048-2.048-4.096-2.048-1.024-1.024-2.048-1.024-14.336-8.192-23.552-17.408t-14.336-17.408q-6.144-10.24-9.216-20.48-63.488 75.776-178.176 75.776-48.128 0-88.064-15.36t-69.12-44.032-45.056-68.096-15.872-88.576 16.896-89.088 47.616-67.584 74.24-42.496 96.768-14.848q48.128 0 88.576 17.408t66.048 49.152q0-8.192 0.512-16.384t0.512-15.36q0-71.68-39.936-104.448t-128-32.768q-43.008 0-84.992 6.656t-84.992 17.92q14.336-28.672 25.088-47.616t24.064-29.184q30.72-24.576 158.72-24.576 79.872 0 135.168 13.824t90.624 43.52 51.2 75.264 15.872 108.032l0 200.704zM487.424 743.424q50.176 0 79.872-33.28t29.696-95.744q0-61.44-28.672-93.696t-76.8-32.256q-52.224 0-82.944 33.28t-30.72 94.72q0 58.368 31.744 92.672t77.824 34.304z\"  ></path></symbol><symbol id=\"icon-full\" viewBox=\"0 0 1024 1024\"><path d=\"M639.328 416c8.032 0 16.096-3.008 22.304-9.056l202.624-197.184-0.8 143.808c-0.096 17.696 14.144 32.096 31.808 32.192 0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808l1.248-222.208c0-0.672-0.352-1.248-0.384-1.92 0.032-0.512 0.288-0.896 0.288-1.408 0.032-17.664-14.272-32-31.968-32.032L671.552 96l-0.032 0c-17.664 0-31.968 14.304-32 31.968C639.488 145.632 653.824 160 671.488 160l151.872 0.224-206.368 200.8c-12.672 12.32-12.928 32.608-0.64 45.248C622.656 412.736 630.976 416 639.328 416z\"  ></path><path d=\"M896.032 639.552 896.032 639.552c-17.696 0-32 14.304-32.032 31.968l-0.224 151.872-200.832-206.4c-12.32-12.64-32.576-12.96-45.248-0.64-12.672 12.352-12.928 32.608-0.64 45.248l197.184 202.624-143.808-0.8c-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808-0.096 17.696 14.144 32.096 31.808 32.192l222.24 1.248c0.064 0 0.128 0 0.192 0 0.64 0 1.12-0.32 1.76-0.352 0.512 0.032 0.896 0.288 1.408 0.288l0.032 0c17.664 0 31.968-14.304 32-31.968L928 671.584C928.032 653.952 913.728 639.584 896.032 639.552z\"  ></path><path d=\"M209.76 159.744l143.808 0.8c0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808 0.096-17.696-14.144-32.096-31.808-32.192L131.68 95.328c-0.064 0-0.128 0-0.192 0-0.672 0-1.248 0.352-1.888 0.384-0.448 0-0.8-0.256-1.248-0.256 0 0-0.032 0-0.032 0-17.664 0-31.968 14.304-32 31.968L96 352.448c-0.032 17.664 14.272 32 31.968 32.032 0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968l0.224-151.936 200.832 206.4c6.272 6.464 14.624 9.696 22.944 9.696 8.032 0 16.096-3.008 22.304-9.056 12.672-12.32 12.96-32.608 0.64-45.248L209.76 159.744z\"  ></path><path d=\"M362.368 617.056l-202.624 197.184 0.8-143.808c0.096-17.696-14.144-32.096-31.808-32.192-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808l-1.248 222.24c0 0.704 0.352 1.312 0.384 2.016 0 0.448-0.256 0.832-0.256 1.312-0.032 17.664 14.272 32 31.968 32.032L352.448 928c0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968s-14.272-32-31.968-32.032l-151.936-0.224 206.4-200.832c12.672-12.352 12.96-32.608 0.64-45.248S375.008 604.704 362.368 617.056z\"  ></path></symbol><symbol id=\"icon-add\" viewBox=\"0 0 1024 1024\"><path d=\"M863.328 482.56l-317.344-1.12L545.984 162.816c0-17.664-14.336-32-32-32s-32 14.336-32 32l0 318.4L159.616 480.064c-0.032 0-0.064 0-0.096 0-17.632 0-31.936 14.24-32 31.904C127.424 529.632 141.728 544 159.392 544.064l322.592 1.152 0 319.168c0 17.696 14.336 32 32 32s32-14.304 32-32l0-318.944 317.088 1.12c0.064 0 0.096 0 0.128 0 17.632 0 31.936-14.24 32-31.904C895.264 496.992 880.96 482.624 863.328 482.56z\"  ></path></symbol><symbol id=\"icon-move\" viewBox=\"0 0 1024 1024\"><path d=\"M863.744 544 163.424 544c-17.664 0-32-14.336-32-32s14.336-32 32-32l700.32 0c17.696 0 32 14.336 32 32S881.44 544 863.744 544z\"  ></path></symbol><symbol id=\"icon-living\" viewBox=\"0 0 1024 1024\"><path d=\"M514.133333 488.533333m-106.666666 0a106.666667 106.666667 0 1 0 213.333333 0 106.666667 106.666667 0 1 0-213.333333 0Z\" fill=\"#666666\" ></path><path d=\"M512 64C264.533333 64 64 264.533333 64 512c0 236.8 183.466667 428.8 416 445.866667v-134.4c-53.333333-59.733333-200.533333-230.4-200.533333-334.933334 0-130.133333 104.533333-234.666667 234.666666-234.666666s234.666667 104.533333 234.666667 234.666666c0 61.866667-49.066667 153.6-145.066667 270.933334l-59.733333 68.266666V960C776.533333 942.933333 960 748.8 960 512c0-247.466667-200.533333-448-448-448z\" fill=\"#666666\" ></path></symbol></svg>',h=(h=document.getElementsByTagName(\"script\"))[h.length-1].getAttribute(\"data-injectcss\");if(h&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write(\"<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>\")}catch(t){console&&console.log(t)}}function d(){o||(o=!0,a())}c=function(){var t,c,l,a;(a=document.createElement(\"div\")).innerHTML=n,n=null,(l=a.getElementsByTagName(\"svg\")[0])&&(l.setAttribute(\"aria-hidden\",\"true\"),l.style.position=\"absolute\",l.style.width=0,l.style.height=0,l.style.overflow=\"hidden\",t=l,(c=document.body).firstChild?(a=t,(l=c.firstChild).parentNode.insertBefore(a,l)):c.appendChild(t))},document.addEventListener?~[\"complete\",\"loaded\",\"interactive\"].indexOf(document.readyState)?setTimeout(c,0):(l=function(){document.removeEventListener(\"DOMContentLoaded\",l,!1),c()},document.addEventListener(\"DOMContentLoaded\",l,!1)):document.attachEvent&&(a=c,e=t.document,o=!1,(i=function(){try{e.documentElement.doScroll(\"left\")}catch(t){return void setTimeout(i,50)}d()})(),e.onreadystatechange=function(){\"complete\"==e.readyState&&(e.onreadystatechange=null,d())})}(window);","import { LEFT, RIGHT, SIDE } from './const'\nimport {\n  isMobile,\n  addParentLink,\n  getObjById,\n  generateUUID,\n  generateNewObj,\n  generateNewSummaryObj,\n} from './utils/index'\nimport { findEle, createInputDiv, layout, Topic, createChildren, createGroup, createTop, createTopic, shapeTpc, createSummary } from './utils/dom'\nimport { createLinkSvg, createLine } from './utils/svg'\nimport {\n  selectNode,\n  unselectNode,\n  selectNextSibling,\n  selectPrevSibling,\n  selectFirstChild,\n  selectParent,\n  getAllDataString,\n  getAllData,\n  getAllDataWithAutoHide,\n  getAllDataMd,\n  scale,\n  toCenter,\n  focusNode,\n  cancelFocus,\n  initLeft,\n  initRight,\n  initSide,\n  setLocale,\n  enableEdit,\n  disableEdit,\n  expandNode,\n  refresh,\n  toTopLeft,\n  autoHide,\n} from './interact'\nimport {\n  insertSibling,\n  insertBefore,\n  insertParent,\n  addChild,\n  copyNode,\n  moveNode,\n  removeNode,\n  moveUpNode,\n  moveDownNode,\n  beginEdit,\n  updateNodeStyle,\n  updateNodeTags,\n  updateNodeIcons,\n  updateNodeHyperLink,\n  updateNodeRemark,\n  // updateNodeImage,\n  processPrimaryNode,\n  setNodeTopic,\n  moveNodeBefore,\n  moveNodeAfter,\n  addSummary,\n} from './nodeOperation'\nimport {\n  createLink,\n  removeLink,\n  selectLink,\n  hideLinkController,\n  showLinkController,\n} from './customLink'\nimport linkDiv from './linkDiv'\nimport initMouseEvent from './mouse'\n\nimport contextMenu from './plugin/contextMenu'\nimport toolBar from './plugin/toolBar'\nimport nodeMenu from './plugin/nodeMenu'\nimport sidebar from './plugin/sidebar'\nimport nodeDraggable from './plugin/nodeDraggable'\nimport keypress from './plugin/keypress'\nimport mobileMenu from './plugin/mobileMenu'\n\nimport Bus from './utils/pubsub'\n\nimport './index.less'\nimport './plugin/contextMenu.less'\nimport './plugin/toolBar.less'\nimport './plugin/nodeMenu.less'\nimport './plugin/sidebar.less'\nimport './plugin/mobileMenu.less'\n\nimport { exportSvg, exportSvgDom } from '../painter/index.foreignObject'\n\nimport './iconfont/iconfont.js'\nimport { node } from 'canvg/dist/presets'\n\n// TODO show up animation\nconst E = findEle\ntype LinkObj = object\ntype operation = {\n  name: string\n}\nexport interface NodeObj {\n  topic: string,\n  id: string,\n  style?: {\n    fontSize?: string,\n    color?: string,\n    background?: string,\n    fontWeight?: string,\n    width?:string,\n    controllWidth?:string\n  },\n  parent?: NodeObj,\n  children?: NodeObj[],\n  tags?: string[],\n  icons?: string[],\n  hyperLink?: string,\n  remark?:string,\n  image?:{\n    url:string,\n    width:number,\n    height?:number,\n  }[],\n  linkJump?:{\n    toId:string,\n    title:string\n  }[]\n  expanded?: boolean,\n  direction?: number,\n  root?: boolean,\n  type?:string\n  summary?:{\n    range:string [],\n    topicId:string\n  }\n}\n\nexport interface NodeElement extends HTMLElement {\n  nodeObj:Object\n}\nexport interface MindElixirData {\n  nodeData: NodeObj,\n  linkData?: LinkObj,\n  expandDeep?:number|null\n  direction?:number\n}\nexport interface MindElixirInstance {\n  mindElixirBox: HTMLElement,\n  nodeData: NodeObj,\n  linkData: LinkObj,\n  expandDeep:number|null\n  currentNode: Topic | null,\n  currentLink: SVGElement | null,\n  inputDiv: HTMLElement | null,\n  scaleVal: number,\n  tempDirection: number | null,\n  bus: object, // wip\n\n  // wip\n  history: operation[],\n  isUndo: boolean,\n  undo: () => void,\n\n  direction: number,\n  locale: string,\n  draggable: boolean,\n  editable: boolean,\n  contextMenu: boolean,\n  contextMenuOption: object,\n  toolBar: boolean,\n  nodeMenu: boolean,\n  keypress: boolean,\n  before: object,\n  newTopicName: string,\n  allowUndo: boolean,\n  overflowHidden: boolean,\n  primaryLinkStyle: number,\n  primaryNodeHorizontalGap: number,\n  primaryNodeVerticalGap: number,\n  mobileMenu: boolean,\n  closeButton:boolean,\n  widthControll:boolean,\n  uploadButton:boolean,\n  nodeDraggable:boolean\n}\nexport interface Options {\n  el: string,\n  data: MindElixirData,\n  direction?: number,\n  locale?: string,\n  draggable?: boolean,\n  editable?: boolean,\n  contextMenu?: boolean,\n  contextMenuOption?: object,\n  toolBar?: boolean,\n  nodeMenu?: boolean,\n  keypress?: boolean,\n  before?: object,\n  newTopicName?: string,\n  allowUndo?: boolean,\n  overflowHidden?: boolean,\n  primaryLinkStyle?: number,\n  primaryNodeHorizontalGap?: number,\n  primaryNodeVerticalGap?: number,\n  mobileMenu?: boolean,\n  closeButton?:boolean,\n  //节点宽度调整\n  widthControll?:boolean,\n  //导入XMind文件\n  uploadButton?:boolean,\n  //配置节点拖拽\n  nodeDraggable?:boolean\n}\nconst $d = document\n/**\n * @export MindElixir\n * @example\n * let mind = new MindElixir({\n  el: '#map',\n  direction: 2,\n  data: data,\n  draggable: true,\n  editable: true,\n  contextMenu: true,\n  toolBar: true,\n  nodeMenu: true,\n  keypress: true,\n})\nmind.init()\n *\n */\nfunction MindElixir(this: MindElixirInstance, {\n  el,\n  data,\n  direction,\n  locale,\n  draggable,\n  editable,\n  contextMenu,\n  contextMenuOption,\n  toolBar,\n  nodeMenu,\n  keypress,\n  before,\n  newTopicName,\n  allowUndo,\n  primaryLinkStyle,\n  overflowHidden,\n  primaryNodeHorizontalGap,\n  primaryNodeVerticalGap,\n  mobileMenu,\n  closeButton,\n  widthControll,\n  uploadButton,\n  nodeDraggable\n}: Options) {\n  const box = document.getElementById(el) as HTMLElement\n  if (!box) return\n  this.mindElixirBox = box\n  this.before = before || {}\n  this.nodeData = data.nodeData\n  this.linkData = data.linkData || {}\n  this.expandDeep=data?.expandDeep\n  this.locale = locale\n  this.contextMenuOption = contextMenuOption\n  this.contextMenu = contextMenu === undefined ? true : contextMenu\n  this.toolBar = toolBar === undefined ? true : toolBar\n  this.nodeMenu = nodeMenu === undefined ? true : nodeMenu\n  this.keypress = keypress === undefined ? true : keypress\n  this.closeButton = closeButton === undefined ? false : closeButton\n  this.widthControll = widthControll === undefined ? true : widthControll\n  this.mobileMenu = mobileMenu\n  // record the direction before enter focus mode, must true in focus mode, reset to null after exit focus\n  // todo move direction to data\n  this.direction = data.direction!==undefined?data.direction:(typeof direction === 'number' ? direction : 1)\n  this.draggable = draggable === undefined ? true : draggable\n  this.newTopicName = newTopicName\n  this.editable = editable === undefined ? true : editable\n  this.allowUndo = allowUndo === undefined ? true : allowUndo\n  // this.parentMap = {} // deal with large amount of nodes\n  this.currentNode = null // the selected <tpc/> element\n  this.currentLink = null // the selected link svg element\n  this.inputDiv = null // editor\n  this.scaleVal = 1\n  this.tempDirection = null\n  this.primaryLinkStyle = primaryLinkStyle || 0\n  this.overflowHidden = overflowHidden\n  this.primaryNodeHorizontalGap = primaryNodeHorizontalGap\n  this.primaryNodeVerticalGap = primaryNodeVerticalGap\n  this.uploadButton = uploadButton === undefined ? true : uploadButton\n  this.nodeDraggable = nodeDraggable === undefined ? true : nodeDraggable\n\n  this.bus = new Bus()\n  ;(this.bus as any).addListener('operation', (operation: operation) => {\n    if (this.isUndo) {\n      this.isUndo = false\n      return\n    }\n    if (['moveNode', 'removeNode', 'addChild', 'finishEdit', 'editStyle', 'editTags', 'editIcons'].includes(\n      operation.name\n    )) {\n      this.history.push(operation)\n      // console.log(operation, this.history)\n    }\n  })\n\n  this.history = [] // TODO\n  this.isUndo = false\n  this.undo = function() {\n    const operation = this.history.pop()\n    if (!operation) return\n    this.isUndo = true\n    if (operation.name === 'moveNode') {\n      this.moveNode(\n        E(operation.obj.fromObj.id),\n        E(operation.obj.originParentId)\n      )\n    } else if (operation.name === 'removeNode') {\n      if (operation.originSiblingId) {\n        this.insertBefore(E(operation.originSiblingId), operation.obj)\n      } else {\n        this.addChild(E(operation.originParentId), operation.obj)\n      }\n    } else if (operation.name === 'addChild' || operation.name === 'copyNode') {\n      this.removeNode(E(operation.obj.id))\n    } else if (operation.name === 'finishEdit') {\n      this.setNodeTopic(E(operation.obj.id), operation.origin)\n    } else {\n      this.isUndo = false\n    }\n  }\n}\n\nfunction beforeHook(fn:(el:any, node?:any)=>void) {\n  return async function(...args:unknown[]) {\n    if (\n      !this.before[fn.name] ||\n      (await this.before[fn.name].apply(this, args))\n    ) {\n      fn.apply(this, args)\n    }\n  }\n}\n\nMindElixir.prototype = {\n  addParentLink,\n  getObjById,\n  generateNewObj,\n  generateNewSummaryObj,\n  // node operation\n  insertSibling: beforeHook(insertSibling),\n  insertBefore: beforeHook(insertBefore),\n  insertParent: beforeHook(insertParent),\n  addSummary:beforeHook(addSummary),\n  addChild: beforeHook(addChild),\n  copyNode: beforeHook(copyNode),\n  moveNode: beforeHook(moveNode),\n  removeNode: beforeHook(removeNode),\n  moveUpNode: beforeHook(moveUpNode),\n  moveDownNode: beforeHook(moveDownNode),\n  beginEdit: beforeHook(beginEdit),\n  moveNodeBefore: beforeHook(moveNodeBefore),\n  moveNodeAfter: beforeHook(moveNodeAfter),\n  updateNodeStyle,\n  updateNodeTags,\n  updateNodeIcons,\n  updateNodeHyperLink,\n  updateNodeRemark,\n  // updateNodeImage,\n  processPrimaryNode,\n  setNodeTopic,\n\n  createLink,\n  removeLink,\n  selectLink,\n  hideLinkController,\n  showLinkController,\n\n  layout,\n  linkDiv,\n  createInputDiv,\n  shapeTpc,\n  createChildren, createGroup, createTop, createTopic,createSummary,\n\n  selectNode,\n  unselectNode,\n  selectNextSibling,\n  selectPrevSibling,\n  selectFirstChild,\n  selectParent,\n  getAllDataString,\n  getAllData,\n  getAllDataWithAutoHide,\n  getAllDataMd,\n  scale,\n  toCenter,\n  toTopLeft,\n  focusNode,\n  cancelFocus,\n  initLeft,\n  initRight,\n  initSide,\n  setLocale,\n  enableEdit,\n  disableEdit,\n  expandNode,\n  refresh,\n  exportSvg,\n  exportSvgDom,\n  init: function(nodeData?:NodeObj,expandDeep?:number) {\n    /**\n     * @function\n     * @global\n     * @name E\n     * @param {string} id Node id.\n     * @return {TargetElement} Target element.\n     * @example\n     * E('bd4313fbac40284b')\n     */  \n    if(nodeData) this.nodeData=nodeData\n    if(expandDeep)this.expandDeep=expandDeep\n    addParentLink(this.nodeData)\n    console.log('ME_version ' + MindElixir.version)\n    console.log(this)\n    if(this.mindElixirBox.className.indexOf('mind-elixir')===-1)\n      this.mindElixirBox.className += ' mind-elixir'\n    this.mindElixirBox.innerHTML = ''\n\n    this.container = $d.createElement('div') // map container\n    this.container.className = 'map-container'\n\n    if (this.overflowHidden) this.container.style.overflow = 'hidden'\n\n    this.map = $d.createElement('div') // map-canvas Element\n    this.map.className = 'map-canvas'\n    this.map.setAttribute('tabindex', '0')\n    this.container.appendChild(this.map)\n    this.mindElixirBox.appendChild(this.container)\n    this.root = $d.createElement('root')\n\n    this.box = $d.createElement('children')\n    this.box.className = 'mindbox'\n\n    // infrastructure\n\n    this.svg2nd = createLinkSvg('svg2nd') // main link container\n\n    this.linkController = createLinkSvg('linkcontroller') // bezier controller container\n    this.P2 = $d.createElement('div') // bezier P2\n    this.P3 = $d.createElement('div') // bezier P3\n    this.P2.className = this.P3.className = 'circle'\n    this.line1 = createLine(0, 0, 0, 0) // bezier auxiliary line1\n    this.line2 = createLine(0, 0, 0, 0) // bezier auxiliary line2\n    this.linkController.appendChild(this.line1)\n    this.linkController.appendChild(this.line2)\n\n    this.linkSvgGroup = createLinkSvg('topiclinks') // storage user custom link svg\n\n    this.map.appendChild(this.root)\n    this.map.appendChild(this.box)\n    this.map.appendChild(this.svg2nd)\n    this.map.appendChild(this.linkController)\n    this.map.appendChild(this.linkSvgGroup)\n    this.map.appendChild(this.P2)\n    this.map.appendChild(this.P3)\n\n    // plugin\n    this.toolBar && toolBar(this)\n    this.nodeMenu && nodeMenu(this)\n    this.keypress && keypress(this)\n    sidebar(this)\n    if (isMobile() && this.mobileMenu) {\n      mobileMenu(this)\n    } else {\n      this.contextMenu && contextMenu(this, this.contextMenuOption)\n    }\n    this.draggable && nodeDraggable(this)\n\n    // 为了兼容从xmind导入的导图在一开始没有\n    autoHide(this.nodeData,0,this.expandDeep||2)\n    this.layout()\n    this.linkDiv()\n    this.toTopLeft()\n    // if (!this.overflowHidden) initMouseEvent(this)\n    initMouseEvent(this)\n  },\n}\n\nMindElixir.LEFT = LEFT\nMindElixir.RIGHT = RIGHT\nMindElixir.SIDE = SIDE\n/**\n * @memberof MindElixir\n * @static\n */\nMindElixir.version = '0.17.0'\nMindElixir.E = findEle\n\n/**\n * @function new\n * @memberof MindElixir\n * @static\n * @param {String} topic root topic\n */\nMindElixir.new = (topic: string): MindElixirData => ({\n  nodeData: {\n    id: generateUUID(),\n    topic: topic || 'new topic',\n    root: true,\n    style: {\n      color: \"#ffffff\",\n      background: \"#00aaff\"\n    },\n    children: [],\n  },\n  linkData: {},\n})\n\nexport default MindElixir\n\n// export {exportSvg,exportPng} something wrong comes with the rollup"],"names":["encodeHTML","s","isMobile","rgbHex","rgb","$0","$1","$2","$3","getObjById","id","data","i","res","addParentLink","parent","refreshIds","generateUUID","throttle","fn","wait","pre","context","args","now","getArrowPoints","p3x","p3y","p4x","p4y","deltay","deltax","angle","arrowLength","arrowAngle","a1","a2","calcP1","fromData","p2x","p2y","x","y","k","calcP4","toData","generateNewObj","generateNewSummaryObj","val","checkMoveValid","from","to","valid","moveUpObj","obj","childrenList","index","t","moveDownObj","removeNodeObj","insertNodeObj","newObj","insertBeforeNodeObj","insertParentNodeObj","moveNodeObj","moveNodeBeforeObj","toIndex","moveNodeAfterObj","dragMoveHelper","container","deltaX","deltaY","LinkDragMoveHelper","dom","map","cb","e","$d","findEle","instance","resizeNode","widthControll","tpc","anotherWidthControll","eDown","startX","width","eMove","endX","eUp","_a","shapeTpc","nodeObj","widthControllRight","widthControllLeft","imgContainer","linkContainer","content","remarkContainer","delayTask","iconsContainer","icon","button","moveToNode","tagsContainer","tag","toNode","findUnExpandedParent","node","toId","flag","createGroup","omitChildren","grp","top","createExpander","children","smyChild","createSummary","smy","createTop","createTopic","topic","selectText","div","range","getSelection","createInputDiv","origin","_b","_d","_c","_e","_g","_f","key","updateLinkJumpTitle","expanded","expander","createChildren","direction","chldr","smyEle","layout","primaryNodes","lcount","rcount","svgNS","createMainPath","d","path","createLinkSvg","klass","svg","createSvgPath","createLine","x1","y1","x2","y2","line","createPath","createSvgGroup","arrowd","g","arrow","maxTop","maxBottom","maxLeft","maxRight","imgPadding","head","init","generateSvgDom","svgContent","primaryNode","rect","bottom","left","right","PrimaryToSvg","RootToSvg","svgHeight","svgWidth","svgFile","createSvg","getHeightAndWidth","height","root","rootTpc","tpcStyle","tStyle","rootOffsetY","rootOffsetX","topicOffsetLeft","topicOffsetTop","svg2ndEle","tags","tagsEle","tagRect","icons","iconsEle","images","imagesEle","image","svg2nd","topiclinks","topics","primaryNodeOffsetY","primaryNodeOffsetX","svg3rd","tpcRect","topicOffsetTopTop","border","backgroundColor","exportSvg","dlUrl","a","exportSvgDom","fileName","getData","selectNode","targetElement","isNewNode","clickEvent","unselectNode","selectNextSibling","sibling","target","siblingList","selectPrevSibling","selectFirstChild","selectParent","getAllDataString","v","getAllData","autoHide","nodeData","cnt","deep","getAllDataWithAutoHide","expandDeep","getAllDataMd","mdString","writeMd","enableEdit","disableEdit","scale","scaleVal","getRootWidth","getRootHeight","getHeightDistance","b","aHeight","bHeight","getHeightFromRootToChild","childTpc","toCenter","toTopLeft","focusNode","tpcEl","cancelFocus","initLeft","initRight","initSide","setLocale","locale","expandNode","el","isExpand","expandNodeChild","refresh","updateNodeStyle","object","nodeEle","updateNodeTags","oldVal","updateNodeIcons","updateNodeHyperLink","hyperLink","hyperLinkArr","link","updateNodeRemark","remark","insertSibling","newNodeObj","insertBefore","insertParent","grp0","children0","c","addSummaryFunction","newTop","smychildren","addChildFunction","addSummary","parentIndex","selectedArr","value","addChild","copyNode","deepCloneObj","moveUpNode","moveDownNode","removeNode","next","originSiblingId","childrenLength","parentT","prop","moveNode","fromObj","toObj","originParentId","fromTop","fromChilren","toTop","moveNodeBefore","fromGrp","toGrp","moveNodeAfter","beginEdit","setNodeTopic","processPrimaryNode","l","r","createLink","isInitPaint","pfrom","pto","fromCenterX","fromCenterY","toCenterX","toCenterY","p1","p1x","p1y","p4","arrowPoint","newSvgGroup","newLinkObj","removeLink","linkSvg","selectLink","hideLinkController","showLinkController","linkObj","linkDiv","primaryNodeHorizontalGap","primaryNodeVerticalGap","primaryNodeList","totalHeight","shortSide","shortSideGap","currentOffsetL","currentOffsetR","totalHeightL","totalHeightR","base","countL","countR","totalHeightLWithoutGap","totalHeightRWithoutGap","primaryPath","alignRight","alignLeft","elOffsetH","xMiddle","LEFT","svgSMY","smypath","loopChildren","first","parentOT","parentOL","parentOW","parentOH","isSmyChild","child","firstEl","lastEl","rangeMap","j","xfirst","yfirst","ylast","xlast","childT","childTOT","childTOH","nextChildren","initMouseEvent","mind","element","cn","i18n","contextMenu$1","option","createTips","words","createLi","name","keyname","li","add_child","add_parent","add_sibling","remove_child","focus","unfocus","up","down","nodeLink","summary","menuUl","item","menuContainer","isRoot","tips","img","queryList","updateSidebar","sidebar","curActive","sidebar$1","createButton","timer","debounce","fun","argu","createToolBarRBContainer","toolBarRBContainer","fc","gc","zo","zi","numberSelection","percentage","uploadButton","createUploadButton","viewBTop","mindBTop","offset","createToolBarLTContainer","toolBarLTContainer","menu","viewTop","mindTop","createCloseButton","close","fm","toolBar$1","createDiv","colorList","nodeMenu$1","bgOrFont","styleDiv","tagDiv","iconDiv","remarkDiv","size","color","addDropTextarea","xxxdiv","textarea","preTextarea","maxHeight","minHeight","getHeight","curHeight","clearSelect","remove","elems","sizeSelector","bold","buttonContainer","fontBtn","tagInput","iconInput","linkInput","remarkInput","newTags","newIcons","input","state","dataSize","dataWeight","dataColor","preVal","curVal","insertPreview","insertLocation","clearPreview","query","className","insertPreviewEL","queryElement","canPreview","dragged","isContain","nodeDraggable","meet","E","topMeet","bottomMeet","keypress","key2func","mobileMenu$1","edit","Bus","type","handler","payload","handlers","o","n","h","MindElixir","draggable","editable","contextMenu","contextMenuOption","toolBar","nodeMenu","before","newTopicName","allowUndo","primaryLinkStyle","overflowHidden","mobileMenu","closeButton","box","operation","beforeHook"],"mappings":"gOAEO,SAASA,GAAWC,EAAG,CACrB,OAAAA,EAAE,QAAQ,KAAM,OAAO,EAAE,QAAQ,KAAM,MAAM,EAAE,QAAQ,KAAM,QAAQ,CAC9E,CAEa,MAAAC,GAAW,IACtB,iEAAiE,KAC/D,UAAU,SACZ,EAEWC,GAAUC,GACdA,EAAI,QACT,mDACA,SAASC,EAAIC,EAAIC,EAAIC,EAAI,CACvB,MAAO,KAAO,IAAM,OAAOF,CAAE,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,GAAK,IAAM,OAAOC,CAAE,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,GAAK,IAAM,OAAOC,CAAE,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,CAClJ,CAAA,EAGSC,GAAa,SAASC,EAAYC,EAAe,CAExD,GADJA,EAAOA,GAAQ,KAAK,SAChBA,EAAK,KAAOD,EACP,OAAAC,EACE,GAAAA,EAAK,UAAYA,EAAK,SAAS,OACxC,QAASC,EAAI,EAAGA,EAAID,EAAK,SAAS,OAAQC,IAAK,CAC7C,MAAMC,EAAMJ,GAAWC,EAAIC,EAAK,SAASC,EAAE,EACvC,GAAAC,EAAY,OAAAA,CAClB,KAEO,QAAA,IAEX,EAEaC,EAAgB,CAACH,EAAeI,IAAqB,CAEhE,GADAJ,EAAK,OAASI,EACVJ,EAAK,SACP,QAASC,EAAI,EAAGA,EAAID,EAAK,SAAS,OAAQC,IAC1BE,EAAAH,EAAK,SAASC,GAAID,CAAI,CAG1C,EAEO,SAASK,GAAWL,EAAe,CAExC,GADAA,EAAK,GAAKM,IACNN,EAAK,SACP,QAASC,EAAI,EAAGA,EAAID,EAAK,SAAS,OAAQC,IAC7BI,GAAAL,EAAK,SAASC,EAAE,CAGjC,CAEa,MAAAM,GAAW,CAACC,EAAmBC,IAAiB,CACvD,IAAAC,EAAM,KAAK,MACf,OAAO,UAAW,CAChB,IAAIC,EAAU,KACVC,EAAO,UACPC,EAAM,KAAK,MACXA,EAAMH,GAAOD,IACZD,EAAA,MAAMG,EAASC,CAAI,EACtBF,EAAM,KAAK,MACb,CAEJ,EAEO,SAASI,GAAeC,EAAaC,EAAaC,EAAaC,EAAa,CACjF,MAAMC,EAASD,EAAMF,EACfI,EAASL,EAAME,EACrB,IAAII,EAAS,KAAK,KAAK,KAAK,IAAIF,CAAM,EAAI,KAAK,IAAIC,CAAM,CAAC,EAAI,KAAQ,IAClEA,EAAS,GAAKD,EAAS,IACzBE,EAAQ,IAAMA,GAEZD,EAAS,GAAKD,EAAS,IACzBE,EAAQ,IAAMA,GAEZD,EAAS,GAAKD,EAAS,IACzBE,EAAQ,IAAMA,GAEhB,MAAMC,EAAc,GACdC,EAAa,GACnB,IAAIC,EAAKH,EAAQE,EACjB,MAAME,EAAKJ,EAAQE,EACZ,MAAA,CACL,GAAIN,EAAM,KAAK,IAAK,KAAK,GAAKO,EAAM,GAAG,EAAIF,EAC3C,GAAIJ,EAAM,KAAK,IAAK,KAAK,GAAKM,EAAM,GAAG,EAAIF,EAC3C,GAAIL,EAAM,KAAK,IAAK,KAAK,GAAKQ,EAAM,GAAG,EAAIH,EAC3C,GAAIJ,EAAM,KAAK,IAAK,KAAK,GAAKO,EAAM,GAAG,EAAIH,CAAA,CAE/C,CAEgB,SAAAI,GAAOC,EAAUC,EAAKC,EAAK,CACzC,IAAIC,EAAGC,EACP,MAAMC,GAAKL,EAAS,GAAKE,IAAQD,EAAMD,EAAS,IAC5C,OAAAK,EAAIL,EAAS,EAAIA,EAAS,GAAKK,EAAI,CAACL,EAAS,EAAIA,EAAS,EACxDA,EAAS,GAAKE,EAAM,GACtBC,EAAIH,EAAS,GAAKA,EAAS,EAAI,EAAIK,EAC/BD,EAAAJ,EAAS,GAAKA,EAAS,EAAI,IAE/BG,EAAIH,EAAS,GAAKA,EAAS,EAAI,EAAIK,EAC/BD,EAAAJ,EAAS,GAAKA,EAAS,EAAI,GAK7BA,EAAS,GAAKC,EAAM,GAClBE,EAAAH,EAAS,GAAKA,EAAS,EAAI,EAC/BI,EAAIJ,EAAS,GAAMA,EAAS,EAAIK,EAAK,IAEjCF,EAAAH,EAAS,GAAKA,EAAS,EAAI,EAC/BI,EAAIJ,EAAS,GAAMA,EAAS,EAAIK,EAAK,GAGlC,CACL,EAAAF,EACA,EAAAC,CAAA,CAEJ,CAEgB,SAAAE,GAAOC,EAAQnB,EAAKC,EAAK,CACvC,IAAIc,EAAGC,EACP,MAAMC,GAAKE,EAAO,GAAKlB,IAAQD,EAAMmB,EAAO,IACxC,OAAAF,EAAIE,EAAO,EAAIA,EAAO,GAAKF,EAAI,CAACE,EAAO,EAAIA,EAAO,EAChDA,EAAO,GAAKlB,EAAM,GACpBc,EAAII,EAAO,GAAKA,EAAO,EAAI,EAAIF,EAC3BD,EAAAG,EAAO,GAAKA,EAAO,EAAI,IAE3BJ,EAAII,EAAO,GAAKA,EAAO,EAAI,EAAIF,EAC3BD,EAAAG,EAAO,GAAKA,EAAO,EAAI,GAKzBA,EAAO,GAAKnB,EAAM,GAChBe,EAAAI,EAAO,GAAKA,EAAO,EAAI,EAC3BH,EAAIG,EAAO,GAAMA,EAAO,EAAIF,EAAK,IAE7BF,EAAAI,EAAO,GAAKA,EAAO,EAAI,EAC3BH,EAAIG,EAAO,GAAMA,EAAO,EAAIF,EAAK,GAG9B,CACL,EAAAF,EACA,EAAAC,CAAA,CAEJ,CAEO,SAASzB,GAAuB,CACrC,OACE,IAAI,OAAO,QAAU,EAAA,SAAS,EAAE,EAAI,KAAK,OAAS,EAAA,SAAS,EAAE,EAAE,OAAO,CAAC,GACvE,OAAO,EAAG,EAAE,CAChB,CAEO,SAAS6B,IAA0B,CACxC,MAAMpC,EAAKO,IACJ,MAAA,CACL,MAAO,KAAK,cAAgB,WAC5B,GAAAP,CAAA,CAEJ,CAEO,SAASqC,IAAiC,CAC/C,MAAMrC,EAAKO,IACJ,MAAA,CACL,MAAO,KAAK,cAAgB,WAC5B,GAAAP,EACA,KAAK,UACL,QAAQ,CACN,QAAQA,EACR,MAAM,KAAK,sBAAsB,IAASsC,GAAAA,EAAI,QAAQ,EAAE,CAC1D,CAAA,CAEJ,CAcgB,SAAAC,GAAeC,EAAeC,EAAa,CACzD,IAAIC,EAAQ,GACZ,KAAOD,EAAG,QAAQ,CACZ,GAAAA,EAAG,SAAWD,EAAM,CACdE,EAAA,GACR,KACF,CACAD,EAAKA,EAAG,MACV,CACO,OAAAC,CACT,CAaO,SAASC,GAAUC,EAAc,CAChC,MAAAC,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EAChCG,EAAIF,EAAaC,GACnBA,IAAU,GACCD,EAAAC,GAASD,EAAaA,EAAa,OAAS,GAC5CA,EAAAA,EAAa,OAAS,GAAKE,IAE3BF,EAAAC,GAASD,EAAaC,EAAQ,GAC3CD,EAAaC,EAAQ,GAAKC,EAE9B,CAEO,SAASC,GAAYJ,EAAc,CAClC,MAAAC,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EAChCG,EAAIF,EAAaC,GACnBA,IAAUD,EAAa,OAAS,GAClCA,EAAaC,GAASD,EAAa,GACnCA,EAAa,GAAKE,IAELF,EAAAC,GAASD,EAAaC,EAAQ,GAC3CD,EAAaC,EAAQ,GAAKC,EAE9B,CAEO,SAASE,GAAcL,EAAc,CACpC,MAAAC,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EACzB,OAAAC,EAAA,OAAOC,EAAO,CAAC,EACrBD,EAAa,MACtB,CAEgB,SAAAK,GAAcN,EAAcO,EAAiB,CACrD,MAAAN,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EACtCC,EAAa,OAAOC,EAAQ,EAAG,EAAGK,CAAM,CAC1C,CAEgB,SAAAC,GAAoBR,EAAcO,EAAiB,CAC3D,MAAAN,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EACzBC,EAAA,OAAOC,EAAO,EAAGK,CAAM,CACtC,CAEgB,SAAAE,GAAoBT,EAAcO,EAAiB,CAC3D,MAAAN,EAAeD,EAAI,OAAO,SAC1BE,EAAQD,EAAa,QAAQD,CAAG,EACtCC,EAAaC,GAASK,EACfA,EAAA,SAAW,CAACP,CAAG,CACxB,CAEgB,SAAAU,GAAYd,EAAeC,EAAa,CACtDQ,GAAcT,CAAI,EACdC,EAAG,SAAaA,EAAA,SAAS,KAAKD,CAAI,EAC9BC,EAAA,SAAW,CAACD,CAAI,CAC1B,CAEgB,SAAAe,GAAkBf,EAAeC,EAAa,CAC5DQ,GAAcT,CAAI,EACZ,MAAAK,EAAeJ,EAAG,OAAO,SAC/B,IAAIe,EAAU,EACd,QAAStD,EAAI,EAAGA,EAAI2C,EAAa,OAAQ3C,IACnC,GAAA2C,EAAa3C,KAAOuC,EAAI,CAChBe,EAAAtD,EACV,KACF,CAEW2C,EAAA,OAAOW,EAAS,EAAGhB,CAAI,CACtC,CAEgB,SAAAiB,GAAiBjB,EAAeC,EAAa,CAC3DQ,GAAcT,CAAI,EACZ,MAAAK,EAAeJ,EAAG,OAAO,SAC/B,IAAIe,EAAU,EACd,QAAStD,EAAI,EAAGA,EAAI2C,EAAa,OAAQ3C,IACnC,GAAA2C,EAAa3C,KAAOuC,EAAI,CAChBe,EAAAtD,EACV,KACF,CAEF2C,EAAa,OAAOW,EAAU,EAAG,EAAGhB,CAAI,CAC1C,CAEO,MAAMkB,EAAiB,CAC5B,YAAa,GACb,UAAW,GACX,MAAO,KACP,MAAO,KACP,OAAO,EAAGC,EAAW,CACnB,GAAI,KAAK,UAAW,CAEd,GADJ,KAAK,YAAc,GACf,CAAC,KAAK,MAAO,CACf,KAAK,MAAQ,EAAE,MACf,KAAK,MAAQ,EAAE,MACf,MACF,CACM,MAAAC,EAAS,KAAK,MAAQ,EAAE,MACxBC,EAAS,KAAK,MAAQ,EAAE,MACpBF,EAAA,SACRA,EAAU,WAAaC,EACvBD,EAAU,UAAYE,CAAA,EAExB,KAAK,MAAQ,EAAE,MACf,KAAK,MAAQ,EAAE,KACjB,CACF,EACA,OAAQ,CACN,KAAK,YAAc,GACnB,KAAK,UAAY,GACjB,KAAK,MAAQ,KACb,KAAK,MAAQ,IACf,CACF,EAEO,SAASC,EAAmBC,EAAK,CACtC,KAAK,IAAMA,EACX,KAAK,UAAY,GACjB,KAAK,MAAQ,KACb,KAAK,MAAQ,IACf,CAEAD,EAAmB,UAAU,KAAO,SAASE,EAAKC,EAAI,CACpD,KAAK,gBAAuBC,GAAA,CAE1B,GADAA,EAAE,gBAAgB,EACd,KAAK,UAAW,CACd,GAAA,CAAC,KAAK,MAAO,CACf,KAAK,MAAQA,EAAE,MACf,KAAK,MAAQA,EAAE,MACf,MACF,CACM,MAAAN,EAAS,KAAK,MAAQM,EAAE,MACxBL,EAAS,KAAK,MAAQK,EAAE,MAC9BD,EAAGL,EAAQC,CAAM,EACjB,KAAK,MAAQK,EAAE,MACf,KAAK,MAAQA,EAAE,KACjB,CAAA,EAEF,KAAK,gBAAuBA,GAAA,CAC1BA,EAAE,gBAAgB,EAClB,KAAK,UAAY,EAAA,EAEnB,KAAK,YAAmBA,GAAA,CACtBA,EAAE,gBAAgB,EAClB,KAAK,MAAM,CAAA,EAETF,EAAA,iBAAiB,YAAa,KAAK,eAAe,EAClDA,EAAA,iBAAiB,aAAc,KAAK,WAAW,EAC/CA,EAAA,iBAAiB,UAAW,KAAK,WAAW,EAChD,KAAK,IAAI,iBAAiB,YAAa,KAAK,eAAe,CAC7D,EAEAF,EAAmB,UAAU,QAAU,SAASE,EAAK,CAC/CA,EAAA,oBAAoB,YAAa,KAAK,eAAe,EACrDA,EAAA,oBAAoB,aAAc,KAAK,WAAW,EAClDA,EAAA,oBAAoB,UAAW,KAAK,WAAW,EACnD,KAAK,IAAI,oBAAoB,YAAa,KAAK,eAAe,CAChE,EAEAF,EAAmB,UAAU,MAAQ,UAAW,CAC9C,KAAK,UAAY,GACjB,KAAK,MAAQ,KACb,KAAK,MAAQ,IACf,EChWA,MAAMK,EAAK,SACEC,EAAU,CAACpE,EAAYqE,KACpBA,EAAWA,EAAS,cAAgBF,GACrC,cAAc,kBAAkBnE,IAAK,EAGpD,SAASsE,GAAWC,EAA0BC,EAAUC,EAAiC,CACvFF,EAAc,cAAqBG,GAAA,CACjC,GAAG,CAACF,EAAI,UAAU,SAAS,UAAU,EAAG,OACxC,MAAMG,EAAOD,EAAM,QACbE,EAAMJ,EAAI,YAAY,OAAO,iBAAiBA,CAAG,EAAE,YAAY,QAAQ,KAAK,EAAE,CAAC,EAAE,OAAO,iBAAiBA,CAAG,EAAE,aAAa,QAAQ,KAAK,EAAE,CAAC,EACjJD,EAAc,cAAqBM,GAAA,CACjC,MAAMC,EAAKD,EAAM,QACjBL,EAAI,MAAM,OAAOI,EAAME,EAAKH,GAAQ,SAAW,EAAA,KACjCJ,EAAA,MAAM,OAAOE,EAAqB,MAAM,OAAOD,EAAI,aAAa,SAAW,EAAA,KAErFA,EAAI,QAAQ,QAAWA,EAAA,QAAQ,MAAM,IACzCA,EAAI,QAAQ,MAAM,MAAMA,EAAI,MAAM,MAElCA,EAAI,QAAQ,MAAM,cAAcD,EAAc,MAAM,OAEpDM,EAAM,eAAe,CAAA,EAETN,EAAA,kBAAkBG,EAAM,SAAS,EAC/CA,EAAM,eAAe,CAAA,EAEvBH,EAAc,YAAiBQ,GAAA,OAC7BR,EAAc,cAAc,KACdA,EAAA,sBAAsBQ,EAAI,SAAS,GACjDC,EAAA,uBAAM,UAAN,MAAAA,EAAA,UAAgB,CAEpB,CACa,MAAAC,EAAW,SAAST,EAAYU,EAAkB,OAEvD,MAAAC,EAAmBhB,EAAG,cAAc,oBAAoB,EACxDiB,EAAkBjB,EAAG,cAAc,mBAAmB,EAqC5D,GAnCAK,EAAI,YAAcU,EAAQ,MAEvB,iBAAM,gBACPZ,GAAW,KAAK,KAAKc,EAAkBZ,EAAIW,CAAkB,EAC7Db,GAAW,KAAK,KAAKa,EAAmBX,EAAIY,CAAiB,EAC7DZ,EAAI,YAAYW,CAAkB,EAClCX,EAAI,YAAYY,CAAiB,GAG/BF,EAAQ,QACVV,EAAI,MAAM,MAAQU,EAAQ,MAAM,OAAS,UACrCV,EAAA,MAAM,WAAaU,EAAQ,MAAM,WAAWA,EAAQ,MAAM,YAAWF,EAAAE,GAAA,YAAAA,EAAS,SAAT,MAAAF,EAAiB,KAAK,UAAU,UACtG,SAAS,KAAKE,EAAQ,MAAM,QAAQ,EACjCV,EAAA,MAAM,SAAWU,EAAQ,MAAM,SAEnCV,EAAI,MAAM,SAAWU,EAAQ,MAAM,SAAW,KAChDV,EAAI,MAAM,WAAaU,EAAQ,MAAM,YAAc,SACnDV,EAAI,MAAM,MAAOU,EAAQ,MAAM,OAAS,cACxCE,EAAkB,MAAM,OAAOD,EAAmB,MAAM,OAAOD,EAAQ,MAAM,eAAiB,QAI5FA,EAAQ,OACGA,EAAQ,MACd,QAAa5C,GAAA,CACZ,MAAA+C,EAAelB,EAAG,cAAc,KAAK,EAC3CkB,EAAa,UAAU,QACvBA,EAAa,IAAM/C,EAAI,IACV+C,EAAA,MAAM,MAAQ/C,EAAI,MAAQ,KAC1B+C,EAAA,MAAM,OAAS/C,EAAI,OAAS,KACzC+C,EAAa,MAAM,QAAU,QAC7Bb,EAAI,YAAYa,CAAY,CAAA,CAC7B,EAGCH,EAAQ,UAAW,CACf,MAAAI,EAAenB,EAAG,cAAc,GAAG,EACzCmB,EAAc,UAAY,aAC1BA,EAAc,OAAS,SAEvBA,EAAc,UAAU,ssCACxBA,EAAc,KAAOJ,EAAQ,UAC7BV,EAAI,YAAYc,CAAa,CAC/B,CACA,GAAIJ,EAAQ,OAAQ,CACZ,MAAAK,EAAQpB,EAAG,cAAc,KAAK,EACpCoB,EAAQ,UAAU,iBAClBA,EAAQ,YAAYL,EAAQ,OACtB,MAAAM,EAAkBrB,EAAG,cAAc,KAAK,EAC9CqB,EAAgB,UAAY,SAC5BA,EAAgB,UAAY,46BACxB,IAAAC,EAEJF,EAAQ,YAAY,IAAI,CACtB,aAAaE,CAAS,CAAA,EAGxBD,EAAgB,YAAY,IAAI,CACtBD,EAAA,UAAU,OAAO,QAAQ,CAAA,EAGnCA,EAAQ,aAAa,IAAI,CACvBE,EAAU,WAAW,IAAI,CACnBF,EAAQ,UAAU,SAAS,QAAQ,GAC7BA,EAAA,UAAU,IAAI,QAAQ,GAEhC,GAAG,CAAA,EAGPC,EAAgB,aAAa,IAAI,CAC/BC,EAAU,WAAW,IAAI,CACnBF,EAAQ,UAAU,SAAS,QAAQ,GAC7BA,EAAA,UAAU,IAAI,QAAQ,GAEhC,GAAG,CAAA,EAEPC,EAAgB,YAAYD,CAAO,EACnCf,EAAI,YAAYgB,CAAe,CACjC,CACA,GAAIN,EAAQ,MAAO,CACX,MAAAQ,EAAiBvB,EAAG,cAAc,MAAM,EAC9CuB,EAAe,UAAY,QAC3BA,EAAe,UAAYR,EAAQ,MAClC,OAAOS,GAAOA,IAAO,EAAE,EAAE,IAAIA,GAAQ,SAASrG,GAAWqG,CAAI,UAAU,EACrE,KAAK,EAAE,EACVnB,EAAI,YAAYkB,CAAc,CAChC,CAcA,GAZIR,EAAQ,UACFA,EAAA,SAAS,QAAe5C,GAAA,CACxB,MAAAsD,EAAS,SAAS,cAAc,GAAG,EACzCA,EAAO,UAAU,WACjBA,EAAO,MAAMtD,EAAI,MACjBsD,EAAO,UAAU,usBACjBA,EAAO,QAAQ,IAAI,CACNC,GAAA,KAAK,KAAKvD,EAAI,IAAI,CAAA,EAE/BkC,EAAI,YAAYoB,CAAM,CAAA,CACvB,EAECV,EAAQ,KAAM,CACV,MAAAY,EAAgB3B,EAAG,cAAc,KAAK,EAC5C2B,EAAc,UAAY,OAC1BA,EAAc,UAAYZ,EAAQ,KAC/B,OAAOa,GAAMA,IAAM,EAAE,EAAE,IAAIA,GAAO,SAASzG,GAAWyG,CAAG,UAAU,EACnE,KAAK,EAAE,EACVvB,EAAI,YAAYsB,CAAa,CAC/B,CACF,EAEO,SAASD,GAAW7F,EAAU,CACnC,IAAIgG,EAAO,KAAK,UAAU,cAAc,qBAAqBhG,IAAK,EAC9DgG,IACmBC,GAAA,KAAK,SAASjG,CAAE,EACrC,KAAK,OAAO,EACZ,KAAK,QAAQ,EACbgG,EAAO,KAAK,UAAU,cAAc,qBAAqBhG,IAAK,GAMhEgG,EAAO,eAAe,CAAC,MAAM,SAAS,SAAS,SAAS,EACxDA,EAAO,UAAU,QACjB,WAAW,IAAM,CACRA,EAAA,UAAU,OAAO,OAAO,GAC9B,GAAI,CACT,CAEA,SAASC,GAAqBC,EAAKC,EAAK,CACnCD,GAAAA,EAAK,KAAKC,EACJ,MAAA,GAET,IAAIC,EAAK,GACT,UAAU9D,KAAQ4D,EAAK,UAAU,CAAA,EAC5BD,GAAqB3D,EAAI6D,CAAI,IAAQC,EAAA,IAEvC,OAAAA,IAAMF,EAAK,SAAS,IAChBE,CACT,CAEa,MAAAC,GAAc,SAASnB,EAAkBoB,EAAwB,CACtE,MAAAC,EAAapC,EAAG,cAAc,KAAK,EACnCqC,EAAW,KAAK,UAAUtB,CAAO,EAEvC,GADAqB,EAAI,YAAYC,CAAG,EACf,CAACF,GAAgBpB,EAAQ,UAAYA,EAAQ,SAAS,OAAS,IACjEsB,EAAI,YAAYC,EAAevB,EAAQ,QAAQ,CAAC,EAC5CA,EAAQ,WAAa,IAAO,CAC9B,KAAM,CAACwB,EAASC,CAAQ,EAAI,KAAK,eAAezB,EAAQ,QAAQ,EAChEqB,EAAI,YAAYG,CAAQ,CAM1B,CAEK,MAAA,CAAE,IAAAH,EAAK,IAAAC,EAChB,EAEaI,GAAgB,SAAS1B,EAAkBoB,EAAwB,CACxE,MAAAO,EAAkB1C,EAAG,cAAc,KAAK,EACxCqC,EAAW,KAAK,UAAUtB,CAAO,EACvC,OAAA2B,EAAI,YAAYL,CAAG,EACf,CAACF,GAAgBpB,EAAQ,UAAYA,EAAQ,SAAS,OAAS,IACjEsB,EAAI,YAAYC,EAAevB,EAAQ,QAAQ,CAAC,EAC5CA,EAAQ,WAAa,IACK,KAAK,eAAeA,EAAQ,QAAQ,GAQ7D,CAAE,IAAA2B,EAAK,IAAAL,EAChB,EAEaM,GAAY,SAAS5B,EAAuB,CACjD,MAAAsB,EAAMrC,EAAG,cAAc,GAAG,EAC1BK,EAAM,KAAK,YAAYU,CAAO,EAC3B,OAAAD,EAAA,KAAK,KAAKT,EAAKU,CAAO,EAC/BsB,EAAI,YAAYhC,CAAG,EACZgC,CACT,EAEaO,GAAc,SAAS7B,EAAyB,CACrD,MAAA8B,EAAe7C,EAAG,cAAc,KAAK,EAC3C,OAAA6C,EAAM,QAAU9B,EACV8B,EAAA,QAAQ,OAAS,KAAO9B,EAAQ,GACtC8B,EAAM,UAAY,KAAK,UAChBA,CACT,EAEO,SAASC,GAAWC,EAAkB,CACrC,MAAAC,EAAQhD,EAAG,cACjBgD,EAAM,mBAAmBD,CAAG,EACtB,MAAAE,EAAe,OAAO,eACxBA,IACFA,EAAa,gBAAgB,EAC7BA,EAAa,SAASD,CAAK,EAE/B,CAGO,SAASE,GAAe7C,EAAY,mBAEzC,GADA,QAAQ,KAAK,gBAAgB,EACzB,CAACA,EAAK,OACN,IAAA0C,EAAM/C,EAAG,cAAc,KAAK,EAC1B,MAAAmD,EAAS9C,EAAI,WAAW,GAAG,YACjCA,EAAI,YAAY0C,CAAG,EACnBA,EAAI,GAAK,YAETA,EAAI,gBAAkB,OACtBA,EAAI,WAAa,GACjBA,EAAI,YAAcI,EACf9C,EAAI,QAAQ,OACAA,EAAI,QAAQ,MAClB,QAAalC,GAAA,CACZ,MAAA+C,EAAelB,EAAG,cAAc,KAAK,EAC3CkB,EAAa,IAAM/C,EAAI,IACV+C,EAAA,MAAM,MAAQ/C,EAAI,MAAQ,KACvC+C,EAAa,MAAM,QAAU,QAC7B6B,EAAI,YAAY7B,CAAY,CAAA,CAC7B,EAEH6B,EAAI,MAAM,QAAU,aAAa1C,EAAI,YAAc,mBAAmBA,EAAI,aAAa,QACpF+C,GAAAvC,EAAAR,EAAI,UAAJ,YAAAQ,EAAa,QAAb,MAAAuC,EAAoB,QACrBL,EAAI,MAAM,MAAM,WAEfM,GAAAC,EAAAjD,EAAI,UAAJ,YAAAiD,EAAa,QAAb,YAAAD,EAAoB,SAAQ,aAAYE,EAAAlD,EAAI,UAAJ,YAAAkD,EAAa,MAAK,QAAQ,GAACC,GAAAC,EAAApD,EAAI,UAAJ,YAAAoD,EAAa,QAAb,MAAAD,EAAoB,UACxFT,EAAI,MAAM,MAAM,WAEd,KAAK,YAAc,IAAMA,EAAI,MAAM,MAAQ,KAC/CA,EAAI,MAAM,EACVD,GAAWC,CAAG,EACd,KAAK,SAAWA,EAEX,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,YACN,IAAK1C,EAAI,OAAA,CACV,EAEG0C,EAAA,iBAAiB,UAAgBhD,GAAA,CACnCA,EAAE,gBAAgB,EAClB,MAAM2D,EAAM3D,EAAE,IAEV,GAAA2D,IAAQ,SAAWA,IAAQ,MAAO,CAEpC,GAAI3D,EAAE,SAAU,OAEhBA,EAAE,eAAe,EACjB,KAAK,SAAS,OACd,KAAK,IAAI,OACX,CAAA,CACD,EACGgD,EAAA,iBAAiB,OAAQ,IAAM,CACjC,GAAI,CAACA,EAAK,OACV,MAAMhB,EAAO1B,EAAI,QACXwC,EAAQE,EAAI,YAAa,KAAK,EAmBpC,GAhBAhB,EAAK,MAAM,GACPgB,EAAA,WAAW,QAAS5E,GAAM,CACzBA,EAAI,WAAW,OAEd4D,EAAK,MAAM,KAAK,CACd,IAAK5D,EAAyB,IAC9B,MAAOA,EAAyB,MAChC,OAAQA,EAAyB,MAAA,CAClC,CACL,CACD,EACG0E,IAAU,IAAMd,EAAK,MAAM,SAAS,EAAGA,EAAK,MAAQoB,EACnDpB,EAAK,MAAQc,EAClBE,EAAI,OAAO,EACX,KAAK,SAAWA,EAAM,KAElBF,IAAUM,GAAUpB,EAAK,MAAM,SAAS,EAAG,OAC3C1B,EAAA,WAAW,GAAG,YAAc0B,EAAK,MAE/B,MAAAd,EAAkBZ,EAAI,cAAc,oBAAoB,EACxDW,EAAmBX,EAAI,cAAc,oBAAoB,EAC3D0B,EAAK,QAAOA,EAAK,MAAM,IAC3BA,EAAK,MAAM,cAAcd,EAAkB,MAAM,OAAOD,EAAmB,MAAM,OAAOX,EAAI,aAAa,SAAA,EAAW,KAGpH,OAAO0B,EAAK,MAAM,MAEb,KAAA,SAAS1B,EAAI0B,CAAI,EACtB,KAAK,QAAQ,EAEb4B,GAAoB,KAAK,KAAK,KAAK,SAAS5B,EAAK,GAAGA,EAAK,KAAK,EACzD,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,aACN,IAAKA,EACL,OAAAoB,CAAA,CACD,CAAA,CACF,EACD,QAAQ,QAAQ,gBAAgB,CAClC,CAGA,SAASQ,GAAoB5B,EAAalG,EAAGgH,EAAM,QACjDd,EAAAA,GAAAA,YAAAA,EAAM,WAANA,MAAAA,EAAgB,QAAQ,CAAC,CAAC,KAAAC,CAAA,EAAMrD,IAAQ,CACtC,GAAGqD,IAAOnG,EAAG,CACXkG,EAAK,SAASpD,GAAO,MAAMkE,EAC3B,MAAMpB,EAAO,KAAK,UAAU,cAAc,qBAAqBM,EAAK,eAAe,EACnFN,EAAO,MAAMoB,CACf,CAAA,GAEF,UAAU1E,KAAQ4D,EAAK,UAAU,CAAA,EAC/B4B,GAAoB,KAAK,KAAKxF,EAAItC,EAAGgH,CAAK,CAE9C,CAEa,MAAAP,EAAiB,SAASsB,EAAyC,CACxE,MAAAC,EAAqB7D,EAAG,cAAc,KAAK,EAExC,OAAA6D,EAAA,UAAYD,IAAa,GAAQ,IAAM,IAChDC,EAAS,SAAWD,IAAa,GACxBC,EAAA,UAAYD,IAAa,GAAQ,QAAU,GAC7CC,CACT,EAUgB,SAAAC,GAAehI,EAAiB0D,EAAyBuE,EAAY,CAC/E,IAAAC,EACAxE,EACMwE,EAAAxE,EAEAwE,EAAAhE,EAAG,cAAc,UAAU,EAErC,IAAIiE,EAAO,CAAA,EACX,QAASlI,EAAI,EAAGA,EAAID,EAAK,OAAQC,IAAK,CACpC,MAAMgF,EAAUjF,EAAKC,GAClB,IAAAgF,GAAA,YAAAA,EAAS,QAAO,UAAU,CAC3B,KAAM,CAAC,IAAA2B,CAAM,EAAA,KAAK,cAAc3B,CAAO,EACvC,GAAIA,EAAQ,UAAYA,EAAQ,SAAS,OAAS,GAC7CA,EAAQ,WAAa,GAAM,CAC5B,KAAM,CAACwB,EAASC,CAAQ,EAAG,KAAK,eAAezB,EAAQ,QAAQ,EAC/D2B,EAAI,YAAYH,CAAQ,EACrBC,GACDA,EAAS,QAAerE,GAAA,CACtBuE,EAAI,YAAYvE,CAAG,CAAA,CACtB,CAEH,CAGF8F,EAAO,KAAKvB,CAAG,EACf,QACF,CACM,MAAAN,EAAMpC,EAAG,cAAc,KAAK,EAC9B+D,IAAc,EAChB3B,EAAI,UAAY,MACP2B,IAAc,EACvB3B,EAAI,UAAY,MACP2B,IAAc,IACnBhD,EAAQ,YAAc,EACxBqB,EAAI,UAAY,MACPrB,EAAQ,YAAc,IAC/BqB,EAAI,UAAY,QAGd,MAAAC,EAAM,KAAK,UAAUtB,CAAO,EAClC,GAAIA,EAAQ,UAAYA,EAAQ,SAAS,OAAS,GAG5C,GAFJsB,EAAI,YAAYC,EAAevB,EAAQ,QAAQ,CAAC,EAChDqB,EAAI,YAAYC,CAAG,EACftB,EAAQ,WAAa,GAAO,CAC9B,KAAM,CAACwB,EAASG,CAAG,EAAI,KAAK,eAAe3B,EAAQ,QAAQ,EAC3DqB,EAAI,YAAYG,CAAQ,EACrBG,GACDA,EAAI,QAAevE,GAAA,QACb0C,EAAAuB,EAAI,WAAJ,MAAAvB,EAAe,IACjBuB,EAAI,YAAYpC,EAAG,cAAc,aAAa,CAAC,EAE7CoC,EAAA,SAAS,GAAG,YAAYjE,CAAG,CAAA,CAChC,CAEL,OAEAiE,EAAI,YAAYC,CAAG,EAErB2B,EAAM,YAAY5B,CAAG,CACvB,CACO,MAAA,CAAC4B,EAAMC,CAAM,CACtB,CAGO,SAASC,IAAS,CACvB,QAAQ,KAAK,QAAQ,EACrB,KAAK,KAAK,UAAY,GACtB,KAAK,IAAI,UAAY,GACrB,MAAM7D,EAAM,KAAK,YAAY,KAAK,QAAQ,EAC1CS,EAAS,KAAK,KAAKT,EAAK,KAAK,QAAQ,EACrCA,EAAI,UAAY,GACX,KAAA,KAAK,YAAYA,CAAG,EAEnB,MAAA8D,EAA0B,KAAK,SAAS,SAC1C,GAAA,GAACA,GAAgBA,EAAa,SAAW,GACzC,IAAA,KAAK,YAAc,EAAM,CAE3B,IAAIC,EAAS,EACTC,EAAS,EACAF,EAAA,IAAIpC,GAAQ,CACnBA,EAAK,YAAc,OACjBqC,GAAUC,GACZtC,EAAK,UAAY,EACPqC,GAAA,IAEVrC,EAAK,UAAY,EACPsC,GAAA,GAGRtC,EAAK,YAAc,EACXqC,GAAA,EAEAC,GAAA,CAEd,CACD,CACH,CACA,KAAK,eAAe,KAAK,SAAS,SAAU,KAAK,IAAK,KAAK,SAAS,EACpE,QAAQ,QAAQ,QAAQ,EAC1B,CCveA,MAAMrE,EAAK,SACLsE,EAAQ,6BACDC,GAAiB,SAASC,EAAW,CAChD,MAAMC,EAAOzE,EAAG,gBAAgBsE,EAAO,MAAM,EACxC,OAAAG,EAAA,aAAa,IAAKD,CAAC,EACnBC,EAAA,aAAa,SAAU,MAAM,EAC7BA,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,eAAgB,GAAG,EAChCA,EAAA,aAAa,iBAAkB,QAAQ,EACvCA,EAAA,aAAa,YAAa,qBAAqB,EAC7CA,CACT,EAEaC,EAAgB,SAASC,EAAe,CACnD,MAAMC,EAAM5E,EAAG,gBAAgBsE,EAAO,KAAK,EACvC,OAAAM,EAAA,aAAa,QAASD,CAAK,EACxBC,CACT,EAEaC,GAAgB,SAASL,EAAW,CAC/C,MAAMC,EAAOzE,EAAG,gBAAgBsE,EAAO,MAAM,EACxC,OAAAG,EAAA,aAAa,IAAKD,CAAC,EACnBC,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,iBAAkB,QAAQ,EACvCA,EAAA,aAAa,SAAU,SAAS,EAChCA,EAAA,aAAa,eAAgB,GAAG,EAChCA,EAAA,aAAa,YAAa,qBAAqB,EAC7CA,CACT,EAEaK,GAAa,SAASC,EAAYC,EAAYC,EAAYC,EAAY,CACjF,MAAMC,EAAOnF,EAAG,gBAAgBsE,EAAO,MAAM,EAC7C,OAAAa,EAAK,aAAa,KAAMJ,EAAG,SAAU,CAAA,EACrCI,EAAK,aAAa,KAAMH,EAAG,SAAU,CAAA,EACrCG,EAAK,aAAa,KAAMF,EAAG,SAAU,CAAA,EACrCE,EAAK,aAAa,KAAMD,EAAG,SAAU,CAAA,EAChCC,EAAA,aAAa,SAAU,MAAM,EAC7BA,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,eAAgB,GAAG,EAC9BA,CACT,EAEaC,GAAa,SAASZ,EAAW,CAC5C,MAAMC,EAAOzE,EAAG,gBAAgBsE,EAAO,MAAM,EACxC,OAAAG,EAAA,aAAa,IAAKD,CAAC,EACnBC,EAAA,aAAa,SAAU,MAAM,EAC7BA,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,iBAAkB,QAAQ,EACvCA,EAAA,aAAa,eAAgB,GAAG,EAChCA,EAAA,aAAa,YAAa,qBAAqB,EAE7CA,CACT,EAmBaY,GAAiB,SAASb,EAAWc,EAA0B,CAC1E,MAAMC,EAAIvF,EAAG,gBAAgBsE,EAAO,GAAG,EACjCG,EAAOzE,EAAG,gBAAgBsE,EAAO,MAAM,EACvCkB,EAAQxF,EAAG,gBAAgBsE,EAAO,MAAM,EACxC,OAAAkB,EAAA,aAAa,IAAKF,CAAM,EACxBE,EAAA,aAAa,SAAU,kBAAkB,EACzCA,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,iBAAkB,KAAK,EACpCA,EAAA,aAAa,eAAgB,GAAG,EACjCf,EAAA,aAAa,IAAKD,CAAC,EACnBC,EAAA,aAAa,SAAU,kBAAkB,EACzCA,EAAA,aAAa,OAAQ,MAAM,EAC3BA,EAAA,aAAa,iBAAkB,KAAK,EACpCA,EAAA,aAAa,eAAgB,GAAG,EAErCc,EAAE,YAAYd,CAAI,EAClBc,EAAE,YAAYC,CAAK,EACZD,CACT,ECxFA,IAAIvF,EAAK,SACLyF,EAAS,IACTC,EAAY,IACZC,EAAU,IACVC,EAAW,IACXC,EAAa,GACbC,GAAO,0IAEX,SAASC,IAAM,CACbN,EAAS,IACTC,EAAY,IACZC,EAAU,IACVC,EAAW,IACXC,EAAa,EACf,CAEA,SAASG,IAAiB,CACxBD,GAAM,EACN,IAAI5B,EAAenE,EAAG,iBAAiB,sBAAsB,EACzDiG,EAAa,GACjB,QAASlK,EAAI,EAAGA,EAAIoI,EAAa,OAAQpI,IAAK,CAC5C,IAAImK,EAAc/B,EAAapI,GAC3BoK,EAAOD,EAAY,sBAAuB,EAC1C7D,EAAM6D,EAAY,UAClBE,EAAS/D,EAAM8D,EAAK,OACpBE,EAAOH,EAAY,WACnBI,EAAQD,EAAOF,EAAK,MAEpB9D,EAAMoD,IACRA,EAASpD,GAEP+D,EAASV,IACXA,EAAYU,GAEVC,EAAOV,IACTA,EAAUU,GAERC,EAAQV,IACVA,EAAWU,GAEbL,GAAcM,GAAaL,CAAW,CACvC,CACD,QAAQ,IAAIT,EAAQC,EAAWC,EAASC,CAAQ,EAChDK,GAAcO,GAAW,EAEzB,IAAIC,EAAYf,EAAYD,EAASI,EAAa,EAC9Ca,EAAWd,EAAWD,EAAUE,EAAa,EAC7Cc,EAAUC,GAAUH,EAAWC,CAAQ,EAC3C,OAAAT,EACE,4BAA4BS,cAAqBD,4BACjDR,EACFU,EAAQ,UAAYV,EAEbU,CACT,CAEO,SAASE,IAAoB,CAClC7G,EAAG,KAAK,UACR+F,GAAM,EACN,IAAI5B,EAAenE,EAAG,iBAAiB,sBAAsB,EACzDiG,EAAa,GACjB,QAASlK,EAAI,EAAGA,EAAIoI,EAAa,OAAQpI,IAAK,CAC5C,IAAImK,EAAc/B,EAAapI,GAC3BoK,EAAOD,EAAY,sBAAuB,EAC1C7D,EAAM6D,EAAY,UAClBE,EAAS/D,EAAM8D,EAAK,OACpBE,EAAOH,EAAY,WACnBI,EAAQD,EAAOF,EAAK,MAEpB9D,EAAMoD,IACRA,EAASpD,GAEP+D,EAASV,IACXA,EAAYU,GAEVC,EAAOV,IACTA,EAAUU,GAERC,EAAQV,IACVA,EAAWU,GAEbL,GAAcM,GAAaL,CAAW,CACvC,CACD,QAAQ,IAAIT,EAAQC,EAAWC,EAASC,CAAQ,EAChD,IAAIa,EAAYf,EAAYD,EACxBiB,EAAWd,EAAWD,EAC1B,eAAQ,IAAI,YAAYc,CAAS,EAC1B,CAACA,EAAU,EAAEC,EAAS,CAAC,CAChC,CAEA,SAASE,GAAUE,EAAQrG,EAAO,CAChC,IAAImE,EAAM,SAAS,gBAAgB,6BAA8B,KAAK,EACtE,OAAAA,EAAI,aAAa,SAAUkC,CAAM,EACjClC,EAAI,aAAa,QAASnE,CAAK,EAC/BmE,EAAI,aAAa,QAAS,4BAA4B,EACtDA,EAAI,aAAa,UAAW,KAAK,EACjCA,EAAI,aAAa,QAAS,8BAA8B,EACjDA,CACT,CAEA,SAAS4B,IAAY,CACnB,IAAIO,EAAO,SAAS,cAAc,MAAM,EACpCC,EAAU,SAAS,cAAc,YAAY,EAC7Cb,EAAOa,EAAQ,sBAAuB,EACtCC,EAAW,iBAAiBD,CAAO,EACnCpI,EAAIoI,EAAQ,WACZ3E,EAAM,EACNgE,EAAO,EACPtF,EAAU,SAAS,cAAc,YAAY,EAAE,QAC/CmG,EAAS,iBAAiBtI,CAAC,EAC3BuI,EAAcJ,EAAK,UAAYtB,EAC/B2B,EAAcL,EAAK,WAAapB,EAChC0B,EACJhB,EAAO,SAASa,EAAO,WAAW,EAAI,SAASf,EAAK,WAAW,EAC3DmB,EACJjF,EACA,SAAS6E,EAAO,UAAU,EAC1B,SAASf,EAAK,UAAU,EACxB,SAASA,EAAK,QAAQ,EAEtB9D,EACA,SAAS6E,EAAO,UAAU,EAC1B,SAASf,EAAK,UAAU,EACxB,IAAIoB,EAAY,SAAS,cAAc,SAAS,EAG5CC,EAAO,GACX,GAAIzG,EAAQ,MAAQA,EAAQ,KAAK,OAAQ,CACvC,IAAI0G,EAAUT,EAAQ,iBAAiB,cAAc,EACrD,QAASjL,EAAI,EAAGA,EAAI0L,EAAQ,OAAQ1L,IAAK,CACvC,IAAI6F,EAAM6F,EAAQ1L,GACd2L,EAAU9F,EAAI,sBAAuB,EACzC4F,GAAQ,YAAYH,SAClBC,EAAiB,+BACaI,EAAQ,kBACtCA,EAAQ;AAAA,4BAEYL,SAClBC,EAAiB,+BACaI,EAAQ,kBACtCA,EAAQ;AAAA,wCAEsB9F,EAAI;AAAA;AAAA,OAGvC,CACF,CACD,IAAI+F,EAAQ,GACZ,GAAI5G,EAAQ,OAASA,EAAQ,MAAM,OAAQ,CACzC,IAAI6G,EAAWZ,EAAQ,iBAAiB,eAAe,EACvD,QAASjL,EAAI,EAAGA,EAAI6L,EAAS,OAAQ7L,IAAK,CACxC,IAAIyF,EAAOoG,EAAS7L,GACLyF,EAAK,sBAAuB,EAC3CmG,GAAS;AAAA,eACAnG,EAAK,mBACf,CACF,CAED,IAAIqG,EAAS,GACb,GAAI9G,EAAQ,OAASA,EAAQ,MAAM,OAAQ,CACzC,IAAI+G,EAAY,IAAI,iBAAiB,QAAQ,EAC7C,QAAS/L,EAAI,EAAGA,EAAI+L,EAAU,OAAQ/L,IAAK,CACzC,IAAIgM,EAAQD,EAAU/L,GACNgM,EAAM,sBAAuB,EAC7CF,GAAU,GAAGE,EAAM,WACpB,CACF,CAED,IAAIC,EAAS,2BAA2BnC,EAAaF,MACnDE,EAAaJ,OACP8B,EAAU,gBAEhBS,GACA,qCAAqCZ,EAAcvB,MACnDsB,EAActB;AAAA,iBAEDQ,SAAYhE,+BACzB8D,EAAK,kBACQA,EAAK;AAAA,0BACIE,EAAO,UACzBhE,EAAM,cACM4E,EAAS,kBAAkBA,EAAS;AAAA,6HACiDA,EAAS,wBAAwBA,EAAS,oBAAoBA,EAAS;AAAA,UACtKlG,EAAQ;AAAA,UACR4G;AAAA,UACAE;AAAA;AAAA;AAAA,QAGFL;AAAA,QAGN,IAAIS,EAAWjI,EAAG,cAAc,aAAa,EAC7C,OAAGiI,IACDD,GAAQ,2BAA2BnC,EAAaF,MAC9CE,EAAaJ,OACTwC,EAAW,iBAEZD,CACT,CAEA,SAASzB,GAAaL,EAAa,CACjC,IAAIgC,EAAShC,EAAY,iBAAiB,KAAK,EAC3CiC,EAAqBjC,EAAY,UAAYT,EAC7C2C,EAAqBlC,EAAY,WAAaP,EAE9Cf,EAAM,GACNyD,EAASnC,EAAY,cAAc,SAAS,EAChDtB,GAAO,2BAA2BwD,EAAqBvC,MACrDsC,EAAqBtC,OAEvBjB,GAAOyD,EAASA,EAAO,UAAY,GACnC,QAAStM,EAAI,EAAGA,EAAImM,EAAO,OAAQnM,IAAK,CACtC,IAAIsE,EAAM6H,EAAOnM,GACb6C,EAAIyB,EAAI,WACRU,EAAUV,EAAI,QAClB,GAAIU,EAAQ,KAAQ,SACpB,IAAIuH,EAAUjI,EAAI,sBAAuB,EACrCgC,EAAMzD,EAAE,UACRyH,EAAOzH,EAAE,WACTqI,EAAW,iBAAiB5G,CAAG,EAC/B6G,EAAS,iBAAiBtI,CAAC,EAC3ByI,EACFhB,EAAO,SAASa,EAAO,WAAW,EAAI,SAASD,EAAS,WAAW,EACjEK,EACFjF,EACA,SAAS6E,EAAO,UAAU,EAC1B,SAASD,EAAS,UAAU,EAC5B,SAASA,EAAS,QAAQ,EACxBsB,EACFlG,EACA,SAAS6E,EAAO,UAAU,EAC1B,SAASD,EAAS,UAAU,EAE1BuB,EAAS,GACTvB,EAAS,aAAe,QAC1BuB,EAAS,YAAYnC,EAAO,UAAUhE,+BACpCiG,EAAQ,kBAERA,EAAQ,8EAGZ,IAAIG,EAAkB,GAClBxB,EAAS,iBAAmB,qBAC9BwB,EAAkB,YAChBpC,EAAO,UACChE,+BAAiCiG,EAAQ,kBACjDA,EAAQ,wBACUrB,EAAS,6BAG/B,IAAIO,EAAO,GACX,GAAIzG,EAAQ,MAAQA,EAAQ,KAAK,OAAQ,CACvC,IAAI0G,EAAUpH,EAAI,iBAAiB,cAAc,EACjD,QAAStE,EAAI,EAAGA,EAAI0L,EAAQ,OAAQ1L,IAAK,CACvC,IAAI6F,EAAM6F,EAAQ1L,GACd2L,EAAU9F,EAAI,sBAAuB,EACzC4F,GAAQ,YAAYH,SAClBC,EAAiB,+BACaI,EAAQ,kBACtCA,EAAQ;AAAA,8BAEYL,SAClBC,EAAiB,+BACaI,EAAQ,kBACtCA,EAAQ;AAAA,0CAEsB9F,EAAI;AAAA,2BAEvC,CACF,CACD,IAAI+F,EAAQ,GACZ,GAAI5G,EAAQ,OAASA,EAAQ,MAAM,OAAQ,CACzC,IAAI6G,EAAWvH,EAAI,iBAAiB,eAAe,EACnD,QAAStE,EAAI,EAAGA,EAAI6L,EAAS,OAAQ7L,IAAK,CACxC,IAAIyF,EAAOoG,EAAS7L,GACLyF,EAAK,sBAAuB,EAC3CmG,GAAS;AAAA,iBACAnG,EAAK,mBACf,CACF,CAED,IAAIqG,EAAS,GACb,GAAI9G,EAAQ,OAASA,EAAQ,MAAM,OAAQ,CACzC,IAAI+G,EAAYzH,EAAI,iBAAiB,QAAQ,EAC7C,QAAStE,EAAI,EAAGA,EAAI+L,EAAU,OAAQ/L,IAAK,CACzC,IAAIgM,EAAQD,EAAU/L,GACNgM,EAAM,sBAAuB,EAC7CF,GAAU,GAAGE,EAAM,WACpB,CACF,CAEDnD,GAAO,UAAU7D,EAAQ;AAAA,QACrByH;AAAA,QACAC;AAAA,2BACmBpB,SAAuBkB,aAA6BtB,EAAS,kBAAkBA,EAAS;AAAA,2HACZA,EAAS,wBAAwBA,EAAS,oBAAoBA,EAAS;AAAA,UACpKlG,EAAQ;AAAA,UACR4G;AAAA,UACAE;AAAA;AAAA;AAAA,QAGFL;AAAA,OAEL,CACD,OAAA5C,GAAO,OACAA,CACT,CAEO,IAAI8D,GAAY,UAAY,CACjC,IAAI/B,EAAUX,GAAgB,EAC1B2C,EAAQ,IAAI,gBACd,IAAI,KAAK,CAAC7C,GAAOa,EAAQ,UAAU,QAAQ,UAAW,GAAG,CAAC,CAAC,CAC5D,EACGiC,EAAI,SAAS,cAAc,GAAG,EAClCA,EAAE,KAAOD,EACTC,EAAE,SAAW,iBACbA,EAAE,MAAO,CACX,EAEWC,GAAe,SAAU3I,EAAS,KAAM4I,EAAS,UAAW,CAGrE9I,OAAAA,EAAKE,EAAS,UACA8F,GAAgB,CAEhC,ECzTA,SAAS+C,GAAQ7I,EAAU,CACzB,OAAOA,EAAS,YAAcA,EAAS,eAAiBA,EAAS,QACnE,CAaO,MAAM8I,GAAa,SAASC,EAAeC,EAAWC,EAAY,CACvE,GAAI,EAACF,EAED,IADJ,QAAQ,KAAK,YAAY,EACrB,OAAOA,GAAkB,SAC3B,OAAO,KAAK,WAAWhJ,EAAQgJ,CAAa,CAAC,EAgC/C,GA5BG,KAAK,YAiBHA,EAAc,YAAY,WAC3BA,EAAc,UAAU,GAExBA,EAAc,UAAU,WAElB,QAAA,IAAI,KAAK,qBAAqB,IAGlC,KAAK,cAAa,KAAK,YAAY,UAAY,IACnDA,EAAc,UAAY,YAEzB,iBAAM,cAAc,CACf,MAAAjI,EAAmBiI,EAAc,cAAc,oBAAoB,EACzEjI,EAAmB,UAAU,uBACvB,MAAAC,EAAkBgI,EAAc,cAAc,mBAAmB,EACvEhI,EAAkB,UAAU,qBAC9B,CACA,KAAK,YAAcgI,EACfC,EACF,KAAK,IAAI,KAAK,gBAAiBD,EAAc,QAASE,CAAU,EAEhE,KAAK,IAAI,KAAK,aAAcF,EAAc,QAASE,CAAU,EAE/D,QAAQ,QAAQ,YAAY,EAC9B,EACaC,GAAe,UAAW,CACrC,GAAI,KAAK,cACP,KAAK,YAAY,UAAY,GAC1B,KAAK,eAAc,CACpB,MAAMpI,EAAmB,KAAK,YAAY,cAAc,oBAAoB,EAC5EA,EAAmB,UAAU,GAC7B,MAAMC,EAAkB,KAAK,YAAY,cAAc,mBAAmB,EAC1EA,EAAkB,UAAU,EAC9B,CAEF,KAAK,YAAc,KACd,KAAA,IAAI,KAAK,cAAc,CAC9B,EACaoI,GAAoB,UAAW,CAC1C,GAAI,CAAC,KAAK,aAAe,KAAK,YAAY,QAAQ,SAAW,SAAiB,OAE9E,MAAMC,EAAU,KAAK,YAAY,cAAc,cAAc,YACzD,IAAAC,EACE,MAAAnH,EAAM,KAAK,YAAY,cAAc,cAC3C,GAAIA,EAAI,YAAc,OAASA,EAAI,YAAc,MAAO,CACtD,MAAMoH,EAAc,KAAK,cAAc,iBAAiB,IAAMpH,EAAI,SAAS,EACrErG,EAAI,MAAM,KAAKyN,CAAW,EAAE,QAAQpH,CAAG,EACzC,GAAArG,EAAI,EAAIyN,EAAY,OACbD,EAAAC,EAAYzN,EAAI,GAAG,WAAW,eAEhC,OAAA,WAEAuN,EACTC,EAASD,EAAQ,WAAW,eAErB,OAAA,GAET,YAAK,WAAWC,CAAM,EACf,EACT,EACaE,GAAoB,UAAW,CAC1C,GAAI,CAAC,KAAK,aAAe,KAAK,YAAY,QAAQ,SAAW,SAAiB,OAE9E,MAAMH,EAAU,KAAK,YAAY,cAAc,cAAc,gBACzD,IAAAC,EACE,MAAAnH,EAAM,KAAK,YAAY,cAAc,cAC3C,GAAIA,EAAI,YAAc,OAASA,EAAI,YAAc,MAAO,CACtD,MAAMoH,EAAc,KAAK,cAAc,iBAAiB,IAAMpH,EAAI,SAAS,EACrErG,EAAI,MAAM,KAAKyN,CAAW,EAAE,QAAQpH,CAAG,EACzC,GAAArG,EAAI,GAAK,EACFwN,EAAAC,EAAYzN,EAAI,GAAG,WAAW,eAEhC,OAAA,WAEAuN,EACTC,EAASD,EAAQ,WAAW,eAErB,OAAA,GAET,YAAK,WAAWC,CAAM,EACf,EACT,EACaG,GAAmB,UAAW,CACzC,GAAI,CAAC,KAAK,YAAa,OACjB,MAAAnH,EAAW,KAAK,YAAY,cAAc,YAC5C,GAAAA,GAAYA,EAAS,WAAY,CAC7B,MAAAgH,EAAShH,EAAS,WAAW,WAAW,WAC9C,KAAK,WAAWgH,CAAM,CACxB,CACF,EACaI,GAAe,UAAW,CACrC,GAAI,CAAC,KAAK,aAAe,KAAK,YAAY,QAAQ,SAAW,SAAiB,OAE9E,MAAMzN,EAAS,KAAK,YAAY,cAAc,cAAc,cACzD,gBACH,GAAIA,EAAQ,CACV,MAAMqN,EAASrN,EAAO,WACtB,KAAK,WAAWqN,CAAM,CACxB,CACF,EASaK,GAAmB,UAAW,CACzC,MAAM9N,EAAO,CACX,UAAU,KAAK,UACf,SAAUiN,GAAQ,IAAI,EACtB,SAAU,KAAK,QAAA,EAEjB,OAAO,KAAK,UAAUjN,EAAM,CAACgC,EAAG+L,IAAM,CACpC,GAAI/L,IAAM,SAEV,OADIA,IAAM,QACNA,IAAM,KAAa+L,EAAE,QAAQ,GAC1BA,CAAA,CACR,CACH,EASaC,GAAa,UAAmB,CAC3C,MAAMhO,EAAO,CACX,UAAU,KAAK,UACf,SAAUiN,GAAQ,IAAI,EACtB,SAAU,KAAK,QAAA,EAEjB,OAAO,KAAK,MACV,KAAK,UAAUjN,EAAM,CAACgC,EAAG+L,IAAM,CAC7B,GAAI/L,IAAM,SAEV,OADIA,IAAM,QACNA,IAAM,KAAa+L,EAAE,QAAQ,GAC1BA,CAAA,CACR,CAAA,CAEL,EAWgB,SAAAE,GAASC,EAAiBC,EAAIC,EAAK,CAC9CD,EAAIC,EACLF,EAAS,SAAS,GAElBA,EAAS,SAAS,GAEpB,UAAU7L,KAAQ6L,EAAS,UAAU,CAAA,EAC1BD,GAAA5L,EAAI8L,EAAI,EAAEC,CAAI,CAE3B,CAMO,MAAMC,GAAyB,UAAiB,CAC/C,MAAAC,EAAW,OAAO,KAAK,UAAU,cAAc,kBAAkB,EAAE,KAAK,GAAG,EAC3EtO,EAAO,CACX,UAAU,KAAK,UACf,SAAUiN,GAAQ,IAAI,EACtB,SAAU,KAAK,SACf,OAAOlC,GAAkB,KAAK,IAAI,EAClC,WAAAuD,CAAA,EAEO,OAAAL,GAAAjO,EAAK,SAAS,EAAEsO,CAAU,EAC5B,KAAK,MACV,KAAK,UAAUtO,EAAM,CAACgC,EAAG+L,IAAM,CAC7B,GAAI/L,IAAM,SAEV,OADIA,IAAM,QACNA,IAAM,KAAa+L,EAAE,QAAQ,GAC1BA,CAAA,CACR,CAAA,CAEL,EAUaQ,GAAe,UAAkB,CACtC,MAAAvO,EAAOiN,GAAQ,IAAI,EACrB,IAAAuB,EAAW,KAAOxO,EAAK,MAAQ;AAAA;AAAA,EAC1B,SAAAyO,EAAQhI,EAAU2H,EAAM,CAC/B,QAASnO,EAAI,EAAGA,EAAIwG,EAAS,OAAQxG,IAC/BmO,GAAQ,EACEI,GAAA,GAAG,SAASJ,EAAM,GAAG,EAAI,IAAM3H,EAASxG,GAAG,MAAQ;AAAA;AAAA,EAG7DuO,GAAA,GAAG,SAASJ,EAAO,EAAG,GAAI,EAAI,KAAO3H,EAASxG,GAAG,MAAQ;AAAA,EAEzDwG,EAASxG,GAAG,UACdwO,EAAQhI,EAASxG,GAAG,SAAUmO,EAAO,CAAC,CAG5C,CACQ,OAAAK,EAAAzO,EAAK,SAAU,CAAC,EACjBwO,CACT,EAQaE,GAAa,UAAW,CACnC,KAAK,SAAW,EAClB,EAQaC,GAAc,UAAW,CACpC,KAAK,SAAW,EAClB,EAUaC,GAAQ,SAASC,EAAU,CACtC,KAAK,SAAWA,EAChB,KAAK,IAAI,MAAM,UAAY,SAAWA,EAAW,GACnD,EAEA,SAASC,GAAa7I,EAAiB,CAErC,OADWA,EAAK,cAAc,MAAM,EACxB,aAAa,GAC3B,CACA,SAAS8I,GAAc9I,EAAiB,CAEtC,OADWA,EAAK,cAAc,MAAM,EACxB,cAAc,GAC5B,CAEA,SAAS+I,GAAkBlC,EAAcmC,EAAc,SACrD,MAAMC,IAAQnK,EAAA+H,GAAA,YAAAA,EAAG,0BAAH,YAAA/H,EAA4B,MAAK,EACzCoK,IAAQ7H,EAAA2H,GAAA,YAAAA,EAAG,0BAAH,YAAA3H,EAA4B,MAAK4H,EACxC,OAAA,KAAK,IAAIA,EAAQC,CAAO,CACjC,CAkBA,SAASC,GAAyBnJ,EAAiB,CAC3C,MAAA1B,EAAI0B,EAAK,cAAc,MAAM,EAC7BoJ,EAASpJ,EAAK,cAAc,0BAA0B,EACrD,OAAA+I,GAAkBzK,EAAI8K,CAAQ,CACvC,CAQO,MAAMC,GAAW,UAAW,CACjC,KAAK,UAAU,SACb,IAAQ,KAAK,UAAU,YAAc,EACrC,IAAQ,KAAK,UAAU,aAAe,CAAA,CAE1C,EAScC,GAAY,UAAW,SAChCxK,EAAA,KAAK,WAAL,YAAAA,EAAe,SAAS,QAAO,EAChC,KAAK,UAAU,SACb,IAAQ+J,GAAa,KAAK,SAAS,EAAE,EAAE,GACvC,IAAQC,GAAc,KAAK,SAAS,EAAE,EAAEK,GAAyB,KAAK,SAAS,EAAE,CAAA,EAGnF,KAAK,UAAU,SACb,IAAQ,KAAK,UAAU,YAAc,EACrC,IAAQ,KAAK,UAAU,aAAe,CAAA,CAI5C,EAaaI,GAAY,SAASC,EAAO,CACnCA,EAAM,QAAQ,OACd,KAAK,gBAAkB,OACzB,KAAK,cAAgB,KAAK,WAEvB,KAAK,cACR,KAAK,eAAiB,KAAK,SAC3B,KAAK,YAAc,IAErB,KAAK,SAAWA,EAAM,QACtB,KAAK,SAAS,KAAO,GACrB,KAAK,UAAU,EACjB,EAQaC,GAAc,UAAW,CACpC,KAAK,YAAc,GACf,KAAK,gBAAkB,OACzB,OAAO,KAAK,SAAS,KACrB,KAAK,SAAW,KAAK,eACrB,KAAK,UAAY,KAAK,cACtB,KAAK,cAAgB,KACrB,KAAK,KAAK,EAEd,EAQaC,GAAW,UAAW,CACjC,KAAK,UAAY,EACjB,KAAK,KAAK,CACZ,EAQaC,GAAY,UAAW,CAClC,KAAK,UAAY,EACjB,KAAK,KAAK,CACZ,EAQaC,GAAW,UAAW,CACjC,KAAK,UAAY,EACjB,KAAK,KAAK,CACZ,EAQaC,GAAY,SAASC,EAAQ,CACxC,KAAK,OAASA,EACd,KAAK,KAAK,CACZ,EAEaC,GAAa,SAASC,EAAIC,EAAU,CAC/C,MAAMjK,EAAOgK,EAAG,QACZ,OAAOC,GAAa,UACtBjK,EAAK,SAAWiK,EACPjK,EAAK,WAAa,GAC3BA,EAAK,SAAW,IAEhBA,EAAK,SAAW,GAChBkK,GAAgBlK,CAAI,GAGtB,KAAK,OAAO,EAEZ,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,aAAcA,CAAI,CAClC,EASamK,GAAU,UAAW,CAE3B,KAAA,cAAc,KAAK,QAAQ,EAEhC,KAAK,OAAO,EAEZ,KAAK,QAAQ,CACf,EAMQ,SAASD,GAAgBjC,EAAiB,CAChDA,EAAS,SAAS,GAClB,UAAU7L,KAAQ6L,EAAS,UAAU,CAAA,EACnCiC,GAAgB9N,CAAG,CAEvB,CCpeA,MAAM6B,EAAK,SAMEmM,GAAkB,SAASC,EAAQ,CAC9C,GAAI,CAACA,EAAO,MAAO,OACnB,MAAMC,EAAUpM,EAAQmM,EAAO,GAAI,IAAI,EACjCjJ,EAAS,CACb,MAAOkJ,EAAQ,MAAM,OAAS/Q,GAAO+Q,EAAQ,MAAM,KAAK,EACxD,WAAYA,EAAQ,MAAM,YAAc/Q,GAAO+Q,EAAQ,MAAM,UAAU,EACvE,SAAUA,EAAQ,MAAM,UAAYA,EAAQ,MAAM,SAAW,KAC7D,WAAYA,EAAQ,MAAM,UAAA,EAEpBA,EAAA,MAAM,MAAQD,EAAO,MAAM,MAC3BC,EAAA,MAAM,WAAaD,EAAO,MAAM,WACxCC,EAAQ,MAAM,SAAWD,EAAO,MAAM,SAAW,KACjDC,EAAQ,MAAM,WAAaD,EAAO,MAAM,YAAc,SACtD,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,YACN,IAAKA,EACL,OAAAjJ,CAAA,CACD,CACH,EAEamJ,GAAiB,SAASF,EAAQ5E,EAAM,CACnD,GAAI,CAACA,EAAM,OACX,MAAM+E,EAASH,EAAO,KACnB5E,EAAK,SAAS,EACf,OAAO4E,EAAO,KAEdA,EAAO,KAAO5E,EACV,MAAA6E,EAAUpM,EAAQmM,EAAO,EAAE,EACxBtL,EAAA,KAAK,KAAKuL,EAASD,CAAM,EAClC,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,WACN,IAAKA,EACL,OAAQG,CAAA,CACT,CACH,EAEaC,GAAkB,SAASJ,EAAQzE,EAAO,CACrD,GAAI,CAACA,EAAO,OACZ,MAAM4E,EAASH,EAAO,MACtBA,EAAO,MAAQzE,EACT,MAAA0E,EAAUpM,EAAQmM,EAAO,EAAE,EACxBtL,EAAA,KAAK,KAAKuL,EAASD,CAAM,EAClC,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,YACN,IAAKA,EACL,OAAQG,CAAA,CACT,CACH,EAEaE,GAAsB,SAASL,EAAQM,EAAW,WACzD,GAAAA,GAAW,MAAMA,GAAW,KAAW,OAC3C,MAAMH,EAASH,EAAO,UAChBO,EAAaD,EAAU,MAAM,GAAG,EACtCN,EAAO,UAASvL,EAAAuL,EAAO,WAAP,YAAAvL,EAAiB,OAAa+L,GACrC,EAAAD,EAAa,KAAKxO,GAAKA,IAAMyO,EAAK,KAAK,KAE7CxJ,EAAAgJ,EAAO,WAAP,YAAAhJ,EAAiB,UAAS,GAAG,OAAOgJ,EAAO,SACvCA,EAAA,UAAYO,EAAa,OAAaC,GAAA,OACpC,OAAAA,IAAO,IAAI,GAAC/L,EAAAuL,EAAO,WAAP,MAAAvL,EAAiB,KAAK1C,GAAKA,EAAI,QAAQyO,GAAI,CAC/D,IACEtJ,EAAA8I,EAAO,YAAP,YAAA9I,EAAkB,UAAS,GAAG,OAAO8I,EAAO,UACzC,MAAAC,EAAUpM,EAAQmM,EAAO,EAAE,EACxBtL,EAAA,KAAK,KAAKuL,EAASD,CAAM,EAClC,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,gBACN,IAAKA,EACL,OAAQG,CAAA,CACT,CACH,EAEaM,GAAmB,SAAST,EAAQU,EAAQ,CACnD,GAAAA,GAAQ,MAAMA,GAAQ,KAAW,OACrC,MAAMP,EAASH,EAAO,OACtBA,EAAO,OAASU,EACV,MAAAT,EAAUpM,EAAQmM,EAAO,EAAE,EACxBtL,EAAA,KAAK,KAAKuL,EAASD,CAAM,EAClC,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,aACN,IAAKA,EACL,OAAQG,CAAA,CACT,CACH,EA+BaQ,GAAgB,SAAShB,EAAIhK,EAAM,CACxC,MAAAsK,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACd,MAAMtL,EAAUsL,EAAQ,QACpB,GAAAtL,EAAQ,OAAS,GAAM,CACzB,KAAK,SAAS,EACd,MACF,CACM,MAAAiM,EAAajL,GAAQ,KAAK,eAAe,EAC/ChD,GAAcgC,EAASiM,CAAU,EACjC/Q,EAAc,KAAK,QAAQ,EAC3B,MAAM2C,EAAIyN,EAAQ,cAClB,QAAQ,KAAK,mBAAmB,EAEhC,KAAM,CAAE,IAAAjK,EAAK,IAAAC,CAAA,EAAQ,KAAK,YAAY2K,CAAU,EAE1CzK,EAAW3D,EAAE,WAAW,WAC9B2D,EAAS,aAAaH,EAAKxD,EAAE,WAAW,WAAW,EAC/C2D,EAAS,YAAc,WACpB,KAAA,mBAAmBH,EAAK4K,CAAU,EACvC,KAAK,QAAQ,GAER,KAAA,QAAQ5K,EAAI,YAAY,EAE1BL,GACE,KAAA,eAAeM,EAAI,SAAS,EAAE,EAErC,KAAK,WAAWA,EAAI,SAAS,GAAI,EAAI,EACrC,QAAQ,QAAQ,mBAAmB,EAC9B,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,gBACN,IAAK2K,CAAA,CACN,CACH,EAaaC,GAAe,SAASlB,EAAIhK,EAAM,CACvC,MAAAsK,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACd,MAAMtL,EAAUsL,EAAQ,QACpB,GAAAtL,EAAQ,OAAS,GAAM,CACzB,KAAK,SAAS,EACd,MACF,CACM,MAAAiM,EAAajL,GAAQ,KAAK,eAAe,EAC/C9C,GAAoB8B,EAASiM,CAAU,EACvC/Q,EAAc,KAAK,QAAQ,EAC3B,MAAM2C,EAAIyN,EAAQ,cAClB,QAAQ,KAAK,mBAAmB,EAEhC,KAAM,CAAE,IAAAjK,EAAK,IAAAC,CAAA,EAAQ,KAAK,YAAY2K,CAAU,EAE1CzK,EAAW3D,EAAE,WAAW,WACrB2D,EAAA,aAAaH,EAAKxD,EAAE,UAAU,EACnC2D,EAAS,YAAc,WACpB,KAAA,mBAAmBH,EAAK4K,CAAU,EACvC,KAAK,QAAQ,GAER,KAAA,QAAQ5K,EAAI,YAAY,EAE1BL,GACE,KAAA,eAAeM,EAAI,SAAS,EAAE,EAErC,KAAK,WAAWA,EAAI,SAAS,GAAI,EAAI,EACrC,QAAQ,QAAQ,mBAAmB,EAC9B,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,gBACN,IAAK2K,CAAA,CACN,CACH,EAaaE,GAAe,SAASnB,EAAIhK,EAAM,CACvC,MAAAsK,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACd,MAAMtL,EAAUsL,EAAQ,QACpB,GAAAtL,EAAQ,OAAS,GACnB,OAEI,MAAAiM,EAAajL,GAAQ,KAAK,eAAe,EAC/C7C,GAAoB6B,EAASiM,CAAU,EACvC/Q,EAAc,KAAK,QAAQ,EAErB,MAAAkR,EAAOd,EAAQ,cAAc,cACnC,QAAQ,KAAK,kBAAkB,EAC/B,KAAM,CAAE,IAAAjK,EAAK,IAAAC,GAAQ,KAAK,YAAY2K,EAAY,EAAI,EAClD3K,EAAA,YAAYC,EAAe,EAAI,CAAC,EACpC,MAAM8K,EAAYD,EAAK,WAClBA,EAAA,sBAAsB,WAAY/K,CAAG,EAEpC,MAAAiL,EAAIrN,EAAG,cAAc,UAAU,EACrCqN,EAAE,YAAYF,CAAI,EAEd9K,EAAA,sBAAsB,WAAYgL,CAAC,EAEnCD,EAAU,YAAc,WAC1BhL,EAAI,UAAY+K,EAAK,UACrBA,EAAK,UAAY,GACZA,EAAA,cAAc,SAAS,EAAE,OAAO,EACrC,KAAK,QAAQ,GAER,KAAA,QAAQ/K,EAAI,YAAY,EAG1BL,GACE,KAAA,eAAeM,EAAI,SAAS,EAAE,EAErC,KAAK,WAAWA,EAAI,SAAS,GAAI,EAAI,EACrC,QAAQ,QAAQ,kBAAkB,EAC7B,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,eACN,IAAK2K,CAAA,CACN,CACH,EAEaM,GAAqB,SAASjB,EAAQtK,EAAK,OACtD,GAAI,CAACsK,EAAgB,OAIrB,MAAMtL,EAAUsL,EAAQ,QAClBW,EAAajL,GAAQ,KAAK,sBAAsB,EAC9ChB,EAAA,OAAO,SAAS,KAAKiM,CAAU,EACvC/Q,EAAc,KAAK,QAAQ,EAC3B,MAAMoG,EAAMgK,EAAQ,WAAW,WAAW,WAAW,WAC/C,CAAE,IAAA3J,EAAK,IAAK6K,CAAW,EAAA,KAAK,cAAcP,CAAU,EACvD,GAAA,GAACnM,EAAAwB,EAAI,WAAJ,MAAAxB,EAAe,aAAe,CAC1B,MAAA2M,EAAYxN,EAAG,cAAc,aAAa,EACpCwN,EAAA,aAAa,OAAO,aAAa,EAC7CnL,EAAI,YAAYmL,CAAW,CAC7B,CACI,OAAAnL,EAAA,SAAS,YAAe,YAAYK,CAAG,EAC3C,KAAK,OAAO,EACZ,KAAK,QAAQ,EACN,CAAE,OAAA6K,EAAQ,WAAAP,EACnB,EAEaS,GAAmB,SAASpB,EAAStK,EAAM,CACtD,GAAI,CAACsK,EAAgB,OACrB,MAAMtL,EAAUsL,EAAQ,QACpBtL,EAAQ,WAAa,KAClB,KAAA,WAAWsL,EAAS,EAAI,EAEnBA,EAAApM,EAAQc,EAAQ,EAAE,GAExB,MAAAiM,EAAajL,GAAQ,KAAK,eAAe,EAC3ChB,EAAQ,SAAkBA,EAAA,SAAS,KAAKiM,CAAU,EACzCjM,EAAA,SAAW,CAACiM,CAAU,EACnC/Q,EAAc,KAAK,QAAQ,EAE3B,MAAMoG,EAAMgK,EAAQ,cAEd,CAAE,IAAAjK,EAAK,IAAKmL,CAAW,EAAA,KAAK,YAAYP,CAAU,EAEpD,GAAA3K,EAAI,UAAY,IAAK,CACnB,GAAAA,EAAI,SAAS,GACXA,EAAA,YAAY,YAAYD,CAAG,MAC1B,CACC,MAAAiL,EAAIrN,EAAG,cAAc,UAAU,EACrCqN,EAAE,YAAYjL,CAAG,EACbC,EAAA,YAAYC,EAAe,EAAI,CAAC,EAChCD,EAAA,sBAAsB,WAAYgL,CAAC,CACzC,CACA,KAAK,OAAO,EACP,KAAA,QAAQjL,EAAI,YAAY,CAAA,MACpBC,EAAI,UAAY,SACpB,KAAA,mBAAmBD,EAAK4K,CAAU,EACnC3K,EAAA,YAAY,YAAYD,CAAG,EAC/B,KAAK,QAAQ,GAER,MAAA,CAAE,OAAAmL,EAAQ,WAAAP,EACnB,EAEaU,GAAa,SAAS3B,EAAiBhK,EAAe,CACjE,QAAQ,KAAK,YAAY,EACzB,MAAM4L,EAAY,CAAA,EACZC,EAAY,CAAA,EAClB,KAAK,UAAU,iBAAiB,cAAc,EAAE,QAAeC,GAAA,UACjDhN,EAAA8M,EAAAE,EAAM,QAAQ,OAAO,MAArB,OAA2BF,EAAYE,EAAM,QAAQ,OAAO,IAAID,EAAY,QAC5EA,EAAAD,EAAYE,EAAM,QAAQ,OAAO,MAAKzK,EAAAwK,EAAYD,EAAYE,EAAM,QAAQ,OAAO,OAA7C,KAAAzK,EAAmD,GACrGwK,EAAYD,EAAYE,EAAM,QAAQ,OAAO,KAAK,KAAKA,CAAK,CAAA,CAC7D,EACD,QAAQ,IAAID,CAAW,EACvBA,EAAY,QAAazP,GAAA,WACjB,MAAAkO,EAAUlO,EAAI,IAAM,KAAK,YAG/B,GAFA,KAAK,sBAAsBA,EACvB,CAACkO,KACF/I,GAAAF,GAAAvC,EAAAwL,GAAA,YAAAA,EAAS,gBAAT,YAAAxL,EAAwB,gBAAxB,YAAAuC,EAAuC,gBAAvC,YAAAE,EAAsD,YAAW,UAAW,OACzE,KAAA,CAAE,OAAAiK,EAAQ,WAAAP,GAAeM,GAAmB,KAAK,KAAMjB,EAAStK,CAAI,EAC1E,QAAQ,QAAQ,YAAY,EACvBA,GACE,KAAA,eAAewL,EAAO,SAAS,EAAE,EAExC,KAAK,WAAWA,EAAO,SAAS,GAAI,EAAI,EACnC,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,aACN,IAAKP,CAAA,CACN,CAAA,CACF,CAEH,EAaac,GAAW,SAAS/B,EAAiBhK,EAAe,CAC/D,QAAQ,KAAK,UAAU,EACjB,MAAAsK,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACR,KAAA,CAAE,OAAAkB,EAAQ,WAAAP,GAAeS,GAAiB,KAAK,KAAMpB,EAAStK,CAAI,EACxE,QAAQ,QAAQ,UAAU,EACrBA,GACE,KAAA,eAAewL,EAAO,SAAS,EAAE,EAExC,KAAK,WAAWA,EAAO,SAAS,GAAI,EAAI,EACnC,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,WACN,IAAKP,CAAA,CACN,CACH,EAeae,GAAW,SAAShM,EAAmBzD,EAAiB,CACnE,QAAQ,KAAK,UAAU,EACvB,MAAM0P,EAAe,KAAK,MACxB,KAAK,UAAUjM,EAAK,QAAS,CAACjE,EAAG+L,IAAM,CACrC,GAAI/L,IAAM,SACH,OAAA+L,CAAA,CACR,CAAA,EAEH1N,GAAW6R,CAAY,EACvB,KAAM,CAAE,WAAAhB,CAAW,EAAIS,GAAiB,KAAK,KAAMnP,EAAI0P,CAAY,EACnE,QAAQ,QAAQ,UAAU,EACrB,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,WACN,IAAKhB,CAAA,CACN,CACH,EAYaiB,GAAa,SAASlC,EAAI,CAC/B,MAAAM,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACR,MAAAjK,EAAMiK,EAAQ,WAAW,WACzB5N,EAAM4N,EAAQ,QACpB7N,GAAUC,CAAG,EACb2D,EAAI,WAAW,aAAaA,EAAKA,EAAI,eAAe,EACpD,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,aACN,IAAA3D,CAAA,CACD,CACH,EAYayP,GAAe,SAASnC,EAAI,CACjC,MAAAM,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACR,MAAAjK,EAAMiK,EAAQ,WAAW,WACzB5N,EAAM4N,EAAQ,QACpBxN,GAAYJ,CAAG,EACX2D,EAAI,YACFA,EAAA,sBAAsB,cAAeA,EAAI,WAAW,EAEpDA,EAAA,WAAW,QAAQA,CAAG,EAE5B,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,eACN,IAAA3D,CAAA,CACD,CACH,EAYa0P,GAAa,SAASpC,EAAI,CAC/B,MAAAM,EAAUN,GAAM,KAAK,YAC3B,GAAI,CAACM,EAAS,OACd,MAAMtL,EAAUsL,EAAQ,QACpB,GAAAtL,EAAQ,OAAS,GACb,MAAA,IAAI,MAAM,0BAA0B,EAE5C,MAAMpC,EAAQoC,EAAQ,OAAO,SAAS,UAAUgB,GAAQA,IAAShB,CAAO,EAClEqN,EAAOrN,EAAQ,OAAO,SAASpC,EAAQ,GACvC0P,EAAkBD,GAAQA,EAAK,GAE/BE,EAAiBxP,GAAciC,CAAO,EACtCnC,EAAIyN,EAAQ,WACd,GAAAzN,EAAE,UAAY,OAGlB,IAAI0P,IAAmB,EAAG,CAElB,MAAAC,EAAU3P,EAAE,WAAW,WAAW,gBAEpC2P,EAAQ,UAAY,QACdA,EAAA,SAAS,GAAG,OAAO,EAE7B,KAAK,aAAa,CAAA,MAGF,KAAK,qBACP,KAAK,kBAAkB,EAE5B,UAAAC,KAAQ,KAAK,SAAU,CAE1B,MAAA5B,EAAO,KAAK,SAAS4B,IACvB5B,EAAK,OAAShO,EAAE,YAAcgO,EAAK,KAAOhO,EAAE,aACzC,KAAA,WACH,KAAK,cAAc,cACjB,gBAAgB,KAAK,SAAS4P,GAAM,KACtC,CAAA,CAGN,CAEA5P,EAAE,WAAW,SACb,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,aACN,IAAKmC,EACL,gBAAAsN,EACA,eAAgBtN,EAAQ,OAAO,EAAA,CAChC,EACH,EAaa0N,GAAW,SAASpQ,EAAMC,EAAI,CACzC,MAAMoQ,EAAUrQ,EAAK,QACfsQ,EAAQrQ,EAAG,QACXsQ,EAAiBF,EAAQ,OAAO,GAMtC,GALIC,EAAM,WAAa,KAChB,KAAA,WAAWrQ,EAAI,EAAI,EACjBD,EAAA4B,EAAQyO,EAAQ,EAAE,EACpBpQ,EAAA2B,EAAQ0O,EAAM,EAAE,GAEnB,CAACvQ,GAAesQ,EAASC,CAAK,EAAG,CACnC,QAAQ,KAAK,cAAc,EAC3B,MACF,CACA,QAAQ,KAAK,UAAU,EACvBxP,GAAYuP,EAASC,CAAK,EAC1B1S,EAAc,KAAK,QAAQ,EAC3B,MAAM4S,EAAUxQ,EAAK,cACfyQ,EAAcD,EAAQ,WAAW,WACjCE,EAAQzQ,EAAG,cAOb,GANAwQ,EAAY,YAAc,UAEpBD,EAAA,WAAW,UAAU,SACpBA,EAAQ,WAAW,YAAc,YAC1CA,EAAQ,MAAM,QAAU,IAEtBE,EAAM,UAAY,IAKhB,GAJAD,EAAY,YAAc,YAE5BD,EAAQ,WAAW,UAAY,IAE7BE,EAAM,SAAS,GAEXA,EAAA,YAAY,YAAYF,EAAQ,UAAU,MAC3C,CAEC,MAAAxB,EAAIrN,EAAG,cAAc,UAAU,EACnCqN,EAAA,YAAYwB,EAAQ,UAAU,EAC1BE,EAAA,YAAYzM,EAAe,EAAI,CAAC,EACtCyM,EAAM,cAAc,aAAa1B,EAAG0B,EAAM,WAAW,CACvD,MACSA,EAAM,UAAY,SACtB,KAAA,mBAAmBF,EAAQ,WAAYH,CAAO,EAC7CK,EAAA,YAAY,YAAYF,EAAQ,UAAU,GAElD,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,WACN,IAAK,CAAE,QAAAH,EAAS,MAAAC,EAAO,eAAAC,CAAe,CAAA,CACvC,EACD,QAAQ,QAAQ,UAAU,CAC5B,EAaaI,GAAiB,SAAS3Q,EAAMC,EAAI,CAC/C,MAAMoQ,EAAUrQ,EAAK,QACfsQ,EAAQrQ,EAAG,QACXsQ,EAAiBF,EAAQ,OAAO,GACtCtP,GAAkBsP,EAASC,CAAK,EAChC1S,EAAc,KAAK,QAAQ,EAC3B,MAAM4S,EAAUxQ,EAAK,cACf4Q,EAAUJ,EAAQ,WAClBE,EAAQzQ,EAAG,cACX4Q,EAAQH,EAAM,WACFA,EAAM,WAAW,WACzB,aAAaE,EAASC,CAAK,EAChC,KAAA,mBAAmBL,EAAQ,cAAcH,CAAO,EACrD,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,iBACN,IAAK,CAAE,QAAAA,EAAS,MAAAC,EAAO,eAAAC,CAAe,CAAA,CACvC,CACH,EAaaO,GAAgB,SAAS9Q,EAAMC,EAAI,CAC9C,MAAMoQ,EAAUrQ,EAAK,QACfsQ,EAAQrQ,EAAG,QACXsQ,EAAiBF,EAAQ,OAAO,GACtCpP,GAAiBoP,EAASC,CAAK,EAC/B1S,EAAc,KAAK,QAAQ,EAC3B,MAAM4S,EAAUxQ,EAAK,cACf4Q,EAAUJ,EAAQ,WAClBE,EAAQzQ,EAAG,cACX4Q,EAAQH,EAAM,WACFA,EAAM,WAAW,WACzB,aAAaE,EAASC,EAAM,WAAW,EAC5C,KAAA,mBAAmBL,EAAQ,cAAcH,CAAO,EACrD,KAAK,QAAQ,EACR,KAAA,IAAI,KAAK,YAAa,CACzB,KAAM,gBACN,IAAK,CAAE,QAAAA,EAAS,MAAAC,EAAO,eAAAC,CAAe,CAAA,CACvC,CACH,EAYaQ,GAAY,SAASrD,EAAI,CAC9B,MAAAM,EAAUN,GAAM,KAAK,YACvB,CAACM,GACL,KAAK,eAAeA,CAAO,CAC7B,EAEagD,GAAe,SAAShP,EAAKwC,EAAO,CAC3CxC,EAAA,WAAW,GAAG,YAAcwC,EAChCxC,EAAI,QAAQ,MAAQwC,EACpB,KAAK,QAAQ,CACf,EAGgB,SAAAyM,GAAmBpJ,EAAazH,EAAK,CAC/C,GAAA,KAAK,YAAc,EACrByH,EAAY,UAAY,cACf,KAAK,YAAc,EAC5BA,EAAY,UAAY,cACf,KAAK,YAAc,EAAM,CAClC,MAAMqJ,EAAIvP,EAAG,iBAAiB,MAAM,EAAE,OAChCwP,EAAIxP,EAAG,iBAAiB,MAAM,EAAE,OAClCuP,GAAKC,GACPtJ,EAAY,UAAY,MACxBzH,EAAI,UAAY,IAEhByH,EAAY,UAAY,MACxBzH,EAAI,UAAY,EAEpB,CACF,CChrBO,MAAMgR,GAAa,SAASpR,EAAMC,EAAIoR,EAAajR,EAAK,CACvD,MAAAoB,EAAM,KAAK,IAAI,sBAAsB,EACvC,GAAA,CAACxB,GAAQ,CAACC,EACZ,OAEI,MAAAqR,EAAQtR,EAAK,wBACbuR,EAAMtR,EAAG,wBACTuR,GAAeF,EAAM,EAAIA,EAAM,MAAQ,EAAI9P,EAAI,GAAK,KAAK,SACzDiQ,GAAeH,EAAM,EAAIA,EAAM,OAAS,EAAI9P,EAAI,GAAK,KAAK,SAC1DkQ,GAAaH,EAAI,EAAIA,EAAI,MAAQ,EAAI/P,EAAI,GAAK,KAAK,SACnDmQ,GAAaJ,EAAI,EAAIA,EAAI,OAAS,EAAI/P,EAAI,GAAK,KAAK,SAEtD,IAAAnC,EAAKC,EAAKd,EAAKC,EACf4S,GACIhS,EAAAmS,EAAcpR,EAAI,OAAO,EACzBd,EAAAmS,EAAcrR,EAAI,OAAO,EACzB5B,EAAAkT,EAAYtR,EAAI,OAAO,EACvB3B,EAAAkT,EAAYvR,EAAI,OAAO,IAExBqR,EAAcE,GAAa,EAAIF,GAAeH,EAAM,OAAS,GAEhEjS,GAAOiS,EAAM,EAAIA,EAAM,MAAQ9P,EAAI,GAAK,KAAK,SAAW,IAClDlC,EAAAmS,EACNjT,GAAO+S,EAAI,EAAIA,EAAI,MAAQ/P,EAAI,GAAK,KAAK,SAAW,IAC9C/C,EAAAkT,IAENtS,GAAOmS,EAAcE,GAAa,EAClCpS,GAAOmS,EAAcE,GAAa,EAClCnT,GAAOgT,EAAcE,GAAa,EAClCjT,GAAOgT,EAAcE,GAAa,GAItC,MAAMvS,EAAW,CACf,GAAIoS,EACJ,GAAIC,EACJ,EAAGH,EAAM,MACT,EAAGA,EAAM,MAAA,EAEL3R,EAAS,CACb,GAAI+R,EACJ,GAAIC,EACJ,EAAGJ,EAAI,MACP,EAAGA,EAAI,MAAA,EAGHK,EAAKzS,GAAOC,EAAUC,EAAKC,CAAG,EAC9BuS,EAAMD,EAAG,EACTE,EAAMF,EAAG,EAETG,EAAKrS,GAAOC,EAAQnB,EAAKC,CAAG,EAC5BC,EAAMqT,EAAG,EACTpT,EAAMoT,EAAG,EAETC,EAAazT,GAAeC,EAAKC,EAAKC,EAAKC,CAAG,EAM9CsT,EAAcjL,GAClB,KAAK6K,KAAOC,OAASzS,KAAOC,KAAOd,KAAOC,KAAOC,KAAOC,IACxD,KAAKqT,EAAW,MAAMA,EAAW,QAAQtT,KAAOC,OAASqT,EAAW,MAAMA,EAAW,IAAA,EAGnF,IAAAE,EACAb,GACWa,EAAA,CACX,GAAI9R,EAAI,GACR,MAAO,GACP,KAAAJ,EACA,GAAAC,EACA,OAAQ,CACN,EAAGZ,EAAMmS,EACT,EAAGlS,EAAMmS,CACX,EACA,OAAQ,CACN,EAAGjT,EAAMkT,EACT,EAAGjT,EAAMkT,CACX,CAAA,EAGG,KAAA,SAASvR,EAAI,IAAM8R,EACxBD,EAAY,QAAUC,EACVD,EAAA,QAAQ,OAAS7R,EAAI,KAEpB8R,EAAA,CACX,GAAInU,EAAa,EACjB,MAAO,GACP,KAAAiC,EACA,GAAAC,EACA,OAAQ,CACN,EAAGZ,EAAMmS,EACT,EAAGlS,EAAMmS,CACX,EACA,OAAQ,CACN,EAAGjT,EAAMkT,EACT,EAAGjT,EAAMkT,CACX,CAAA,EAGG,KAAA,SAASO,EAAW,IAAMA,EAC/BD,EAAY,QAAUC,EACVD,EAAA,QAAQ,OAASC,EAAW,GACxC,KAAK,YAAcD,GAEhB,KAAA,aAAa,YAAYA,CAAW,EACpCZ,GAAe,KAAK,mBAAmBhS,EAAKC,EAAKd,EAAKC,EAAKyT,EAAY9S,EAAUO,CAAM,CAC9F,EAEawS,GAAa,SAASC,EAAS,CACtC,IAAA7D,EAMJ,GALI6D,EACK7D,EAAA6D,EAEP7D,EAAO,KAAK,YAEV,CAACA,EAAM,OACX,KAAK,mBAAmB,EAClB,MAAA/Q,EAAK+Q,EAAK,QAAQ,GACxB,OAAO,KAAK,SAAS/Q,GACrB+Q,EAAK,OAAO,EACLA,EAAA,IACT,EACa8D,GAAa,SAASzH,EAAe,CAChD,KAAK,YAAcA,EACnB,MAAMxK,EAAMwK,EAAc,QACpB5K,EAAOI,EAAI,KACXH,EAAKG,EAAI,GAEToB,EAAM,KAAK,IAAI,sBAAsB,EACrC8P,EAAQtR,EAAK,wBACbuR,EAAMtR,EAAG,wBACTuR,GAAeF,EAAM,EAAIA,EAAM,MAAQ,EAAI9P,EAAI,GAAK,KAAK,SACzDiQ,GAAeH,EAAM,EAAIA,EAAM,OAAS,EAAI9P,EAAI,GAAK,KAAK,SAC1DkQ,GAAaH,EAAI,EAAIA,EAAI,MAAQ,EAAI/P,EAAI,GAAK,KAAK,SACnDmQ,GAAaJ,EAAI,EAAIA,EAAI,OAAS,EAAI/P,EAAI,GAAK,KAAK,SAEpDpC,EAAW,CACf,GAAIoS,EACJ,GAAIC,EACJ,EAAGH,EAAM,MACT,EAAGA,EAAM,MAAA,EAEL3R,EAAS,CACb,GAAI+R,EACJ,GAAIC,EACJ,EAAGJ,EAAI,MACP,EAAGA,EAAI,MAAA,EAGHlS,EAAMmS,EAAcpR,EAAI,OAAO,EAC/Bd,EAAMmS,EAAcrR,EAAI,OAAO,EAC/B5B,EAAMkT,EAAYtR,EAAI,OAAO,EAC7B3B,EAAMkT,EAAYvR,EAAI,OAAO,EAEnC,KAAK,mBAAmBf,EAAKC,EAAKd,EAAKC,EAAK2B,EAAKhB,EAAUO,CAAM,CACnE,EACa2S,GAAqB,UAAW,CACtC,KAAA,eAAe,MAAM,QAAU,OAC/B,KAAA,GAAG,MAAM,QAAU,OACnB,KAAA,GAAG,MAAM,QAAU,MAC1B,EACaC,GAAqB,SAChClT,EACAC,EACAd,EACAC,EACA+T,EACApT,EACAO,EACA,CACK,KAAA,eAAe,MAAM,QAAU,UAC/B,KAAA,GAAG,MAAM,QAAU,UACnB,KAAA,GAAG,MAAM,QAAU,UAExB,MAAMiS,EAAKzS,GAAOC,EAAUC,EAAKC,CAAG,EACpC,IAAIuS,EAAMD,EAAG,EACTE,EAAMF,EAAG,EAEb,MAAMG,EAAKrS,GAAOC,EAAQnB,EAAKC,CAAG,EAClC,IAAIC,EAAMqT,EAAG,EACTpT,EAAMoT,EAAG,EAEb,KAAK,GAAG,MAAM,QAAU,OAAOzS,YAAcD,OAC7C,KAAK,GAAG,MAAM,QAAU,OAAOZ,YAAcD,OACxC,KAAA,MAAM,aAAa,KAAMqT,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMzS,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMd,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAE7B,KAAK,UACF,KAAA,QAAQ,QAAQ,KAAK,GAAG,EACxB,KAAA,QAAQ,QAAQ,KAAK,GAAG,GAG/B,KAAK,QAAU,IAAI2C,EAAmB,KAAK,EAAE,EAC7C,KAAK,QAAU,IAAIA,EAAmB,KAAK,EAAE,EAE7C,KAAK,QAAQ,KAAK,KAAK,IAAK,CAACF,EAAQC,IAAW,CAKxChC,EAAAA,EAAM+B,EAAS,KAAK,SACpB9B,EAAAA,EAAM+B,EAAS,KAAK,SAE1B,MAAMuQ,EAAKzS,GAAOC,EAAUC,EAAKC,CAAG,EACpCuS,EAAMD,EAAG,EACTE,EAAMF,EAAG,EAEJ,KAAA,GAAG,MAAM,IAAMtS,EAAM,KACrB,KAAA,GAAG,MAAM,KAAOD,EAAM,KACtB,KAAA,YAAY,SAAS,GAAG,aAC3B,IACA,KAAKwS,KAAOC,OAASzS,KAAOC,KAAOd,KAAOC,KAAOC,KAAOC,GAAA,EAErD,KAAA,MAAM,aAAa,KAAMkT,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMzS,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EACzBkT,EAAA,OAAO,EAAInT,EAAMD,EAAS,GAC1BoT,EAAA,OAAO,EAAIlT,EAAMF,EAAS,EAAA,CACnC,EAED,KAAK,QAAQ,KAAK,KAAK,IAAK,CAACgC,EAAQC,IAAW,CACxC7C,EAAAA,EAAM4C,EAAS,KAAK,SACpB3C,EAAAA,EAAM4C,EAAS,KAAK,SAE1B,MAAM0Q,EAAKrS,GAAOC,EAAQnB,EAAKC,CAAG,EAClCC,EAAMqT,EAAG,EACTpT,EAAMoT,EAAG,EACT,MAAMC,EAAazT,GAAeC,EAAKC,EAAKC,EAAKC,CAAG,EAE/C,KAAA,GAAG,MAAM,IAAMF,EAAM,KACrB,KAAA,GAAG,MAAM,KAAOD,EAAM,KACtB,KAAA,YAAY,SAAS,GAAG,aAC3B,IACA,KAAKqT,KAAOC,OAASzS,KAAOC,KAAOd,KAAOC,KAAOC,KAAOC,GAAA,EAErD,KAAA,YAAY,SAAS,GAAG,aAC3B,IACA,KAAKqT,EAAW,MAAMA,EAAW,QAAQtT,KAAOC,OAASqT,EAAW,MAAMA,EAAW,IAAA,EAElF,KAAA,MAAM,aAAa,KAAMxT,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EAC5B,KAAA,MAAM,aAAa,KAAMC,CAAG,EACzB6T,EAAA,OAAO,EAAIhU,EAAMmB,EAAO,GACxB6S,EAAA,OAAO,EAAI/T,EAAMkB,EAAO,EAAA,CACjC,CACH,EC/OA,SAAwB8S,GAAQ5K,EAAa,SACvC,IAAA6K,EAA2B,KAAK,0BAA4B,GAC5DC,EAAyB,KAAK,wBAA0B,GAC5D,QAAQ,KAAK,SAAS,EACtB,MAAMjK,EAAO,KAAK,KACbA,EAAA,MAAM,QAAU,OAAO,IAAQA,EAAK,aAAe,YAAY,IAAQA,EAAK,YAAc,OACzF,MAAAkK,EAAkB,KAAK,IAAI,SACjC,KAAK,OAAO,UAAY,GAGxB,IAAIC,EAAc,EACdC,EACAC,EAAe,EACfC,EAAiB,EACjBC,EAAiB,EACjBC,EAAe,EACfC,EAAe,EACfC,EAEA,GAAA,KAAK,YAAc,EAAM,CAC3B,IAAIC,EAAS,EACTC,EAAS,EACTC,EAAyB,EACzBC,EAAyB,EAC7B,QAAS9V,EAAI,EAAGA,EAAIkV,EAAgB,OAAQlV,IAAK,CAC/C,MAAMgQ,EAAKkF,EAAgBlV,GACvBgQ,EAAG,YAAc,OACnBwF,GAAgBxF,EAAG,aAAeiF,EAClCY,GAA0B7F,EAAG,aACnB2F,GAAA,IAEVF,GAAgBzF,EAAG,aAAeiF,EAClCa,GAA0B9F,EAAG,aACnB4F,GAAA,EAEd,CACIJ,EAAeC,GACjBC,EAAO,IAAQ,KAAK,IAAIF,CAAY,EAAI,EAC5BJ,EAAA,IACIC,GAAAG,EAAeM,IAA2BF,EAAS,KAEnEF,EAAO,IAAQ,KAAK,IAAID,CAAY,EAAI,EAC5BL,EAAA,IACIC,GAAAI,EAAeI,IAA2BF,EAAS,GACrE,KACK,CACL,QAAS3V,EAAI,EAAGA,EAAIkV,EAAgB,OAAQlV,IAE1CmV,GADWD,EAAgBlV,GACT,aAAeiV,EAEnCS,EAAO,IAAQP,EAAc,CAC/B,CAGA,IAAIY,EAAc,GAClB,MAAMC,EAAa,IAAQhL,EAAK,YAAc,EAAIgK,EAAyB,GACrEiB,EAAY,IAAQjL,EAAK,YAAc,EAAIgK,EAAyB,GAC1E,QAAShV,EAAI,EAAGA,EAAIkV,EAAgB,OAAQlV,IAAK,CAC/C,IAAIkJ,EAAIC,EACR,MAAM6G,EAAKkF,EAAgBlV,GACrBkW,EAAYlG,EAAG,aACjB,IAAAmG,EAAQnL,EAAK,WAAW,GACxB,GAAAgF,EAAG,YAAc,MAAO,CACvBA,EAAA,MAAM,IAAM0F,EAAOJ,EAAiB,KACvCtF,EAAG,MAAM,KAAOgG,EAAahG,EAAG,YAAc,KAC9C9G,EAAK8M,EAAa,GACb7M,EAAAuM,EAAOJ,EAAiBY,EAAY,EAGzC,IAAIE,EAAO,IACP,KAAK,mBAAqB,GACxB,KAAK,YAAc,IACdA,EAAA,IAAQpL,EAAK,YAAc,GAEhC7B,EAAK,IACQ4M,GAAA,KAAKK,aAAgBjN,EAAK,QAAQiN,KAAQjN,KAAMiN,KAAQjN,KAAMiN,EAAO,MAAMjN,OAAQD,IAEnF6M,GAAA,KAAKK,aAAgBjN,EAAK,QAAQiN,KAAQjN,KAAMiN,KAAQjN,KAAMiN,EAAO,MAAMjN,OAAQD,KAGrF6M,GAAA,mBAAmBI,OAAahN,OAAQD,IAGrDkM,IAAc,IAChBE,GAAkBY,EAAYb,EAE9BC,GAAkBY,EAAYjB,CAChC,KACK,CACGkB,EAAAnL,EAAK,WAAWA,EAAK,YAAY,GACtCgF,EAAA,MAAM,IAAM0F,EAAOH,EAAiB,KACpCvF,EAAA,MAAM,KAAOiG,EAAY,KAC5B/M,EAAK+M,EAAY,GACZ9M,EAAAuM,EAAOH,EAAiBW,EAAY,EAEzC,IAAIE,EAAO,IACP,KAAK,mBAAqB,GACxB,KAAK,YAAc,IACdA,EAAA,IAAQpL,EAAK,YAAc,GAEhC7B,EAAK,IACQ4M,GAAA,KAAKK,aAAgBjN,EAAK,QAAQiN,KAAQjN,KAAMiN,KAAQjN,KAAMiN,EAAO,MAAMjN,OAAQD,IAEnF6M,GAAA,KAAKK,aAAgBjN,EAAK,QAAQiN,KAAQjN,KAAMiN,KAAQjN,KAAMiN,EAAO,MAAMjN,OAAQD,KAGrF6M,GAAA,mBAAmBI,OAAahN,OAAQD,IAErDkM,IAAc,IAChBG,GAAkBW,EAAYb,EAE9BE,GAAkBW,EAAYjB,CAElC,CAEA,MAAMnN,EAAWkI,EAAG,SAAS,GAAG,SAAS,GACrClI,IACFA,EAAS,MAAM,KACZA,EAAS,WAAW,aAAeA,EAAS,cAAgB,EAAI,KAC/DkI,EAAG,YAAc,MACVlI,EAAA,MAAM,KAAO,IAAM,KAE5BA,EAAS,MAAM,KAAOA,EAAS,WAAW,YAAc,GAAK,KAGnE,CACA,KAAK,OAAO,YAAYU,GAAeuN,CAAW,CAAC,EAGnD,QAAS/V,EAAI,EAAGA,EAAIkV,EAAgB,OAAQlV,IAAK,CAC/C,MAAMgQ,EAAKkF,EAAgBlV,GACvB,GAAA,EAAAmK,GAAeA,IAAgB+K,EAAgBlV,KAG/CgQ,EAAG,kBAAmB,CAClB,MAAAnH,EAAMF,EAAc,QAAQ,EAC5B0N,EAAS1N,EAAc,QAAQ,EAGrCqH,EAAG,iBAAiB,SAAS,EAAE,QAAe5N,GAAA,CAC5CA,EAAI,OAAO,CAAA,CACZ,EACD4N,EAAG,YAAYnH,CAAG,EACZ,MAAA1I,EAAS6P,EAAG,SAAS,GACvB,IAAAxJ,IACDa,GAAAvC,EAAAkL,EAAG,WAAH,YAAAlL,EAAc,KAAd,YAAAuC,EAAkB,WAAU,cAClBb,EAAA,CAAC,GAAGwJ,EAAG,SAAS,GAAG,SAAS,GAAGA,EAAG,SAAS,GAAG,QAAQ,EAGtDxJ,EAAAwJ,EAAG,SAAS,GAAG,SACrBtH,EAAA,GACG4N,GAAA,GACVC,GAAa/P,EAAUrG,EAAO,KAAK,SAAS,SAASH,GAAG,EAAI,EACxD6I,EAAA,YAAYQ,GAAWX,CAAI,CAAC,EAC7B4N,GAAQ,OAAO,IAChBtG,EAAG,YAAYqG,CAAM,EACdA,EAAA,YAAYvN,GAAcwN,EAAO,CAAC,EAE7C,CACF,CAGA,KAAK,aAAa,UAAY,GACnB,UAAA7D,KAAQ,KAAK,SAAU,CAC1B,MAAA5B,EAAO,KAAK,SAAS4B,GACvB,OAAO5B,EAAK,MAAS,SAClB,KAAA,WAAW3M,EAAQ2M,EAAK,IAAI,EAAG3M,EAAQ2M,EAAK,EAAE,EAAG,GAAMA,CAAI,EAE3D,KAAA,WACH3M,EAAQ2M,EAAK,KAAK,QAAQ,EAAE,EAC5B3M,EAAQ2M,EAAK,GAAG,QAAQ,EAAE,EAC1B,GACAA,CAAA,CAGN,CACA,QAAQ,QAAQ,SAAS,CAC3B,CAEA,IAAInI,EAAO,GACP4N,GAAU,GAEd,SAASC,GAAa/P,EAAyBrG,EAAoB8N,EAAiBuI,EAAiB,WACnG,IAAIC,EAAWtW,EAAO,UAClBuW,EAAWvW,EAAO,WAClBwW,EAAWxW,EAAO,YAClByW,EAAWzW,EAAO,aAClB0W,EAAW,GACZ1W,EAAO,aAAa,UAAU,QACpB0W,EAAA,GACXJ,GAAWtW,EAAO,aAA6B,UAC/CuW,GAAWvW,EAAO,aAA6B,YAIjD,QAASH,EAAI,EAAGA,EAAIwG,EAAS,OAAQxG,IAAK,CACxC,MAAM8W,EAAqBtQ,EAASxG,GACjC,IAAA8W,GAAA,YAAAA,EAAO,WAAU,MAAM,CACxB,IAAIC,EAAQvQ,EAAS,GACjBwQ,EAAOxQ,EAASxG,EAAE,GAEtB,MAAMiX,EAAmB,CAAA,EACzBhJ,EAAS,SAASjO,GAAG,QAAQ,MAAM,QAAaoC,GAAA,CAC9C6U,EAAS7U,GAAK,EAAA,CACf,EACD,IAAI8D,GAAK,GACT,QAAQgR,EAAE,EAAEA,EAAElX,EAAEkX,IAAI,CACV,MAAAvP,GAAInB,EAAS0Q,GAAG,SAAS,GAAG,SAAS,GAAG,aAAa,aAAa,EAAE,MAAM,CAAC,EAC9ED,EAAStP,MACPzB,KACIA,GAAA,GACL6Q,EAAQvQ,EAAS0Q,IAEnBF,EAAOxQ,EAAS0Q,GAEtB,CACA,MAAMC,GAAOJ,EAAQ,WAAWA,EAAQ,YAAY,EAC9CK,GAAOL,EAAQ,UAAU,GACzBM,GAAML,EAAO,UAAUA,EAAO,aAAa,EAC3CM,GAAMN,EAAO,WAAWA,EAAO,YAAY,EAC3ClV,GAAEgV,EAAM,UAAWA,EAAM,SAAS,GAAmB,UAAWA,EAAM,SAAS,GAAmB,aACpG,IAAAxQ,IAAIxB,EAAAgS,EAAM,MAAM,MAAZ,KAAAhS,EAAiB,EACtB,OAAOwB,IAAO,WAAUA,GAAI,OAAOA,GAAI,QAAQ,KAAK,EAAE,CAAC,GAC1DwQ,EAAM,MAAM,IAAIxQ,IAAK+Q,GAAMD,GAAO,IAAI,EAAEtV,GAAE,KAC1CwU,IAAS,KAAKa,MAAUC,QAAYD,GAAO,QAAQE,OAAUC,IAC/D,CACM,MAAAC,EAAsBT,EAAM,SAAS,GAC3C,IAAIU,EAAWD,EAAO,UAClBE,EAAWF,EAAO,aACnBV,IACDW,GAAWD,EAAO,aAA6B,WAG7C,IAAAtO,EACAuN,GAAOK,EACT5N,EAAKwN,EAAWG,EAAW,EAE3B3N,EAAKwN,EAAWG,EAElB,MAAMzN,EAAKqO,EAAWC,EACtB,IAAIzO,EAAYE,EAAYiN,EAC5B,MAAMnO,EAAY8O,EAAM,aAAa,WAAYA,EAAM,aAA6B,aAAa,UAC7F9O,IAAc,QAAO8O,GAAA,YAAAA,EAAO,WAAU,OACxC9N,EAAK0N,EAAW,GACNP,EAAAO,EACVxN,EAAKwN,EAAWa,EAAO,YAErBC,EAAWC,EAAWhB,EAAWG,EAAW,EAAI,IAChDY,EAAWC,EAAWhB,EAAWG,EAAW,EAAI,GAGhDlO,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAAQD,IACvCsO,EAAWC,GAAYhB,EAAWG,EAAW,EAEtDlO,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAASD,IAGjDR,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAASD,KAE1ClB,IAAc,QAAO8O,GAAA,YAAAA,EAAO,WAAU,QAC/C9N,EAAK0N,EAAWC,EAAW,GACxBE,IACG7N,GAAA,IAGNmN,EAAUO,EAAWC,EAChBzN,EAAAwN,EAAWC,EAAWY,EAAO,YAEhCC,EAAWC,EAAWhB,EAAWG,EAAW,EAAI,IAChDY,EAAWC,EAAWhB,EAAWG,EAAW,EAAI,GAEhDlO,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAAQD,IAEvCsO,EAAWC,GAAYhB,EAAWG,EAAW,EACtDlO,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAASD,IAEjDR,GAAQ,KAAKM,KAAMC,OAAQkN,OAAahN,OAASD,KAI/C,MAAApB,EAAWyP,EAAO,SAAS,GACjC,GAAIzP,GASF,GARAA,EAAS,MAAM,KACZyP,EAAO,aAAezP,EAAS,cAAgB,EAAI,KAClDE,IAAc,MACPF,EAAA,MAAM,KAAO,IAAM,KACnBE,IAAc,QACvBF,EAAS,MAAM,KAAOyP,EAAO,YAAc,GAAK,MAG9C,CAACzP,EAAS,SAAU,aAGxB,UAGE,IAAA4P,IACDnQ,GAAAF,EAAAyP,EAAM,WAAN,YAAAzP,EAAiB,KAAjB,YAAAE,EAAqB,WAAU,cACnBmQ,EAAA,CAAC,GAAGZ,EAAM,SAAS,GAAG,SAAS,GAAGA,EAAM,SAAS,GAAG,QAAQ,EAEzEY,EAAa,CAAC,GAAGZ,EAAM,SAAS,GAAG,QAAQ,EAEzCY,EAAa,OAAS,GAAGnB,GAAamB,EAAcH,EAAOtJ,EAAS,SAASjO,EAAE,CACrF,CACF,CCzUA,SAAA2X,GAAwBC,EAAM,CACvBA,EAAA,IAAI,iBAAiB,QAAc5T,GAAA,CAGlCA,EAAE,OAAO,WAAa,MACnB4T,EAAA,WAAW5T,EAAE,OAAO,eAAe,EAExCA,EAAE,OAAO,cAAc,WAAa,KACpCA,EAAE,OAAO,cAAc,WAAa,OAEpC4T,EAAK,WAAW5T,EAAE,OAAQ,GAAOA,CAAC,EACzBA,EAAE,OAAO,WAAa,OAC3BA,EAAE,OAAO,cAAc,WAAa,KACjC4T,EAAA,WAAW5T,EAAE,OAAO,aAAa,EAE/BA,EAAE,OAAO,YAAc,WAGhC4T,EAAK,aAAa,EAElBA,EAAK,UAAU,iBAAiB,cAAc,EAAE,QAAmBC,GAAA,CACnEA,EAAQ,UAAU,EAAA,CACnB,EACCD,EAAK,mBAAmB,EAC1B,CAED,EAEIA,EAAA,IAAI,iBAAiB,WAAiB5T,GAAA,CAEzC,GADAA,EAAE,eAAe,EACb,EAAC4T,EAAK,UAER,GAAA5T,EAAE,OAAO,cAAc,WAAa,KACpCA,EAAE,OAAO,cAAc,WAAa,OAE/B4T,EAAA,UAAU5T,EAAE,MAAM,UAChBA,EAAE,OAAO,YAAY,UAAU,CACtC,IAAIgC,EAAOhC,EAAE,OACb,KAAMgC,EAAK,eAEN,GADHA,EAAKA,EAAK,cACPA,EAAK,WAAa,MAAM,CACzB4R,EAAK,UAAU5R,CAAI,EACnB,KACF,CAEJ,EAAA,CACD,EAKI4R,EAAA,IAAI,iBAAiB,YAAkB5T,GAAA,CACtC,GAAA,CAAC4T,EAAK,eACJ5T,GAAKA,EAAE,OAAO,YAAc,WAAY,CAC1CR,EAAe,MAAM,EACrBQ,EAAE,OAAO,UAAY,GACrB,MACF,CAKEA,EAAE,OAAO,kBAAoB,QAChBR,EAAA,OAAOQ,EAAG4T,EAAK,SAAS,CACzC,CACD,EACIA,EAAA,IAAI,iBAAiB,YAAkB5T,GAAA,CACtCA,EAAE,OAAO,kBAAoB,SAC/BR,EAAe,YAAc,GAC7BA,EAAe,UAAY,GAC7B,CACD,EACIoU,EAAA,IAAI,iBAAiB,aAAmB5T,GAAA,CAC3CR,EAAe,MAAM,CAAA,CACtB,EACIoU,EAAA,IAAI,iBAAiB,UAAgB5T,GAAA,CACxCR,EAAe,MAAM,CAAA,CACtB,EAEIoU,EAAA,IAAI,iBAAiB,QAAc5T,GAAA,CAAA,CAEvC,CACH,CCnFA,MAAM8T,GAAK,CACT,SAAU,iCACV,UAAW,iCACX,WAAY,uCACZ,WAAY,2BACZ,MAAO,eACP,YAAa,2BACb,OAAQ,eACR,SAAU,eAEV,UAAW,6CAEX,KAAM,eACN,WAAY,eACZ,IAAK,eACL,KAAM,eACN,aAAc,+DACd,cAAe,+DACf,KAAK,eACL,SAAS,uCACT,UAAU,qBACV,aAAa,wFACb,OAAO,eACP,eAAe,eACf,QAAQ,cACV,EACeC,EAAA,CACb,GAAAD,GACA,MAAOA,GACP,MAAO,CACL,SAAU,iCACV,UAAW,iCACX,WAAY,uCACZ,WAAY,2BACZ,MAAO,eACP,YAAa,2BACb,OAAQ,eACR,SAAU,eACV,KAAM,eACN,UAAW,6CAEX,KAAM,eACN,WAAY,eACZ,IAAK,eACL,KAAM,eACN,aAAc,+DACd,cAAe,8DACjB,EACA,GAAI,CACF,SAAU,YACV,UAAW,aACX,WAAY,cACZ,WAAY,cACZ,MAAO,aACP,YAAa,oBACb,OAAQ,UACR,SAAU,YACV,KAAM,OACN,UAAW,+BAEX,KAAM,OACN,WAAY,aACZ,IAAK,MACL,KAAM,OACN,aAAc,yBACd,cAAe,0BACf,UAAU,YACV,aAAa,eACb,OAAO,SACP,eAAe,UACf,QAAQ,UACR,SAAS,YACX,EACA,GAAI,CACF,SAAU,yDACV,UAAW,+DACX,WAAY,+DACZ,WAAY,uCACZ,MAAO,eACP,YAAa,2BACb,OAAQ,2BACR,SAAU,2BACV,KAAM,2BACN,UAAW,qHAEX,KAAM,2BACN,WAAY,mDACZ,IAAK,eACL,KAAM,2BACN,aAAc,qEACd,cAAe,gFACjB,EACA,GAAI,CACF,SAAU,uBACV,UAAW,qBACX,WAAY,uBACZ,WAAY,eACZ,MAAO,YACP,YAAa,qBACb,OAAQ,kBACR,SAAU,mBACV,KAAM,OACN,UAAW,4BAEX,KAAM,QACN,WAAY,eACZ,IAAK,MACL,KAAM,QACN,aAAc,0BACd,cAAe,2BACjB,CACF,EC1GA,SAAAE,GAAwBJ,EAAMK,EAAQ,CACpC,MAAMC,EAAsBC,GAAA,CACpB,MAAAnR,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,UAAYmR,EAChBnR,EAAI,MAAM,QAAU,qEACbA,CAAA,EAEHoR,EAAW,CAACtY,EAAIuY,EAAMC,IAAY,CAChC,MAAAC,EAAK,SAAS,cAAc,IAAI,EACtC,OAAAA,EAAG,GAAKzY,EACRyY,EAAG,UAAY,SAASnZ,GAAWiZ,CAAI,iBAAiBjZ,GAAWkZ,CAAO,WACnEC,CAAA,EAEHzI,EAASiI,EAAKH,EAAK,QAAUA,EAAK,OAAS,KAE3CY,EAAYJ,EAAS,eAAgBL,EAAKjI,GAAQ,SAAU,KAAK,EACjE2I,EAAaL,EAAS,gBAAiBL,EAAKjI,GAAQ,UAAW,EAAE,EACjE4I,EAAcN,EAAS,iBAAkBL,EAAKjI,GAAQ,WAAY,OAAO,EACzE6I,EAAeP,EACnB,kBACAL,EAAKjI,GAAQ,WACb,QAAA,EAEI8I,EAAQR,EAAS,WAAYL,EAAKjI,GAAQ,MAAO,EAAE,EACnD+I,EAAUT,EAAS,aAAcL,EAAKjI,GAAQ,YAAa,EAAE,EAC7DgJ,EAAKV,EAAS,QAASL,EAAKjI,GAAQ,OAAQ,MAAM,EAClDiJ,EAAOX,EAAS,UAAWL,EAAKjI,GAAQ,SAAU,MAAM,EACxDe,EAAOuH,EAAS,UAAWL,EAAKjI,GAAQ,KAAM,EAAE,EAChDkJ,EAAWZ,EAAS,cAAeL,EAAKjI,GAAQ,SAAU,EAAE,EAC5DmJ,EAAUb,EAAS,aAAcL,EAAKjI,GAAQ,QAAS,EAAE,EAEzDoJ,EAAS,SAAS,cAAc,IAAI,EAiBtC,GAhBJA,EAAO,UAAY,YACnBA,EAAO,YAAYV,CAAS,EAC5BU,EAAO,YAAYT,CAAU,EAC7BS,EAAO,YAAYR,CAAW,EAC9BQ,EAAO,YAAYP,CAAY,GAC3B,CAACV,GAAUA,EAAO,SACpBiB,EAAO,YAAYN,CAAK,EACxBM,EAAO,YAAYL,CAAO,GAE5BK,EAAO,YAAYJ,CAAE,EACrBI,EAAO,YAAYH,CAAI,GACnB,CAACd,GAAUA,EAAO,QACpBiB,EAAO,YAAYrI,CAAI,EACvBqI,EAAO,YAAYF,CAAQ,GAE7BE,EAAO,YAAYD,CAAO,EACtBhB,GAAUA,EAAO,OACnB,QAASjY,EAAI,EAAGA,EAAIiY,EAAO,OAAO,OAAQjY,IAAK,CACvC,MAAAmZ,EAAOlB,EAAO,OAAOjY,GACrB6D,EAAMuU,EAASe,EAAK,KAAMA,EAAK,KAAMA,EAAK,KAAO,EAAE,EACzDD,EAAO,YAAYrV,CAAG,EACtBA,EAAI,QAAeG,GAAA,CACjBmV,EAAK,QAAQnV,CAAC,CAAA,CAElB,CAEI,MAAAoV,EAAgB,SAAS,cAAc,OAAO,EACpDA,EAAc,YAAYF,CAAM,EAChCE,EAAc,OAAS,GAElBxB,EAAA,UAAU,OAAOwB,CAAa,EACnC,IAAIC,EAAS,GACRzB,EAAA,UAAU,cAAgB,SAAS5T,EAAG,CAEzC,GADAA,EAAE,eAAe,EACb,CAAC4T,EAAK,SAAU,OAEpB,MAAMpK,EAASxJ,EAAE,OACb,GAAAwJ,EAAO,UAAY,MAAO,CACxBA,EAAO,cAAc,UAAY,OAC1B6L,EAAA,GAEAA,EAAA,GAEPA,GACFT,EAAM,UAAY,WAClBE,EAAG,UAAY,WACfC,EAAK,UAAY,WACjBL,EAAY,UAAY,WACxBC,EAAa,UAAY,aAEzBC,EAAM,UAAY,GAClBE,EAAG,UAAY,GACfC,EAAK,UAAY,GACjBL,EAAY,UAAY,GACxBC,EAAa,UAAY,IAE3Bf,EAAK,WAAWpK,CAAM,EACtB4L,EAAc,OAAS,GACvB,MAAMrO,EAASmO,EAAO,aAChBxU,EAAQwU,EAAO,YACjBnO,EAAS/G,EAAE,QAAU,OAAO,aAC9BkV,EAAO,MAAM,IAAM,GACnBA,EAAO,MAAM,OAAS,QAEtBA,EAAO,MAAM,OAAS,GACtBA,EAAO,MAAM,IAAMlV,EAAE,QAAU,GAAK,MAElCU,EAAQV,EAAE,QAAU,OAAO,YAC7BkV,EAAO,MAAM,KAAO,GACpBA,EAAO,MAAM,MAAQ,QAErBA,EAAO,MAAM,MAAQ,GACrBA,EAAO,MAAM,KAAOlV,EAAE,QAAU,GAAK,KAEzC,CAAA,EAGFoV,EAAc,QAAepV,GAAA,CACvBA,EAAE,SAAWoV,IAAeA,EAAc,OAAS,GAAA,EAGzDZ,EAAU,QAAexU,GAAA,CACvB4T,EAAK,SAAS,EACdwB,EAAc,OAAS,EAAA,EAEzBH,EAAQ,QAAejV,GAAA,CACrB4T,EAAK,WAAW,EAChBwB,EAAc,OAAS,EAAA,EAEzBX,EAAW,QAAezU,GAAA,CACxB4T,EAAK,aAAa,EAClBwB,EAAc,OAAS,EAAA,EAEzBV,EAAY,QAAe1U,GAAA,CACrBqV,IACJzB,EAAK,cAAc,EACnBwB,EAAc,OAAS,GAAA,EAEzBT,EAAa,QAAe3U,GAAA,CACtBqV,IACJzB,EAAK,WAAW,EAChBwB,EAAc,OAAS,GAAA,EAEzBR,EAAM,QAAe5U,GAAA,CACfqV,IACCzB,EAAA,UAAUA,EAAK,WAAW,EAC/BwB,EAAc,OAAS,GAAA,EAEzBP,EAAQ,QAAe7U,GAAA,CACrB4T,EAAK,YAAY,EACjBwB,EAAc,OAAS,EAAA,EAEzBN,EAAG,QAAe9U,GAAA,CACZqV,IACJzB,EAAK,WAAW,EAChBwB,EAAc,OAAS,GAAA,EAEzBL,EAAK,QAAe/U,GAAA,CACdqV,IACJzB,EAAK,aAAa,EAClBwB,EAAc,OAAS,GAAA,EAEzBvI,EAAK,QAAe7M,GAAA,CAClBoV,EAAc,OAAS,GACvB,MAAM9W,EAAOsV,EAAK,YACZ0B,EAAOpB,EAAWH,EAAKjI,GAAQ,SAAS,EACzC8H,EAAA,UAAU,YAAY0B,CAAI,EAC/B1B,EAAK,IAAI,iBACP,QACA5T,GAAK,CAIDA,GAHFA,EAAE,eAAe,EACjBsV,EAAK,OAAO,EAEVtV,EAAE,OAAO,cAAc,WAAa,KACpCA,EAAE,OAAO,cAAc,WAAa,OACpC,CACA,MAAMzB,EAAIqV,EAAK,YACVA,EAAA,WAAWtV,EAAKC,CAAE,CAAA,MAEvB,QAAQ,IAAI,0BAAM,CAEtB,EACA,CACE,KAAM,EACR,CAAA,CACF,EAEFyW,EAAS,QAAehV,GAAA,CACtBoV,EAAc,OAAS,GACvB,MAAM9W,EAAOsV,EAAK,YACZ0B,EAAOpB,EAAWH,EAAKjI,GAAQ,SAAS,EACzC8H,EAAA,UAAU,YAAY0B,CAAI,EAC/B1B,EAAK,IAAI,iBACP,QACA5T,GAAK,CAIDA,GAHFA,EAAE,eAAe,EACjBsV,EAAK,OAAO,EAEVtV,EAAE,OAAO,cAAc,WAAa,KACpCA,EAAE,OAAO,cAAc,WAAa,OACpC,CACA,MAAMzB,EAAIqV,EAAK,YACXtV,EAAK,QAAQ,WAAeA,EAAA,QAAQ,SAAS,IACjDA,EAAK,QAAQ,SAAS,KAAK,CACvB,KAAKC,EAAG,QAAQ,GAChB,MAAMA,EAAG,QAAQ,KACnB,CAAA,EAEGqV,EAAA,SAAStV,EAAKA,EAAK,OAAO,EAC/BsV,EAAK,QAAQ,CAAA,MAEb,QAAQ,IAAI,0BAAM,CAEtB,EACA,CACE,KAAM,EACR,CAAA,CACF,CAEJ,CCrNA,MAAM2B,GAAK,8lEAEX,SAASC,GAAUvL,EAAiBC,EAAkB,OAClD,IAAIjO,EAAW,GACf,QAAQD,EAAG,EAAEA,IAAE8E,EAAAmJ,EAAS,WAAT,YAAAnJ,EAAmB,QAAO9E,IAErCC,GAAM,6BAA6BuZ,GAAUvL,EAAS,SAASjO,GAAGkO,EAAI,CAAC,SAE3E,MAAG,EAACD,GAAA,MAAAA,EAAU,WAAU,CAACA,EAAS,SAAS,OAChC,uCAAuCA,EAAS,2BAA2BA,EAAS,MAAM,GAAG,8CAA8CA,EAAS,MAAMA,EAAS,MAAMsL,gBAEzK,uCAAuCtL,EAAS,0BAA0BC,EAAI,EAAE,OAAO,YAAYD,EAAS,MAAM,GAAG,6CAA6CA,EAAS,MAAMA,EAAS,MAAMsL,gDAAiDrL,EAAI,EAAE,GAAG,aAAajO,QAGtR,CAEgB,SAAAwZ,GAAc7B,EAAK8B,EAAoB,CACnD,MAAMzL,EAAS2J,EAAK,SACpB8B,EAAQ,UAAY,GAAGF,GAAUvL,EAAS,CAAC,IAC3CyL,EAAQ,iBAAiB,gBAAgB,EAAE,QAAS1V,GAAgB,CAChEA,EAAE,QAAQ,IAAI,CACF,MAAA+U,EAAO/U,EAAE,cAAc,OAAO,EAC9BuG,EAAQvG,EAAE,cAAc,QAAQ,EAChC2V,EAAU/B,EAAK,UAAU,cAAc,uBAAuB,EACzD+B,GAAA,MAAAA,EAAA,UAAU,OAAO,UACzBZ,GACD/U,EAAE,cAAc,cAAc,IAAI,EAAE,UAAU,IAAI,QAAQ,EACrD+U,EAAA,UAAU,QAAQ,OAAO,OAAO,GAC9BxO,IACPvG,EAAE,cAAc,cAAc,IAAI,EAAE,UAAU,OAAO,QAAQ,EACvDuG,EAAA,UAAU,QAAQ,QAAQ,MAAM,GAEtCvG,EAAA,UAAU,IAAI,QAAQ,EACxB2B,GAAW,KAAKiS,EAAK5T,EAAE,GAAG,QAAQ,UAAU,EAAE,CAAC,CAAA,CACrD,CACH,CACL,CAEA,SAAA4V,GAAwBhC,EAAK,CACnB,MAAA8B,EAAU,SAAS,cAAc,SAAS,EAC1CzL,EAAS2J,EAAK,SACpB8B,EAAQ,UAAY,GAAGF,GAAUvL,EAAS,CAAC,IACtC2J,EAAA,UAAU,OAAO8B,CAAO,CACjC,CC3CA,MAAMG,EAAe,CAAC/Z,EAAIuY,IAAS,CAC3B,MAAA3S,EAAS,SAAS,cAAc,MAAM,EAC5C,OAAAA,EAAO,GAAK5F,EACZ4F,EAAO,UAAY;AAAA,6BACQ2S;AAAA,UAEpB3S,CACT,EAEA,IAAIoU,GAAQ,KACZ,SAASC,GAAUC,EAAIxZ,EAAM,CAC3B,OAAO,UAAY,CAClB,MAAMyZ,EAAO,UAERH,IACF,aAAaA,EAAK,EAEpBA,GAAQ,WAAW,UAAY,CACzBE,EAAA,MAAM,KAAMC,CAAI,GACnBzZ,CAAI,CAAA,CAEX,CAEA,SAAS0Z,GAAyBtC,EAAM,OAChC,MAAAuC,EAAqB,SAAS,cAAc,SAAS,EACrDC,EAAKP,EAAa,aAAc,MAAM,EACtCQ,EAAKR,EAAa,WAAY,QAAQ,EACtCS,EAAKT,EAAa,UAAW,MAAM,EACnCU,EAAKV,EAAa,SAAU,KAAK,EACjCW,EAAgB,SAAS,cAAc,OAAO,EACpDA,EAAgB,UAAU,kBAC1BA,EAAgB,KAAK,SACrBA,EAAgB,IAAI,IACpBA,EAAgB,IAAI,MACpBA,EAAgB,KAAK,IACrBA,EAAgB,QAAM1V,EAAA8S,GAAA,YAAAA,EAAM,aAAN,YAAA9S,EAAkB,aAAY,IACpC0V,EAAA,QAAQT,GAAS,IAAI,CAC7B,MAAAha,EAAK6X,EAAK,yBAChB1H,GAAgBnQ,GAAA,YAAAA,EAAM,QAAQ,EAC9B6X,EAAK,OAAO,EACZA,EAAK,QAAQ,GACb,GAAG,EAGC,MAAA6C,EAAa,SAAS,cAAc,MAAM,EAOhD,GANAA,EAAW,UAAY,OACvBN,EAAmB,YAAYK,CAAe,EAC9CL,EAAmB,YAAYC,CAAE,EACjCD,EAAmB,YAAYE,CAAE,EACjCF,EAAmB,YAAYG,CAAE,EACjCH,EAAmB,YAAYI,CAAE,EAC7B3C,EAAK,aAAc,CACf,MAAA8C,EAAeC,GAAmB/C,CAAI,EAC5CuC,EAAmB,YAAYO,CAAY,CAC7C,CAEA,OAAAP,EAAmB,UAAY,KAC/BC,EAAG,QAAU,IAAM,CACjBxC,EAAK,UAAU,mBAAkB,EAEnCyC,EAAG,QAAU,IAAM,CACjBzC,EAAK,UAAU,CAAA,EAEjB0C,EAAG,QAAU,IAAM,CACb1C,EAAK,SAAW,IACfA,EAAA,MAAOA,EAAK,UAAY,EAAI,CAAA,EAEnC2C,EAAG,QAAU,IAAM,CACb3C,EAAK,SAAW,KACfA,EAAA,MAAOA,EAAK,UAAY,EAAI,CAAA,EAE9BA,EAAA,IAAI,YAAY,QAAW5T,GAAA,CAC9B,MAAM4W,EAAS5W,EAAE,MAAMA,EAAE,QAAQ,SAAS,gBAAgB,aACpD6W,EAAWjD,EAAK,UAAU,sBAAA,EAAwB,IAAI,OAAO,QAAQA,EAAK,UAAU,UAAUA,EAAK,UAAU,aAG7GkD,GADWD,EAASD,EAAS,EAAEC,EAASD,EAAS,GAChCT,EAAmB,aAAa,GACpDW,EAAO,IAAIA,EAAOlD,EAAK,UAAU,aAAauC,EAAmB,aAAa,KAC5DA,EAAA,MAAM,OAAOW,EAAO,KAAA,CAC1C,EACMX,CACT,CAGA,SAASY,GAAyBnD,EAAM,CAChC,MAAAoD,EAAqB,SAAS,cAAc,SAAS,EACrDC,EAAQpB,EAAa,UAAW,MAAM,EACtCrG,EAAIqG,EAAa,QAAS,MAAM,EAChCpG,EAAIoG,EAAa,QAAS,OAAO,EACjC,EAAIA,EAAa,QAAS,MAAM,EACtC,OAAAmB,EAAmB,YAAYC,CAAI,EACnCD,EAAmB,YAAYxH,CAAC,EAChCwH,EAAmB,YAAYvH,CAAC,EAChCuH,EAAmB,YAAY,CAAC,EAChCA,EAAmB,UAAY,KAG/BC,EAAK,QAAQ,IAAM,CACX,MAAAvB,EAAS,SAAS,cAAc,SAAS,EAC/CD,GAAc7B,EAAK8B,CAAsB,EACtCA,EAAQ,UAAU,SAAS,UAAU,EACtCA,EAAQ,gBAAgB,OAAO,EAEvBA,EAAA,aAAa,QAAQ,UAAU,CACzC,EAEFlG,EAAE,QAAU,IAAM,CAChBoE,EAAK,SAAS,CAAA,EAEhBnE,EAAE,QAAU,IAAM,CAChBmE,EAAK,UAAU,CAAA,EAEjB,EAAE,QAAU,IAAM,CAChBA,EAAK,SAAS,CAAA,EAEXA,EAAA,IAAI,YAAY,QAAW5T,GAAA,CACxB,MAAAkX,EAAQlX,EAAE,MAAMA,EAAE,QAClBmX,EAAUvD,EAAK,UAAU,wBAAwB,IAAI,OAAO,QAAQA,EAAK,UAAU,UACnFkD,EAAOI,EAAQC,EAAQ,GAC1BL,EAAO,IAAIA,EAAOlD,EAAK,UAAU,aAAaoD,EAAmB,aAAa,KAC5DA,EAAA,MAAM,IAAIF,EAAO,KAAA,CACvC,EACME,CACT,CAEA,SAASI,GAAkBxD,EAAK,CACxB,MAAAyD,EAAQxB,EAAa,QAAQ,OAAO,EAC1C,OAAAwB,EAAM,QAAQ,IAAI,CAChB,QAAQ,IAAI,cAAI,EAChBzD,EAAK,IAAI,KAAK,QAAQ,CAAE,CAAA,CAAA,EAEnByD,CACT,CAEA,SAASV,GAAmB/C,EAAK,CACzB,MAAAlS,EAAS,SAAS,cAAc,MAAM,EAC5CA,EAAO,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASb,MAAA4V,EAAK5V,EAAO,SAAS,GACxB,OAAA4V,EAAA,iBAAiB,SAAetX,GAAA,CAC5B4T,EAAA,IAAI,KAAK,SAAU0D,CAAE,CAAA,CAC3B,EACM5V,CACT,CAGA,SAAA6V,GAAwB3D,EAAM,CAC5BA,EAAK,UAAU,OAAOsC,GAAyBtC,CAAI,CAAC,EACpDA,EAAK,UAAU,OAAOmD,GAAyBnD,CAAI,CAAC,EACpDA,EAAK,aAAeA,EAAK,UAAU,OAAOwD,GAAkBxD,CAAI,CAAC,CACnE,CC9JA,MAAM4D,GAAa1b,GAAO,CAClB,MAAAkH,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,GAAKlH,EACFkH,CACT,EAEMyU,GAAY,CAChB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACF,EAEA,SAAAC,GAAwB9D,EAAM,CAC5B,MAAM9H,EAASiI,EAAKH,EAAK,QAAUA,EAAK,OAAS,KAC7C,IAAA+D,EACE,MAAAC,EAAWJ,GAAU,UAAU,EAC/BK,EAASL,GAAU,QAAQ,EAC3BM,EAAUN,GAAU,SAAS,EAE7BzG,EAAUyG,GAAU,SAAS,EAC7BO,EAAYP,GAAU,WAAW,EACvCI,EAAS,UAAY;AAAA;AAAA,UAEb,CAAC,KAAM,KAAM,IAAI,EACtB,IAAYI,GACJ,iCAAiCA;AAAA,0CACJA,eAAkBA;AAAA;AAAA,qBAGvD,EACA,KAAK,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,UAKFP,GACL,IAAaQ,GACL,wDAAwDA,+BAAmCA,kBACnG,EACA,KAAK,EAAE;AAAA;AAAA;AAAA,2BAGelE,EAAKjI,GAAQ;AAAA,iCACPiI,EAAKjI,GAAQ;AAAA;AAAA,IAG5C+L,EAAO,UAAY,GAAG9D,EAAKjI,GAAQ,0DAA0DiI,EAAKjI,GAAQ,uBAC1GgM,EAAQ,UAAY,GAAG/D,EAAKjI,GAAQ,4DAA4DiI,EAAKjI,GAAQ,wBAC7GiF,EAAQ,UAAY,GAAGgD,EAAKjI,GAAQ,iEAAiEiI,EAAKjI,GAAQ,uBAClHiM,EAAU,UAAY,GAAGhE,EAAKjI,GAAQ,gEAAgEiI,EAAKjI,GAAQ,yBAEnH,SAASoM,EAAgBC,EAAmB,CACnCA,EAAA,WAAYnY,GAAI,CACf,MAAAoY,EAAS,SAAS,cAAc,UAAU,EAC1CC,EAAYF,EAAO,SAAS,GAC5BG,EAAU1E,EAAK,UAAU,aAAauE,EAAO,UAAU,GACvDI,EAAU,GACVC,EAAWC,GACZA,EAAUF,EACJA,EACAE,EAAUH,EACVA,EAEAG,EAGXL,EAAS,MAAMC,EAAY,MAC3BD,EAAS,MAAM,SAAS,WACfA,EAAA,MAAM,KAAKC,EAAY,WAAW,KAC3CD,EAAS,MAAM,IAAIC,EAAY,UAAU,GAAG,KAC5CD,EAAS,MAAM,OAAOI,EAAUH,EAAY,YAAY,EAAI,KACnDD,EAAA,MAAM,MAAMC,EAAY,YAAY,KACpCD,EAAA,QAASpY,GAAuC,CACnD,IAAA+G,GAAO/G,EAAE,OAAO,aACpBoY,EAAS,MAAM,OAAQI,EAAUzR,EAAM,EAAI,IAAA,EAEpCqR,EAAA,OAAOpY,GAAG,CACjBqY,EAAY,MAAMD,EAAS,MAC3BC,EAAY,cAAc,IAAI,YAAY,QAAQ,CAAC,EACnDD,EAAS,OAAO,CAAA,EAElBD,EAAO,YAAYC,CAAQ,EAC3BA,EAAS,MAAM,CAAA,CAEnB,CACAF,EAAgBL,CAAM,EACtBK,EAAgBJ,CAAO,EACvBI,EAAgBnH,CAAO,EACvBmH,EAAgBH,CAAS,EACnB,MAAA3C,EAAgB,SAAS,cAAc,OAAO,EACpDA,EAAc,UAAY;AAAA;AAAA;AAAA;AAAA,IAK1BA,EAAc,YAAYwC,CAAQ,EAClCxC,EAAc,YAAYyC,CAAM,EAChCzC,EAAc,YAAY0C,CAAO,EACjC1C,EAAc,YAAYrE,CAAO,EACjCqE,EAAc,YAAY2C,CAAS,EACnC3C,EAAc,OAAS,GAEd,SAAAsD,EAAY9T,EAAO+T,EAAQ,CAClC,IAAIC,EAAQhF,EAAK,UAAU,iBAAiBhP,CAAK,EAChD,CAAA,EAAG,QAAQ,KAAKgU,EAAO,SAAS5M,EAAI,CAChCA,EAAA,UAAU,OAAO2M,CAAM,CAAA,CAC3B,CACH,CAEK/E,EAAA,UAAU,OAAOwB,CAAa,EAC7B,MAAAyD,EAAezD,EAAc,iBAAiB,OAAO,EACrD0D,EAAmB1D,EAAc,cAAc,OAAO,EACtD2D,EAA8B3D,EAAc,cAAc,mBAAmB,EAC7E4D,EAAsB5D,EAAc,cAAc,OAAO,EACzD6D,EAA4BrF,EAAK,UAAU,cAAc,SAAS,EAClEsF,EAA6BtF,EAAK,UAAU,cAAc,UAAU,EACpEuF,EAA6BvF,EAAK,UAAU,cAAc,UAAU,EACpEwF,EAA+BxF,EAAK,UAAU,cAAc,YAAY,EAC9EwB,EAAc,QAAepV,GAAA,CAC3B,GAAI,CAAC4T,EAAK,YAAa,OACjB,MAAA5S,EAAU4S,EAAK,YAAY,QAC3BpK,EAASxJ,EAAE,OACbwJ,EAAO,YAAc,WAClBxI,EAAQ,QAAOA,EAAQ,MAAQ,IACpC0X,EAAY,WAAY,gBAAgB,EACxClP,EAAO,UAAY,yBACfmO,IAAa,OACP3W,EAAA,MAAM,MAAQwI,EAAO,QAAQ,MAC5BmO,IAAa,eACd3W,EAAA,MAAM,WAAawI,EAAO,QAAQ,OAE5CoK,EAAK,gBAAgB5S,CAAO,GACnBwI,EAAO,YAAc,cAC9BkP,EAAY,WAAY,gBAAgB,EAC7Bf,EAAA,aACXnO,EAAO,UAAY,sBACnBA,EAAO,uBAAuB,UAAY,OACtCxI,EAAQ,OAASA,EAAQ,MAAM,aACnBoU,EAAA,cACZ,wBAA0BpU,EAAQ,MAAM,WAAa,IAAA,EACrD,UAAY,2BAEPwI,EAAO,YAAc,SAC9BkP,EAAY,WAAY,gBAAgB,EAC7Bf,EAAA,OACXnO,EAAO,UAAY,gBACnBA,EAAO,mBAAmB,UAAY,aAClCxI,EAAQ,OAASA,EAAQ,MAAM,QACnBoU,EAAA,cACZ,wBAA0BpU,EAAQ,MAAM,MAAQ,IAAA,EAChD,UAAY,0BAElB,EAEI,MAAA,KAAK6X,CAAY,EAAE,IAChBhZ,GAAA,CACJA,EAAoB,QAAeG,GAAA,CAC7B4T,EAAK,YAAY,QAAQ,QAAYA,EAAA,YAAY,QAAQ,MAAQ,CAAA,GACtE8E,EAAY,QAAS,eAAe,EACpC,MAAMV,EAAOhY,EAAE,cACf4T,EAAK,YAAY,QAAQ,MAAM,SAAWoE,EAAK,QAAQ,KACvDA,EAAK,UAAY,qBACZpE,EAAA,gBAAgBA,EAAK,YAAY,OAAO,CAAA,CAEjD,CAAA,EAEGkF,EAAA,QAAW9Y,GAA6C,CACtD4T,EAAK,YAAY,QAAQ,QAAYA,EAAA,YAAY,QAAQ,MAAQ,CAAA,GAClEA,EAAK,YAAY,QAAQ,MAAM,aAAe,QACzC,OAAAA,EAAK,YAAY,QAAQ,MAAM,WACtC5T,EAAE,cAAc,UAAY,OACvB4T,EAAA,gBAAgBA,EAAK,YAAY,OAAO,IAExCA,EAAA,YAAY,QAAQ,MAAM,WAAa,OAC5C5T,EAAE,cAAc,UAAY,qBACvB4T,EAAA,gBAAgBA,EAAK,YAAY,OAAO,EAC/C,EAEOqF,EAAA,SAAYjZ,GAA+C,CAClE,GAAI,EAAC4T,EAAK,cACN5T,EAAE,OAAO,QAAQ,MAAMA,EAAE,OAAO,QAAQ,QAAW,CACjD,IAAAqZ,EACDrZ,EAAE,OAAO,QAAQ,GAClBqZ,EAAQ,CAAA,EAERA,EAAUrZ,EAAE,OAAO,MAAM,MAAM,GAAG,EACpC4T,EAAK,eAAeA,EAAK,YAAY,QAASyF,CAAO,CACvD,CAAA,EAEQH,EAAA,SAAYlZ,GAA+C,CACnE,GAAI,EAAC4T,EAAK,cACN5T,EAAE,OAAO,QAAQ,MAAMA,EAAE,OAAO,QAAQ,QAAW,CACrD,MAAMsZ,EAAWtZ,EAAE,OAAO,MAAM,MAAM,GAAG,EACzC4T,EAAK,gBAAgBA,EAAK,YAAY,QAAS0F,CAAQ,CACzD,CAAA,EAEQH,EAAA,SAAYnZ,GAA+C,CACnE,GAAI,EAAC4T,EAAK,cACN5T,EAAE,OAAO,QAAQ,MAAMA,EAAE,OAAO,QAAQ,QAAW,CAC/C,MAAA6M,EAAO7M,EAAE,OAAO,MACtB4T,EAAK,oBAAoBA,EAAK,YAAY,QAAS/G,CAAI,CACzD,CAAA,EAEUuM,EAAA,SAAYpZ,GAA+C,CACrE,GAAI,EAAC4T,EAAK,cACN5T,EAAE,OAAO,QAAQ,MAAMA,EAAE,OAAO,QAAQ,QAAW,CAC/C,MAAAuZ,EAAQvZ,EAAE,OAAO,MACvB4T,EAAK,iBAAiBA,EAAK,YAAY,QAAS2F,CAAK,CACvD,CAAA,EAEF,IAAIC,EAAQ,OACZT,EAAgB,QAAe/Y,GAAA,CACzBwZ,IAAU,QACJA,EAAA,QACRpE,EAAc,UAAY,QAC1B2D,EAAgB,UAAY,mFAEpBS,EAAA,OACRpE,EAAc,UAAY,GAC1B2D,EAAgB,UAAY,kFAC9B,EAEGnF,EAAA,IAAI,YAAY,eAAgB,UAAW,CAC9CwB,EAAc,OAAS,EAAA,CACxB,EACDxB,EAAK,IAAI,YAAY,aAAc,SAAS5S,EAASoI,EAAY,CAC/D,GAAI,EAACA,EAQL,IAPAgM,EAAc,OAAS,GACvBsD,EAAY,WAAY,gBAAgB,EACxCA,EAAY,QAAS,eAAe,EACpCA,EAAY,QAAS,eAAe,EACzBf,EAAA,OACXqB,EAAQ,UAAY,gBACpBA,EAAQ,mBAAmB,UAAY,aACnChY,EAAQ,MAAO,CACb,GAAAA,EAAQ,MAAM,SAAU,CAC1B,MAAMyY,EAAWrE,EAAc,cAC7B,oBAAsBpU,EAAQ,MAAM,SAAW,IAAA,EAE9CyY,IAAUA,EAAS,UAAY,qBACpC,CACI,GAAAzY,EAAQ,MAAM,WAAY,CACtB,MAAA0Y,EAAatE,EAAc,cAAc,OAAO,EACnDsE,IAAYA,EAAW,UAAY,qBACxC,CACI,GAAA1Y,EAAQ,MAAM,MAAO,CACvB,MAAM2Y,EAAUvE,EAAc,cAC5B,wBAA0BpU,EAAQ,MAAM,MAAQ,IAAA,EAE/C2Y,IAAWA,EAAU,UAAY,yBACtC,CACF,CACI3Y,EAAQ,KACViY,EAAS,MAAQjY,EAAQ,KAAK,KAAK,GAAG,EAEtCiY,EAAS,MAAQ,GAEfjY,EAAQ,MACVkY,EAAU,MAAQlY,EAAQ,MAAM,KAAK,GAAG,EAExCkY,EAAU,MAAQ,GAEpBC,EAAU,MAAM,GACZnY,EAAQ,YACVmY,EAAU,MAAQnY,EAAQ,WAEzBA,EAAQ,WACNmY,EAAU,MAAM,OAAO,IAAGA,EAAU,OAAO,KAC9CA,EAAU,OAASnY,EAAQ,SAAS,IAAS5C,GAAAA,EAAI,KAAK,EAAE,OAAO,CAACwb,EAAOC,EAAOjb,IAAQgb,GAAQhb,EAAM,IAAI,IAAIib,EAAO,EAAE,GAEnH7Y,EAAQ,OACVoY,EAAY,MAAQpY,EAAQ,OAE5BoY,EAAY,MAAQ,GACtB,CACD,CACH,CCjSA,MAAMnZ,GAAK,SACL6Z,GAAgB,SAAS9N,EAAI+N,EAAgB,CACjD,GAAI,CAACA,EACH,OAAAC,GAAahO,CAAE,EACRA,EAEH,MAAAiO,EAAQjO,EAAG,uBAAuB,gBAAgB,EAClDkO,EAAY,kBAAkBH,SAChC,GAAAE,EAAM,OAAS,EACjBA,EAAM,GAAG,UAAYC,MAChB,CACC,MAAAC,EAAkBla,GAAG,cAAc,KAAK,EAC9Cka,EAAgB,UAAYD,EAC5BlO,EAAG,YAAYmO,CAAe,CAChC,CACO,OAAAnO,CACT,EAEMgO,GAAe,SAAShO,EAAI,CAChC,GAAI,CAACA,EAAI,OACH,MAAAiO,EAAQjO,EAAG,uBAAuB,gBAAgB,EAC7C,UAAAoO,KAAgBH,GAAS,GAClCG,EAAa,OAAO,CAExB,EAEMC,GAAa,SAASrO,EAAYsO,EAAe,CACrD,MAAMC,EAAYD,EAAQ,WAAW,WAAW,SAAStO,CAAE,EAEzD,OAAAA,GACAA,EAAG,UAAY,OACfA,IAAOsO,GACP,CAACC,GACAvO,EAAa,QAAQ,OAAS,EAEnC,EAEA,SAAAwO,GAAwB5G,EAAM,CACxB,IAAA0G,EACAP,EACAU,EAGJ7G,EAAK,IAAI,iBAAiB,YAAa,SAAS5T,EAAG,CACjDsa,EAAUta,EAAE,OACVsa,EAAQ,WAAW,WAAqB,MAAM,QAAU,MAC1D9a,EAAe,MAAM,CAAA,CACtB,EAEDoU,EAAK,IAAI,iBAAiB,UAAW,eAAe5T,EAAc,CAC/DA,EAAE,OAAuB,MAAM,QAAU,GAC1Cga,GAAaS,CAAI,EACjB,MAAM/b,EAAM4b,EAAQ,QACpB,OAAQP,EAAgB,CACtB,IAAK,SACEnG,EAAA,eAAe0G,EAASG,CAAI,EACjC7G,EAAK,WAAW8G,EAAEhc,EAAI,EAAE,CAAC,EACzB,MACF,IAAK,QACEkV,EAAA,cAAc0G,EAASG,CAAI,EAChC7G,EAAK,WAAW8G,EAAEhc,EAAI,EAAE,CAAC,EACzB,MACF,IAAK,KACEkV,EAAA,SAAS0G,EAASG,CAAI,EAC3B,KACJ,CACEH,EAAQ,WAAW,WAAqB,MAAM,QAAU,IAChDA,EAAA,IAAA,CACX,EAED1G,EAAK,IAAI,iBAAiB,WAAYtX,GAAS,SAAS0D,EAAc,CAEpEga,GAAaS,CAAI,EAEjB,MAAME,EAAU1a,GAAG,iBACjBD,EAAE,QACFA,EAAE,QAAU,EAAA,EAEV,GAAAqa,GAAWM,EAASL,CAAO,EAAG,CACzBG,EAAAE,EACD,MAAA7c,EAAI6c,EAAQ,sBAAA,EAAwB,EACtC3a,EAAE,QAAUlC,EAAI6c,EAAQ,aACTZ,EAAA,QACR/Z,EAAE,QAAUlC,EAAI6c,EAAQ,aAAe,IAC/BZ,EAAA,KACnB,KACK,CACL,MAAMa,EAAa3a,GAAG,iBACpBD,EAAE,QACFA,EAAE,QAAU,EAAA,EAEV,GAAAqa,GAAWO,EAAYN,CAAO,EAAG,CAC5BG,EAAAG,EACD,MAAA9c,EAAI8c,EAAW,sBAAA,EAAwB,EACzC5a,EAAE,QAAUlC,EACGic,EAAA,SACR/Z,EAAE,QAAUlC,EAAI8c,EAAW,aAAe,IAClCb,EAAA,KACnB,MAEAA,EAAiBU,EAAO,IAE5B,CACIA,GAAMX,GAAcW,EAAMV,CAAc,CAAA,EAC3C,GAAG,CAAC,CACT,CC7GA,SAAAc,GAAwBjH,EAAM,CAC5B,MAAMkH,EAAW,CACf,GAAI,IAAM,CAERlH,EAAK,cAAc,CACrB,EACA,EAAG,IAAM,CAEPA,EAAK,SAAS,CAChB,EACA,GAAS5T,GAAA,CAEP4T,EAAK,WAAW,GAChB,QAAQ,IAAI,sBAAY,CAC1B,EACA,GAAS5T,GAAA,CAEP4T,EAAK,WAAW,GAChB,QAAQ,IAAI,qBAAW,CACzB,EACA,IAAK,IAAM,CAETA,EAAK,UAAU,CACjB,EACA,GAAI,IAAM,CAERA,EAAK,kBAAkB,CACzB,EACA,GAAI,IAAM,CAERA,EAAK,kBAAkB,CACzB,EACA,GAAI,IAAM,CAEJ,CAACA,EAAK,cACNA,EAAK,YAAY,aAAa,aAAa,YAAc,MAC3DA,EAAK,aAAa,GAElBA,EAAK,YAAY,aAAa,aAAa,YAAc,OACzDA,EAAK,YAAY,QAAQ,OAEzBA,EAAK,iBAAiB,EAE1B,EACA,GAAI,IAAM,CAEJ,CAACA,EAAK,cAERA,EAAK,YAAY,aAAa,aAAa,YAAc,OACzDA,EAAK,YAAY,QAAQ,KAEzBA,EAAK,iBAAiB,EAEtBA,EAAK,YAAY,aAAa,aAAa,YAAc,OAEzDA,EAAK,aAAa,EAEtB,EACA,IAAK,CAEHA,EAAK,WAAW,CAClB,EACA,IAAK,CAEHA,EAAK,aAAa,CACpB,EACA,GAAG5T,EAAG,EACAA,EAAE,SAAWA,EAAE,WAEjB4T,EAAK,SAAWA,EAAK,YAEzB,EACA,GAAG5T,EAAG,CACA,CAAC4T,EAAK,WACN5T,EAAE,SAAWA,EAAE,WAEjB4T,EAAK,SAASA,EAAK,SAAUA,EAAK,WAAW,EAC7CA,EAAK,SAAW,KAEpB,EAEA,GAAS5T,GAAA,CACH,CAAC4T,EAAK,YACN5T,EAAE,SAAWA,EAAE,UAAS4T,EAAK,KAAK,CACxC,EAEA,IAAU5T,GAAA,CACJ,GAAAA,EAAE,SAAWA,EAAE,QAAS,CAC1B,GAAI4T,EAAK,SAAW,IAAK,OACpBA,EAAA,MAAOA,EAAK,UAAY,EAAI,CACnC,CACF,EAEA,IAAU5T,GAAA,CACJ,GAAAA,EAAE,SAAWA,EAAE,QAAS,CAC1B,GAAI4T,EAAK,SAAW,GAAK,OACpBA,EAAA,MAAOA,EAAK,UAAY,EAAI,CACnC,CACF,CAAA,EAEGA,EAAA,IAAI,UAAiB5T,GAAA,CAGpB,CAAC4T,EAAK,UAEN5T,EAAE,SAAWA,EAAE,gBAIfA,EAAE,UAAY,GAAKA,EAAE,UAAY,GAE/B4T,EAAK,YAAaA,EAAK,WAAW,EACjCA,EAAK,WAAW,EAErBkH,EAAS9a,EAAE,UAAY8a,EAAS9a,EAAE,SAASA,CAAC,EAC9C,EAEG4T,EAAA,IAAI,QAAe5T,GAAA,EAClBA,EAAE,UAAY,IAAMA,EAAE,UAAY,MACpC4T,EAAK,WAAW,GAClB,CAEJ,CC1HA,SAAAmH,GAAwBnH,EAAMK,EAAS,CAC/B,MAAAG,EAAW,CAACtY,EAAIuY,IAAS,CACvB,MAAArR,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,GAAKlH,EACTkH,EAAI,UAAY;AAAA,6BACSqR;AAAA,UAElBrR,CAAA,EAGHwR,EAAYJ,EAAS,eAAgB,WAAW,EAChDM,EAAcN,EAAS,iBAAkB,gBAAgB,EACzDO,EAAeP,EAAS,kBAAmB,UAAU,EAGrDU,EAAKV,EAAS,QAAS,QAAQ,EAC/BW,EAAOX,EAAS,UAAW,SAAS,EACpC4G,EAAO5G,EAAS,UAAW,MAAM,EAGjCc,EAAS,SAAS,cAAc,IAAI,EAKtC,GAJJA,EAAO,UAAY,YAIfjB,GAAUA,EAAO,OACnB,QAASjY,EAAI,EAAGA,EAAIiY,EAAO,OAAO,OAAQjY,IAAK,CACvC,MAAAmZ,EAAOlB,EAAO,OAAOjY,GACrB6D,EAAMuU,EAASe,EAAK,KAAMA,EAAK,IAAI,EACzCD,EAAO,YAAYrV,CAAG,EACtBA,EAAI,QAAeG,GAAA,CACjBmV,EAAK,QAAQnV,CAAC,CAAA,CAElB,CAEI,MAAAoV,EAAgB,SAAS,cAAc,OAAO,EACpDA,EAAc,YAAYZ,CAAS,EACnCY,EAAc,YAAYV,CAAW,EACrCU,EAAc,YAAYT,CAAY,EAKtCS,EAAc,YAAYN,CAAE,EAC5BM,EAAc,YAAYL,CAAI,EAC9BK,EAAc,YAAY4F,CAAI,EAC9B5F,EAAc,OAAS,GAElBxB,EAAA,UAAU,OAAOwB,CAAa,EACnC,IAAIC,EAAS,GAmCRzB,EAAA,IAAI,YAAY,eAAgB,UAAW,CAC9CwB,EAAc,OAAS,EAAA,CACxB,EACDxB,EAAK,IAAI,YAAY,aAAc,SAAS5S,EAAS,CACnDoU,EAAc,OAAS,GACnBpU,EAAQ,KACDqU,EAAA,GAEAA,EAAA,EACX,CACD,EACDD,EAAc,QAAepV,GAAA,CACvBA,EAAE,SAAWoV,IAAeA,EAAc,OAAS,GAAA,EAGzDZ,EAAU,QAAexU,GAAA,CACvB4T,EAAK,SAAS,CAAA,EAEhBc,EAAY,QAAe1U,GAAA,CACrBqV,GACJzB,EAAK,cAAc,CAAA,EAErBe,EAAa,QAAe3U,GAAA,CACtBqV,GACJzB,EAAK,WAAW,CAAA,EAWlBkB,EAAG,QAAe9U,GAAA,CACZqV,GACJzB,EAAK,WAAW,CAAA,EAElBmB,EAAK,QAAe/U,GAAA,CACdqV,GACJzB,EAAK,aAAa,CAAA,EAEpBoH,EAAK,QAAehb,GAAA,CAClB4T,EAAK,UAAU,CAAA,CAsBnB,CCtJA,SAAwBqH,IAAM,CAC5B,KAAK,SAAW,EAClB,CACAA,GAAI,UAAY,CACd,YAAa,UAAW,CACd,QAAA,IAAI,KAAK,QAAQ,CAC3B,EACA,YAAa,SAASC,EAAMC,EAAS,CAC/B,KAAK,SAASD,KAAU,SAAgB,KAAA,SAASA,GAAQ,IACxD,KAAA,SAASA,GAAM,KAAKC,CAAO,CAClC,EACA,KAAM,SAASD,KAASE,EAAS,CAC3B,GAAA,KAAK,SAASF,aAAiB,MAEjC,QADIG,EAAW,KAAK,SAASH,GACpB,EAAI,EAAG,EAAIG,EAAS,OAAQ,IAC1BA,EAAA,GAAG,GAAGD,CAAO,CAG5B,EACA,eAAgB,SAASF,EAAMC,EAAS,CAClC,GAAA,EAAC,KAAK,SAASD,GACf,KAAAG,EAAW,KAAK,SAASH,GAC7B,GAAI,CAACC,EACHE,EAAS,OAAS,UACTA,EAAS,OAClB,QAAS,EAAI,EAAG,EAAIA,EAAS,OAAQ,IAC/BA,EAAS,KAAOF,GAClB,KAAK,SAASD,GAAM,OAAO,EAAG,CAAC,EAIvC,CACF,6CChCC,SAASrc,EAAE,CAAC,IAAIyO,EAAEkC,EAAE3G,EAAE7I,EAAEsb,EAAEtf,EAAEuf,EAAE,wkeAAwkeC,GAAGA,EAAE,SAAS,qBAAqB,QAAQ,GAAGA,EAAE,OAAO,GAAG,aAAa,gBAAgB,EAAE,GAAGA,GAAG,CAAC3c,EAAE,6BAA6B,CAACA,EAAE,6BAA6B,GAAG,GAAG,CAAC,SAAS,MAAM,kIAAkI,CAAC,OAAOA,EAAN,CAAS,SAAS,QAAQ,IAAIA,CAAC,CAAC,CAAC,CAAC,SAAS4F,GAAG,CAAC6W,IAAIA,EAAE,GAAGzS,EAAG,EAAC,CAACyE,EAAE,UAAU,CAAC,IAAIzO,EAAEyO,EAAEkC,EAAE3G,GAAGA,EAAE,SAAS,cAAc,KAAK,GAAG,UAAU0S,EAAEA,EAAE,MAAM/L,EAAE3G,EAAE,qBAAqB,KAAK,EAAE,MAAM2G,EAAE,aAAa,cAAc,MAAM,EAAEA,EAAE,MAAM,SAAS,WAAWA,EAAE,MAAM,MAAM,EAAEA,EAAE,MAAM,OAAO,EAAEA,EAAE,MAAM,SAAS,SAAS3Q,EAAE2Q,GAAGlC,EAAE,SAAS,MAAM,YAAYzE,EAAEhK,GAAG2Q,EAAElC,EAAE,YAAY,WAAW,aAAazE,EAAE2G,CAAC,GAAGlC,EAAE,YAAYzO,CAAC,EAAE,EAAE,SAAS,iBAAiB,CAAC,CAAC,WAAW,SAAS,aAAa,EAAE,QAAQ,SAAS,UAAU,EAAE,WAAWyO,EAAE,CAAC,GAAGkC,EAAE,UAAU,CAAC,SAAS,oBAAoB,mBAAmBA,EAAE,EAAE,EAAElC,EAAC,CAAE,EAAE,SAAS,iBAAiB,mBAAmBkC,EAAE,EAAE,GAAG,SAAS,cAAc3G,EAAEyE,EAAEtN,EAAEnB,EAAE,SAASyc,EAAE,IAAItf,EAAE,UAAU,CAAC,GAAG,CAACgE,EAAE,gBAAgB,SAAS,MAAM,CAAC,MAAC,CAAS,OAAO,KAAK,WAAWhE,EAAE,EAAE,CAAC,CAACyI,EAAG,CAAA,KAAKzE,EAAE,mBAAmB,UAAU,CAAaA,EAAE,YAAd,aAA2BA,EAAE,mBAAmB,KAAKyE,IAAI,EAAE,GAAE,MAAM,EC6FlxgB,MAAMiW,EAAIxa,EAqHJD,EAAK,SAkBX,SAASwb,EAAqC,CAC5C,GAAAzP,EACA,KAAAjQ,EACA,UAAAiI,EACA,OAAA8H,EACA,UAAA4P,EACA,SAAAC,EACA,YAAAC,EACA,kBAAAC,EACA,QAAAC,EACA,SAAAC,EACA,SAAAlB,EACA,OAAAmB,EACA,aAAAC,EACA,UAAAC,EACA,iBAAAC,EACA,eAAAC,EACA,yBAAApL,EACA,uBAAAC,EACA,WAAAoL,EACA,YAAAC,EACA,cAAAjc,EACA,aAAAqW,EACA,cAAA8D,CACF,EAAY,CACJ,MAAA+B,EAAM,SAAS,eAAevQ,CAAE,EAClC,CAACuQ,IACL,KAAK,cAAgBA,EAChB,KAAA,OAASP,GAAU,GACxB,KAAK,SAAWjgB,EAAK,SAChB,KAAA,SAAWA,EAAK,UAAY,CAAA,EACjC,KAAK,WAAWA,GAAA,YAAAA,EAAM,WACtB,KAAK,OAAS+P,EACd,KAAK,kBAAoB+P,EACpB,KAAA,YAAcD,IAAgB,OAAY,GAAOA,EACjD,KAAA,QAAUE,IAAY,OAAY,GAAOA,EACzC,KAAA,SAAWC,IAAa,OAAY,GAAOA,EAC3C,KAAA,SAAWlB,IAAa,OAAY,GAAOA,EAC3C,KAAA,YAAcyB,IAAgB,OAAY,GAAQA,EAClD,KAAA,cAAgBjc,IAAkB,OAAY,GAAOA,EAC1D,KAAK,WAAagc,EAGb,KAAA,UAAYtgB,EAAK,YAAY,OAAUA,EAAK,UAAW,OAAOiI,GAAc,SAAWA,EAAY,EACnG,KAAA,UAAY0X,IAAc,OAAY,GAAOA,EAClD,KAAK,aAAeO,EACf,KAAA,SAAWN,IAAa,OAAY,GAAOA,EAC3C,KAAA,UAAYO,IAAc,OAAY,GAAOA,EAElD,KAAK,YAAc,KACnB,KAAK,YAAc,KACnB,KAAK,SAAW,KAChB,KAAK,SAAW,EAChB,KAAK,cAAgB,KACrB,KAAK,iBAAmBC,GAAoB,EAC5C,KAAK,eAAiBC,EACtB,KAAK,yBAA2BpL,EAChC,KAAK,uBAAyBC,EACzB,KAAA,aAAeyF,IAAiB,OAAY,GAAOA,EACnD,KAAA,cAAgB8D,IAAkB,OAAY,GAAOA,EAErD,KAAA,IAAM,IAAIS,GACb,KAAK,IAAY,YAAY,YAAcuB,GAAyB,CACpE,GAAI,KAAK,OAAQ,CACf,KAAK,OAAS,GACd,MACF,CACI,CAAC,WAAY,aAAc,WAAY,aAAc,YAAa,WAAY,WAAW,EAAE,SAC7FA,EAAU,IAAA,GAEL,KAAA,QAAQ,KAAKA,CAAS,CAE7B,CACD,EAED,KAAK,QAAU,GACf,KAAK,OAAS,GACd,KAAK,KAAO,UAAW,CACf,MAAAA,EAAY,KAAK,QAAQ,IAAI,EAC/B,CAACA,IACL,KAAK,OAAS,GACVA,EAAU,OAAS,WAChB,KAAA,SACH9B,EAAE8B,EAAU,IAAI,QAAQ,EAAE,EAC1B9B,EAAE8B,EAAU,IAAI,cAAc,CAAA,EAEvBA,EAAU,OAAS,aACxBA,EAAU,gBACZ,KAAK,aAAa9B,EAAE8B,EAAU,eAAe,EAAGA,EAAU,GAAG,EAE7D,KAAK,SAAS9B,EAAE8B,EAAU,cAAc,EAAGA,EAAU,GAAG,EAEjDA,EAAU,OAAS,YAAcA,EAAU,OAAS,WAC7D,KAAK,WAAW9B,EAAE8B,EAAU,IAAI,EAAE,CAAC,EAC1BA,EAAU,OAAS,aAC5B,KAAK,aAAa9B,EAAE8B,EAAU,IAAI,EAAE,EAAGA,EAAU,MAAM,EAEvD,KAAK,OAAS,GAChB,EAEJ,CAEA,SAASC,EAAWlgB,EAA8B,CAChD,OAAO,kBAAkBI,EAAgB,EAErC,CAAC,KAAK,OAAOJ,EAAG,OACf,MAAM,KAAK,OAAOA,EAAG,MAAM,MAAM,KAAMI,CAAI,IAEzCJ,EAAA,MAAM,KAAMI,CAAI,CACrB,CAEJ,CAEA,OAAA8e,EAAW,UAAY,CACrB,cAAAvf,EACA,WAAAL,GACA,eAAAqC,GACA,sBAAAC,GAEA,cAAese,EAAWzP,EAAa,EACvC,aAAcyP,EAAWvP,EAAY,EACrC,aAAcuP,EAAWtP,EAAY,EACrC,WAAWsP,EAAW9O,EAAU,EAChC,SAAU8O,EAAW1O,EAAQ,EAC7B,SAAU0O,EAAWzO,EAAQ,EAC7B,SAAUyO,EAAW/N,EAAQ,EAC7B,WAAY+N,EAAWrO,EAAU,EACjC,WAAYqO,EAAWvO,EAAU,EACjC,aAAcuO,EAAWtO,EAAY,EACrC,UAAWsO,EAAWpN,EAAS,EAC/B,eAAgBoN,EAAWxN,EAAc,EACzC,cAAewN,EAAWrN,EAAa,EACvC,gBAAAhD,GACA,eAAAG,GACA,gBAAAE,GACA,oBAAAC,GACA,iBAAAI,GAEA,mBAAAyC,GACA,aAAAD,GAEA,WAAAI,GACA,WAAAe,GACA,WAAAE,GACA,mBAAAC,GACA,mBAAAC,GAEA,OAAA1M,GACA,QAAA4M,GACA,eAAA5N,GACA,SAAApC,EACA,eAAAgD,GAAgB,YAAA5B,GAAa,UAAAS,GAAW,YAAAC,GAAY,cAAAH,GAEpD,WAAAuG,GACA,aAAAI,GACA,kBAAAC,GACA,kBAAAI,GACA,iBAAAC,GACA,aAAAC,GACA,iBAAAC,GACA,WAAAE,GACA,uBAAAK,GACA,aAAAE,GACA,MAAAK,GACA,SAAAU,GACA,UAAAC,GACA,UAAAC,GACA,YAAAE,GACA,SAAAC,GACA,UAAAC,GACA,SAAAC,GACA,UAAAC,GACA,WAAApB,GACA,YAAAC,GACA,WAAAqB,GACA,QAAAI,GACA,UAAAxD,GACA,aAAAG,GACA,KAAM,SAASmB,EAAkBI,EAAoB,CAUhDJ,IAAU,KAAK,SAASA,GACxBI,IAAW,KAAK,WAAWA,GAC9BnO,EAAc,KAAK,QAAQ,EACnB,QAAA,IAAI,cAAgBuf,EAAW,OAAO,EAC9C,QAAQ,IAAI,IAAI,EACb,KAAK,cAAc,UAAU,QAAQ,aAAa,IAAI,KACvD,KAAK,cAAc,WAAa,gBAClC,KAAK,cAAc,UAAY,GAE1B,KAAA,UAAYxb,EAAG,cAAc,KAAK,EACvC,KAAK,UAAU,UAAY,gBAEvB,KAAK,iBAAqB,KAAA,UAAU,MAAM,SAAW,UAEpD,KAAA,IAAMA,EAAG,cAAc,KAAK,EACjC,KAAK,IAAI,UAAY,aAChB,KAAA,IAAI,aAAa,WAAY,GAAG,EAChC,KAAA,UAAU,YAAY,KAAK,GAAG,EAC9B,KAAA,cAAc,YAAY,KAAK,SAAS,EACxC,KAAA,KAAOA,EAAG,cAAc,MAAM,EAE9B,KAAA,IAAMA,EAAG,cAAc,UAAU,EACtC,KAAK,IAAI,UAAY,UAIhB,KAAA,OAAS0E,EAAc,QAAQ,EAE/B,KAAA,eAAiBA,EAAc,gBAAgB,EAC/C,KAAA,GAAK1E,EAAG,cAAc,KAAK,EAC3B,KAAA,GAAKA,EAAG,cAAc,KAAK,EAChC,KAAK,GAAG,UAAY,KAAK,GAAG,UAAY,SACxC,KAAK,MAAQ8E,GAAW,EAAG,EAAG,EAAG,CAAC,EAClC,KAAK,MAAQA,GAAW,EAAG,EAAG,EAAG,CAAC,EAC7B,KAAA,eAAe,YAAY,KAAK,KAAK,EACrC,KAAA,eAAe,YAAY,KAAK,KAAK,EAErC,KAAA,aAAeJ,EAAc,YAAY,EAEzC,KAAA,IAAI,YAAY,KAAK,IAAI,EACzB,KAAA,IAAI,YAAY,KAAK,GAAG,EACxB,KAAA,IAAI,YAAY,KAAK,MAAM,EAC3B,KAAA,IAAI,YAAY,KAAK,cAAc,EACnC,KAAA,IAAI,YAAY,KAAK,YAAY,EACjC,KAAA,IAAI,YAAY,KAAK,EAAE,EACvB,KAAA,IAAI,YAAY,KAAK,EAAE,EAGvB,KAAA,SAAWmX,GAAQ,IAAI,EACvB,KAAA,UAAYC,GAAS,IAAI,EACzB,KAAA,UAAYlB,GAAS,IAAI,EAC9BnF,GAAQ,IAAI,EACRpa,GAAA,GAAc,KAAK,WACrB+gB,GAAW,IAAI,EAEf,KAAK,aAAeT,GAAY,KAAM,KAAK,iBAAiB,EAEzD,KAAA,WAAapB,GAAc,IAAI,EAGpCxQ,GAAS,KAAK,SAAS,EAAE,KAAK,YAAY,CAAC,EAC3C,KAAK,OAAO,EACZ,KAAK,QAAQ,EACb,KAAK,UAAU,EAEf2J,GAAe,IAAI,CACrB,CACF,EAEA8H,EAAW,KAAO,EAClBA,EAAW,MAAQ,EACnBA,EAAW,KAAO,EAKlBA,EAAW,QAAU,SACrBA,EAAW,EAAIvb,EAQfub,EAAW,IAAO3Y,IAAmC,CACnD,SAAU,CACR,GAAIzG,EAAa,EACjB,MAAOyG,GAAS,YAChB,KAAM,GACN,MAAO,CACL,MAAO,UACP,WAAY,SACd,EACA,SAAU,CAAC,CACb,EACA,SAAU,CAAC,CACb"}