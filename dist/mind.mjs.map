{"version":3,"file":"mind.mjs","sources":["../src/utils/index.ts","../src/utils/dom.ts","../src/const.ts","../src/utils/svg.ts","../painter/index.foreignObject.js","../src/interact.ts","../src/nodeOperation.ts","../src/customLink.ts","../src/linkDiv.ts","../src/mouse.ts","../src/i18n.ts","../src/plugin/contextMenu.ts","../src/plugin/sidebar.ts","../src/plugin/toolBar.ts","../src/plugin/nodeMenu.ts","../src/plugin/nodeDraggable.ts","../src/plugin/keypress.ts","../src/plugin/mobileMenu.ts","../src/utils/pubsub.ts","../src/iconfont/iconfont.js","../src/index.ts"],"sourcesContent":["import { NodeObj } from '../index'\n\nexport function encodeHTML(s) {\n  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/\"/g, '&quot;')\n}\n\nexport const isMobile = (): boolean =>\n  /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n    navigator.userAgent\n  )\n\nexport const rgbHex = (rgb) => {\n  return rgb.replace(\n    /\\brgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/g,\n    function($0, $1, $2, $3) {\n      return '#' + ('0' + Number($1).toString(16)).substr(-2) + ('0' + Number($2).toString(16)).substr(-2) + ('0' + Number($3).toString(16)).substr(-2)\n    })\n}\n\nexport const getObjById = function(id: string, data: NodeObj) {\n  data = data || this.nodeData\n  if (data.id === id) {\n    return data\n  } else if (data.children && data.children.length) {\n    for (let i = 0; i < data.children.length; i++) {\n      const res = getObjById(id, data.children[i])\n      if (res) return res\n    }\n  } else {\n    return null\n  }\n}\n\nexport const addParentLink = (data: NodeObj, parent?: NodeObj) => {\n  data.parent = parent\n  if (data.children) {\n    for (let i = 0; i < data.children.length; i++) {\n      addParentLink(data.children[i], data)\n    }\n  }\n}\n\nexport function refreshIds(data: NodeObj) {\n  data.id = generateUUID()\n  if (data.children) {\n    for (let i = 0; i < data.children.length; i++) {\n      refreshIds(data.children[i])\n    }\n  }\n}\n\nexport const throttle = (fn: (any) => void, wait: number) => {\n  var pre = Date.now()\n  return function() {\n    var context = this\n    var args = arguments\n    var now = Date.now()\n    if (now - pre >= wait) {\n      fn.apply(context, args)\n      pre = Date.now()\n    }\n  }\n}\n\nexport function getArrowPoints(p3x: number, p3y: number, p4x: number, p4y: number) {\n  const deltay = p4y - p3y\n  const deltax = p3x - p4x\n  let angle = (Math.atan(Math.abs(deltay) / Math.abs(deltax)) / 3.14) * 180\n  if (deltax < 0 && deltay > 0) {\n    angle = 180 - angle\n  }\n  if (deltax < 0 && deltay < 0) {\n    angle = 180 + angle\n  }\n  if (deltax > 0 && deltay < 0) {\n    angle = 360 - angle\n  }\n  const arrowLength = 20\n  const arrowAngle = 30\n  var a1 = angle + arrowAngle\n  const a2 = angle - arrowAngle\n  return {\n    x1: p4x + Math.cos((Math.PI * a1) / 180) * arrowLength,\n    y1: p4y - Math.sin((Math.PI * a1) / 180) * arrowLength,\n    x2: p4x + Math.cos((Math.PI * a2) / 180) * arrowLength,\n    y2: p4y - Math.sin((Math.PI * a2) / 180) * arrowLength,\n  }\n}\n\nexport function calcP1(fromData, p2x, p2y) {\n  let x, y\n  const k = (fromData.cy - p2y) / (p2x - fromData.cx)\n  if (k > fromData.h / fromData.w || k < -fromData.h / fromData.w) {\n    if (fromData.cy - p2y < 0) {\n      x = fromData.cx - fromData.h / 2 / k\n      y = fromData.cy + fromData.h / 2\n    } else {\n      x = fromData.cx + fromData.h / 2 / k\n      y = fromData.cy - fromData.h / 2\n    }\n  } else {\n    // console.log('斜率', k)\n    // console.log('fromData.cx-x', fromData.cx - p2x)\n    if (fromData.cx - p2x < 0) {\n      x = fromData.cx + fromData.w / 2\n      y = fromData.cy - (fromData.w * k) / 2\n    } else {\n      x = fromData.cx - fromData.w / 2\n      y = fromData.cy + (fromData.w * k) / 2\n    }\n  }\n  return {\n    x,\n    y,\n  }\n}\n\nexport function calcP4(toData, p3x, p3y) {\n  let x, y\n  const k = (toData.cy - p3y) / (p3x - toData.cx)\n  if (k > toData.h / toData.w || k < -toData.h / toData.w) {\n    if (toData.cy - p3y < 0) {\n      x = toData.cx - toData.h / 2 / k\n      y = toData.cy + toData.h / 2\n    } else {\n      x = toData.cx + toData.h / 2 / k\n      y = toData.cy - toData.h / 2\n    }\n  } else {\n    // console.log('斜率', k)\n    // console.log('toData.cx-x', toData.cx - p3x)\n    if (toData.cx - p3x < 0) {\n      x = toData.cx + toData.w / 2\n      y = toData.cy - (toData.w * k) / 2\n    } else {\n      x = toData.cx - toData.w / 2\n      y = toData.cy + (toData.w * k) / 2\n    }\n  }\n  return {\n    x,\n    y,\n  }\n}\n\nexport function generateUUID(): string {\n  return (\n    new Date().getTime().toString(16) + Math.random().toString(16).substr(2)\n  ).substr(2, 16)\n}\n\nexport function generateNewObj(): NodeObj {\n  const id = generateUUID()\n  return {\n    topic: this.newTopicName || 'new node',\n    id,\n  }\n}\n\nexport function generateNewSummaryObj(): NodeObj {\n  const id = generateUUID()\n  return {\n    topic: this.newTopicName || 'new node',\n    id,\n    type:'summary',\n    summary:{\n      topicId:id,\n      range:this.currentSummaryNodeArr.map(val=>val.nodeObj.id)\n    }\n  }\n}\n\nexport function generateNewLink(from, to) {\n  const id = generateUUID()\n  return {\n    id,\n    name: '',\n    from,\n    to,\n    delta1: { x: 0, y: -100 },\n    delta2: { x: 0, y: -100 },\n  }\n}\n\nexport function checkMoveValid(from: NodeObj, to: NodeObj) {\n  let valid = true\n  while (to.parent) {\n    if (to.parent === from) {\n      valid = false\n      break\n    }\n    to = to.parent\n  }\n  return valid\n}\n\nexport function getObjSibling(obj: NodeObj): NodeObj {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  if (index + 1 >= childrenList.length) {\n    // 最后一个\n    return null\n  } else {\n    return childrenList[index + 1]\n  }\n}\n\nexport function moveUpObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  const t = childrenList[index]\n  if (index === 0) {\n    childrenList[index] = childrenList[childrenList.length - 1]\n    childrenList[childrenList.length - 1] = t\n  } else {\n    childrenList[index] = childrenList[index - 1]\n    childrenList[index - 1] = t\n  }\n}\n\nexport function moveDownObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  const t = childrenList[index]\n  if (index === childrenList.length - 1) {\n    childrenList[index] = childrenList[0]\n    childrenList[0] = t\n  } else {\n    childrenList[index] = childrenList[index + 1]\n    childrenList[index + 1] = t\n  }\n}\n\nexport function removeNodeObj(obj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index, 1)\n  return childrenList.length\n}\n\nexport function insertNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index + 1, 0, newObj)\n}\n\nexport function insertBeforeNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList.splice(index, 0, newObj)\n}\n\nexport function insertParentNodeObj(obj: NodeObj, newObj: NodeObj) {\n  const childrenList = obj.parent.children\n  const index = childrenList.indexOf(obj)\n  childrenList[index] = newObj\n  newObj.children = [obj]\n}\n\nexport function moveNodeObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  if (to.children) to.children.push(from)\n  else to.children = [from]\n}\n\nexport function moveNodeBeforeObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  const childrenList = to.parent.children\n  let toIndex = 0\n  for (let i = 0; i < childrenList.length; i++) {\n    if (childrenList[i] === to) {\n      toIndex = i\n      break\n    }\n  }\n  childrenList.splice(toIndex, 0, from)\n}\n\nexport function moveNodeAfterObj(from: NodeObj, to: NodeObj) {\n  removeNodeObj(from)\n  const childrenList = to.parent.children\n  let toIndex = 0\n  for (let i = 0; i < childrenList.length; i++) {\n    if (childrenList[i] === to) {\n      toIndex = i\n      break\n    }\n  }\n  childrenList.splice(toIndex + 1, 0, from)\n}\n\nexport const dragMoveHelper = {\n  afterMoving: false, // 区别click事件\n  mousedown: false,\n  lastX: null,\n  lastY: null,\n  onMove(e, container) {\n    if (this.mousedown) {\n      this.afterMoving = true\n      if (!this.lastX) {\n        this.lastX = e.pageX\n        this.lastY = e.pageY\n        return\n      }\n      const deltaX = this.lastX - e.pageX\n      const deltaY = this.lastY - e.pageY\n      container.scrollTo(\n        container.scrollLeft + deltaX,\n        container.scrollTop + deltaY\n      )\n      this.lastX = e.pageX\n      this.lastY = e.pageY\n    }\n  },\n  clear() {\n    this.afterMoving = false\n    this.mousedown = false\n    this.lastX = null\n    this.lastY = null\n  },\n}\n\nexport function LinkDragMoveHelper(dom) {\n  this.dom = dom\n  this.mousedown = false\n  this.lastX = null\n  this.lastY = null\n}\n\nLinkDragMoveHelper.prototype.init = function(map, cb) {\n  this.handleMouseMove = e => {\n    e.stopPropagation()\n    if (this.mousedown) {\n      if (!this.lastX) {\n        this.lastX = e.pageX\n        this.lastY = e.pageY\n        return\n      }\n      const deltaX = this.lastX - e.pageX\n      const deltaY = this.lastY - e.pageY\n      cb(deltaX, deltaY)\n      this.lastX = e.pageX\n      this.lastY = e.pageY\n    }\n  }\n  this.handleMouseDown = e => {\n    e.stopPropagation()\n    this.mousedown = true\n  }\n  this.handleClear = e => {\n    e.stopPropagation()\n    this.clear()\n  }\n  map.addEventListener('mousemove', this.handleMouseMove)\n  map.addEventListener('mouseleave', this.handleClear)\n  map.addEventListener('mouseup', this.handleClear)\n  this.dom.addEventListener('mousedown', this.handleMouseDown)\n}\n\nLinkDragMoveHelper.prototype.destory = function(map) {\n  map.removeEventListener('mousemove', this.handleMouseMove)\n  map.removeEventListener('mouseleave', this.handleClear)\n  map.removeEventListener('mouseup', this.handleClear)\n  this.dom.removeEventListener('mousedown', this.handleMouseDown)\n}\n\nLinkDragMoveHelper.prototype.clear = function() {\n  this.mousedown = false\n  this.lastX = null\n  this.lastY = null\n}\n","import { node } from 'canvg/dist/presets'\nimport { LEFT, RIGHT, SIDE } from '../const'\nimport MindElixir, { NodeObj } from '../index'\nimport { expandNodeChild, getHeightFromRootToAnotherNode, getWidthFromRootToAnotherNode } from '../interact'\nimport { addChild } from '../nodeOperation'\nimport { encodeHTML, getArrowPoints } from '../utils/index'\nexport type Top = HTMLElement\nexport type Group = HTMLElement\n\nexport interface Topic extends HTMLElement {\n  nodeObj?: NodeObj\n}\n\nexport interface Expander extends HTMLElement {\n  expanded?: boolean\n}\n\n// DOM manipulation\nconst $d = document\nexport const findEle = (id: string, instance?) => {\n  const scope = instance ? instance.mindElixirBox : $d\n  return scope.querySelector(`[data-nodeid=me${id}]`)\n}\n\nfunction resizeNode(widthControll:HTMLElement,tpc:Topic,anotherWidthControll:HTMLElement){\n  widthControll.onpointerdown=eDown=>{\n    if(!tpc.classList.contains('selected')) return\n    const startX=eDown.clientX\n    const width=tpc.clientWidth-Number(getComputedStyle(tpc).paddingLeft.replace('px',''))-Number(getComputedStyle(tpc).paddingRight.replace('px',''))\n    widthControll.onpointermove=eMove=>{\n      const endX=eMove.clientX\n      tpc.style.width=(width+endX-startX).toString()+'px'\n      widthControll.style.height=anotherWidthControll.style.height=tpc.clientHeight.toString()+'px'\n      //保存样式\n      if(!tpc.nodeObj.style) tpc.nodeObj.style={}\n      tpc.nodeObj.style.width=tpc.style.width\n      //设置宽度控制条的高度\n      tpc.nodeObj.style.controllWidth=widthControll.style.height\n      //更新图片的宽度和高度 \n      eMove.preventDefault()\n    }\n    widthControll.setPointerCapture(eDown.pointerId)\n    eDown.preventDefault()\n  }\n  widthControll.onpointerup=eUp=>{\n    widthControll.onpointermove=null\n    widthControll.releasePointerCapture(eUp.pointerId)\n    this?.linkDiv?.()\n  }\n}\nexport const shapeTpc = function(tpc: Topic, nodeObj: NodeObj) {\n  \n  const widthControllRight=$d.createElement('widthControllRight')\n  const widthControllLeft=$d.createElement('widthControllLeft')\n\n  tpc.textContent = nodeObj.topic\n  //放在textContent之后，因为会清除子节点\n  if(this?.widthControll){\n    resizeNode.call(this,widthControllLeft,tpc,widthControllRight)\n    resizeNode.call(this,widthControllRight,tpc,widthControllLeft)\n    tpc.appendChild(widthControllRight)\n    tpc.appendChild(widthControllLeft)\n  }\n  \n  if (nodeObj.style) {\n    tpc.style.color = nodeObj.style.color || '#2c3e50'\n    tpc.style.background = nodeObj.style.background?nodeObj.style.background:nodeObj?.parent?.root?'#ffffff':'inherit'\n    if(/[a-z]/i.test(nodeObj.style.fontSize))\n      tpc.style.fontSize = nodeObj.style.fontSize\n    else\n      tpc.style.fontSize = nodeObj.style.fontSize + 'px'\n    tpc.style.fontWeight = nodeObj.style.fontWeight || 'normal'\n    tpc.style.width= nodeObj.style.width || 'fit-content'\n    widthControllLeft.style.height=widthControllRight.style.height=nodeObj.style.controllWidth || '29px'\n  }\n\n  // TODO allow to add online image\n  if (nodeObj.image) {\n    const images=nodeObj.image\n    images.forEach(val=>{\n      const imgContainer = $d.createElement('img')\n      imgContainer.className='image'\n      imgContainer.src = val.url\n      imgContainer.style.width = val.width + 'px'\n      imgContainer.style.height = val.height + 'px'\n      imgContainer.style.display = 'block'\n      tpc.appendChild(imgContainer)\n    })\n  }\n  \n  if (nodeObj.hyperLink) {\n    const linkContainer =$d.createElement('a')\n    linkContainer.className = 'hyper-link'\n    linkContainer.target = '_blank'\n    // linkContainer.innerText = '🔗'\n    linkContainer.innerHTML='<svg t=\"1662346495524\" style=\"font-size:20px;margin-left: 3px\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2372\" width=\"22\" height=\"22\"><path d=\"M573.44 640a187.68 187.68 0 0 1-132.8-55.36L416 560l45.28-45.28 24.64 24.64a124.32 124.32 0 0 0 170.08 5.76l1.44-1.28a49.44 49.44 0 0 0 4-3.84l101.28-101.28a124.16 124.16 0 0 0 0-176l-1.92-1.92a124.16 124.16 0 0 0-176 0l-51.68 51.68a49.44 49.44 0 0 0-3.84 4l-20 24.96-49.92-40L480 276.32a108.16 108.16 0 0 1 8.64-9.28l51.68-51.68a188.16 188.16 0 0 1 266.72 0l1.92 1.92a188.16 188.16 0 0 1 0 266.72l-101.28 101.28a112 112 0 0 1-8.48 7.84 190.24 190.24 0 0 1-125.28 48z\" fill=\"#002fa7\" p-id=\"2373\"></path><path d=\"M350.72 864a187.36 187.36 0 0 1-133.28-55.36l-1.92-1.92a188.16 188.16 0 0 1 0-266.72l101.28-101.28a112 112 0 0 1 8.48-7.84 188.32 188.32 0 0 1 258.08 7.84L608 464l-45.28 45.28-24.64-24.64A124.32 124.32 0 0 0 368 478.88l-1.44 1.28a49.44 49.44 0 0 0-4 3.84l-101.28 101.28a124.16 124.16 0 0 0 0 176l1.92 1.92a124.16 124.16 0 0 0 176 0l51.68-51.68a49.44 49.44 0 0 0 3.84-4l20-24.96 50.08 40-20.8 25.12a108.16 108.16 0 0 1-8.64 9.28l-51.68 51.68A187.36 187.36 0 0 1 350.72 864z\" fill=\"#002fa7\" p-id=\"2374\"></path></svg>'\n    linkContainer.href = nodeObj.hyperLink\n    tpc.appendChild(linkContainer)\n  }\n  if (nodeObj.remark) {\n    const content=$d.createElement('div')\n    content.className='content hidden'\n    content.textContent=nodeObj.remark\n    const remarkContainer = $d.createElement('div')\n    remarkContainer.className = 'remark'\n    remarkContainer.innerHTML = `<svg t=\"1659682144612\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2580\" width=\"200\" height=\"200\"><path d=\"M625.728 57.472c19.264 0 34.688 6.848 48.128 20.16l208.96 207.04c14.272 13.12 21.568 29.568 21.568 49.28v504.576c0 71.808-56.256 127.744-128.576 127.744H252.16c-72.128 0-128.576-55.68-128.576-127.744V184.704c0-71.68 56.256-127.232 128.576-127.232z m-34.304 76.8H252.16c-30.144 0-51.776 21.376-51.776 50.432v653.824c0 29.44 21.888 50.944 51.776 50.944h523.648c30.016 0 51.84-21.632 51.84-50.944l-0.128-464.512H687.488A96 96 0 0 1 591.936 287.36l-0.448-9.216V134.208zM665.6 704a38.4 38.4 0 0 1 0 76.8H294.4a38.4 38.4 0 0 1 0-76.8h371.2z m0-192a38.4 38.4 0 0 1 0 76.8H294.4a38.4 38.4 0 0 1 0-76.8h371.2z m-192-192a38.4 38.4 0 1 1 0 76.8H294.4a38.4 38.4 0 1 1 0-76.8h179.2z m181.824-152.512v110.592a32 32 0 0 0 26.24 31.488l5.76 0.512h111.872L655.424 167.424z\" p-id=\"2581\"></path></svg>`\n    let delayTask\n    // 鼠标移入内容\n    content.onmouseover=()=>{\n      clearTimeout(delayTask)\n    }\n    //鼠标移入按钮\n    remarkContainer.onmouseover=()=>{\n      content.classList.remove('hidden')\n    }\n    //鼠标移出内容\n    content.onmouseleave=()=>{\n      delayTask=setTimeout(()=>{\n        if(!content.classList.contains('hidden')){\n          content.classList.add('hidden')\n        }\n      },300)\n    }\n    //鼠标移出按钮\n    remarkContainer.onmouseleave=()=>{\n      delayTask=setTimeout(()=>{\n        if(!content.classList.contains('hidden')){\n          content.classList.add('hidden')\n        }\n      },300)\n    }\n    remarkContainer.appendChild(content)\n    tpc.appendChild(remarkContainer)\n  }\n  if (nodeObj.icons) {\n    const iconsContainer = $d.createElement('span')\n    iconsContainer.className = 'icons'\n    iconsContainer.innerHTML = nodeObj.icons\n    .filter(icon=> icon!=='').map(icon => `<span>${encodeHTML(icon)}</span>`)\n      .join('')\n    tpc.appendChild(iconsContainer)\n  }\n\n  if (nodeObj.linkJump) {\n    nodeObj.linkJump.forEach(val => {\n      const button = document.createElement('a')\n      button.className=\"linkJump\"\n      button.title=val.title\n      button.innerHTML='<svg t=\"1661493526135\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2220\" width=\"16\" height=\"16\"><path d=\"M1001.175714 593.762001L700.806246 293.324796a76.091491 76.091491 0 0 0-107.566725 0 76.023754 76.023754 0 0 0 0 107.544146l171.713884 171.826779H152.653982v-115.288769a76.046333 76.046333 0 0 0-152.115245 0v152.092666c0 6.931777 2.145012 13.253918 3.951338 19.621218-1.806326 6.389879-3.951339 12.644283-3.951338 19.621218a76.068912 76.068912 0 0 0 76.046333 76.068912h686.020111L593.239521 894.131468a76.046333 76.046333 0 1 0 107.566725 107.566726L1001.175714 701.328726a76.091491 76.091491 0 0 0 0-107.566725z\" fill=\"#1296db\" p-id=\"2221\"></path></svg>'\n      button.onclick=()=>{  \n        moveToNode.call(this,val.toId)\n      }\n      tpc.appendChild(button)\n    });\n  }\n  if (nodeObj.tags) {\n    const tagsContainer = $d.createElement('div')\n    tagsContainer.className = 'tags'\n    tagsContainer.innerHTML = nodeObj.tags\n      .filter(tag=> tag!=='').map(tag => `<span>${encodeHTML(tag)}</span>`)\n      .join('')\n    tpc.appendChild(tagsContainer)\n  }\n}\n\nexport function moveToNode(id:string){\n  let toNode=this.container.querySelector(`tpc[data-nodeid=me${id}]`)\n  if(!toNode){\n    findUnExpandedParent(this.nodeData,id)\n    this.layout()\n    this.linkDiv()\n    toNode=this.container.querySelector(`tpc[data-nodeid=me${id}]`)\n  }\n  // this.container.scrollTo(\n  //   10000 - this.container.offsetWidth / 2 + getWidthFromRootToAnotherNode(this.container,toNode),\n  //   10000 - this.container.offsetHeight / 2 - getHeightFromRootToAnotherNode(this.container,toNode)\n  // )\n  toNode.scrollIntoView({block:'center',behavior:'smooth'})\n  toNode.className='blink'\n  setTimeout(() => {\n    toNode.classList.remove('blink')\n  }, 3000);\n}\n\nfunction findUnExpandedParent(node,toId){\n  if(node.id===toId){\n    return true\n  }\n  let flag=false\n  for(const val of (node.children||[])){\n    if(findUnExpandedParent(val,toId)) flag=true\n  }\n  if(flag) node.expanded=true\n  return flag\n}\n\nexport const createGroup = function(nodeObj: NodeObj, omitChildren?: boolean) {\n  const grp: Group = $d.createElement('GRP')\n  const top: Top = this.createTop(nodeObj)\n  grp.appendChild(top)\n  if (!omitChildren && nodeObj.children && nodeObj.children.length > 0) {\n    top.appendChild(createExpander(nodeObj.expanded))\n    if (nodeObj.expanded !== false) {\n      const [children,smyChild] = this.createChildren(nodeObj.children)\n      grp.appendChild(children)\n      // if(smyChild){\n      //   smyChild.forEach(val => {\n      //     grp.appendChild(val)\n      //   });\n      // }\n    }\n  }\n  return { grp, top }\n}\n\nexport const createSummary = function(nodeObj: NodeObj, omitChildren?: boolean) {\n  const smy:HTMLElement = $d.createElement('SMY')\n  const top: Top = this.createTop(nodeObj)\n  smy.appendChild(top)\n  if (!omitChildren && nodeObj.children && nodeObj.children.length > 0) {\n    top.appendChild(createExpander(nodeObj.expanded))\n    if (nodeObj.expanded !== false) {\n      const [children,smyChild] = this.createChildren(nodeObj.children)\n      // if(smyChild){\n      //   smyChild.forEach(val => {\n      //     smy.appendChild(val)\n      //   });\n      // }\n    }\n  }\n  return { smy, top }\n}\n\nexport const createTop = function(nodeObj: NodeObj): Top {\n  const top = $d.createElement('t')\n  const tpc = this.createTopic(nodeObj)\n  shapeTpc.call(this,tpc, nodeObj)\n  top.appendChild(tpc)\n  return top\n}\n\nexport const createTopic = function(nodeObj: NodeObj): Topic {\n  const topic: Topic = $d.createElement('tpc')\n  topic.nodeObj = nodeObj\n  topic.dataset.nodeid = 'me' + nodeObj.id\n  topic.draggable = this.draggable\n  return topic\n}\n\nexport function selectText(div: HTMLElement) {\n  const range = $d.createRange()\n  range.selectNodeContents(div)\n  const getSelection = window.getSelection()\n  if (getSelection) {\n    getSelection.removeAllRanges()\n    getSelection.addRange(range)\n  }\n}\n\n\nexport function createInputDiv(tpc: Topic) {\n  console.time('createInputDiv')\n  if (!tpc) return\n  let div = $d.createElement('div')\n  const origin = tpc.childNodes[0].textContent as string\n  tpc.appendChild(div)\n  div.id = 'input-box'\n  // div.innerHTML=origin.replace(/<div(([\\s\\S])*?)<\\/div>/, '').replace('🔗','')\n  div.contentEditable = 'true'\n  div.spellcheck = false\n  div.textContent = origin\n  if(tpc.nodeObj.image){\n    const images=tpc.nodeObj.image\n    images.forEach(val=>{\n      const imgContainer = $d.createElement('img')\n      imgContainer.src = val.url\n      imgContainer.style.width = val.width + 'px'\n      imgContainer.style.display = 'block'\n      div.appendChild(imgContainer)\n    })\n  }\n  div.style.cssText = `min-width:${tpc.offsetWidth - 22}px;min-height:${tpc.clientHeight-16}px`\n  if(tpc.nodeObj?.style?.width){\n    div.style.width='auto'\n  }\n  if(tpc.nodeObj?.style?.color==='#ffffff'||(tpc.nodeObj?.id==='root'&&!tpc.nodeObj?.style?.color)){\n    div.style.color='#2c3e50'\n  }\n  if (this.direction === LEFT) div.style.right = '0'\n  div.focus()\n  selectText(div)\n  this.inputDiv = div\n\n  this.bus.fire('operation', {\n    name: 'beginEdit',\n    obj: tpc.nodeObj,\n  })\n\n  div.addEventListener('keydown', e => {\n    e.stopPropagation()\n    const key = e.key\n    // console.log(e, key)\n    if (key === 'Enter' || key === 'Tab') {\n      // keep wrap for shift enter\n      if (e.shiftKey) return\n\n      e.preventDefault()\n      this.inputDiv.blur()\n      this.map.focus()\n    }\n  })\n  div.addEventListener('blur', () => {\n    if (!div) return // 防止重复blur\n    const node = tpc.nodeObj\n    const topic = div.textContent!.trim()\n    //添加图片支持\n    //去除节点缩放鼠标移动的监听\n    node.image=[]\n    div.childNodes.forEach((val)=>{\n      if(val.nodeName==='IMG'){\n          // console.log('宽度  ',div.clientWidth)\n          node.image.push({\n            url:(val as HTMLImageElement).src,\n            width:(val as HTMLImageElement).width,\n            height:(val as HTMLImageElement).height,\n          })\n      }\n    })\n    if (topic === '' && node.image.length===0) node.topic = origin\n    else node.topic = topic\n    div.remove()\n    this.inputDiv = div = null\n    // TODO 优化\n    if (topic === origin && node.image.length===0) return // 没有修改不做处理\n    tpc.childNodes[0].textContent = node.topic\n    //更新宽度控制条的高度\n    const widthControllLeft=tpc.querySelector('widthControllRight') as HTMLElement\n    const widthControllRight=tpc.querySelector('widthControllRight') as HTMLElement\n    if(!node.style) node.style={}\n    node.style.controllWidth=widthControllLeft.style.height=widthControllRight.style.height=tpc.clientHeight.toString()+'px'\n    //记录节点宽度\n    // node.style.width=tpc.clientWidth-Number(getComputedStyle(tpc).paddingLeft.replace('px',''))-Number(getComputedStyle(tpc).paddingRight.replace('px',''))+1+'px'\n    delete node.style.width\n\n    this.shapeTpc(tpc,node)\n    this.linkDiv()\n    //时间分片，待优化\n    updateLinkJumpTitle.call(this,this.nodeData,node.id,node.topic)\n    this.bus.fire('operation', {\n      name: 'finishEdit',\n      obj: node,\n      origin,\n    })\n  })\n  console.timeEnd('createInputDiv')\n}\n\n\nfunction updateLinkJumpTitle(node:NodeObj,id,topic){\n  node?.linkJump?.forEach(({toId},index)=>{\n    if(toId===id){\n      node.linkJump[index].title=topic\n      const button=this.container.querySelector(`tpc[data-nodeid=me${node.id}] .linkJump`)\n      button.title=topic\n    }\n  })\n  for(const val of (node.children||[])){\n    updateLinkJumpTitle.call(this,val,id,topic)\n  }\n}\n\nexport const createExpander = function(expanded: boolean | undefined): Expander {\n  const expander: Expander = $d.createElement('epd')\n  // 包含未定义 expanded 的情况，未定义视为展开\n  expander.innerText = expanded !== false ? '-' : '+'\n  expander.expanded = expanded !== false\n  expander.className = expanded !== false ? 'minus' : ''\n  return expander\n}\n\n/**\n * traversal data and generate dom structure of mind map\n * @ignore\n * @param {object} data node data object\n * @param {object} container node container(mostly primary node)\n * @param {number} direction primary node direction\n * @return {ChildrenElement} children element.\n */\nexport function createChildren(data: NodeObj[], container?: HTMLElement, direction?) {\n  let chldr: HTMLElement\n  if (container) {\n    chldr = container\n  } else {\n    chldr = $d.createElement('children')\n  }\n  let smyEle=[]\n  for (let i = 0; i < data.length; i++) {\n    const nodeObj = data[i]\n    if(nodeObj?.type==='summary'){\n      const {smy} =this.createSummary(nodeObj)\n      if (nodeObj.children && nodeObj.children.length > 0) {\n        if(nodeObj.expanded !== false){\n          const [children,smyChild]= this.createChildren(nodeObj.children)\n          smy.appendChild(children)\n          if(smyChild){\n            smyChild.forEach(val => {\n              smy.appendChild(val)\n          });\n        }\n        }\n        \n      }\n      smyEle.push(smy)\n      continue\n    }\n    const grp = $d.createElement('GRP')\n    if (direction === LEFT) {\n      grp.className = 'lhs'\n    } else if (direction === RIGHT) {\n      grp.className = 'rhs'\n    } else if (direction === SIDE) {\n      if (nodeObj.direction === LEFT) {\n        grp.className = 'lhs'\n      } else if (nodeObj.direction === RIGHT) {\n        grp.className = 'rhs'\n      }\n    }\n    const top = this.createTop(nodeObj)\n    if (nodeObj.children && nodeObj.children.length > 0) {\n      top.appendChild(createExpander(nodeObj.expanded))\n      grp.appendChild(top)\n      if (nodeObj.expanded !== false) {\n        const [children,smy] = this.createChildren(nodeObj.children)\n        grp.appendChild(children)\n        if(smy){\n          smy.forEach(val => {\n            if(!grp.children?.[2]){\n              grp.appendChild($d.createElement('smychildren'))\n            }\n            grp.children[2].appendChild(val)\n          });\n        }\n      }\n    } else {\n      grp.appendChild(top)\n    }\n    chldr.appendChild(grp)\n  }\n  return [chldr,smyEle]    \n}\n\n// Set primary nodes' direction and invoke createChildren()\nexport function layout() {\n  console.time('layout')\n  this.root.innerHTML = ''\n  this.box.innerHTML = ''\n  const tpc = this.createTopic(this.nodeData)\n  shapeTpc.call(this,tpc, this.nodeData) // shape root tpc\n  tpc.draggable = false\n  this.root.appendChild(tpc)\n\n  const primaryNodes: NodeObj[] = this.nodeData.children\n  if (!primaryNodes || primaryNodes.length === 0) return\n  if (this.direction === SIDE) {\n    // initiate direction of primary nodes\n    let lcount = 0\n    let rcount = 0\n    primaryNodes.map(node => {\n      if (node.direction === undefined) {\n        if (lcount <= rcount) {\n          node.direction = LEFT\n          lcount += 1\n        } else {\n          node.direction = RIGHT\n          rcount += 1\n        }\n      } else {\n        if (node.direction === LEFT) {\n          lcount += 1\n        } else {\n          rcount += 1\n        }\n      }\n    })\n  }\n  this.createChildren(this.nodeData.children, this.box, this.direction)\n  console.timeEnd('layout')\n}\n","export const LEFT = 0\nexport const RIGHT = 1\nexport const SIDE = 2\nexport const DOWN = 3\n\nexport const GAP = 15\nexport const PRIMARY_NODE_HORIZONTAL_GAP = 65\nexport const PRIMARY_NODE_VERTICAL_GAP = 25\nexport const TURNPOINT_R = 8\n","const $d = document\nconst svgNS = 'http://www.w3.org/2000/svg'\nexport const createMainPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', '#555')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-width', '1')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  return path\n}\n\nexport const createLinkSvg = function(klass: string) {\n  const svg = $d.createElementNS(svgNS, 'svg')\n  svg.setAttribute('class', klass)\n  return svg\n}\n\nexport const createSvgPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('stroke', '#F6A04D')\n  path.setAttribute('stroke-width', '3')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  return path\n}\n\nexport const createLine = function(x1: number, y1: number, x2: number, y2: number) {\n  const line = $d.createElementNS(svgNS, 'line')\n  line.setAttribute('x1', x1.toString())\n  line.setAttribute('y1', y1.toString())\n  line.setAttribute('x2', x2.toString())\n  line.setAttribute('y2', y2.toString())\n  line.setAttribute('stroke', '#bbb')\n  line.setAttribute('fill', 'none')\n  line.setAttribute('stroke-width', '2')\n  return line\n}\n\nexport const createPath = function(d: string) {\n  const path = $d.createElementNS(svgNS, 'path')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', '#555')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'square')\n  path.setAttribute('stroke-width', '1')\n  path.setAttribute('transform', 'translate(0.5,-0.5)')\n  // adding translate(0.5,-0.5) can fix render error on windows, but i still dunno why\n  return path\n}\n\nexport const createWidthControll = function(d: string) {\n  const g = $d.createElementNS(svgNS, 'g')\n  const left =$d.createElementNS(svgNS, 'rect')\n  const right =$d.createElementNS(svgNS, 'rect')\n  left.setAttribute('width','7')\n  left.setAttribute('height','30')\n  left.setAttribute('opacity','0')\n  left.setAttribute('style','cursor: ew-resize;')\n  left.setAttribute('x','22')\n  g.appendChild(right)\n  g.appendChild(left)\n  // adding translate(0.5,-0.5) can fix render error on windows, but i still dunno why\n  return g\n}\ninterface CustomSvg extends SVGElement{\n  linkObj?:object\n}\nexport const createSvgGroup = function(d: string, arrowd: string):CustomSvg {\n  const g = $d.createElementNS(svgNS, 'g')\n  const path = $d.createElementNS(svgNS, 'path')\n  const arrow = $d.createElementNS(svgNS, 'path')\n  arrow.setAttribute('d', arrowd)\n  arrow.setAttribute('stroke', 'rgb(235, 95, 82)')\n  arrow.setAttribute('fill', 'none')\n  arrow.setAttribute('stroke-linecap', 'cap')\n  arrow.setAttribute('stroke-width', '2')\n  path.setAttribute('d', d)\n  path.setAttribute('stroke', 'rgb(235, 95, 82)')\n  path.setAttribute('fill', 'none')\n  path.setAttribute('stroke-linecap', 'cap')\n  path.setAttribute('stroke-width', '2')\n\n  g.appendChild(path)\n  g.appendChild(arrow)\n  return g\n}\n","import { Canvg } from 'canvg';\nlet $d = document\nlet maxTop = 10000\nlet maxBottom = 10000\nlet maxLeft = 10000\nlet maxRight = 10000\nlet imgPadding = 40\nlet head = `<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">`\n\nfunction init(){\n  maxTop = 10000\n  maxBottom = 10000\n  maxLeft = 10000\n  maxRight = 10000\n  imgPadding = 40\n}\n\nfunction generateSvgDom() {\n  init()\n  let primaryNodes = $d.querySelectorAll('.mindbox > grp, root')\n  let svgContent = ''\n  for (let i = 0; i < primaryNodes.length; i++) {\n    let primaryNode = primaryNodes[i]\n    let rect = primaryNode.getBoundingClientRect()\n    let top = primaryNode.offsetTop\n    let bottom = top + rect.height\n    let left = primaryNode.offsetLeft\n    let right = left + rect.width\n    // console.log(top, bottom, left, right)\n    if (top < maxTop) {\n      maxTop = top\n    }\n    if (bottom > maxBottom) {\n      maxBottom = bottom\n    }\n    if (left < maxLeft) {\n      maxLeft = left\n    }\n    if (right > maxRight) {\n      maxRight = right\n    }\n    svgContent += PrimaryToSvg(primaryNode)\n  }\n  console.log(maxTop, maxBottom, maxLeft, maxRight)\n  svgContent += RootToSvg()\n  // 需要添加图片边缘padding\n  let svgHeight = maxBottom - maxTop + imgPadding * 2\n  let svgWidth = maxRight - maxLeft + imgPadding * 2\n  let svgFile = createSvg(svgHeight, svgWidth)\n  svgContent =\n    `<rect x=\"0\" y=\"0\" width=\"${svgWidth}\" height=\"${svgHeight}\" fill=\"#f6f6f6\"></rect>` +\n    svgContent\n  svgFile.innerHTML = svgContent\n  // document.body.append(svgFile)\n  return svgFile\n}\n\nexport function getHeightAndWidth() {\n  $d=this.container\n  init()\n  let primaryNodes = $d.querySelectorAll('.mindbox > grp, root')\n  let svgContent = ''\n  for (let i = 0; i < primaryNodes.length; i++) {\n    let primaryNode = primaryNodes[i]\n    let rect = primaryNode.getBoundingClientRect()\n    let top = primaryNode.offsetTop\n    let bottom = top + rect.height\n    let left = primaryNode.offsetLeft\n    let right = left + rect.width\n    // console.log(top, bottom, left, right)\n    if (top < maxTop) {\n      maxTop = top\n    }\n    if (bottom > maxBottom) {\n      maxBottom = bottom\n    }\n    if (left < maxLeft) {\n      maxLeft = left\n    }\n    if (right > maxRight) {\n      maxRight = right\n    }\n    svgContent += PrimaryToSvg(primaryNode)\n  }\n  console.log(maxTop, maxBottom, maxLeft, maxRight)\n  let svgHeight = maxBottom - maxTop\n  let svgWidth = maxRight - maxLeft\n  console.log('svgHeight',svgHeight)\n  return [svgHeight+5,svgWidth+5]\n}\n\nfunction createSvg(height, width) {\n  let svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n  svg.setAttribute('height', height)\n  svg.setAttribute('width', width)\n  svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg')\n  svg.setAttribute('version', '1.2')\n  svg.setAttribute('xlink', 'http://www.w3.org/1999/xlink')\n  return svg\n}\n\nfunction RootToSvg() {\n  let root = document.querySelector('root')\n  let rootTpc = document.querySelector('root > tpc')\n  let rect = rootTpc.getBoundingClientRect()\n  let tpcStyle = getComputedStyle(rootTpc)\n  let t = rootTpc.parentNode\n  let top = 0\n  let left = 0\n  let nodeObj = document.querySelector('root > tpc').nodeObj\n  let tStyle = getComputedStyle(t)\n  let rootOffsetY = root.offsetTop - maxTop\n  let rootOffsetX = root.offsetLeft - maxLeft\n  let topicOffsetLeft =\n  left + parseInt(tStyle.paddingLeft) + parseInt(rect.paddingLeft)\n  let topicOffsetTop =\n  top +\n  parseInt(tStyle.paddingTop) +\n  parseInt(rect.paddingTop) +\n  parseInt(rect.fontSize)\n  let topicOffsetTopTop =\n  top +\n  parseInt(tStyle.paddingTop) +\n  parseInt(rect.paddingTop)\n  let svg2ndEle = document.querySelector('.svg2nd')\n\n  // render tags\n  let tags = ''\n  if (nodeObj.tags && nodeObj.tags.length) {\n    let tagsEle = rootTpc.querySelectorAll('.tags > span')\n    for (let i = 0; i < tagsEle.length; i++) {\n      let tag = tagsEle[i]\n      let tagRect = tag.getBoundingClientRect()\n      tags += `<rect x=\"${topicOffsetLeft}\" y=\"${\n        topicOffsetTop + 4\n        }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n        tagRect.height\n        }\" style=\"fill: #d6f0f8;\"></rect>\n        <foreignObject x=\"${topicOffsetLeft}\" y=\"${\n          topicOffsetTop + 4\n          }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n          tagRect.height\n          }\" > \n          <div sytle=\"font-size:12px\">${tag.innerHTML}</div>\n        </foreignObject>\n      `\n    }\n  }\n  let icons = ''\n  if (nodeObj.icons && nodeObj.icons.length) {\n    let iconsEle = rootTpc.querySelectorAll('.icons > span')\n    for (let i = 0; i < iconsEle.length; i++) {\n      let icon = iconsEle[i]\n      let iconRect = icon.getBoundingClientRect()\n      icons += `\n      <tspan>${icon.innerHTML}</tspan>`\n    }\n  }\n  //render images\n  let images = ''\n  if (nodeObj.image && nodeObj.image.length) {\n    let imagesEle = tpc.querySelectorAll('.image')\n    for (let i = 0; i < imagesEle.length; i++) {\n      let image = imagesEle[i]\n      let imageRect = image.getBoundingClientRect()\n      images += `${image.outerHTML}`\n    }\n  }\n\n  let svg2nd = `<g transform=\"translate(${imgPadding - maxLeft}, ${\n    imgPadding - maxTop\n    })\">${svg2ndEle.innerHTML}</g>`\n  // return (\n    svg2nd +=\n    `<g id=\"root\" transform=\"translate(${rootOffsetX + imgPadding}, ${\n    rootOffsetY + imgPadding\n    })\">\n      <rect x=\"${left}\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${\n    rect.width\n    }\" height=\"${rect.height}\" style=\"fill: #00aaff;\"></rect>\n      <foreignObject x=\"${left + 15}\" y=\"${\n        top + 10\n        }\" width=\"${tpcStyle.width}\" height=\"${tpcStyle.height}\" \">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"padding:0;margin:0;font-family:微软雅黑;font-size:${tpcStyle.fontSize};font-weight:${tpcStyle.fontWeight};color:${tpcStyle.color};word-break: break-all;line-height: 1\">\n        ${nodeObj.topic}\n        ${icons}\n        ${images}\n      </div>\n      </foreignObject>\n      ${tags}\n  </g>`\n  // )\n  let topiclinks=$d.querySelector('.topiclinks')\n  if(topiclinks){\n    svg2nd+=`<g transform=\"translate(${imgPadding - maxLeft}, ${\n      imgPadding - maxTop\n    })\">${topiclinks.innerHTML}</g>`\n  }\n  return svg2nd\n}\n\nfunction PrimaryToSvg(primaryNode) {\n  let topics = primaryNode.querySelectorAll('tpc')\n  let primaryNodeOffsetY = primaryNode.offsetTop - maxTop\n  let primaryNodeOffsetX = primaryNode.offsetLeft - maxLeft\n\n  let svg = ''\n  let svg3rd = primaryNode.querySelector('.svg3rd')\n  svg += `<g transform=\"translate(${primaryNodeOffsetX + imgPadding}, ${\n    primaryNodeOffsetY + imgPadding\n    })\">`\n  svg += svg3rd ? svg3rd.innerHTML : ''\n  for (let i = 0; i < topics.length; i++) {\n    let tpc = topics[i]\n    let t = tpc.parentNode\n    let nodeObj = tpc.nodeObj\n    if (nodeObj.root) { continue }\n    let tpcRect = tpc.getBoundingClientRect()\n    let top = t.offsetTop\n    let left = t.offsetLeft\n    let tpcStyle = getComputedStyle(tpc)\n    let tStyle = getComputedStyle(t)\n    let topicOffsetLeft =\n      left + parseInt(tStyle.paddingLeft) + parseInt(tpcStyle.paddingLeft)\n    let topicOffsetTop =\n      top +\n      parseInt(tStyle.paddingTop) +\n      parseInt(tpcStyle.paddingTop) +\n      parseInt(tpcStyle.fontSize)\n    let topicOffsetTopTop =\n      top +\n      parseInt(tStyle.paddingTop) +\n      parseInt(tpcStyle.paddingTop)\n    // style render\n    let border = ''\n    if (tpcStyle.borderWidth != '0px') {\n      border = `<rect x=\"${left + 15}\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${\n        tpcRect.width\n        }\" height=\"${\n        tpcRect.height\n        }\" style=\"fill: rgba(0,0,0,0); stroke:#444;stroke-width:1px;\"></rect>`\n    }\n    let backgroundColor = ''\n    if (tpcStyle.backgroundColor != 'rgba(0, 0, 0, 0)') {\n      backgroundColor = `<rect x=\"${\n        left + 15\n        }\" y=\"${top}\" rx=\"5px\" ry=\"5px\" width=\"${tpcRect.width}\" height=\"${\n        tpcRect.height\n        }\" style=\"fill: ${tpcStyle.backgroundColor};\"></rect>`\n    }\n    // render tags\n    let tags = ''\n    if (nodeObj.tags && nodeObj.tags.length) {\n      let tagsEle = tpc.querySelectorAll('.tags > span')\n      for (let i = 0; i < tagsEle.length; i++) {\n        let tag = tagsEle[i]\n        let tagRect = tag.getBoundingClientRect()\n        tags += `<rect x=\"${topicOffsetLeft}\" y=\"${\n          topicOffsetTop + 4\n          }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n          tagRect.height\n          }\" style=\"fill: #d6f0f8;\"></rect>\n          <foreignObject x=\"${topicOffsetLeft}\" y=\"${\n            topicOffsetTop + 4\n            }\" rx=\"5px\" ry=\"5px\" width=\"${tagRect.width}\" height=\"${\n            tagRect.height\n            }\" > \n            <div sytle=\"font-size:12px\">${tag.innerHTML}</div>\n          </foreignObject>`\n      }\n    }\n    let icons = ''\n    if (nodeObj.icons && nodeObj.icons.length) {\n      let iconsEle = tpc.querySelectorAll('.icons > span')\n      for (let i = 0; i < iconsEle.length; i++) {\n        let icon = iconsEle[i]\n        let iconRect = icon.getBoundingClientRect()\n        icons += `\n        <tspan>${icon.innerHTML}</tspan>`\n      }\n    }\n      //render images\n    let images = ''\n    if (nodeObj.image && nodeObj.image.length) {\n      let imagesEle = tpc.querySelectorAll('.image')\n      for (let i = 0; i < imagesEle.length; i++) {\n        let image = imagesEle[i]\n        let imageRect = image.getBoundingClientRect()\n        images += `${image.outerHTML}`\n      }\n    }\n    // render every single node\n    svg += `<g id=\"${nodeObj.id}\">\n      ${border}\n      ${backgroundColor}\n      <foreignObject  x=\"${topicOffsetLeft}\" y=\"${topicOffsetTopTop}\" width=\"${tpcStyle.width}\" height=\"${tpcStyle.height}\">\n      <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"padding:0;margin:0;font-family:微软雅黑;font-size:${tpcStyle.fontSize};font-weight:${tpcStyle.fontWeight};color:${tpcStyle.color};word-break: break-all;line-height: 1\">\n        ${nodeObj.topic}\n        ${icons}\n        ${images}\n      </div>\n      </foreignObject>\n      ${tags}\n  </g>`\n  }\n  svg += '</g>'\n  return svg\n}\n\nexport let exportSvg = function () {\n  let svgFile = generateSvgDom()\n  let dlUrl = URL.createObjectURL(\n    new Blob([head + svgFile.outerHTML.replace(/&nbsp;/g, ' ')])\n  )\n  let a = document.createElement('a')\n  a.href = dlUrl\n  a.download = 'me-mindmap.svg'\n  a.click()\n}\n\nexport let exportSvgDom = function (instance=this, fileName='default') {\n  // if (!instance) throw new Error('Mind-elixir instance is not presented. ---> exportSvg(instance, fileName)') \n  // initVar()\n  $d = instance.container\n  let svgFile = generateSvgDom()\n  return svgFile\n}\n\nexport let exportPng = async function () {\n  let svgFile = generateSvgDom()\n  const canvas = document.createElement('canvas')\n  canvas.style.display = 'none'\n  const ctx = canvas.getContext('2d')\n  // Canvg do not support foreignObject\n  let v = await Canvg.fromString(\n    ctx,\n    head + svgFile.outerHTML.replace(/&nbsp;/g, ' ')\n  )\n  v.start()\n  let imgURL = canvas.toDataURL('image/png')\n  let a = document.createElement('a')\n  a.href = imgURL\n  a.download = 'me-mindmap.png'\n  a.click()\n}\n\n\nexport default {\n  exportSvg, exportPng\n}","import { node } from 'canvg/dist/presets'\nimport { MindElixirInstance, NodeObj } from '.'\nimport { getHeightAndWidth } from '../painter/index.foreignObject'\nimport { MindElixirData } from './index.lite'\nimport { findEle } from './utils/dom'\n/**\n * @exports -\n * workaround for jsdoc\n */\n/**\n * @exports MapInteraction\n * @namespace MapInteraction\n */\nfunction getData(instance) {\n  return instance.isFocusMode ? instance.nodeDataBackup : instance.nodeData\n}\n\ninterface ISummaryNode{\n  NodeObj\n}\n/**\n * @function\n * @instance\n * @name selectNode\n * @memberof MapInteraction\n * @description Select a node and add solid border to it.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n */\nexport const selectNode = function(targetElement, isNewNode, clickEvent) {\n  if (!targetElement) return\n  console.time('selectNode')\n  if (typeof targetElement === 'string') {\n    return this.selectNode(findEle(targetElement))\n  }\n  // if ((this.currentNode&&!this.ctrlRepeat)||this.currentNode?.nodeObj.id===targetElement?.nodeObj.id) this.currentNode.className = ''\n  // else targetElement.className = 'selected'\\\n  if(this.ctrlRepeat){\n    // let flag=false\n    // this.currentSummaryNodeArr=this.currentSummaryNodeArr??[]\n    // this.currentSummaryNodeArr=this.currentSummaryNodeArr.filter(node=>{\n    //   if(node.nodeObj.id===targetElement.nodeObj.id){\n    //     flag=true\n    //     return false\n    //   }else{\n    //     return true\n    //   }\n    // })\n    // if(!flag){\n    //   this.currentSummaryNodeArr.push(targetElement)\n    //   targetElement.className='selected'\n    // }else{\n    //   targetElement.className=''\n    // }\n    if(targetElement.className==='selected'){\n      targetElement.className=''\n    }else{\n      targetElement.className='selected'\n    }\n    console.log(this.currentSummaryNodeArr)\n  }else{\n    // this.currentSummaryNodeArr=[targetElement]\n    if (this.currentNode) this.currentNode.className = ''\n    targetElement.className = 'selected'\n  }\n  if(this?.widthControll){\n    const widthControllRight=targetElement.querySelector('widthControllRight')\n    widthControllRight.className='width-controll-right'\n    const widthControllLeft=targetElement.querySelector('widthControllLeft')\n    widthControllLeft.className='width-controll-left'\n  }\n  this.currentNode = targetElement\n  if (isNewNode) {\n    this.bus.fire('selectNewNode', targetElement.nodeObj, clickEvent)\n  } else {\n    this.bus.fire('selectNode', targetElement.nodeObj, clickEvent)\n  }\n  console.timeEnd('selectNode')\n}\nexport const unselectNode = function() {\n  if (this.currentNode) {\n    this.currentNode.className = ''\n    if(this.widthControll){\n      const widthControllRight=this.currentNode.querySelector('widthControllRight')\n      widthControllRight.className=''\n      const widthControllLeft=this.currentNode.querySelector('widthControllLeft')\n      widthControllLeft.className=''\n    }\n  }\n  this.currentNode = null\n  this.bus.fire('unselectNode')\n}\nexport const selectNextSibling = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const sibling = this.currentNode.parentElement.parentElement.nextSibling\n  let target: HTMLElement\n  const grp = this.currentNode.parentElement.parentElement\n  if (grp.className === 'rhs' || grp.className === 'lhs') {\n    const siblingList = this.mindElixirBox.querySelectorAll('.' + grp.className)\n    const i = Array.from(siblingList).indexOf(grp)\n    if (i + 1 < siblingList.length) {\n      target = siblingList[i + 1].firstChild.firstChild\n    } else {\n      return false\n    }\n  } else if (sibling) {\n    target = sibling.firstChild.firstChild\n  } else {\n    return false\n  }\n  this.selectNode(target)\n  return true\n}\nexport const selectPrevSibling = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const sibling = this.currentNode.parentElement.parentElement.previousSibling\n  let target\n  const grp = this.currentNode.parentElement.parentElement\n  if (grp.className === 'rhs' || grp.className === 'lhs') {\n    const siblingList = this.mindElixirBox.querySelectorAll('.' + grp.className)\n    const i = Array.from(siblingList).indexOf(grp)\n    if (i - 1 >= 0) {\n      target = siblingList[i - 1].firstChild.firstChild\n    } else {\n      return false\n    }\n  } else if (sibling) {\n    target = sibling.firstChild.firstChild\n  } else {\n    return false\n  }\n  this.selectNode(target)\n  return true\n}\nexport const selectFirstChild = function() {\n  if (!this.currentNode) return\n  const children = this.currentNode.parentElement.nextSibling\n  if (children && children.firstChild) {\n    const target = children.firstChild.firstChild.firstChild\n    this.selectNode(target)\n  }\n}\nexport const selectParent = function() {\n  if (!this.currentNode || this.currentNode.dataset.nodeid === 'meroot') return undefined\n\n  const parent = this.currentNode.parentElement.parentElement.parentElement\n    .previousSibling\n  if (parent) {\n    const target = parent.firstChild\n    this.selectNode(target)\n  }\n}\n/**\n * @function\n * @instance\n * @name getAllDataString\n * @description Get all node data as string.\n * @memberof MapInteraction\n * @return {string}\n */\nexport const getAllDataString = function() {\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n  }\n  return JSON.stringify(data, (k, v) => {\n    if (k === 'parent') return undefined\n    if (k === 'from') return v.nodeObj.id\n    if (k === 'to') return v.nodeObj.id\n    return v\n  })\n}\n/**\n * @function\n * @instance\n * @name getAllData\n * @description Get all node data as object.\n * @memberof MapInteraction\n * @return {Object}\n */\nexport const getAllData = function(): object {\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n  }\n  return JSON.parse(\n    JSON.stringify(data, (k, v) => {\n      if (k === 'parent') return undefined\n      if (k === 'from') return v.nodeObj.id\n      if (k === 'to') return v.nodeObj.id\n      return v\n    })\n  )\n}\n\n/**\n * @function\n * @instance\n * @name getAllDataWithAutoHide\n * @description Get all the data of automatically hidden third-level nodes\n * @memberof MapInteraction\n * @return {Object}\n */\n\nexport function autoHide(nodeData:NodeObj,cnt,deep){\n  if(cnt<deep){\n    nodeData.expanded=true\n  }else{\n    nodeData.expanded=false\n  }\n  for(const val of (nodeData.children||[])){\n    autoHide(val,cnt+1,deep)\n  }\n}\ntype data = {\n  [key: string]: any;\n  nodeData: string;\n};\n\nexport const getAllDataWithAutoHide = function(): data {\n  const expandDeep=Number(this.container.querySelector('.numberSelection').value)||2\n  const data = {\n    direction:this.direction,\n    nodeData: getData(this),\n    linkData: this.linkData,\n    height:getHeightAndWidth.call(this),\n    expandDeep\n  }\n  autoHide(data.nodeData,0,expandDeep)\n  return JSON.parse(\n    JSON.stringify(data, (k, v) => {\n      if (k === 'parent') return undefined\n      if (k === 'from') return v.nodeObj.id\n      if (k === 'to') return v.nodeObj.id\n      return v\n    })\n  )\n}\n\n/**\n * @function\n * @instance\n * @name getAllDataMd\n * @description Get all node data as markdown.\n * @memberof MapInteraction\n * @return {String}\n */\nexport const getAllDataMd = function():string {\n  const data = getData(this)\n  let mdString = '# ' + data.topic + '\\n\\n'\n  function writeMd(children, deep) {\n    for (let i = 0; i < children.length; i++) {\n      if (deep <= 6) {\n        mdString += ''.padStart(deep, '#') + ' ' + children[i].topic + '\\n\\n'\n      } else {\n        mdString +=\n          ''.padStart(deep - 7, '\\t') + '- ' + children[i].topic + '\\n'\n      }\n      if (children[i].children) {\n        writeMd(children[i].children, deep + 1)\n      }\n    }\n  }\n  writeMd(data.children, 2)\n  return mdString\n}\n\n/**\n * @function\n * @instance\n * @name enableEdit\n * @memberof MapInteraction\n */\nexport const enableEdit = function() {\n  this.editable = true\n}\n\n/**\n * @function\n * @instance\n * @name disableEdit\n * @memberof MapInteraction\n */\nexport const disableEdit = function() {\n  this.editable = false\n}\n\n/**\n * @function\n * @instance\n * @name scale\n * @description Change the scale of the mind map.\n * @memberof MapInteraction\n * @param {number}\n */\nexport const scale = function(scaleVal) {\n  this.scaleVal = scaleVal\n  this.map.style.transform = 'scale(' + scaleVal + ')'\n}\n\nfunction getRootWidth(node:HTMLElement){\n  const root=node.querySelector('root')as HTMLElement\n  return root.offsetWidth||150\n}\nfunction getRootHeight(node:HTMLElement){\n  const root=node.querySelector('root')as HTMLElement\n  return root.offsetHeight||150\n}\n\nfunction getHeightDistance(a:HTMLElement,b:HTMLElement){\n  const aHeight=a?.getBoundingClientRect()?.top||0\n  const bHeight=b?.getBoundingClientRect()?.top||aHeight\n  return Math.abs(aHeight-bHeight)\n}\n\nfunction getWidthDistance(a:HTMLElement,b:HTMLElement){\n  const aWidth=a?.getBoundingClientRect()?.left||0\n  const bWidth=b?.getBoundingClientRect()?.left||aWidth\n  return Math.abs(aWidth-bWidth)\n}\n\nexport function getHeightFromRootToAnotherNode(node:HTMLElement,anotherNode:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  return getHeightDistance(tpc,anotherNode)\n}\n\nexport function getWidthFromRootToAnotherNode(node:HTMLElement,anotherNode:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  return getWidthDistance(tpc,anotherNode)\n}\n\nfunction getHeightFromRootToChild(node:HTMLElement){\n  const tpc=node.querySelector('root')as HTMLElement\n  const childTpc=node.querySelector('.map-canvas children grp')as HTMLElement\n  return getHeightDistance(tpc,childTpc)\n}\n/**\n * @function\n * @instance\n * @name toCenter\n * @description Reset position of the map to center.\n * @memberof MapInteraction\n */\nexport const toCenter = function() {\n  this.container.scrollTo(\n    10000 - this.container.offsetWidth / 2,\n    10000 - this.container.offsetHeight / 2\n  )\n}\n\n/**\n * @function\n * @instance\n * @name toCenter\n * @description Reset position of the map to top left.\n * @memberof MapInteraction\n */\n export const toTopLeft = function() {\n  if(this.nodeData?.children.length>0){\n    this.container.scrollTo(\n      10000 - getRootWidth(this.container)/2-10,\n      10000 - getRootHeight(this.container)/2-getHeightFromRootToChild(this.container)-5\n    )\n  }else{\n    this.container.scrollTo(\n      10000 - this.container.offsetWidth / 2,\n      10000 - this.container.offsetHeight / 2\n    )\n  }\n  \n}\n\nexport const install = function(plugin) {\n  plugin(this)\n}\n/**\n * @function\n * @instance\n * @name focusNode\n * @description Enter focus mode, set the target element as root.\n * @memberof MapInteraction\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n */\nexport const focusNode = function(tpcEl) {\n  if (tpcEl.nodeObj.root) return\n  if (this.tempDirection === null) {\n    this.tempDirection = this.direction\n  }\n  if (!this.isFocusMode) {\n    this.nodeDataBackup = this.nodeData // help reset focus mode\n    this.isFocusMode = true\n  }\n  this.nodeData = tpcEl.nodeObj\n  this.nodeData.root = true\n  this.initRight()\n}\n/**\n * @function\n * @instance\n * @name cancelFocus\n * @description Exit focus mode.\n * @memberof MapInteraction\n */\nexport const cancelFocus = function() {\n  this.isFocusMode = false\n  if (this.tempDirection !== null) {\n    delete this.nodeData.root\n    this.nodeData = this.nodeDataBackup\n    this.direction = this.tempDirection\n    this.tempDirection = null\n    this.init()\n  }\n}\n/**\n * @function\n * @instance\n * @name initLeft\n * @description Child nodes will distribute on the left side of the root node.\n * @memberof MapInteraction\n */\nexport const initLeft = function() {\n  this.direction = 0\n  this.init()\n}\n/**\n * @function\n * @instance\n * @name initRight\n * @description Child nodes will distribute on the right side of the root node.\n * @memberof MapInteraction\n */\nexport const initRight = function() {\n  this.direction = 1\n  this.init()\n}\n/**\n * @function\n * @instance\n * @name initSide\n * @description Child nodes will distribute on both left and right side of the root node.\n * @memberof MapInteraction\n */\nexport const initSide = function() {\n  this.direction = 2\n  this.init()\n}\n\n/**\n * @function\n * @instance\n * @name setLocale\n * @memberof MapInteraction\n */\nexport const setLocale = function(locale) {\n  this.locale = locale\n  this.init()\n}\n\nexport const expandNode = function(el, isExpand) {\n  const node = el.nodeObj\n  if (typeof isExpand === 'boolean') {\n    node.expanded = isExpand\n  } else if (node.expanded !== false) {\n    node.expanded = false\n  } else {\n    node.expanded = true\n    expandNodeChild(node)\n  }\n  // TODO 在此函数构造 html 结构，而非调用 layout\n  this.layout()\n  // linkDiv 已实现只更新特定主节点\n  this.linkDiv()\n  this.bus.fire('expandNode', node)\n}\n\n/**\n * @function\n * @instance\n * @name refresh\n * @description Refresh mind map, you can use it after modified `this.nodeData`\n * @memberof MapInteraction\n */\nexport const refresh = function() {\n  // add parent property to every node\n  this.addParentLink(this.nodeData)\n  // create dom element for every node\n  this.layout()\n  // generate links between nodes\n  this.linkDiv()\n}\n\n/**\n * 一键展开子主题\n * @param nodeData \n */\n export function expandNodeChild(nodeData:NodeObj){\n  nodeData.expanded=true\n  for(const val of (nodeData.children||[])){\n    expandNodeChild(val)\n  }\n}","import type { NodeElement, NodeObj } from './index'\n\nimport {\n  moveNodeObj,\n  removeNodeObj,\n  insertNodeObj,\n  insertBeforeNodeObj,\n  insertParentNodeObj,\n  checkMoveValid,\n  addParentLink,\n  moveUpObj,\n  moveDownObj,\n  moveNodeBeforeObj,\n  moveNodeAfterObj,\n  refreshIds,\n} from './utils/index'\nimport { findEle, createExpander, shapeTpc } from './utils/dom'\nimport { rgbHex } from './utils/index'\nimport { LEFT, RIGHT, SIDE } from './const'\nconst $d = document\n\n/**\n * @exports NodeOperation\n * @namespace NodeOperation\n */\nexport const updateNodeStyle = function(object) {\n  if (!object.style) return\n  const nodeEle = findEle(object.id, this)\n  const origin = {\n    color: nodeEle.style.color && rgbHex(nodeEle.style.color),\n    background: nodeEle.style.background && rgbHex(nodeEle.style.background),\n    fontSize: nodeEle.style.fontSize && nodeEle.style.fontSize + 'px',\n    fontWeight: nodeEle.style.fontWeight,\n  }\n  nodeEle.style.color = object.style.color\n  nodeEle.style.background = object.style.background\n  nodeEle.style.fontSize = object.style.fontSize + 'px'\n  nodeEle.style.fontWeight = object.style.fontWeight || 'normal'\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editStyle',\n    obj: object,\n    origin,\n  })\n}\n\nexport const updateNodeTags = function(object, tags) {\n  if (!tags) return\n  const oldVal = object.tags\n  if(tags.length===0)\n    delete object.tags\n  else\n    object.tags = tags\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editTags',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeIcons = function(object, icons) {\n  if (!icons) return\n  const oldVal = object.icons\n  object.icons = icons\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editIcons',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeHyperLink = function(object, hyperLink) {\n  if (hyperLink==null||hyperLink==undefined) return\n  const oldVal = object.hyperLink\n  const hyperLinkArr=hyperLink.split(',')\n  object.linkJump=object.linkJump?.filter(link=>{\n    return hyperLinkArr.find(val=>val===link.title)?true:false\n  })\n  if(object.linkJump?.length===0) delete object.linkJump\n  object.hyperLink = hyperLinkArr.filter(link=>{\n    return link!==''&&!object.linkJump?.find(val=>val.title===link)\n  })\n  if(object.hyperLink?.length===0) delete object.hyperLink\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editHyperLink',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\nexport const updateNodeRemark = function(object, remark) {\n  if (remark==null||remark==undefined) return\n  const oldVal = object.remark\n  object.remark = remark\n  const nodeEle = findEle(object.id)\n  shapeTpc.call(this,nodeEle, object)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'editRemark',\n    obj: object,\n    origin: oldVal,\n  })\n}\n\n// export const updateNodeImage = function(object, image) {\n//   if (!image) return\n//   const oldVal = object.image\n//   object.image = image\n//   const nodeEle = findEle(object.id)\n//   shapeTpc(nodeEle, object)\n//   this.linkDiv()\n//   this.bus.fire('operation', {\n//     name: 'editImage',\n//     obj: object,\n//     origin: oldVal,\n//   })\n// }\n\nexport const updateNodeSvgChart = function() {\n  // TODO\n}\n\n/**\n * @function\n * @instance\n * @name insertSibling\n * @memberof NodeOperation\n * @description Create a sibling node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertSibling(E('bd4313fbac40284b'))\n */\nexport const insertSibling = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    this.addChild()\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n  const t = nodeEle.parentElement\n  console.time('insertSibling_DOM')\n\n  const { grp, top } = this.createGroup(newNodeObj)\n\n  const children = t.parentNode.parentNode\n  children.insertBefore(grp, t.parentNode.nextSibling)\n  if (children.className === 'mindbox') {\n    this.processPrimaryNode(grp, newNodeObj)\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertSibling_DOM')\n  this.bus.fire('operation', {\n    name: 'insertSibling',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name insertBefore\n * @memberof NodeOperation\n * @description Create a sibling node before the selected node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertBefore(E('bd4313fbac40284b'))\n */\nexport const insertBefore = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    this.addChild()\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertBeforeNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n  const t = nodeEle.parentElement\n  console.time('insertSibling_DOM')\n\n  const { grp, top } = this.createGroup(newNodeObj)\n\n  const children = t.parentNode.parentNode\n  children.insertBefore(grp, t.parentNode)\n  if (children.className === 'mindbox') {\n    this.processPrimaryNode(grp, newNodeObj)\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertSibling_DOM')\n  this.bus.fire('operation', {\n    name: 'insertSibling',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name insertParent\n * @memberof NodeOperation\n * @description Create a parent node of the selected node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * insertParent(E('bd4313fbac40284b'))\n */\nexport const insertParent = function(el, node) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    return\n  }\n  const newNodeObj = node || this.generateNewObj()\n  insertParentNodeObj(nodeObj, newNodeObj)\n  addParentLink(this.nodeData)\n\n  const grp0 = nodeEle.parentElement.parentElement\n  console.time('insertParent_DOM')\n  const { grp, top } = this.createGroup(newNodeObj, true)\n  top.appendChild(createExpander(true))\n  const children0 = grp0.parentNode\n  grp0.insertAdjacentElement('afterend', grp)\n\n  const c = $d.createElement('children')\n  c.appendChild(grp0)\n\n  top.insertAdjacentElement('afterend', c)\n\n  if (children0.className === 'mindbox') {\n    grp.className = grp0.className // l/rhs\n    grp0.className = ''\n    grp0.querySelector('.svg3rd').remove()\n    this.linkDiv()\n  } else {\n    this.linkDiv(grp.offsetParent)\n  }\n\n  if (!node) {\n    this.createInputDiv(top.children[0])\n  }\n  this.selectNode(top.children[0], true)\n  console.timeEnd('insertParent_DOM')\n  this.bus.fire('operation', {\n    name: 'insertParent',\n    obj: newNodeObj,\n  })\n}\n\nexport const addSummaryFunction = function(nodeEle,node){\n  if (!nodeEle) return undefined\n  \n  // this.layout()\n  // nodeEle = findEle(nodeEle.nodeObj.id)\n  const nodeObj = nodeEle.nodeObj\n  const newNodeObj = node || this.generateNewSummaryObj()\n  nodeObj.parent.children.push(newNodeObj)\n  addParentLink(this.nodeData)\n  const top = nodeEle.parentNode.parentNode.parentNode.parentNode\n  const { smy, top: newTop } = this.createSummary(newNodeObj)\n  if(!top.children?.['smychildren']){\n    const smychildren=$d.createElement('smychildren')\n    smychildren.setAttribute('name','smychildren')\n    top.appendChild(smychildren)\n  }\n  top.children['smychildren'].appendChild(smy)\n  this.layout()\n  this.linkDiv()\n  return { newTop, newNodeObj }\n}\n\nexport const addChildFunction = function(nodeEle, node) { \n  if (!nodeEle) return undefined\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.expanded === false) {\n    this.expandNode(nodeEle, true)\n    // dom had resetted\n    nodeEle = findEle(nodeObj.id)\n  }\n  const newNodeObj = node || this.generateNewObj()\n  if (nodeObj.children) nodeObj.children.push(newNodeObj)\n  else nodeObj.children = [newNodeObj]\n  addParentLink(this.nodeData)\n\n  const top = nodeEle.parentElement\n\n  const { grp, top: newTop } = this.createGroup(newNodeObj)\n\n  if (top.tagName === 'T') {\n    if (top.children[1]) {\n      top.nextSibling.appendChild(grp)\n    } else {\n      const c = $d.createElement('children')\n      c.appendChild(grp)\n      top.appendChild(createExpander(true))\n      top.insertAdjacentElement('afterend', c)\n    }\n    this.layout()\n    this.linkDiv(grp.offsetParent)\n  } else if (top.tagName === 'ROOT') {\n    this.processPrimaryNode(grp, newNodeObj)\n    top.nextSibling.appendChild(grp)\n    this.linkDiv()\n  }\n  return { newTop, newNodeObj }\n}\n\nexport const addSummary = function(el: NodeElement, node: NodeObj) {\n  console.time('addSummary')\n  const parentIndex={}\n  const selectedArr=[]\n  this.container.querySelectorAll('tpc.selected').forEach(value=>{\n    parentIndex[value.nodeObj.parent.id]??(parentIndex[value.nodeObj.parent.id]=selectedArr.length)\n    selectedArr[parentIndex[value.nodeObj.parent.id]]=selectedArr[parentIndex[value.nodeObj.parent.id]]??[]\n    selectedArr[parentIndex[value.nodeObj.parent.id]].push(value)\n  })\n  console.log(selectedArr)\n  selectedArr.forEach(val=>{\n    const nodeEle = val[0] || this.currentNode\n    this.currentSummaryNodeArr=val\n    if (!nodeEle) return\n    if(nodeEle?.parentElement?.parentElement?.parentElement?.className=='mindbox') return\n    const { newTop, newNodeObj } = addSummaryFunction.call(this, nodeEle, node)\n    console.timeEnd('addSummary')\n    if (!node) {\n      this.createInputDiv(newTop.children[0])\n    }\n    this.selectNode(newTop.children[0], true)\n    this.bus.fire('operation', {\n      name: 'addSummary',\n      obj: newNodeObj,\n    })\n  })\n\n}\n\n/**\n * @function\n * @instance\n * @name addChild\n * @memberof NodeOperation\n * @description Create a child node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @param {node} node - New node information.\n * @example\n * addChild(E('bd4313fbac40284b'))\n */\nexport const addChild = function(el: NodeElement, node: NodeObj) {\n  console.time('addChild')\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const { newTop, newNodeObj } = addChildFunction.call(this, nodeEle, node)\n  console.timeEnd('addChild')\n  if (!node) {\n    this.createInputDiv(newTop.children[0])\n  }\n  this.selectNode(newTop.children[0], true)\n  this.bus.fire('operation', {\n    name: 'addChild',\n    obj: newNodeObj,\n  })\n}\n// uncertain link disappear sometimes??\n// TODO while direction = SIDE, move up won't change the direction of primary node\n\n/**\n * @function\n * @instance\n * @name copyNode\n * @memberof NodeOperation\n * @description Copy node to another node.\n * @param {TargetElement} node - Target element return by E('...'), default value: currentTarget.\n * @param {TargetElement} to - The target(as parent node) you want to copy to.\n * @example\n * copyNode(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const copyNode = function(node: NodeElement, to: NodeElement) {\n  console.time('copyNode')\n  const deepCloneObj = JSON.parse(\n    JSON.stringify(node.nodeObj, (k, v) => {\n      if (k === 'parent') return undefined\n      return v\n    })\n  )\n  refreshIds(deepCloneObj)\n  const { newNodeObj } = addChildFunction.call(this, to, deepCloneObj)\n  console.timeEnd('copyNode')\n  this.bus.fire('operation', {\n    name: 'copyNode',\n    obj: newNodeObj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveUpNode\n * @memberof NodeOperation\n * @description Move the target node up.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * moveUpNode(E('bd4313fbac40284b'))\n */\nexport const moveUpNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const grp = nodeEle.parentNode.parentNode\n  const obj = nodeEle.nodeObj\n  moveUpObj(obj)\n  grp.parentNode.insertBefore(grp, grp.previousSibling)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveUpNode',\n    obj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveDownNode\n * @memberof NodeOperation\n * @description Move the target node down.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * moveDownNode(E('bd4313fbac40284b'))\n */\nexport const moveDownNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const grp = nodeEle.parentNode.parentNode\n  const obj = nodeEle.nodeObj\n  moveDownObj(obj)\n  if (grp.nextSibling) {\n    grp.insertAdjacentElement('beforebegin', grp.nextSibling)\n  } else {\n    grp.parentNode.prepend(grp)\n  }\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveDownNode',\n    obj,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name removeNode\n * @memberof NodeOperation\n * @description Remove the target node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * removeNode(E('bd4313fbac40284b'))\n */\nexport const removeNode = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  const nodeObj = nodeEle.nodeObj\n  if (nodeObj.root === true) {\n    throw new Error('Can not remove root node')\n  }\n  const index = nodeObj.parent.children.findIndex(node => node === nodeObj)\n  const next = nodeObj.parent.children[index + 1]\n  const originSiblingId = next && next.id\n\n  const childrenLength = removeNodeObj(nodeObj)\n  const t = nodeEle.parentNode\n  if (t.tagName === 'ROOT') {\n    return\n  }\n  if (childrenLength === 0) {\n    // remove epd when children length === 0\n    const parentT = t.parentNode.parentNode.previousSibling\n    // root doesn't have epd\n    if (parentT.tagName !== 'ROOT') {\n      parentT.children[1].remove()\n    }\n    this.selectParent()\n  } else {\n    // select sibling automatically\n    const success = this.selectPrevSibling()\n    if (!success) this.selectNextSibling()\n  }\n  for (const prop in this.linkData) {\n    // MAYBEBUG should traversal all children node\n    const link = this.linkData[prop]\n    if (link.from === t.firstChild || link.to === t.firstChild) {\n      this.removeLink(\n        this.mindElixirBox.querySelector(\n          `[data-linkid=${this.linkData[prop].id}]`\n        )\n      )\n    }\n  }\n  // remove GRP\n  t.parentNode.remove()\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'removeNode',\n    obj: nodeObj,\n    originSiblingId,\n    originParentId: nodeObj.parent.id,\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveNode\n * @memberof NodeOperation\n * @description Move a node to another node (as child node).\n * @param {TargetElement} from - The target you want to move.\n * @param {TargetElement} to - The target(as parent node) you want to move to.\n * @example\n * moveNode(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNode = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  if (toObj.expanded === false) {\n    this.expandNode(to, true)\n    from = findEle(fromObj.id)\n    to = findEle(toObj.id)\n  }\n  if (!checkMoveValid(fromObj, toObj)) {\n    console.warn('Invalid move')\n    return\n  }\n  console.time('moveNode')\n  moveNodeObj(fromObj, toObj)\n  addParentLink(this.nodeData) // update parent property\n  const fromTop = from.parentElement\n  const fromChilren = fromTop.parentNode.parentNode\n  const toTop = to.parentElement\n  if (fromChilren.className === 'mindbox') {\n    // clear svg group of primary node\n    fromTop.parentNode.lastChild.remove()\n  } else if (fromTop.parentNode.className === 'mindbox') {\n    fromTop.style.cssText = '' // clear style\n  }\n  if (toTop.tagName === 'T') {\n    if (fromChilren.className === 'mindbox') {\n      // clear direaction class of primary node\n      fromTop.parentNode.className = ''\n    }\n    if (toTop.children[1]) {\n      // expander exist\n      toTop.nextSibling.appendChild(fromTop.parentNode)\n    } else {\n      // expander not exist, no child\n      const c = $d.createElement('children')\n      c.appendChild(fromTop.parentNode)\n      toTop.appendChild(createExpander(true))\n      toTop.parentElement.insertBefore(c, toTop.nextSibling)\n    }\n  } else if (toTop.tagName === 'ROOT') {\n    this.processPrimaryNode(fromTop.parentNode, fromObj)\n    toTop.nextSibling.appendChild(fromTop.parentNode)\n  }\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNode',\n    obj: { fromObj, toObj, originParentId },\n  })\n  console.timeEnd('moveNode')\n}\n\n/**\n * @function\n * @instance\n * @name moveNodeBefore\n * @memberof NodeOperation\n * @description Move a node and become previous node of another node.\n * @param {TargetElement} from\n * @param {TargetElement} to\n * @example\n * moveNodeBefore(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNodeBefore = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  moveNodeBeforeObj(fromObj, toObj)\n  addParentLink(this.nodeData)\n  const fromTop = from.parentElement\n  const fromGrp = fromTop.parentNode\n  const toTop = to.parentElement\n  const toGrp = toTop.parentNode\n  const toChilren = toTop.parentNode.parentNode\n  toChilren.insertBefore(fromGrp, toGrp)\n  this.processPrimaryNode(fromTop.parentElement,fromObj)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNodeBefore',\n    obj: { fromObj, toObj, originParentId },\n  })\n}\n\n/**\n * @function\n * @instance\n * @name moveNodeAfter\n * @memberof NodeOperation\n * @description Move a node and become next node of another node.\n * @param {TargetElement} from\n * @param {TargetElement} to\n * @example\n * moveNodeAfter(E('bd4313fbac402842'),E('bd4313fbac402839'))\n */\nexport const moveNodeAfter = function(from, to) {\n  const fromObj = from.nodeObj\n  const toObj = to.nodeObj\n  const originParentId = fromObj.parent.id\n  moveNodeAfterObj(fromObj, toObj)\n  addParentLink(this.nodeData)\n  const fromTop = from.parentElement\n  const fromGrp = fromTop.parentNode\n  const toTop = to.parentElement\n  const toGrp = toTop.parentNode\n  const toChilren = toTop.parentNode.parentNode\n  toChilren.insertBefore(fromGrp, toGrp.nextSibling)\n  this.processPrimaryNode(fromTop.parentElement,fromObj)\n  this.linkDiv()\n  this.bus.fire('operation', {\n    name: 'moveNodeAfter',\n    obj: { fromObj, toObj, originParentId },\n  })\n}\n\n/**\n * @function\n * @instance\n * @name beginEdit\n * @memberof NodeOperation\n * @description Begin to edit the target node.\n * @param {TargetElement} el - Target element return by E('...'), default value: currentTarget.\n * @example\n * beginEdit(E('bd4313fbac40284b'))\n */\nexport const beginEdit = function(el) {\n  const nodeEle = el || this.currentNode\n  if (!nodeEle) return\n  this.createInputDiv(nodeEle)\n}\n\nexport const setNodeTopic = function(tpc, topic) {\n  tpc.childNodes[0].textContent = topic\n  tpc.nodeObj.topic = topic\n  this.linkDiv()\n}\n\n// Judge L or R\nexport function processPrimaryNode(primaryNode, obj) {\n  if (this.direction === LEFT) {\n    primaryNode.className = 'lhs'\n  } else if (this.direction === RIGHT) {\n    primaryNode.className = 'rhs'\n  } else if (this.direction === SIDE) {\n    const l = $d.querySelectorAll('.lhs').length\n    const r = $d.querySelectorAll('.rhs').length\n    if (l <= r) {\n      primaryNode.className = 'lhs'\n      obj.direction = LEFT\n    } else {\n      primaryNode.className = 'rhs'\n      obj.direction = RIGHT\n    }\n  }\n}\n","import {\n  LinkDragMoveHelper,\n  generateUUID,\n  getArrowPoints,\n  calcP1,\n  calcP4,\n} from './utils/index'\nimport { createSvgGroup } from './utils/svg'\n\n// TODO Link label\nexport const createLink = function(from, to, isInitPaint, obj) {\n  const map = this.map.getBoundingClientRect()\n  if (!from || !to) {\n    return // not expand\n  }\n  const pfrom = from.getBoundingClientRect()\n  const pto = to.getBoundingClientRect()\n  const fromCenterX = (pfrom.x + pfrom.width / 2 - map.x) / this.scaleVal\n  const fromCenterY = (pfrom.y + pfrom.height / 2 - map.y) / this.scaleVal\n  const toCenterX = (pto.x + pto.width / 2 - map.x) / this.scaleVal\n  const toCenterY = (pto.y + pto.height / 2 - map.y) / this.scaleVal\n\n  let p2x, p2y, p3x, p3y\n  if (isInitPaint) {\n    p2x = fromCenterX + obj.delta1.x\n    p2y = fromCenterY + obj.delta1.y\n    p3x = toCenterX + obj.delta2.x\n    p3y = toCenterY + obj.delta2.y\n  } else {\n    if ((fromCenterY + toCenterY) / 2 - fromCenterY <= pfrom.height / 2) {\n      // the situation that two div is too close\n      p2x = (pfrom.x + pfrom.width - map.x) / this.scaleVal + 100\n      p2y = fromCenterY\n      p3x = (pto.x + pto.width - map.x) / this.scaleVal + 100\n      p3y = toCenterY\n    } else {\n      p2x = (fromCenterX + toCenterX) / 2\n      p2y = (fromCenterY + toCenterY) / 2\n      p3x = (fromCenterX + toCenterX) / 2\n      p3y = (fromCenterY + toCenterY) / 2\n    }\n  }\n\n  const fromData = {\n    cx: fromCenterX,\n    cy: fromCenterY,\n    w: pfrom.width,\n    h: pfrom.height,\n  }\n  const toData = {\n    cx: toCenterX,\n    cy: toCenterY,\n    w: pto.width,\n    h: pto.height,\n  }\n\n  const p1 = calcP1(fromData, p2x, p2y)\n  const p1x = p1.x\n  const p1y = p1.y\n\n  const p4 = calcP4(toData, p3x, p3y)\n  const p4x = p4.x\n  const p4y = p4.y\n\n  const arrowPoint = getArrowPoints(p3x, p3y, p4x, p4y)\n\n  // TODO link lable\n  // const halfx = p1x / 8 + (p2x * 3) / 8 + (p3x * 3) / 8 + p4x / 8\n  // const halfy = p1y / 8 + (p2y * 3) / 8 + (p3y * 3) / 8 + p4y / 8\n\n  const newSvgGroup = createSvgGroup(\n    `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`,\n    `M ${arrowPoint.x1} ${arrowPoint.y1} L ${p4x} ${p4y} L ${arrowPoint.x2} ${arrowPoint.y2}`\n  )\n\n  let newLinkObj\n  if (isInitPaint) {\n    newLinkObj = {\n      id: obj.id,\n      label: '',\n      from,\n      to,\n      delta1: {\n        x: p2x - fromCenterX,\n        y: p2y - fromCenterY,\n      },\n      delta2: {\n        x: p3x - toCenterX,\n        y: p3y - toCenterY,\n      },\n    }\n    // overwrite\n    this.linkData[obj.id] = newLinkObj\n    newSvgGroup.linkObj = newLinkObj\n    newSvgGroup.dataset.linkid = obj.id\n  } else {\n    newLinkObj = {\n      id: generateUUID(),\n      label: '',\n      from,\n      to,\n      delta1: {\n        x: p2x - fromCenterX,\n        y: p2y - fromCenterY,\n      },\n      delta2: {\n        x: p3x - toCenterX,\n        y: p3y - toCenterY,\n      },\n    }\n    // new\n    this.linkData[newLinkObj.id] = newLinkObj\n    newSvgGroup.linkObj = newLinkObj\n    newSvgGroup.dataset.linkid = newLinkObj.id\n    this.currentLink = newSvgGroup\n  }\n  this.linkSvgGroup.appendChild(newSvgGroup)\n  if (!isInitPaint) { this.showLinkController(p2x, p2y, p3x, p3y, newLinkObj, fromData, toData) }\n}\n\nexport const removeLink = function(linkSvg) {\n  let link\n  if (linkSvg) {\n    link = linkSvg\n  } else {\n    link = this.currentLink\n  }\n  if (!link) return\n  this.hideLinkController()\n  const id = link.linkObj.id\n  delete this.linkData[id]\n  link.remove()\n  link = null\n}\nexport const selectLink = function(targetElement) {\n  this.currentLink = targetElement\n  const obj = targetElement.linkObj\n  const from = obj.from\n  const to = obj.to\n\n  const map = this.map.getBoundingClientRect()\n  const pfrom = from.getBoundingClientRect()\n  const pto = to.getBoundingClientRect()\n  const fromCenterX = (pfrom.x + pfrom.width / 2 - map.x) / this.scaleVal\n  const fromCenterY = (pfrom.y + pfrom.height / 2 - map.y) / this.scaleVal\n  const toCenterX = (pto.x + pto.width / 2 - map.x) / this.scaleVal\n  const toCenterY = (pto.y + pto.height / 2 - map.y) / this.scaleVal\n\n  const fromData = {\n    cx: fromCenterX,\n    cy: fromCenterY,\n    w: pfrom.width,\n    h: pfrom.height,\n  }\n  const toData = {\n    cx: toCenterX,\n    cy: toCenterY,\n    w: pto.width,\n    h: pto.height,\n  }\n\n  const p2x = fromCenterX + obj.delta1.x\n  const p2y = fromCenterY + obj.delta1.y\n  const p3x = toCenterX + obj.delta2.x\n  const p3y = toCenterY + obj.delta2.y\n\n  this.showLinkController(p2x, p2y, p3x, p3y, obj, fromData, toData)\n}\nexport const hideLinkController = function() {\n  this.linkController.style.display = 'none'\n  this.P2.style.display = 'none'\n  this.P3.style.display = 'none'\n}\nexport const showLinkController = function(\n  p2x,\n  p2y,\n  p3x,\n  p3y,\n  linkObj,\n  fromData,\n  toData\n) {\n  this.linkController.style.display = 'initial'\n  this.P2.style.display = 'initial'\n  this.P3.style.display = 'initial'\n\n  const p1 = calcP1(fromData, p2x, p2y)\n  let p1x = p1.x\n  let p1y = p1.y\n\n  const p4 = calcP4(toData, p3x, p3y)\n  let p4x = p4.x\n  let p4y = p4.y\n\n  this.P2.style.cssText = `top:${p2y}px;left:${p2x}px;`\n  this.P3.style.cssText = `top:${p3y}px;left:${p3x}px;`\n  this.line1.setAttribute('x1', p1x)\n  this.line1.setAttribute('y1', p1y)\n  this.line1.setAttribute('x2', p2x)\n  this.line1.setAttribute('y2', p2y)\n  this.line2.setAttribute('x1', p3x)\n  this.line2.setAttribute('y1', p3y)\n  this.line2.setAttribute('x2', p4x)\n  this.line2.setAttribute('y2', p4y)\n\n  if (this.helper1) {\n    this.helper1.destory(this.map)\n    this.helper2.destory(this.map)\n  }\n\n  this.helper1 = new LinkDragMoveHelper(this.P2)\n  this.helper2 = new LinkDragMoveHelper(this.P3)\n\n  this.helper1.init(this.map, (deltaX, deltaY) => {\n    /**\n     * user will control bezier with p2 & p3\n     * p1 & p4 is depend on p2 & p3\n     */\n    p2x = p2x - deltaX / this.scaleVal\n    p2y = p2y - deltaY / this.scaleVal\n\n    const p1 = calcP1(fromData, p2x, p2y)\n    p1x = p1.x\n    p1y = p1.y\n\n    this.P2.style.top = p2y + 'px'\n    this.P2.style.left = p2x + 'px'\n    this.currentLink.children[0].setAttribute(\n      'd',\n      `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`\n    )\n    this.line1.setAttribute('x1', p1x)\n    this.line1.setAttribute('y1', p1y)\n    this.line1.setAttribute('x2', p2x)\n    this.line1.setAttribute('y2', p2y)\n    linkObj.delta1.x = p2x - fromData.cx\n    linkObj.delta1.y = p2y - fromData.cy\n  })\n\n  this.helper2.init(this.map, (deltaX, deltaY) => {\n    p3x = p3x - deltaX / this.scaleVal\n    p3y = p3y - deltaY / this.scaleVal\n\n    const p4 = calcP4(toData, p3x, p3y)\n    p4x = p4.x\n    p4y = p4.y\n    const arrowPoint = getArrowPoints(p3x, p3y, p4x, p4y)\n\n    this.P3.style.top = p3y + 'px'\n    this.P3.style.left = p3x + 'px'\n    this.currentLink.children[0].setAttribute(\n      'd',\n      `M ${p1x} ${p1y} C ${p2x} ${p2y} ${p3x} ${p3y} ${p4x} ${p4y}`\n    )\n    this.currentLink.children[1].setAttribute(\n      'd',\n      `M ${arrowPoint.x1} ${arrowPoint.y1} L ${p4x} ${p4y} L ${arrowPoint.x2} ${arrowPoint.y2}`\n    )\n    this.line2.setAttribute('x1', p3x)\n    this.line2.setAttribute('y1', p3y)\n    this.line2.setAttribute('x2', p4x)\n    this.line2.setAttribute('y2', p4y)\n    linkObj.delta2.x = p3x - toData.cx\n    linkObj.delta2.y = p3y - toData.cy\n  })\n}\n","import { createPath, createMainPath, createLinkSvg, createSvgPath } from './utils/svg'\nimport { findEle, Expander } from './utils/dom'\nimport {\n  SIDE,\n  GAP,\n  TURNPOINT_R,\n  PRIMARY_NODE_HORIZONTAL_GAP,\n  PRIMARY_NODE_VERTICAL_GAP,\n} from './const'\nimport { NodeObj } from '.'\nimport { node } from 'canvg/dist/presets'\n\ninterface rangeMapI{\n  [propName: string]: boolean;\n}\n/**\n * Link nodes with svg,\n * only link specific node if `primaryNode` is present\n *\n * procedure:\n * 1. calculate position of primary nodes\n * 2. layout primary node, generate primary link\n * 3. generate links inside primary node\n * 4. generate custom link\n * @param {object} primaryNode process the specific primary node only\n */\nexport default function linkDiv(primaryNode) {\n  var primaryNodeHorizontalGap = this.primaryNodeHorizontalGap || PRIMARY_NODE_HORIZONTAL_GAP\n  var primaryNodeVerticalGap = this.primaryNodeVerticalGap || PRIMARY_NODE_VERTICAL_GAP\n  console.time('linkDiv')\n  const root = this.root\n  root.style.cssText = `top:${10000 - root.offsetHeight / 2}px;left:${10000 - root.offsetWidth / 2}px;`\n  const primaryNodeList = this.box.children\n  this.svg2nd.innerHTML = ''\n\n  // 1. calculate position of primary nodes\n  let totalHeight = 0\n  let shortSide: string // l or r\n  let shortSideGap = 0 // balance heigt of two side\n  let currentOffsetL = 0 // left side total offset\n  let currentOffsetR = 0 // right side total offset\n  let totalHeightL = 0\n  let totalHeightR = 0\n  let base: number\n\n  if (this.direction === SIDE) {\n    let countL = 0\n    let countR = 0\n    let totalHeightLWithoutGap = 0\n    let totalHeightRWithoutGap = 0\n    for (let i = 0; i < primaryNodeList.length; i++) {\n      const el = primaryNodeList[i]\n      if (el.className === 'lhs') {\n        totalHeightL += el.offsetHeight + primaryNodeVerticalGap\n        totalHeightLWithoutGap += el.offsetHeight\n        countL += 1\n      } else {\n        totalHeightR += el.offsetHeight + primaryNodeVerticalGap\n        totalHeightRWithoutGap += el.offsetHeight\n        countR += 1\n      }\n    }\n    if (totalHeightL > totalHeightR) {\n      base = 10000 - Math.max(totalHeightL) / 2\n      shortSide = 'r'\n      shortSideGap = (totalHeightL - totalHeightRWithoutGap) / (countR - 1)\n    } else {\n      base = 10000 - Math.max(totalHeightR) / 2\n      shortSide = 'l'\n      shortSideGap = (totalHeightR - totalHeightLWithoutGap) / (countL - 1)\n    }\n  } else {\n    for (let i = 0; i < primaryNodeList.length; i++) {\n      const el = primaryNodeList[i]\n      totalHeight += el.offsetHeight + primaryNodeVerticalGap\n    }\n    base = 10000 - totalHeight / 2\n  }\n\n  // 2. layout primary node, generate primary link\n  let primaryPath = ''\n  const alignRight = 10000 - root.offsetWidth / 2 - primaryNodeHorizontalGap+60\n  const alignLeft = 10000 + root.offsetWidth / 2 + primaryNodeHorizontalGap-60\n  for (let i = 0; i < primaryNodeList.length; i++) {\n    let x2, y2\n    const el = primaryNodeList[i]\n    const elOffsetH = el.offsetHeight\n    let xMiddle=root.offsetLeft-10\n    if (el.className === 'lhs') {\n      el.style.top = base + currentOffsetL + 'px'\n      el.style.left = alignRight - el.offsetWidth + 'px'\n      x2 = alignRight - 15 // padding\n      y2 = base + currentOffsetL + elOffsetH / 2\n\n      // https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#path_commands\n      let LEFT = 10000\n      if (this.primaryLinkStyle === 2) {\n        if (this.direction === SIDE) {\n          LEFT = 10000 - root.offsetWidth / 6\n        }\n        if (y2 < 10000) {\n          primaryPath += `M ${LEFT} 10000 V ${y2 + 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT - 20} ${y2} H ${x2}`\n        } else {\n          primaryPath += `M ${LEFT} 10000 V ${y2 - 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT - 20} ${y2} H ${x2}`\n        }\n      } else {\n        primaryPath += `M 10000 10000 H ${xMiddle} V ${y2} H ${x2}`\n      }\n\n      if (shortSide === 'l') {\n        currentOffsetL += elOffsetH + shortSideGap\n      } else {\n        currentOffsetL += elOffsetH + primaryNodeVerticalGap\n      }\n    } else {\n      xMiddle=root.offsetLeft+root.offsetWidth+10\n      el.style.top = base + currentOffsetR + 'px'\n      el.style.left = alignLeft + 'px'\n      x2 = alignLeft + 15 // padding\n      y2 = base + currentOffsetR + elOffsetH / 2\n\n      let LEFT = 10000\n      if (this.primaryLinkStyle === 2) {\n        if (this.direction === SIDE) {\n          LEFT = 10000 + root.offsetWidth / 6\n        }\n        if (y2 < 10000) {\n          primaryPath += `M ${LEFT} 10000 V ${y2 + 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT + 20} ${y2} H ${x2}`\n        } else {\n          primaryPath += `M ${LEFT} 10000 V ${y2 - 20} C ${LEFT} ${y2} ${LEFT} ${y2} ${LEFT + 20} ${y2} H ${x2}`\n        }\n      } else {\n        primaryPath += `M 10000 10000 H ${xMiddle} V ${y2} H ${x2}`\n      }\n      if (shortSide === 'r') {\n        currentOffsetR += elOffsetH + shortSideGap\n      } else {\n        currentOffsetR += elOffsetH + primaryNodeVerticalGap\n      }\n    }\n    // set position of expander\n    const expander = el.children[0].children[1]\n    if (expander) {\n      expander.style.top =\n        (expander.parentNode.offsetHeight - expander.offsetHeight) / 2 + 'px'\n      if (el.className === 'lhs') {\n        expander.style.left = -10 + 'px'\n      } else {\n        expander.style.left = expander.parentNode.offsetWidth - 10 + 'px'\n      }\n    }\n  }\n  this.svg2nd.appendChild(createMainPath(primaryPath))\n\n  // 3. generate link inside primary node\n  for (let i = 0; i < primaryNodeList.length; i++) {\n    const el = primaryNodeList[i]\n    if (primaryNode && primaryNode !== primaryNodeList[i]) {\n      continue\n    }\n    if (el.childElementCount) {\n      const svg = createLinkSvg('svg3rd')\n      const svgSMY = createLinkSvg('svg3rd')\n      // svg tag name is lower case\n      // if (el.lastChild.tagName === 'svg') el.lastChild.remove()\n      el.querySelectorAll('.svg3rd').forEach(val => {\n        val.remove()\n      });\n      el.appendChild(svg)     \n      const parent = el.children[0]\n      let children\n      if(el.children?.[2]?.tagName==='SMYCHILDREN'){\n        children = [...el.children[1].children,...el.children[2].children]\n      }   \n      else\n        children = el.children[1].children\n      path = ''\n      smypath = ''\n      loopChildren(children, parent,this.nodeData.children[i],true)\n      svg.appendChild(createPath(path))\n      if(smypath.length>0){\n        el.appendChild(svgSMY)\n        svgSMY.appendChild(createSvgPath(smypath))\n      }  \n    }\n  }\n\n  // 4. generate custom link\n  this.linkSvgGroup.innerHTML = ''\n  for (const prop in this.linkData) {\n    const link = this.linkData[prop]\n    if (typeof link.from === 'string') {\n      this.createLink(findEle(link.from), findEle(link.to), true, link)\n    } else {\n      this.createLink(\n        findEle(link.from.nodeObj.id),\n        findEle(link.to.nodeObj.id),\n        true,\n        link\n      )\n    }\n  }\n  console.timeEnd('linkDiv')\n}\n\nlet path = ''\nlet smypath = ''\n\nfunction loopChildren(children: HTMLElement[], parent: HTMLElement,nodeData:NodeObj,first?: boolean) {\n  let parentOT = parent.offsetTop\n  let parentOL = parent.offsetLeft\n  let parentOW = parent.offsetWidth\n  let parentOH = parent.offsetHeight\n  let isSmyChild=false\n  if(parent.offsetParent.tagName==='SMY'){\n    isSmyChild=true\n    parentOT+=(parent.offsetParent as HTMLElement).offsetTop\n    parentOL+=(parent.offsetParent as HTMLElement).offsetLeft\n    // parentOW+=(parent.offsetParent as HTMLElement).offsetWidth\n    // parentOH+=(parent.offsetParent as HTMLElement).offsetHeight\n  }\n  for (let i = 0; i < children.length; i++) {\n    const child: HTMLElement = children[i] as HTMLElement\n    if(child?.tagName==='SMY'){\n      let firstEl=children[0] as HTMLElement\n      let lastEl=children[i-1] as HTMLElement\n\n      const rangeMap:rangeMapI={}\n      nodeData.children[i].summary.range.forEach(val=>{\n        rangeMap[val]=true\n      })\n      let flag=true\n      for(let j=0;j<i;j++){\n          const key=children[j].children[0].children[0].getAttribute('data-nodeid').slice(2)\n          if(rangeMap[key]){\n            if(flag){\n              flag=false\n              firstEl=children[j]\n            }\n            lastEl=children[j]\n          }\n      }\n      const xfirst=firstEl.offsetLeft+firstEl.offsetWidth+8\n      const yfirst=firstEl.offsetTop+15\n      const ylast=lastEl.offsetTop+lastEl.offsetHeight-5\n      const xlast=lastEl.offsetLeft+lastEl.offsetWidth+8\n      const y=child.offsetTop+(child.children[0] as HTMLElement).offsetTop+(child.children[0] as HTMLElement).offsetHeight\n      let top=child.style.top??0\n      if(typeof top ==='string') top=Number(top.replace('px',''))\n      child.style.top=top+(ylast+yfirst+20)/2-y+'px'\n      smypath+=`M ${xfirst} ${yfirst} H ${xfirst+10} V ${ylast} H${xlast}`\n    }\n    const childT: HTMLElement = child.children[0] as HTMLElement // t tag inside the child dom\n    let childTOT = childT.offsetTop\n    let childTOH = childT.offsetHeight\n    if(isSmyChild){\n      childTOT+=(childT.offsetParent as HTMLElement).offsetTop\n      // childTOH=(childT.offsetParent as HTMLElement).offsetHeight\n    }\n    let y1: number\n    if (first||isSmyChild) {\n      y1 = parentOT + parentOH / 2\n    } else {\n      y1 = parentOT + parentOH\n    }\n    const y2 = childTOT + childTOH\n    let x1: number, x2: number, xMiddle: number\n    const direction = child.offsetParent.className||(child.offsetParent as HTMLElement).offsetParent.className\n    if (direction === 'lhs'&&child?.tagName!=='SMY') {\n      x1 = parentOL + GAP\n      xMiddle = parentOL\n      x2 = parentOL - childT.offsetWidth\n      if (\n        childTOT + childTOH < parentOT + parentOH / 2 + 50 &&\n        childTOT + childTOH > parentOT + parentOH / 2 - 50\n      ) {\n        // 相差+-50内直接直线\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2} H ${x2}`\n      } else if (childTOT + childTOH >= parentOT + parentOH / 2) {\n        // 子底部低于父中点\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      } else {\n        // 子底部高于父中点\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      }\n    } else if (direction === 'rhs'&&child?.tagName!=='SMY') {\n      x1 = parentOL + parentOW - GAP\n      if(isSmyChild) x1+=GAP\n      xMiddle = parentOL + parentOW\n      x2 = parentOL + parentOW + childT.offsetWidth\n      if (\n        childTOT + childTOH < parentOT + parentOH / 2 + 50 &&\n        childTOT + childTOH > parentOT + parentOH / 2 - 50\n      ) {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2} H ${x2}`\n        \n      } else if (childTOT + childTOH >= parentOT + parentOH / 2) {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      } else {\n        path += `M ${x1} ${y1} H ${xMiddle} V ${y2 } H ${x2}`\n      }\n    }\n\n    const expander = childT.children[1] as Expander\n    if (expander) {\n      expander.style.top =\n        (childT.offsetHeight - expander.offsetHeight) / 2 + 'px'\n      if (direction === 'lhs') {\n        expander.style.left = -10 + 'px'\n      } else if (direction === 'rhs') {\n        expander.style.left = childT.offsetWidth - 10 + 'px'\n      }\n      // this property is added in the layout phase\n      if (!expander.expanded) continue\n    } else {\n      // expander not exist\n      continue\n    }\n    // traversal\n    let nextChildren\n    if(child.children?.[2]?.tagName==='SMYCHILDREN'){\n      nextChildren=[...child.children[1].children,...child.children[2].children]\n    }else{\n      nextChildren=[...child.children[1].children]\n    }\n    if (nextChildren.length > 0) loopChildren(nextChildren, childT,nodeData.children[i])\n  }\n}\n","import { dragMoveHelper } from './utils/index'\nexport default function(mind) {\n  mind.map.addEventListener('click', e => {\n    // if (dragMoveHelper.afterMoving) return\n    // e.preventDefault() // can cause a tag don't work\n    if (e.target.nodeName === 'EPD') {\n      mind.expandNode(e.target.previousSibling)\n    } else if (\n      e.target.parentElement.nodeName === 'T' ||\n      e.target.parentElement.nodeName === 'ROOT'\n    ) {\n      mind.selectNode(e.target, false, e)\n    } else if (e.target.nodeName === 'path') {\n      if (e.target.parentElement.nodeName === 'g') {\n        mind.selectLink(e.target.parentElement)\n      }\n    } else if (e.target.className === 'circle') {\n      // skip circle\n    } else {\n      mind.unselectNode()    \n      //unselect all nodes\n      mind.container.querySelectorAll('tpc.selected').forEach(element => {\n      element.className=''\n    });\n      mind.hideLinkController()\n    }\n\n  })\n\n  mind.map.addEventListener('dblclick', e => {\n    e.preventDefault()\n    if (!mind.editable) return\n    if (\n      e.target.parentElement.nodeName === 'T' ||\n      e.target.parentElement.nodeName === 'ROOT'\n    ) {\n      mind.beginEdit(e.target)\n    }else if(e.target.className!=='content'){\n      let node = e.target\n      while(node.parentElement){\n        node=node.parentElement\n        if(node.nodeName === 'TPC'){\n          mind.beginEdit(node)\n          break\n        }\n      }\n    }\n  })\n\n  /**\n   * drag and move\n   */\n  mind.map.addEventListener('mousemove', e => {\n    if (!mind.nodeDraggable) {\n      if (e && e.target.className === 'selected') {\n        dragMoveHelper.clear()\n        e.target.draggable = false\n        return\n      }\n    }\n\n    // click trigger mousemove in windows chrome\n    // the 'true' is a string\n    if (e.target.contentEditable !== 'true') {\n      dragMoveHelper.onMove(e, mind.container)\n    }\n  })\n  mind.map.addEventListener('mousedown', e => {\n    if (e.target.contentEditable !== 'true') {\n      dragMoveHelper.afterMoving = false\n      dragMoveHelper.mousedown = true\n    }\n  })\n  mind.map.addEventListener('mouseleave', e => {\n    dragMoveHelper.clear()\n  })\n  mind.map.addEventListener('mouseup', e => {\n    dragMoveHelper.clear()\n  })\n\n  mind.map.addEventListener('wheel', e => {\n    // e.preventDefault()\n  })\n}\n","const cn = {\n  addChild: '插入子节点',\n  addParent: '插入父节点',\n  addSibling: '插入同级节点',\n  removeNode: '删除节点',\n  focus: '专注',\n  cancelFocus: '取消专注',\n  moveUp: '上移',\n  moveDown: '下移',\n  // link: '连接',\n  clickTips: '请点击目标节点',\n\n  font: '文字',\n  background: '背景',\n  tag: '标签',\n  icon: '图标',\n  tagsSeparate: '多个标签半角逗号分隔',\n  iconsSeparate: '多个图标半角逗号分隔',\n  link:'连线',\n  nodeLink:'主题内超链接',\n  hyperlink:'超链接',\n  linkSeparate:'链接地址,多个链接半角逗号分隔',\n  remark:'备注',\n  reamrkSeparate:'内容' ,\n  summary:'概要'\n}\nexport default {\n  cn,\n  zh_CN: cn,\n  zh_TW: {\n    addChild: '插入子節點',\n    addParent: '插入父節點',\n    addSibling: '插入同級節點',\n    removeNode: '刪除節點',\n    focus: '專注',\n    cancelFocus: '取消專注',\n    moveUp: '上移',\n    moveDown: '下移',\n    link: '連接',\n    clickTips: '請點擊目標節點',\n\n    font: '文字',\n    background: '背景',\n    tag: '標簽',\n    icon: '圖標',\n    tagsSeparate: '多個標簽半角逗號分隔',\n    iconsSeparate: '多個圖標半角逗號分隔',\n  },\n  en: {\n    addChild: 'Add child',\n    addParent: 'Add parent',\n    addSibling: 'Add sibling',\n    removeNode: 'Remove node',\n    focus: 'Focus Mode',\n    cancelFocus: 'Cancel Focus Mode',\n    moveUp: 'Move up',\n    moveDown: 'Move down',\n    link: 'Link',\n    clickTips: 'Please click the target node',\n\n    font: 'Font',\n    background: 'Background',\n    tag: 'Tag',\n    icon: 'Icon',\n    tagsSeparate: 'Separate tags by comma',\n    iconsSeparate: 'Separate icons by comma',\n    hyperlink:'hyperlink',\n    linkSeparate:'link address',\n    remark:'remark',\n    reamrkSeparate:'content',\n    summary:'summary',\n    nodeLink:'inner link'\n  },\n  ja: {\n    addChild: '子ノードを追加する',\n    addParent: '親ノードを追加します',\n    addSibling: '兄弟ノードを追加する',\n    removeNode: 'ノードを削除',\n    focus: '集中',\n    cancelFocus: '集中解除',\n    moveUp: '上へ移動',\n    moveDown: '下へ移動',\n    link: 'コネクト',\n    clickTips: 'ターゲットノードをクリックしてください',\n\n    font: 'フォント',\n    background: 'バックグラウンド',\n    tag: 'タグ',\n    icon: 'アイコン',\n    tagsSeparate: '複数タグはカンマ区切り',\n    iconsSeparate: '複数アイコンはカンマ区切り',\n  },\n  pt: {\n    addChild: 'Adicionar item filho',\n    addParent: 'Adicionar item pai',\n    addSibling: 'Adicionar item irmao',\n    removeNode: 'Remover item',\n    focus: 'Modo Foco',\n    cancelFocus: 'Cancelar Modo Foco',\n    moveUp: 'Mover para cima',\n    moveDown: 'Mover para baixo',\n    link: 'Link',\n    clickTips: 'Favor clicar no item alvo',\n\n    font: 'Fonte',\n    background: 'Cor de fundo',\n    tag: 'Tag',\n    icon: 'Icone',\n    tagsSeparate: 'Separe tags por virgula',\n    iconsSeparate: 'Separe icones por virgula',\n  },\n}\n","import i18n from '../i18n'\nimport linkDiv from '../linkDiv'\nimport { shapeTpc } from '../utils/dom'\nimport { encodeHTML } from '../utils/index'\n\nexport default function(mind, option) {\n  const createTips = words => {\n    const div = document.createElement('div')\n    div.innerText = words\n    div.style.cssText = 'position:absolute;bottom:20px;left:50%;transform:translateX(-50%);'\n    return div\n  }\n  const createLi = (id, name, keyname) => {\n    const li = document.createElement('li')\n    li.id = id\n    li.innerHTML = `<span>${encodeHTML(name)}</span><span>${encodeHTML(keyname)}</span>`\n    return li\n  }\n  const locale = i18n[mind.locale] ? mind.locale : 'en'\n\n  const add_child = createLi('cm-add_child', i18n[locale].addChild, 'tab')\n  const add_parent = createLi('cm-add_parent', i18n[locale].addParent, '')\n  const add_sibling = createLi('cm-add_sibling', i18n[locale].addSibling, 'enter')\n  const remove_child = createLi(\n    'cm-remove_child',\n    i18n[locale].removeNode,\n    'delete'\n  )\n  const focus = createLi('cm-fucus', i18n[locale].focus, '')\n  const unfocus = createLi('cm-unfucus', i18n[locale].cancelFocus, '')\n  const up = createLi('cm-up', i18n[locale].moveUp, 'PgUp')\n  const down = createLi('cm-down', i18n[locale].moveDown, 'Pgdn')\n  const link = createLi('cm-link', i18n[locale].link, '')\n  const nodeLink = createLi('cm-nodelink', i18n[locale].nodeLink, '')\n  const summary = createLi('cm-summary', i18n[locale].summary, '')\n\n  const menuUl = document.createElement('ul')\n  menuUl.className = 'menu-list'\n  menuUl.appendChild(add_child)\n  menuUl.appendChild(add_parent)\n  menuUl.appendChild(add_sibling)\n  menuUl.appendChild(remove_child)\n  if (!option || option.focus) {\n    menuUl.appendChild(focus)\n    menuUl.appendChild(unfocus)\n  }\n  menuUl.appendChild(up)\n  menuUl.appendChild(down)\n  if (!option || option.link) {\n    menuUl.appendChild(link)\n    menuUl.appendChild(nodeLink)\n  }\n  menuUl.appendChild(summary)\n  if (option && option.extend) {\n    for (let i = 0; i < option.extend.length; i++) {\n      const item = option.extend[i]\n      const dom = createLi(item.name, item.name, item.key || '')\n      menuUl.appendChild(dom)\n      dom.onclick = e => {\n        item.onclick(e)\n      }\n    }\n  }\n  const menuContainer = document.createElement('cmenu')\n  menuContainer.appendChild(menuUl)\n  menuContainer.hidden = true\n\n  mind.container.append(menuContainer)\n  let isRoot = true\n  mind.container.oncontextmenu = function(e) {\n    e.preventDefault()\n    if (!mind.editable) return\n    // console.log(e.pageY, e.screenY, e.clientY)\n    const target = e.target\n    if (target.tagName === 'TPC') {\n      if (target.parentElement.tagName === 'ROOT') {\n        isRoot = true\n      } else {\n        isRoot = false\n      }\n      if (isRoot) {\n        focus.className = 'disabled'\n        up.className = 'disabled'\n        down.className = 'disabled'\n        add_sibling.className = 'disabled'\n        remove_child.className = 'disabled'\n      } else {\n        focus.className = ''\n        up.className = ''\n        down.className = ''\n        add_sibling.className = ''\n        remove_child.className = ''\n      }\n      mind.selectNode(target)\n      menuContainer.hidden = false\n      const height = menuUl.offsetHeight\n      const width = menuUl.offsetWidth\n      if (height + e.clientY > window.innerHeight) {\n        menuUl.style.top = ''\n        menuUl.style.bottom = '0px'\n      } else {\n        menuUl.style.bottom = ''\n        menuUl.style.top = e.clientY + 15 + 'px'\n      }\n      if (width + e.clientX > window.innerWidth) {\n        menuUl.style.left = ''\n        menuUl.style.right = '0px'\n      } else {\n        menuUl.style.right = ''\n        menuUl.style.left = e.clientX + 10 + 'px'\n      }\n    }\n  }\n\n  menuContainer.onclick = e => {\n    if (e.target === menuContainer) menuContainer.hidden = true\n  }\n\n  add_child.onclick = e => {\n    mind.addChild()\n    menuContainer.hidden = true\n  }\n  summary.onclick = e => {\n    mind.addSummary()\n    menuContainer.hidden = true\n  }\n  add_parent.onclick = e => {\n    mind.insertParent()\n    menuContainer.hidden = true\n  }\n  add_sibling.onclick = e => {\n    if (isRoot) return\n    mind.insertSibling()\n    menuContainer.hidden = true\n  }\n  remove_child.onclick = e => {\n    if (isRoot) return\n    mind.removeNode()\n    menuContainer.hidden = true\n  }\n  focus.onclick = e => {\n    if (isRoot) return\n    mind.focusNode(mind.currentNode)\n    menuContainer.hidden = true\n  }\n  unfocus.onclick = e => {\n    mind.cancelFocus()\n    menuContainer.hidden = true\n  }\n  up.onclick = e => {\n    if (isRoot) return\n    mind.moveUpNode()\n    menuContainer.hidden = true\n  }\n  down.onclick = e => {\n    if (isRoot) return\n    mind.moveDownNode()\n    menuContainer.hidden = true\n  }\n  link.onclick = e => {\n    menuContainer.hidden = true\n    const from = mind.currentNode\n    const tips = createTips(i18n[locale].clickTips)\n    mind.container.appendChild(tips)\n    mind.map.addEventListener(\n      'click',\n      e => {\n        e.preventDefault()\n        tips.remove()\n        if (\n          e.target.parentElement.nodeName === 'T' ||\n          e.target.parentElement.nodeName === 'ROOT'\n        ) {\n          const to =mind.currentNode\n          mind.createLink(from,to)\n        } else {\n          console.log('取消连接')\n        }\n      },\n      {\n        once: true,\n      }\n    )\n  }\n  nodeLink.onclick = e => {\n    menuContainer.hidden = true\n    const from = mind.currentNode\n    const tips = createTips(i18n[locale].clickTips)\n    mind.container.appendChild(tips)\n    mind.map.addEventListener(\n      'click',\n      e => {\n        e.preventDefault()\n        tips.remove()\n        if (\n          e.target.parentElement.nodeName === 'T' ||\n          e.target.parentElement.nodeName === 'ROOT'\n        ) {\n          const to =mind.currentNode\n          if(!from.nodeObj.linkJump) from.nodeObj.linkJump=[]\n          from.nodeObj.linkJump.push({\n              toId:to.nodeObj.id,\n              title:to.nodeObj.topic\n            }\n          )\n          mind.shapeTpc(from,from.nodeObj)\n          mind.linkDiv()\n        } else {\n          console.log('取消连接')\n        }\n      },\n      {\n        once: true,\n      }\n    )\n  }\n}\n","import { NodeObj } from \"..\"\nimport { moveToNode } from \"../utils/dom\"\n\nconst img =`<svg style=\"width: 1.3em;height: 1.3em;fill: currentColor;overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"3464\"><path d=\"M909.061224 684.930612c-5.22449 0-10.44898-2.089796-14.628571-6.269388l-291.526531-291.52653c-4.179592-4.179592-10.971429-4.179592-14.628571 0l-143.673469 143.673469c-9.926531 9.926531-22.987755 15.15102-37.093878 15.151021s-27.167347-5.22449-37.093877-15.151021l-39.183674-39.183673c-4.179592-4.179592-10.971429-4.179592-14.628571 0l-187.036735 187.036734c-8.359184 8.359184-21.420408 8.359184-29.779592 0-8.359184-8.359184-8.359184-21.420408 0-29.779591l187.036735-187.036735c20.37551-20.37551 53.289796-20.37551 73.665306 0l39.183673 39.183673c2.612245 2.612245 5.746939 3.134694 7.314286 3.134694s4.702041-0.522449 7.314286-3.134694l143.673469-143.673469c20.37551-20.37551 53.289796-20.37551 73.665306 0l291.526531 291.526531c8.359184 8.359184 8.359184 21.420408 0 29.779591-3.657143 4.179592-8.881633 6.269388-14.106123 6.269388zM846.367347 867.265306H177.632653c-45.97551 0-83.591837-37.616327-83.591837-83.591837V240.326531c0-45.97551 37.616327-83.591837 83.591837-83.591837h668.734694c45.97551 0 83.591837 37.616327 83.591837 83.591837v543.346938c0 45.97551-37.616327 83.591837-83.591837 83.591837zM177.632653 198.530612c-22.987755 0-41.795918 18.808163-41.795918 41.795919v543.346938c0 22.987755 18.808163 41.795918 41.795918 41.795919h668.734694c22.987755 0 41.795918-18.808163 41.795918-41.795919V240.326531c0-22.987755-18.808163-41.795918-41.795918-41.795919H177.632653zM261.22449 303.020408m-52.244898 0a52.244898 52.244898 0 1 0 104.489796 0 52.244898 52.244898 0 1 0-104.489796 0ZM644.179592 768h-365.714286c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.897959h365.714286c11.493878 0 20.897959 9.404082 20.897959 20.897959s-9.404082 20.897959-20.897959 20.897959zM461.322449 670.82449h-182.857143c-11.493878 0-20.897959-9.404082-20.897959-20.897959s9.404082-20.897959 20.897959-20.89796h182.857143c11.493878 0 20.897959 9.404082 20.897959 20.89796s-9.404082 20.897959-20.897959 20.897959z\" p-id=\"3465\"></path></svg>`\n\nfunction queryList(nodeData:NodeObj,cnt:number):string{\n    let res:string=''\n    for(let i =0;i<nodeData.children?.length;i++){\n        // res+=queryList(nodeData.children[i])`\n        res +=`<li class=\"sidebar-links\">${queryList(nodeData.children[i],cnt+1)}</li>`\n    }\n    if(!nodeData?.children||!nodeData.children.length){\n        return `<p class=\"sidebar-title\" id=\"sidebar${nodeData.id}\"><span class=\"arrow\" ${nodeData.topic?'':'style=\"margin-bottom:5px;\"'}\"></span><span>${nodeData.topic?nodeData.topic:img}</span></p>`\n    }else{\n        return `<p class=\"sidebar-title\" id=\"sidebar${nodeData.id}\"><span class=\"arrow ${cnt<2?'down':'right'}\" ${nodeData.topic?'':'style=\"margin-bottom:5px;\"'}></span><span>${nodeData.topic?nodeData.topic:img}</span></p><ul class=\"sidebar-heading open ${cnt<2?'':'hidden'}\">${res}</ul>`\n    }\n    \n}\n\nexport function updateSidebar(mind,sidebar:HTMLElement){\n    const nodeData=mind.nodeData\n    sidebar.innerHTML = `${queryList(nodeData,0)}`\n    sidebar.querySelectorAll('.sidebar-title').forEach((e:HTMLElement)=>{\n        e.onclick=()=>{\n              const down = e.querySelector('.down')\n              const right = e.querySelector('.right')\n              const curActive=mind.container.querySelector('.sidebar-title.active')\n              curActive?.classList.remove('active')\n              if(down){\n                e.parentElement.querySelector('ul').classList.add('hidden')\n                down.classList.replace('down','right')\n              }else if(right){\n                e.parentElement.querySelector('ul').classList.remove('hidden')\n                right.classList.replace('right','down')\n              }\n              e.classList.add('active')\n              moveToNode.call(mind,e.id.replace('sidebar',''))\n        }\n    })\n}\n\nexport default function(mind){\n    const sidebar = document.createElement('sidebar')\n    const nodeData=mind.nodeData\n    sidebar.innerHTML = `${queryList(nodeData,0)}`\n    mind.container.append(sidebar)\n}\n","import { expandNodeChild } from \"../interact\"\nimport { updateSidebar } from \"./sidebar\"\n\nconst createButton = (id, name) => {\n  const button = document.createElement('span')\n  button.id = id\n  button.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\">\n    <use xlink:href=\"#icon-${name}\"></use>\n  </svg>`\n  return button\n}\n\nlet timer = null;\nfunction debounce (fun,wait) {\n  return function () {\n  \tconst argu = arguments;\n  \t// 事件触发，如果之前有等待的事件，则清空计时，重新进行事件等待执行\n    if (timer) {\n      clearTimeout(timer);\n    }\n    timer = setTimeout(function () {\n      fun.apply(this, argu);\n    }, wait);\n  }\n}\n\nfunction createToolBarRBContainer(mind) {\n  const toolBarRBContainer = document.createElement('toolbar')\n  const fc = createButton('fullscreen', 'full')\n  const gc = createButton('toCenter', 'living')\n  const zo = createButton('zoomout', 'move')\n  const zi = createButton('zoomin', 'add')\n  const numberSelection=document.createElement('input')\n  numberSelection.className='numberSelection'\n  numberSelection.type='number'\n  numberSelection.min='2'\n  numberSelection.max='100'\n  numberSelection.step='1'\n  numberSelection.value=mind?.expandDeep?.toString()||'2'\n  numberSelection.oninput=debounce(()=>{\n    const data=mind.getAllDataWithAutoHide()\n    expandNodeChild(data?.nodeData)\n    mind.layout()\n    mind.linkDiv()\n  },300)\n\n  \n  const percentage = document.createElement('span')\n  percentage.innerText = '100%'\n  toolBarRBContainer.appendChild(numberSelection)\n  toolBarRBContainer.appendChild(fc)\n  toolBarRBContainer.appendChild(gc)\n  toolBarRBContainer.appendChild(zo)\n  toolBarRBContainer.appendChild(zi)\n  if (mind.uploadButton) {\n    const uploadButton = createUploadButton(mind)\n    toolBarRBContainer.appendChild(uploadButton)\n  }\n  // toolBarRBContainer.appendChild(percentage)\n  toolBarRBContainer.className = 'rb'\n  fc.onclick = () => {\n    mind.container.requestFullscreen()\n  }\n  gc.onclick = () => {\n    mind.toTopLeft()\n  }\n  zo.onclick = () => {\n    if (mind.scaleVal < 0.6) return\n    mind.scale((mind.scaleVal -= 0.2))\n  }\n  zi.onclick = () => {\n    if (mind.scaleVal > 1.6) return\n    mind.scale((mind.scaleVal += 0.2))\n  }\n  mind.bus.addListener('wheel',e=>{\n    const viewBTop=e.pageY-e.clientY+document.documentElement.clientHeight\n    const mindBTop = mind.container.getBoundingClientRect().top+window.scrollY-mind.container.clientTop+mind.container.clientHeight\n    //bottom 20\n    const offsetTop= mindBTop-viewBTop>0?mindBTop-viewBTop:0\n    const offset=offsetTop+toolBarRBContainer.clientHeight-20\n    if(offset>20&&offset<mind.container.clientHeight-toolBarRBContainer.clientHeight-20)\n      toolBarRBContainer.style.bottom=offset+'px'\n  })\n  return toolBarRBContainer\n}\n\n\nfunction createToolBarLTContainer(mind) {\n  const toolBarLTContainer = document.createElement('toolbar')\n  const menu  = createButton('sidebar', 'menu')\n  const l = createButton('tbltl', 'left')\n  const r = createButton('tbltr', 'right')\n  const s = createButton('tblts', 'side')\n  toolBarLTContainer.appendChild(menu)\n  toolBarLTContainer.appendChild(l)\n  toolBarLTContainer.appendChild(r)\n  toolBarLTContainer.appendChild(s)\n  toolBarLTContainer.className = 'lt'\n\n  \n  menu.onclick=() => {\n    const sidebar =document.querySelector('sidebar')\n    updateSidebar(mind,sidebar as HTMLElement)\n    if(sidebar.classList.contains('selected')){\n      sidebar.removeAttribute('class')\n    }else{\n      sidebar.setAttribute('class','selected')\n    }\n  }\n  l.onclick = () => {\n    mind.initLeft()\n  }\n  r.onclick = () => {\n    mind.initRight()\n  }\n  s.onclick = () => {\n    mind.initSide()\n  }\n  mind.bus.addListener('wheel',e=>{\n    const viewTop=e.pageY-e.clientY\n    const mindTop = mind.container.getBoundingClientRect().top+window.scrollY-mind.container.clientTop\n    const offset=viewTop-mindTop+20\n    if(offset>20&&offset<mind.container.clientHeight-toolBarLTContainer.clientHeight-20)\n      toolBarLTContainer.style.top=offset+'px'\n  })\n  return toolBarLTContainer\n}\n\nfunction createCloseButton(mind){\n  const close = createButton('close','close')\n  close.onclick=()=>{\n    console.log('关闭')\n    mind.bus.fire('close',{})\n  }\n  return close\n}\n\nfunction createUploadButton(mind){\n  const button = document.createElement('span')\n  button.innerHTML = `\n  <form action=\"\" enctype=\"multipart/form-data\" method=\"post\" class=\"fm\">\n    <input type=\"file\" name=\"file\" class=\"selectFile\">\n  </form>\n  <svg t=\"1662362270319\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"2591\" width=\"200\" height=\"200\">\n  <path d=\"M324.6592 352.13312c7.1168 0 13.34272-2.66752 18.688-8.00768l141.50656-141.51168v443.2128c0 15.12448 11.5712 26.70592 26.7008 26.70592s26.7008-11.58144 26.7008-26.70592V202.61376l141.50656 141.51168c5.34528 5.34016 12.4672 8.00768 18.688 8.00768 6.23616 0 13.35296-2.66752 18.69312-8.00768 10.68032-10.68032 10.68032-27.59168 0-37.38112l-186.9056-186.89536c-0.88576-0.89088-2.66752-2.66752-4.44416-3.5584-0.88576 0-1.77664-0.89088-1.77664-0.89088-0.896-0.88576-1.78688-0.88576-2.67776-1.77664-0.89088 0-1.77664-0.89088-2.66752-0.89088-0.896 0-1.77664-0.89088-2.66752-0.89088a21.67296 21.67296 0 0 0-10.68032 0c-0.89088 0-1.77664 0.89088-2.66752 0.89088-0.89088 0-1.78176 0.89088-2.67264 0.89088-0.89088 0-1.77664 0.89088-2.66752 1.77664-0.89088 0-1.77664 0.89088-1.77664 0.89088-1.78176 0.89088-2.66752 1.78176-4.4544 3.5584L304.18944 306.74432c-10.68032 10.68032-10.68032 27.59168 0 37.38112 7.1168 5.34016 13.34784 8.00768 20.46976 8.00768z\" fill=\"#333333\" p-id=\"2592\"></path><path d=\"M929.84832 556.83072c-15.1296 0-26.7008 11.5712-26.7008 26.7008v206.47936c0 38.272-31.15008 69.42208-69.41696 69.42208H189.37856c-38.26688 0-69.41696-31.15008-69.41696-69.42208v-206.47936c0-15.1296-11.5712-26.7008-26.7008-26.7008s-26.69568 11.5712-26.69568 26.7008v206.47936c0 67.6352 55.17824 122.81856 122.81856 122.81856h645.23776c67.64544 0 122.82368-55.18336 122.82368-122.81856v-206.47936c-0.896-15.1296-12.4672-26.7008-27.5968-26.7008z\" \n  fill=\"#333333\" p-id=\"2593\"></path>\n  </svg>\n  `\n  const fm = button.children[0];\n  fm.addEventListener(\"change\", e => {\n    mind.bus.fire('upload', fm)\n  })\n  return button\n}\n\n\nexport default function(mind) {\n  mind.container.append(createToolBarRBContainer(mind))\n  mind.container.append(createToolBarLTContainer(mind))\n  mind.closeButton && mind.container.append(createCloseButton(mind))\n}\n","import i18n from '../i18n'\n\nconst createDiv = (id) => {\n  const div = document.createElement('div')\n  div.id = id\n  return div\n}\n\nconst colorList = [\n  '#2c3e50',\n  '#34495e',\n  '#7f8c8d',\n  '#94a5a6',\n  '#bdc3c7',\n  '#ffffff',\n  '#8e44ad',\n  '#9b59b6',\n  '#2980b9',\n  '#3298db',\n  '#c0392c',\n  '#e74c3c',\n  '#d35400',\n  '#f39c11',\n  '#f1c40e',\n  '#17a085',\n  '#27ae61',\n  '#2ecc71',\n]\n\nexport default function(mind) {\n  const locale = i18n[mind.locale] ? mind.locale : 'en'\n  let bgOrFont\n  const styleDiv = createDiv('nm-style')\n  const tagDiv = createDiv('nm-tag')\n  const iconDiv = createDiv('nm-icon')\n  //different from \"linkDiv\" which is aims to link nodes with svg,\n  const linkDiv = createDiv('nm-link')\n  const remarkDiv = createDiv('nm-remark')\n  styleDiv.innerHTML = `\n      <div class=\"nm-fontsize-container\">\n        ${['15', '24', '32']\n    .map(size => {\n      return `<div class=\"size\"  data-size=\"${size}\">\n        <svg class=\"icon\" style=\"width: ${size}px;height: ${size}px\" aria-hidden=\"true\">\n          <use xlink:href=\"#icon-a\"></use>\n        </svg></div>`\n    })\n    .join('')}<div class=\"bold\"><svg class=\"icon\" aria-hidden=\"true\">\n  <use xlink:href=\"#icon-B\"></use>\n  </svg></div>\n      </div>\n      <div class=\"nm-fontcolor-container\">\n        ${colorList\n    .map(color => {\n      return `<div class=\"split6\"><div class=\"palette\" data-color=\"${color}\" style=\"background-color: ${color};\"></div></div>`\n    })\n    .join('')}\n      </div>\n      <div class=\"bof\">\n      <span class=\"font\">${i18n[locale].font}</span>\n      <span class=\"background\">${i18n[locale].background}</span>\n      </div>\n  `\n  tagDiv.innerHTML = `${i18n[locale].tag}<input class=\"nm-tag\" tabindex=\"-1\" placeholder=\"${i18n[locale].tagsSeparate}\" /><br>`\n  iconDiv.innerHTML = `${i18n[locale].icon}<input class=\"nm-icon\" tabindex=\"-1\" placeholder=\"${i18n[locale].iconsSeparate}\" /><br>`\n  linkDiv.innerHTML = `${i18n[locale].hyperlink}<input class=\"nm-link\" tabindex=\"-1\" placeholder=\"${i18n[locale].linkSeparate}\" /><br>`\n  remarkDiv.innerHTML = `${i18n[locale].remark}<input class=\"nm-remark\" tabindex=\"-1\" placeholder=\"${i18n[locale].reamrkSeparate}\" /><br>`\n\n  const menuContainer = document.createElement('nmenu')\n  menuContainer.innerHTML = `\n  <div class=\"button-container\"><svg class=\"icon\" aria-hidden=\"true\">\n  <use xlink:href=\"#icon-close\"></use>\n  </svg></div>\n  `\n  menuContainer.appendChild(styleDiv)\n  menuContainer.appendChild(tagDiv)\n  menuContainer.appendChild(iconDiv)\n  menuContainer.appendChild(linkDiv) \n  menuContainer.appendChild(remarkDiv)\n  menuContainer.hidden = true\n\n  function clearSelect(klass, remove) {\n    var elems = mind.container.querySelectorAll(klass)\n    ;[].forEach.call(elems, function(el) {\n      el.classList.remove(remove)\n    })\n  }\n\n  mind.container.append(menuContainer)\n  const sizeSelector = menuContainer.querySelectorAll('.size')\n  const bold:HTMLElement = menuContainer.querySelector('.bold')\n  const buttonContainer:HTMLElement = menuContainer.querySelector('.button-container')\n  const fontBtn:HTMLElement = menuContainer.querySelector('.font')\n  const tagInput:HTMLInputElement = mind.container.querySelector('.nm-tag')\n  const iconInput:HTMLInputElement = mind.container.querySelector('.nm-icon')\n  const linkInput:HTMLInputElement = mind.container.querySelector('.nm-link')\n  const remarkInput:HTMLInputElement = mind.container.querySelector('.nm-remark')\n  menuContainer.onclick = e => {\n    if (!mind.currentNode) return\n    const nodeObj = mind.currentNode.nodeObj\n    const target = e.target as HTMLElement\n    if (target.className === 'palette') {\n      if (!nodeObj.style) nodeObj.style = {}\n      clearSelect('.palette', 'nmenu-selected')\n      target.className = 'palette nmenu-selected'\n      if (bgOrFont === 'font') {\n        nodeObj.style.color = target.dataset.color\n      } else if (bgOrFont === 'background') {\n        nodeObj.style.background = target.dataset.color\n      }\n      mind.updateNodeStyle(nodeObj)\n    } else if (target.className === 'background') {\n      clearSelect('.palette', 'nmenu-selected')\n      bgOrFont = 'background'\n      target.className = 'background selected'\n      target.previousElementSibling.className = 'font'\n      if (nodeObj.style && nodeObj.style.background) {\n        menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.background + '\"]'\n        ).className = 'palette nmenu-selected'\n      }\n    } else if (target.className === 'font') {\n      clearSelect('.palette', 'nmenu-selected')\n      bgOrFont = 'font'\n      target.className = 'font selected'\n      target.nextElementSibling.className = 'background'\n      if (nodeObj.style && nodeObj.style.color) {\n        menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.color + '\"]'\n        ).className = 'palette nmenu-selected'\n      }\n    }\n  }\n  Array.from(sizeSelector).map(\n    dom => {\n      (dom as HTMLElement).onclick = e => {\n        if (!mind.currentNode.nodeObj.style) mind.currentNode.nodeObj.style = {}\n        clearSelect('.size', 'size-selected')\n        const size = e.currentTarget as HTMLElement\n        mind.currentNode.nodeObj.style.fontSize = size.dataset.size\n        size.className = 'size size-selected'\n        mind.updateNodeStyle(mind.currentNode.nodeObj)\n      }\n    }\n  )\n  bold.onclick = (e:MouseEvent & { currentTarget: Element}) => {\n    if (!mind.currentNode.nodeObj.style) mind.currentNode.nodeObj.style = {}\n    if (mind.currentNode.nodeObj.style.fontWeight === 'bold') {\n      delete mind.currentNode.nodeObj.style.fontWeight\n      e.currentTarget.className = 'bold'\n      mind.updateNodeStyle(mind.currentNode.nodeObj)\n    } else {\n      mind.currentNode.nodeObj.style.fontWeight = 'bold'\n      e.currentTarget.className = 'bold size-selected'\n      mind.updateNodeStyle(mind.currentNode.nodeObj)\n    }\n  }\n  tagInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      let newTags\n      if(e.target.value==='')\n        newTags=[]\n      else\n        newTags = e.target.value.split(',')\n      mind.updateNodeTags(mind.currentNode.nodeObj, newTags)\n    }\n  }\n  iconInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const newIcons = e.target.value.split(',')\n      mind.updateNodeIcons(mind.currentNode.nodeObj, newIcons)\n    }\n  }\n  linkInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const link = e.target.value\n      mind.updateNodeHyperLink(mind.currentNode.nodeObj, link)\n    }\n  }\n  remarkInput.onchange = (e:InputEvent & { target: HTMLInputElement}) => {\n    if (!mind.currentNode) return\n    if (e.target.value!==null||e.target.value!==undefined) {\n      const input = e.target.value\n      mind.updateNodeRemark(mind.currentNode.nodeObj, input)\n    }\n  }\n  let state = 'open'\n  buttonContainer.onclick = e => {\n    if (state === 'open') {\n      state = 'close'\n      menuContainer.className = 'close'\n      buttonContainer.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\"><use xlink:href=\"#icon-menu\"></use></svg>`\n    } else {\n      state = 'open'\n      menuContainer.className = ''\n      buttonContainer.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\"><use xlink:href=\"#icon-close\"></use></svg>`\n    }\n  }\n  mind.bus.addListener('unselectNode', function() {\n    menuContainer.hidden = true\n  })\n  mind.bus.addListener('selectNode', function(nodeObj, clickEvent) {\n    if (!clickEvent) return\n    menuContainer.hidden = false\n    clearSelect('.palette', 'nmenu-selected')\n    clearSelect('.size', 'size-selected')\n    clearSelect('.bold', 'size-selected')\n    bgOrFont = 'font'\n    fontBtn.className = 'font selected'\n    fontBtn.nextElementSibling.className = 'background'\n    if (nodeObj.style) {\n      if (nodeObj.style.fontSize) {\n        const dataSize = menuContainer.querySelector(\n          '.size[data-size=\"' + nodeObj.style.fontSize + '\"]'\n        )\n        if(dataSize) dataSize.className = 'size size-selected'\n      }\n      if (nodeObj.style.fontWeight) { \n        const dataWeight = menuContainer.querySelector('.bold')\n        if(dataWeight) dataWeight.className = 'bold size-selected' \n      }\n      if (nodeObj.style.color) {\n        const dataColor=menuContainer.querySelector(\n          '.palette[data-color=\"' + nodeObj.style.color + '\"]'\n        )\n        if(dataColor) dataColor.className = 'palette nmenu-selected'\n      }\n    }\n    if (nodeObj.tags) {\n      tagInput.value = nodeObj.tags.join(',')\n    } else {\n      tagInput.value = '' \n    }\n    if (nodeObj.icons) {\n      iconInput.value = nodeObj.icons.join(',')\n    } else {\n      iconInput.value = ''\n    }\n    linkInput.value=''\n    if (nodeObj.hyperLink) {\n      linkInput.value = nodeObj.hyperLink\n    } \n    if(nodeObj.linkJump){\n      if(linkInput.value.length>0) linkInput.value+=','\n      linkInput.value += nodeObj.linkJump.map(val=>val.title).reduce((preVal,curVal,index)=>preVal+(index?',':'')+curVal,'')\n    }\n    if (nodeObj.remark) {\n      remarkInput.value = nodeObj.remark\n    } else {\n      remarkInput.value = ''\n    }\n  })\n}\n","import { dragMoveHelper, throttle } from '../utils/index'\nimport { findEle as E, Topic, Group } from '../utils/dom'\n// https://html.spec.whatwg.org/multipage/dnd.html#drag-and-drop-processing-model\n\nconst $d = document\nconst insertPreview = function(el, insertLocation) {\n  if (!insertLocation) {\n    clearPreview(el)\n    return el\n  }\n  const query = el.getElementsByClassName('insert-preview')\n  const className = `insert-preview ${insertLocation} show`\n  if (query.length > 0) {\n    query[0].className = className\n  } else {\n    const insertPreviewEL = $d.createElement('div')\n    insertPreviewEL.className = className\n    el.appendChild(insertPreviewEL)\n  }\n  return el\n}\n\nconst clearPreview = function(el) {\n  if (!el) return\n  const query = el.getElementsByClassName('insert-preview')\n  for (const queryElement of query || []) {\n    queryElement.remove()\n  }\n}\n\nconst canPreview = function(el:Element, dragged:Topic) {\n  const isContain = dragged.parentNode.parentNode.contains(el)\n  return (\n    el &&\n    el.tagName === 'TPC' &&\n    el !== dragged &&\n    !isContain &&\n    (el as Topic).nodeObj.root !== true\n  )\n}\n\nexport default function(mind) {\n  let dragged: Topic\n  let insertLocation:string\n  let meet: Element\n  const threshold = 12\n\n  mind.map.addEventListener('dragstart', function(e) {\n    dragged = e.target\n    ;(dragged.parentNode.parentNode as Group).style.opacity = '0.5'\n    dragMoveHelper.clear()\n  })\n\n  mind.map.addEventListener('dragend', async function(e: DragEvent) {\n    (e.target as HTMLElement).style.opacity = ''\n    clearPreview(meet)\n    const obj = dragged.nodeObj\n    switch (insertLocation) {\n      case 'before':\n        mind.moveNodeBefore(dragged, meet)\n        mind.selectNode(E(obj.id))\n        break\n      case 'after':\n        mind.moveNodeAfter(dragged, meet)\n        mind.selectNode(E(obj.id))\n        break\n      case 'in':\n        mind.moveNode(dragged, meet)\n        break\n    }\n    ;(dragged.parentNode.parentNode as Group).style.opacity = '1'\n    dragged = null\n  })\n\n  mind.map.addEventListener('dragover', throttle(function(e: DragEvent) {\n    // console.log('drag', e)\n    clearPreview(meet)\n    // minus threshold infer that postion of the cursor is above topic\n    const topMeet = $d.elementFromPoint(\n      e.clientX,\n      e.clientY - threshold\n    )\n    if (canPreview(topMeet, dragged)) {\n      meet = topMeet\n      const y = topMeet.getBoundingClientRect().y\n      if (e.clientY > y + topMeet.clientHeight) {\n        insertLocation = 'after'\n      } else if (e.clientY > y + topMeet.clientHeight / 2) {\n        insertLocation = 'in'\n      }\n    } else {\n      const bottomMeet = $d.elementFromPoint(\n        e.clientX,\n        e.clientY + threshold\n      )\n      if (canPreview(bottomMeet, dragged)) {\n        meet = bottomMeet\n        const y = bottomMeet.getBoundingClientRect().y\n        if (e.clientY < y) {\n          insertLocation = 'before'\n        } else if (e.clientY < y + bottomMeet.clientHeight / 2) {\n          insertLocation = 'in'\n        }\n      } else {\n        insertLocation = meet = null\n      }\n    }\n    if (meet) insertPreview(meet, insertLocation)\n  }, 200))\n}\n","export default function(mind) {\n  const key2func = {\n    13: () => {\n      // enter\n      mind.insertSibling()\n    },\n    9: () => {\n      // tab\n      mind.addChild()\n    },\n    17: e => {\n      // controll\n      mind.ctrlRepeat=true\n      console.log('按下controll')\n    },\n    91: e => {\n      // command\n      mind.ctrlRepeat=true\n      console.log('按下command')\n    },\n    113: () => {\n      // f2\n      mind.beginEdit()\n    },\n    38: () => {\n      // up\n      mind.selectPrevSibling()\n    },\n    40: () => {\n      // down\n      mind.selectNextSibling()\n    },\n    37: () => {\n      // left\n      if (!mind.currentNode) return\n      if (mind.currentNode.offsetParent.offsetParent.className === 'rhs') {\n        mind.selectParent()\n      } else if (\n        mind.currentNode.offsetParent.offsetParent.className === 'lhs' ||\n        mind.currentNode.nodeObj.root\n      ) {\n        mind.selectFirstChild()\n      }\n    },\n    39: () => {\n      // right\n      if (!mind.currentNode) return\n      if (\n        mind.currentNode.offsetParent.offsetParent.className === 'rhs' ||\n        mind.currentNode.nodeObj.root\n      ) {\n        mind.selectFirstChild()\n      } else if (\n        mind.currentNode.offsetParent.offsetParent.className === 'lhs'\n      ) {\n        mind.selectParent()\n      }\n    },\n    33() {\n      // pageUp\n      mind.moveUpNode()\n    },\n    34() {\n      // pageDown\n      mind.moveDownNode()\n    },\n    67(e) {\n      if (e.metaKey || e.ctrlKey) {\n      // ctrl c\n        mind.waitCopy = mind.currentNode\n      }\n    },\n    86(e) {\n      if (!mind.waitCopy) return\n      if (e.metaKey || e.ctrlKey) {\n      // ctrl v\n        mind.copyNode(mind.waitCopy, mind.currentNode)\n        mind.waitCopy = null\n      }\n    },\n    // ctrl z\n    90: e => {\n      if (!mind.allowUndo) return\n      if (e.metaKey || e.ctrlKey) mind.undo()\n    },\n    // ctrl +\n    187: e => {\n      if (e.metaKey || e.ctrlKey) {\n        if (mind.scaleVal > 1.6) return\n        mind.scale((mind.scaleVal += 0.2))\n      }\n    },\n    // ctrl -\n    189: e => {\n      if (e.metaKey || e.ctrlKey) {\n        if (mind.scaleVal < 0.6) return\n        mind.scale((mind.scaleVal -= 0.2))\n      }\n    },\n  }\n  mind.map.onkeydown = e => {\n    // console.log(e)\n    // e.preventDefault()\n    if (!mind.editable) return\n    // console.log(e, e.target)\n    if (e.target !== e.currentTarget) {\n      // input\n      return\n    }\n    if (e.keyCode === 8 || e.keyCode === 46) {\n      // del,backspace\n      if (mind.currentLink) mind.removeLink()\n      else mind.removeNode()\n    } else {\n      key2func[e.keyCode] && key2func[e.keyCode](e)\n    }\n  }\n  mind.map.onkeyup = e => {\n    if (e.keyCode === 17 || e.keyCode === 91) {\n      mind.ctrlRepeat=false\n    }\n  }\n}\n","export default function(mind, option?) {\n  const createLi = (id, name) => {\n    const div = document.createElement('div')\n    div.id = id\n    div.innerHTML = `<svg class=\"icon\" aria-hidden=\"true\">\n    <use xlink:href=\"#icon-${name}\"></use>\n  </svg>`\n    return div\n  }\n\n  const add_child = createLi('cm-add_child', 'zijiedian')\n  const add_sibling = createLi('cm-add_sibling', 'tongjijiedian-')\n  const remove_child = createLi('cm-remove_child', 'shanchu2')\n  // let focus = createLi('cm-fucus', i18n[locale].focus, '')\n  // let unfocus = createLi('cm-unfucus', i18n[locale].cancelFocus, '')\n  const up = createLi('cm-up', 'rising')\n  const down = createLi('cm-down', 'falling')\n  const edit = createLi('cm-edit', 'edit')\n  // let link = createLi('cm-down', i18n[locale].link, '')\n\n  const menuUl = document.createElement('ul')\n  menuUl.className = 'menu-list'\n  // if (!option || option.link) {\n  //   menuUl.appendChild(link)\n  // }\n  if (option && option.extend) {\n    for (let i = 0; i < option.extend.length; i++) {\n      const item = option.extend[i]\n      const dom = createLi(item.name, item.name)\n      menuUl.appendChild(dom)\n      dom.onclick = e => {\n        item.onclick(e)\n      }\n    }\n  }\n  const menuContainer = document.createElement('mmenu')\n  menuContainer.appendChild(add_child)\n  menuContainer.appendChild(add_sibling)\n  menuContainer.appendChild(remove_child)\n  // if (!option || option.focus) {\n  //   menuContainer.appendChild(focus)\n  //   menuContainer.appendChild(unfocus)\n  // }\n  menuContainer.appendChild(up)\n  menuContainer.appendChild(down)\n  menuContainer.appendChild(edit)\n  menuContainer.hidden = true\n\n  mind.container.append(menuContainer)\n  let isRoot = true\n  // mind.container.onclick = function (e) {\n  //   e.preventDefault()\n  //   // console.log(e.pageY, e.screenY, e.clientY)\n  //   let target = e.target\n  //   if (target.tagName === 'TPC') {\n  //     if (target.parentElement.tagName === 'ROOT') {\n  //       isRoot = true\n  //     } else {\n  //       isRoot = false\n  //     }\n  //     // if (isRoot) {\n  //     //   focus.className = 'disabled'\n  //     //   up.className = 'disabled'\n  //     //   down.className = 'disabled'\n  //     //   add_sibling.className = 'disabled'\n  //     //   remove_child.className = 'disabled'\n  //     // } else {\n  //     //   focus.className = ''\n  //     //   up.className = ''\n  //     //   down.className = ''\n  //     //   add_sibling.className = ''\n  //     //   remove_child.className = ''\n  //     // }\n  //     mind.selectNode(target)\n  //     menuContainer.hidden = false\n  //     let height = menuUl.offsetHeight\n  //     let width = menuUl.offsetWidth\n  //     let rect = target.getBoundingClientRect()\n  //     // menuUl.style.top = rect.top - 10 - height + 'px'\n  //     // menuUl.style.left = rect.left - (width - rect.width) / 2 + 'px'\n  //     // menuUl.style.left = e.clientX + 'px'\n  //   }\n  // }\n\n  mind.bus.addListener('unselectNode', function() {\n    menuContainer.hidden = true\n  })\n  mind.bus.addListener('selectNode', function(nodeObj) {\n    menuContainer.hidden = false\n    if (nodeObj.root) {\n      isRoot = true\n    } else {\n      isRoot = false\n    }\n  })\n  menuContainer.onclick = e => {\n    if (e.target === menuContainer) menuContainer.hidden = true\n  }\n\n  add_child.onclick = e => {\n    mind.addChild()\n  }\n  add_sibling.onclick = e => {\n    if (isRoot) return\n    mind.insertSibling()\n  }\n  remove_child.onclick = e => {\n    if (isRoot) return\n    mind.removeNode()\n  }\n  // focus.onclick = e => {\n  //   if (isRoot) return\n  //   mind.focusNode(mind.currentNode)\n  //   menuContainer.hidden = true\n  // }\n  // unfocus.onclick = e => {\n  //   mind.cancelFocus()\n  //   menuContainer.hidden = true\n  // }\n  up.onclick = e => {\n    if (isRoot) return\n    mind.moveUpNode()\n  }\n  down.onclick = e => {\n    if (isRoot) return\n    mind.moveDownNode()\n  }\n  edit.onclick = e => {\n    mind.beginEdit()\n  }\n  // link.onclick = e => {\n  //   let from = mind.currentNode\n  //   mind.map.addEventListener(\n  //     'click',\n  //     e => {\n  //       e.preventDefault()\n  //       if (\n  //         e.target.parentElement.nodeName === 'T' ||\n  //         e.target.parentElement.nodeName === 'ROOT'\n  //       ) {\n  //         mind.createLink(from, mind.currentNode)\n  //       } else {\n  //         console.log('取消连接')\n  //       }\n  //     },\n  //     {\n  //       once: true,\n  //     }\n  //   )\n  // }\n}\n","export default function Bus() {\n  this.handlers = {}\n}\nBus.prototype = {\n  showHandler: function() {\n    console.log(this.handlers)\n  },\n  addListener: function(type, handler) {\n    if (this.handlers[type] === undefined) this.handlers[type] = []\n    this.handlers[type].push(handler)\n  },\n  fire: function(type, ...payload) {\n    if (this.handlers[type] instanceof Array) {\n      var handlers = this.handlers[type]\n      for (var i = 0; i < handlers.length; i++) {\n        handlers[i](...payload)\n      }\n    }\n  },\n  removeListener: function(type, handler) {\n    if (!this.handlers[type]) return\n    var handlers = this.handlers[type]\n    if (!handler) {\n      handlers.length = 0\n    } else if (handlers.length) {\n      for (var i = 0; i < handlers.length; i++) {\n        if (handlers[i] === handler) {\n          this.handlers[type].splice(i, 1)\n        }\n      }\n    }\n  },\n}\n","!function(t){var c,l,a,e,o,i,n='<svg><symbol id=\"icon-edit\" viewBox=\"0 0 1024 1024\"><path d=\"M423.765333 128a42.666667 42.666667 0 0 1 3.2 85.205333L423.765333 213.333333H234.666667a64 64 0 0 0-63.872 60.245334L170.666667 277.333333v512a64 64 0 0 0 60.245333 63.872L234.666667 853.333333h512a64 64 0 0 0 63.872-60.245333L810.666667 789.333333v-189.098666a42.666667 42.666667 0 0 1 85.205333-3.2l0.128 3.2V789.333333a149.333333 149.333333 0 0 1-144.213333 149.248L746.666667 938.666667h-512a149.333333 149.333333 0 0 1-149.248-144.213334L85.333333 789.333333v-512a149.333333 149.333333 0 0 1 144.213334-149.248L234.666667 128h189.098666z m324.949334-53.248a42.666667 42.666667 0 0 1 60.330666 0l150.869334 150.869333a42.666667 42.666667 0 0 1 0 60.330667l-329.386667 329.386667a42.666667 42.666667 0 0 1-29.44 12.458666l-153.386667 2.517334a42.666667 42.666667 0 0 1-43.349333-43.349334l2.56-153.386666a42.666667 42.666667 0 0 1 12.458667-29.44z m30.165333 90.496L491.946667 452.266667l-1.493334 91.989333 92.032-1.493333 286.976-286.976-90.538666-90.538667z\"  ></path></symbol><symbol id=\"icon-rising\" viewBox=\"0 0 1024 1024\"><path d=\"M553.173333 803.84h-64l0.021334-474.581333-224.021334 224-45.269333-45.226667L521.6 206.293333l301.717333 301.696-45.269333 45.269334-224.853333-224.896v475.477333z\"  ></path></symbol><symbol id=\"icon-falling\" viewBox=\"0 0 1024 1024\"><path d=\"M553.173333 238.314667h-64l0.021334 474.602666-224.021334-224-45.269333 45.226667L521.6 835.861333l301.717333-301.717333-45.269333-45.226667-224.853333 224.853334V238.336z\"  ></path></symbol><symbol id=\"icon-shanchu2\" viewBox=\"0 0 1024 1024\"><path d=\"M516.60601807 107.93026734c-82.64382935 0-149.71865844 65.51751709-152.5729065 147.77160644H171.37136841c-21.40603638 0-38.92044068 17.38504028-38.92044068 38.92126465 0 21.40686036 17.38504028 38.92208862 38.92126466 38.92208862h42.94308471v435.40136719c0 81.73498536 55.39828492 148.55026245 123.90106201 148.55026245h348.99444581c68.37341309 0 123.90106201-66.42553711 123.901062-148.55026245V333.80477906h38.92126465c21.40686036 0 38.92126464-17.38586426 38.92126465-38.92208863 0-21.40686036-17.38504028-38.92126464-38.92126465-38.92126465H668.91854859C666.45321656 173.44860839 599.24902344 107.93109131 516.60601807 107.93109131z m-79.65939331 147.77160644c2.85424805-42.16442872 37.2354126-74.85809326 79.78875732-74.85809326s76.93450927 32.82302857 79.39984131 74.85809326H436.94662476z m-98.86047364 589.01165771c-24.2611084 0-50.98754883-31.13717651-50.98754883-75.76693725V333.80477906h450.97036744V769.33551026c0 44.50039673-26.72644043 75.76776123-50.98754884 75.76776122H338.08615112v-0.38973999z m0 0\"  ></path><path d=\"M390.37063599 751.17263794c17.77313232 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.77478027 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.27124023 40.08883667 32.43493653 40.08883667z m117.41308594 0c17.7739563 0 32.43411255-17.7739563 32.43411255-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43411255-40.08966065-17.7739563 0-32.43493653 17.77478027-32.43493653 40.08966065v228.72875976c0 22.18469239 14.66098023 40.08883667 32.43493653 40.08883667z m123.51049804 0c17.7739563 0 32.43493653-17.7739563 32.43493652-40.08883667V482.35504151c0-22.31488037-14.53079224-40.08966065-32.43493652-40.08966065-17.7739563 0-32.43411255 17.77478027-32.43411255 40.08966065v228.72875976c0 22.18469239 14.14105224 40.08883667 32.43411255 40.08883667z m0 0\"  ></path></symbol><symbol id=\"icon-zijiedian\" viewBox=\"0 0 1024 1024\"><path d=\"M312.208 472c19.568-157.856 153.432-280 315.656-280 175.68 0 318.112 143.272 318.112 320S803.552 832 627.864 832c-162.224 0-296.08-122.144-315.656-280H120a40 40 0 0 1 0-80h192.208zM632 752c132.552 0 240-107.448 240-240 0-132.552-107.448-240-240-240-132.552 0-240 107.448-240 240 0 132.552 107.448 240 240 240z m-40-280v-80a40 40 0 0 1 80 0v80h80a40 40 0 0 1 0 80h-80v80a40 40 0 0 1-80 0v-80h-80a40 40 0 0 1 0-80h80z\"  ></path></symbol><symbol id=\"icon-tongjijiedian-\" viewBox=\"0 0 1024 1024\"><path d=\"M803.84 131.626667H410.24A59.733333 59.733333 0 0 0 350.506667 192v45.226667H199.68a51.626667 51.626667 0 0 0-51.626667 51.626666v465.92a51.626667 51.626667 0 0 0 51.626667 51.626667h187.52v-55.466667h-162.133333a21.333333 21.333333 0 0 1-21.333334-21.333333V313.386667a21.333333 21.333333 0 0 1 21.333334-21.333334h125.653333v64a59.733333 59.733333 0 0 0 59.733333 59.733334h393.386667a59.733333 59.733333 0 0 0 59.733333-59.733334V192a59.733333 59.733333 0 0 0-59.733333-60.373333z m4.266667 224.64a4.266667 4.266667 0 0 1-4.266667 4.266666H410.24a4.266667 4.266667 0 0 1-4.266667-4.266666V192a4.266667 4.266667 0 0 1 4.266667-4.266667h393.6a4.266667 4.266667 0 0 1 4.266667 4.266667zM716.16 749.44h-81.28v-81.493333a27.733333 27.733333 0 0 0-55.466667 0v81.28h-81.493333a27.733333 27.733333 0 1 0 0 55.466666h81.28v81.28a27.733333 27.733333 0 1 0 55.466667 0v-81.066666h81.28a27.733333 27.733333 0 0 0 0-55.466667z\"  ></path></symbol><symbol id=\"icon-close\" viewBox=\"0 0 1024 1024\"><path d=\"M557.312 513.248l265.28-263.904c12.544-12.48 12.608-32.704 0.128-45.248-12.512-12.576-32.704-12.608-45.248-0.128L512.128 467.904l-263.04-263.84c-12.448-12.48-32.704-12.544-45.248-0.064-12.512 12.48-12.544 32.736-0.064 45.28l262.976 263.776L201.6 776.8c-12.544 12.48-12.608 32.704-0.128 45.248a31.937 31.937 0 0 0 22.688 9.44c8.16 0 16.32-3.104 22.56-9.312l265.216-263.808 265.44 266.24c6.24 6.272 14.432 9.408 22.656 9.408a31.94 31.94 0 0 0 22.592-9.344c12.512-12.48 12.544-32.704 0.064-45.248L557.312 513.248z\" fill=\"\" ></path></symbol><symbol id=\"icon-menu\" viewBox=\"0 0 1024 1024\"><path d=\"M109.714 292.571h804.572c21.943 0 36.571-21.942 36.571-43.885 0-14.629-14.628-29.257-36.571-29.257H109.714c-21.943 0-36.571 14.628-36.571 36.571 0 14.629 14.628 36.571 36.571 36.571zM914.286 512H109.714c-21.943 0-36.571 14.629-36.571 36.571 0 14.629 14.628 36.572 36.571 36.572h804.572c21.943 0 36.571-21.943 36.571-43.886 0-14.628-14.628-29.257-36.571-29.257z m0 292.571H109.714c-21.943 0-36.571 14.629-36.571 36.572s14.628 36.571 36.571 36.571h804.572c21.943 0 36.571-21.943 36.571-36.571 0-21.943-14.628-36.572-36.571-36.572z\"  ></path></symbol><symbol id=\"icon-right\" viewBox=\"0 0 1024 1024\"><path d=\"M385 560.69999999L385 738.9c0 36.90000001 26.4 68.5 61.3 68.5l150.2 0c1.5 0 3-0.1 4.5-0.3 10.2 38.7 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-42 0-77.3 28.6-87.5 67.39999999-1.4-0.3-2.9-0.4-4.5-0.39999999L446.3 760.4c-6.8 0-14.3-8.9-14.3-21.49999999l0-427.00000001c0-12.7 7.40000001-21.5 14.30000001-21.5l150.19999999 0c1.5 0 3-0.2 4.5-0.4 10.2 38.8 45.5 67.3 87.5 67.3 50 0 90.5-40.5 90.5-90.4 0-49.9-40.5-90.6-90.5-90.59999999-42 0-77.3 28.6-87.5 67.39999999-1.4-0.2-2.9-0.4-4.49999999-0.4L446.3 243.3c-34.80000001 0-61.3 31.6-61.3 68.50000001L385 513.7l-79.1 0c-10.4-38.5-45.49999999-67-87.4-67-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c41.79999999 0 77.00000001-28.4 87.4-67L385 560.69999999z\" fill=\"#333333\" ></path></symbol><symbol id=\"icon-left\" viewBox=\"0 0 1024 1024\"><path d=\"M639 463.30000001L639 285.1c0-36.90000001-26.4-68.5-61.3-68.5l-150.2 0c-1.5 0-3 0.1-4.5 0.3-10.2-38.7-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.5s40.5 90.5 90.5 90.5c42 0 77.3-28.6 87.5-67.39999999 1.4 0.3 2.9 0.4 4.5 0.39999999L577.7 263.6c6.8 0 14.3 8.9 14.3 21.49999999l0 427.00000001c0 12.7-7.40000001 21.5-14.30000001 21.5l-150.19999999 0c-1.5 0-3 0.2-4.5 0.4-10.2-38.8-45.5-67.3-87.5-67.3-50 0-90.5 40.5-90.5 90.4 0 49.9 40.5 90.6 90.5 90.59999999 42 0 77.3-28.6 87.5-67.39999999 1.4 0.2 2.9 0.4 4.49999999 0.4L577.7 780.7c34.80000001 0 61.3-31.6 61.3-68.50000001L639 510.3l79.1 0c10.4 38.5 45.49999999 67 87.4 67 50 0 90.5-40.5 90.5-90.5s-40.5-90.5-90.5-90.5c-41.79999999 0-77.00000001 28.4-87.4 67L639 463.30000001z\" fill=\"#333333\" ></path></symbol><symbol id=\"icon-side\" viewBox=\"0 0 1024 1024\"><path d=\"M851.91168 328.45312c-59.97056 0-108.6208 48.47104-108.91264 108.36992l-137.92768 38.4a109.14304 109.14304 0 0 0-63.46752-46.58688l1.39264-137.11872c47.29344-11.86816 82.31936-54.66624 82.31936-105.64096 0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.76288-108.91776 108.91776c0 49.18784 32.60928 90.75712 77.38368 104.27392l-1.41312 138.87488a109.19936 109.19936 0 0 0-63.50336 48.55808l-138.93632-39.48544 0.01024-0.72704c0-60.15488-48.76288-108.91776-108.91776-108.91776s-108.91776 48.75776-108.91776 108.91776c0 60.15488 48.76288 108.91264 108.91776 108.91264 39.3984 0 73.91232-20.92032 93.03552-52.2496l139.19232 39.552-0.00512 0.2304c0 25.8304 9.00096 49.5616 24.02816 68.23424l-90.14272 132.63872a108.7488 108.7488 0 0 0-34.2528-5.504c-60.15488 0-108.91776 48.768-108.91776 108.91776 0 60.16 48.76288 108.91776 108.91776 108.91776 60.16 0 108.92288-48.75776 108.92288-108.91776 0-27.14624-9.9328-51.968-26.36288-71.04l89.04704-131.03104a108.544 108.544 0 0 0 37.6832 6.70208 108.672 108.672 0 0 0 36.48512-6.272l93.13792 132.57216a108.48256 108.48256 0 0 0-24.69888 69.0688c0 60.16 48.768 108.92288 108.91776 108.92288 60.16 0 108.91776-48.76288 108.91776-108.92288 0-60.14976-48.75776-108.91776-108.91776-108.91776a108.80512 108.80512 0 0 0-36.69504 6.3488l-93.07136-132.48a108.48768 108.48768 0 0 0 24.79616-72.22784l136.09984-37.888c18.99008 31.93856 53.84192 53.3504 93.69088 53.3504 60.16 0 108.92288-48.75776 108.92288-108.91264-0.00512-60.15488-48.77312-108.92288-108.92288-108.92288z\"  ></path></symbol><symbol id=\"icon-B\" viewBox=\"0 0 1024 1024\"><path d=\"M98.067692 65.457231H481.28c75.854769 0 132.411077 3.150769 169.668923 9.452307 37.336615 6.301538 70.656 19.534769 100.036923 39.620924 29.459692 20.007385 53.956923 46.710154 73.570462 80.029538 19.692308 33.398154 29.459692 70.734769 29.459692 112.167385 0 44.898462-12.130462 86.094769-36.233846 123.588923a224.886154 224.886154 0 0 1-98.461539 84.283077c58.368 17.092923 103.266462 46.08 134.695385 87.04 31.350154 40.96 47.025231 89.088 47.025231 144.462769 0 43.638154-10.082462 86.016-30.404923 127.212308-20.243692 41.196308-47.891692 74.043077-83.02277 98.697846-35.052308 24.654769-78.296615 39.778462-129.732923 45.449846-32.295385 3.465846-110.119385 5.671385-233.472 6.537846H98.067692V65.457231z m193.536 159.507692V446.621538h126.818462c75.460923 0 122.328615-1.024 140.603077-3.229538 33.083077-3.938462 59.155692-15.36 78.139077-34.343385 18.904615-18.904615 28.435692-43.874462 28.435692-74.830769 0-29.696-8.192-53.720615-24.497231-72.310154-16.384-18.510769-40.644923-29.696-72.940307-33.634461-19.140923-2.205538-74.279385-3.308308-165.415385-3.308308h-111.064615z m0 381.243077v256.315077h179.2c69.710769 0 113.979077-1.969231 132.726154-5.907692 28.750769-5.198769 52.145231-17.959385 70.262154-38.281847 18.116923-20.243692 27.096615-47.340308 27.096615-81.368615 0-28.750769-6.931692-53.169231-20.873846-73.255385a118.232615 118.232615 0 0 0-60.494769-43.795692c-26.387692-9.137231-83.574154-13.705846-171.638154-13.705846H291.603692z\"  ></path></symbol><symbol id=\"icon-a\" viewBox=\"0 0 1024 1024\"><path d=\"M757.76 665.6q0 20.48 1.536 34.304t7.68 22.016 18.944 12.288 34.304 4.096q-3.072 25.6-15.36 44.032-11.264 16.384-33.28 29.696t-62.976 13.312q-11.264 0-20.48-0.512t-17.408-2.56l-6.144-2.048-1.024 0q-4.096-1.024-10.24-4.096-2.048-2.048-4.096-2.048-1.024-1.024-2.048-1.024-14.336-8.192-23.552-17.408t-14.336-17.408q-6.144-10.24-9.216-20.48-63.488 75.776-178.176 75.776-48.128 0-88.064-15.36t-69.12-44.032-45.056-68.096-15.872-88.576 16.896-89.088 47.616-67.584 74.24-42.496 96.768-14.848q48.128 0 88.576 17.408t66.048 49.152q0-8.192 0.512-16.384t0.512-15.36q0-71.68-39.936-104.448t-128-32.768q-43.008 0-84.992 6.656t-84.992 17.92q14.336-28.672 25.088-47.616t24.064-29.184q30.72-24.576 158.72-24.576 79.872 0 135.168 13.824t90.624 43.52 51.2 75.264 15.872 108.032l0 200.704zM487.424 743.424q50.176 0 79.872-33.28t29.696-95.744q0-61.44-28.672-93.696t-76.8-32.256q-52.224 0-82.944 33.28t-30.72 94.72q0 58.368 31.744 92.672t77.824 34.304z\"  ></path></symbol><symbol id=\"icon-full\" viewBox=\"0 0 1024 1024\"><path d=\"M639.328 416c8.032 0 16.096-3.008 22.304-9.056l202.624-197.184-0.8 143.808c-0.096 17.696 14.144 32.096 31.808 32.192 0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808l1.248-222.208c0-0.672-0.352-1.248-0.384-1.92 0.032-0.512 0.288-0.896 0.288-1.408 0.032-17.664-14.272-32-31.968-32.032L671.552 96l-0.032 0c-17.664 0-31.968 14.304-32 31.968C639.488 145.632 653.824 160 671.488 160l151.872 0.224-206.368 200.8c-12.672 12.32-12.928 32.608-0.64 45.248C622.656 412.736 630.976 416 639.328 416z\"  ></path><path d=\"M896.032 639.552 896.032 639.552c-17.696 0-32 14.304-32.032 31.968l-0.224 151.872-200.832-206.4c-12.32-12.64-32.576-12.96-45.248-0.64-12.672 12.352-12.928 32.608-0.64 45.248l197.184 202.624-143.808-0.8c-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808-0.096 17.696 14.144 32.096 31.808 32.192l222.24 1.248c0.064 0 0.128 0 0.192 0 0.64 0 1.12-0.32 1.76-0.352 0.512 0.032 0.896 0.288 1.408 0.288l0.032 0c17.664 0 31.968-14.304 32-31.968L928 671.584C928.032 653.952 913.728 639.584 896.032 639.552z\"  ></path><path d=\"M209.76 159.744l143.808 0.8c0.064 0 0.128 0 0.192 0 17.6 0 31.904-14.208 32-31.808 0.096-17.696-14.144-32.096-31.808-32.192L131.68 95.328c-0.064 0-0.128 0-0.192 0-0.672 0-1.248 0.352-1.888 0.384-0.448 0-0.8-0.256-1.248-0.256 0 0-0.032 0-0.032 0-17.664 0-31.968 14.304-32 31.968L96 352.448c-0.032 17.664 14.272 32 31.968 32.032 0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968l0.224-151.936 200.832 206.4c6.272 6.464 14.624 9.696 22.944 9.696 8.032 0 16.096-3.008 22.304-9.056 12.672-12.32 12.96-32.608 0.64-45.248L209.76 159.744z\"  ></path><path d=\"M362.368 617.056l-202.624 197.184 0.8-143.808c0.096-17.696-14.144-32.096-31.808-32.192-0.064 0-0.128 0-0.192 0-17.6 0-31.904 14.208-32 31.808l-1.248 222.24c0 0.704 0.352 1.312 0.384 2.016 0 0.448-0.256 0.832-0.256 1.312-0.032 17.664 14.272 32 31.968 32.032L352.448 928c0 0 0.032 0 0.032 0 17.664 0 31.968-14.304 32-31.968s-14.272-32-31.968-32.032l-151.936-0.224 206.4-200.832c12.672-12.352 12.96-32.608 0.64-45.248S375.008 604.704 362.368 617.056z\"  ></path></symbol><symbol id=\"icon-add\" viewBox=\"0 0 1024 1024\"><path d=\"M863.328 482.56l-317.344-1.12L545.984 162.816c0-17.664-14.336-32-32-32s-32 14.336-32 32l0 318.4L159.616 480.064c-0.032 0-0.064 0-0.096 0-17.632 0-31.936 14.24-32 31.904C127.424 529.632 141.728 544 159.392 544.064l322.592 1.152 0 319.168c0 17.696 14.336 32 32 32s32-14.304 32-32l0-318.944 317.088 1.12c0.064 0 0.096 0 0.128 0 17.632 0 31.936-14.24 32-31.904C895.264 496.992 880.96 482.624 863.328 482.56z\"  ></path></symbol><symbol id=\"icon-move\" viewBox=\"0 0 1024 1024\"><path d=\"M863.744 544 163.424 544c-17.664 0-32-14.336-32-32s14.336-32 32-32l700.32 0c17.696 0 32 14.336 32 32S881.44 544 863.744 544z\"  ></path></symbol><symbol id=\"icon-living\" viewBox=\"0 0 1024 1024\"><path d=\"M514.133333 488.533333m-106.666666 0a106.666667 106.666667 0 1 0 213.333333 0 106.666667 106.666667 0 1 0-213.333333 0Z\" fill=\"#666666\" ></path><path d=\"M512 64C264.533333 64 64 264.533333 64 512c0 236.8 183.466667 428.8 416 445.866667v-134.4c-53.333333-59.733333-200.533333-230.4-200.533333-334.933334 0-130.133333 104.533333-234.666667 234.666666-234.666666s234.666667 104.533333 234.666667 234.666666c0 61.866667-49.066667 153.6-145.066667 270.933334l-59.733333 68.266666V960C776.533333 942.933333 960 748.8 960 512c0-247.466667-200.533333-448-448-448z\" fill=\"#666666\" ></path></symbol></svg>',h=(h=document.getElementsByTagName(\"script\"))[h.length-1].getAttribute(\"data-injectcss\");if(h&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write(\"<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>\")}catch(t){console&&console.log(t)}}function d(){o||(o=!0,a())}c=function(){var t,c,l,a;(a=document.createElement(\"div\")).innerHTML=n,n=null,(l=a.getElementsByTagName(\"svg\")[0])&&(l.setAttribute(\"aria-hidden\",\"true\"),l.style.position=\"absolute\",l.style.width=0,l.style.height=0,l.style.overflow=\"hidden\",t=l,(c=document.body).firstChild?(a=t,(l=c.firstChild).parentNode.insertBefore(a,l)):c.appendChild(t))},document.addEventListener?~[\"complete\",\"loaded\",\"interactive\"].indexOf(document.readyState)?setTimeout(c,0):(l=function(){document.removeEventListener(\"DOMContentLoaded\",l,!1),c()},document.addEventListener(\"DOMContentLoaded\",l,!1)):document.attachEvent&&(a=c,e=t.document,o=!1,(i=function(){try{e.documentElement.doScroll(\"left\")}catch(t){return void setTimeout(i,50)}d()})(),e.onreadystatechange=function(){\"complete\"==e.readyState&&(e.onreadystatechange=null,d())})}(window);","import { LEFT, RIGHT, SIDE } from './const'\nimport {\n  isMobile,\n  addParentLink,\n  getObjById,\n  generateUUID,\n  generateNewObj,\n  generateNewSummaryObj,\n} from './utils/index'\nimport { findEle, createInputDiv, layout, Topic, createChildren, createGroup, createTop, createTopic, shapeTpc, createSummary } from './utils/dom'\nimport { createLinkSvg, createLine } from './utils/svg'\nimport {\n  selectNode,\n  unselectNode,\n  selectNextSibling,\n  selectPrevSibling,\n  selectFirstChild,\n  selectParent,\n  getAllDataString,\n  getAllData,\n  getAllDataWithAutoHide,\n  getAllDataMd,\n  scale,\n  toCenter,\n  focusNode,\n  cancelFocus,\n  initLeft,\n  initRight,\n  initSide,\n  setLocale,\n  enableEdit,\n  disableEdit,\n  expandNode,\n  refresh,\n  toTopLeft,\n  autoHide,\n} from './interact'\nimport {\n  insertSibling,\n  insertBefore,\n  insertParent,\n  addChild,\n  copyNode,\n  moveNode,\n  removeNode,\n  moveUpNode,\n  moveDownNode,\n  beginEdit,\n  updateNodeStyle,\n  updateNodeTags,\n  updateNodeIcons,\n  updateNodeHyperLink,\n  updateNodeRemark,\n  // updateNodeImage,\n  processPrimaryNode,\n  setNodeTopic,\n  moveNodeBefore,\n  moveNodeAfter,\n  addSummary,\n} from './nodeOperation'\nimport {\n  createLink,\n  removeLink,\n  selectLink,\n  hideLinkController,\n  showLinkController,\n} from './customLink'\nimport linkDiv from './linkDiv'\nimport initMouseEvent from './mouse'\n\nimport contextMenu from './plugin/contextMenu'\nimport toolBar from './plugin/toolBar'\nimport nodeMenu from './plugin/nodeMenu'\nimport sidebar from './plugin/sidebar'\nimport nodeDraggable from './plugin/nodeDraggable'\nimport keypress from './plugin/keypress'\nimport mobileMenu from './plugin/mobileMenu'\n\nimport Bus from './utils/pubsub'\n\nimport './index.less'\nimport './plugin/contextMenu.less'\nimport './plugin/toolBar.less'\nimport './plugin/nodeMenu.less'\nimport './plugin/sidebar.less'\nimport './plugin/mobileMenu.less'\n\nimport { exportSvg, exportSvgDom } from '../painter/index.foreignObject'\n\nimport './iconfont/iconfont.js'\nimport { node } from 'canvg/dist/presets'\n\n// TODO show up animation\nconst E = findEle\ntype LinkObj = object\ntype operation = {\n  name: string\n}\nexport interface NodeObj {\n  topic: string,\n  id: string,\n  style?: {\n    fontSize?: string,\n    color?: string,\n    background?: string,\n    fontWeight?: string,\n    width?:string,\n    controllWidth?:string\n  },\n  parent?: NodeObj,\n  children?: NodeObj[],\n  tags?: string[],\n  icons?: string[],\n  hyperLink?: string,\n  remark?:string,\n  image?:{\n    url:string,\n    width:number,\n    height?:number,\n  }[],\n  linkJump?:{\n    toId:string,\n    title:string\n  }[]\n  expanded?: boolean,\n  direction?: number,\n  root?: boolean,\n  type?:string\n  summary?:{\n    range:string [],\n    topicId:string\n  }\n}\n\nexport interface NodeElement extends HTMLElement {\n  nodeObj:Object\n}\nexport interface MindElixirData {\n  nodeData: NodeObj,\n  linkData?: LinkObj,\n  expandDeep?:number|null\n  direction?:number\n}\nexport interface MindElixirInstance {\n  mindElixirBox: HTMLElement,\n  nodeData: NodeObj,\n  linkData: LinkObj,\n  expandDeep:number|null\n  currentNode: Topic | null,\n  currentLink: SVGElement | null,\n  inputDiv: HTMLElement | null,\n  scaleVal: number,\n  tempDirection: number | null,\n  bus: object, // wip\n\n  // wip\n  history: operation[],\n  isUndo: boolean,\n  undo: () => void,\n\n  direction: number,\n  locale: string,\n  draggable: boolean,\n  editable: boolean,\n  contextMenu: boolean,\n  contextMenuOption: object,\n  toolBar: boolean,\n  nodeMenu: boolean,\n  keypress: boolean,\n  before: object,\n  newTopicName: string,\n  allowUndo: boolean,\n  overflowHidden: boolean,\n  primaryLinkStyle: number,\n  primaryNodeHorizontalGap: number,\n  primaryNodeVerticalGap: number,\n  mobileMenu: boolean,\n  closeButton:boolean,\n  widthControll:boolean,\n  uploadButton:boolean,\n  nodeDraggable:boolean\n}\nexport interface Options {\n  el: string,\n  data: MindElixirData,\n  direction?: number,\n  locale?: string,\n  draggable?: boolean,\n  editable?: boolean,\n  contextMenu?: boolean,\n  contextMenuOption?: object,\n  toolBar?: boolean,\n  nodeMenu?: boolean,\n  keypress?: boolean,\n  before?: object,\n  newTopicName?: string,\n  allowUndo?: boolean,\n  overflowHidden?: boolean,\n  primaryLinkStyle?: number,\n  primaryNodeHorizontalGap?: number,\n  primaryNodeVerticalGap?: number,\n  mobileMenu?: boolean,\n  closeButton?:boolean,\n  //节点宽度调整\n  widthControll?:boolean,\n  //导入XMind文件\n  uploadButton?:boolean,\n  //配置节点拖拽\n  nodeDraggable?:boolean\n}\nconst $d = document\n/**\n * @export MindElixir\n * @example\n * let mind = new MindElixir({\n  el: '#map',\n  direction: 2,\n  data: data,\n  draggable: true,\n  editable: true,\n  contextMenu: true,\n  toolBar: true,\n  nodeMenu: true,\n  keypress: true,\n})\nmind.init()\n *\n */\nfunction MindElixir(this: MindElixirInstance, {\n  el,\n  data,\n  direction,\n  locale,\n  draggable,\n  editable,\n  contextMenu,\n  contextMenuOption,\n  toolBar,\n  nodeMenu,\n  keypress,\n  before,\n  newTopicName,\n  allowUndo,\n  primaryLinkStyle,\n  overflowHidden,\n  primaryNodeHorizontalGap,\n  primaryNodeVerticalGap,\n  mobileMenu,\n  closeButton,\n  widthControll,\n  uploadButton,\n  nodeDraggable\n}: Options) {\n  const box = document.getElementById(el) as HTMLElement\n  if (!box) return\n  this.mindElixirBox = box\n  this.before = before || {}\n  this.nodeData = data.nodeData\n  this.linkData = data.linkData || {}\n  this.expandDeep=data?.expandDeep\n  this.locale = locale\n  this.contextMenuOption = contextMenuOption\n  this.contextMenu = contextMenu === undefined ? true : contextMenu\n  this.toolBar = toolBar === undefined ? true : toolBar\n  this.nodeMenu = nodeMenu === undefined ? true : nodeMenu\n  this.keypress = keypress === undefined ? true : keypress\n  this.closeButton = closeButton === undefined ? false : closeButton\n  this.widthControll = widthControll === undefined ? true : widthControll\n  this.mobileMenu = mobileMenu\n  // record the direction before enter focus mode, must true in focus mode, reset to null after exit focus\n  // todo move direction to data\n  this.direction = data.direction!==undefined?data.direction:(typeof direction === 'number' ? direction : 1)\n  this.draggable = draggable === undefined ? true : draggable\n  this.newTopicName = newTopicName\n  this.editable = editable === undefined ? true : editable\n  this.allowUndo = allowUndo === undefined ? true : allowUndo\n  // this.parentMap = {} // deal with large amount of nodes\n  this.currentNode = null // the selected <tpc/> element\n  this.currentLink = null // the selected link svg element\n  this.inputDiv = null // editor\n  this.scaleVal = 1\n  this.tempDirection = null\n  this.primaryLinkStyle = primaryLinkStyle || 0\n  this.overflowHidden = overflowHidden\n  this.primaryNodeHorizontalGap = primaryNodeHorizontalGap\n  this.primaryNodeVerticalGap = primaryNodeVerticalGap\n  this.uploadButton = uploadButton === undefined ? true : uploadButton\n  this.nodeDraggable = nodeDraggable === undefined ? true : nodeDraggable\n\n  this.bus = new Bus()\n  ;(this.bus as any).addListener('operation', (operation: operation) => {\n    if (this.isUndo) {\n      this.isUndo = false\n      return\n    }\n    if (['moveNode', 'removeNode', 'addChild', 'finishEdit', 'editStyle', 'editTags', 'editIcons'].includes(\n      operation.name\n    )) {\n      this.history.push(operation)\n      // console.log(operation, this.history)\n    }\n  })\n\n  this.history = [] // TODO\n  this.isUndo = false\n  this.undo = function() {\n    const operation = this.history.pop()\n    if (!operation) return\n    this.isUndo = true\n    if (operation.name === 'moveNode') {\n      this.moveNode(\n        E(operation.obj.fromObj.id),\n        E(operation.obj.originParentId)\n      )\n    } else if (operation.name === 'removeNode') {\n      if (operation.originSiblingId) {\n        this.insertBefore(E(operation.originSiblingId), operation.obj)\n      } else {\n        this.addChild(E(operation.originParentId), operation.obj)\n      }\n    } else if (operation.name === 'addChild' || operation.name === 'copyNode') {\n      this.removeNode(E(operation.obj.id))\n    } else if (operation.name === 'finishEdit') {\n      this.setNodeTopic(E(operation.obj.id), operation.origin)\n    } else {\n      this.isUndo = false\n    }\n  }\n}\n\nfunction beforeHook(fn:(el:any, node?:any)=>void) {\n  return async function(...args:unknown[]) {\n    if (\n      !this.before[fn.name] ||\n      (await this.before[fn.name].apply(this, args))\n    ) {\n      fn.apply(this, args)\n    }\n  }\n}\n\nMindElixir.prototype = {\n  addParentLink,\n  getObjById,\n  generateNewObj,\n  generateNewSummaryObj,\n  // node operation\n  insertSibling: beforeHook(insertSibling),\n  insertBefore: beforeHook(insertBefore),\n  insertParent: beforeHook(insertParent),\n  addSummary:beforeHook(addSummary),\n  addChild: beforeHook(addChild),\n  copyNode: beforeHook(copyNode),\n  moveNode: beforeHook(moveNode),\n  removeNode: beforeHook(removeNode),\n  moveUpNode: beforeHook(moveUpNode),\n  moveDownNode: beforeHook(moveDownNode),\n  beginEdit: beforeHook(beginEdit),\n  moveNodeBefore: beforeHook(moveNodeBefore),\n  moveNodeAfter: beforeHook(moveNodeAfter),\n  updateNodeStyle,\n  updateNodeTags,\n  updateNodeIcons,\n  updateNodeHyperLink,\n  updateNodeRemark,\n  // updateNodeImage,\n  processPrimaryNode,\n  setNodeTopic,\n\n  createLink,\n  removeLink,\n  selectLink,\n  hideLinkController,\n  showLinkController,\n\n  layout,\n  linkDiv,\n  createInputDiv,\n  shapeTpc,\n  createChildren, createGroup, createTop, createTopic,createSummary,\n\n  selectNode,\n  unselectNode,\n  selectNextSibling,\n  selectPrevSibling,\n  selectFirstChild,\n  selectParent,\n  getAllDataString,\n  getAllData,\n  getAllDataWithAutoHide,\n  getAllDataMd,\n  scale,\n  toCenter,\n  toTopLeft,\n  focusNode,\n  cancelFocus,\n  initLeft,\n  initRight,\n  initSide,\n  setLocale,\n  enableEdit,\n  disableEdit,\n  expandNode,\n  refresh,\n  exportSvg,\n  exportSvgDom,\n  init: function(nodeData?:NodeObj,expandDeep?:number) {\n    /**\n     * @function\n     * @global\n     * @name E\n     * @param {string} id Node id.\n     * @return {TargetElement} Target element.\n     * @example\n     * E('bd4313fbac40284b')\n     */  \n    if(nodeData) this.nodeData=nodeData\n    if(expandDeep)this.expandDeep=expandDeep\n    addParentLink(this.nodeData)\n    console.log('ME_version ' + MindElixir.version)\n    console.log(this)\n    if(this.mindElixirBox.className.indexOf('mind-elixir')===-1)\n      this.mindElixirBox.className += ' mind-elixir'\n    this.mindElixirBox.innerHTML = ''\n\n    this.container = $d.createElement('div') // map container\n    this.container.className = 'map-container'\n\n    if (this.overflowHidden) this.container.style.overflow = 'hidden'\n\n    this.map = $d.createElement('div') // map-canvas Element\n    this.map.className = 'map-canvas'\n    this.map.setAttribute('tabindex', '0')\n    this.container.appendChild(this.map)\n    this.mindElixirBox.appendChild(this.container)\n    this.root = $d.createElement('root')\n\n    this.box = $d.createElement('children')\n    this.box.className = 'mindbox'\n\n    // infrastructure\n\n    this.svg2nd = createLinkSvg('svg2nd') // main link container\n\n    this.linkController = createLinkSvg('linkcontroller') // bezier controller container\n    this.P2 = $d.createElement('div') // bezier P2\n    this.P3 = $d.createElement('div') // bezier P3\n    this.P2.className = this.P3.className = 'circle'\n    this.line1 = createLine(0, 0, 0, 0) // bezier auxiliary line1\n    this.line2 = createLine(0, 0, 0, 0) // bezier auxiliary line2\n    this.linkController.appendChild(this.line1)\n    this.linkController.appendChild(this.line2)\n\n    this.linkSvgGroup = createLinkSvg('topiclinks') // storage user custom link svg\n\n    this.map.appendChild(this.root)\n    this.map.appendChild(this.box)\n    this.map.appendChild(this.svg2nd)\n    this.map.appendChild(this.linkController)\n    this.map.appendChild(this.linkSvgGroup)\n    this.map.appendChild(this.P2)\n    this.map.appendChild(this.P3)\n\n    // plugin\n    this.toolBar && toolBar(this)\n    this.nodeMenu && nodeMenu(this)\n    this.keypress && keypress(this)\n    sidebar(this)\n    if (isMobile() && this.mobileMenu) {\n      mobileMenu(this)\n    } else {\n      this.contextMenu && contextMenu(this, this.contextMenuOption)\n    }\n    this.draggable && nodeDraggable(this)\n\n    // 为了兼容从xmind导入的导图在一开始没有\n    autoHide(this.nodeData,0,this.expandDeep||2)\n    this.layout()\n    this.linkDiv()\n    this.toTopLeft()\n    // if (!this.overflowHidden) initMouseEvent(this)\n    initMouseEvent(this)\n  },\n}\n\nMindElixir.LEFT = LEFT\nMindElixir.RIGHT = RIGHT\nMindElixir.SIDE = SIDE\n/**\n * @memberof MindElixir\n * @static\n */\nMindElixir.version = '0.17.0'\nMindElixir.E = findEle\n\n/**\n * @function new\n * @memberof MindElixir\n * @static\n * @param {String} topic root topic\n */\nMindElixir.new = (topic: string): MindElixirData => ({\n  nodeData: {\n    id: generateUUID(),\n    topic: topic || 'new topic',\n    root: true,\n    style: {\n      color: \"#ffffff\",\n      background: \"#00aaff\"\n    },\n    children: [],\n  },\n  linkData: {},\n})\n\nexport default MindElixir\n\n// export {exportSvg,exportPng} something wrong comes with the rollup"],"names":["encodeHTML","s","isMobile","rgbHex","rgb","$0","$1","$2","$3","getObjById","id","data","i","res","addParentLink","parent","refreshIds","generateUUID","throttle","fn","wait","pre","context","args","now","getArrowPoints","p3x","p3y","p4x","p4y","deltay","deltax","angle","arrowLength","arrowAngle","a1","a2","calcP1","fromData","p2x","p2y","x","y","k","calcP4","toData","generateNewObj","generateNewSummaryObj","val","checkMoveValid","from","to","valid","moveUpObj","obj","childrenList","index","t","moveDownObj","removeNodeObj","insertNodeObj","newObj","insertBeforeNodeObj","insertParentNodeObj","moveNodeObj","moveNodeBeforeObj","toIndex","moveNodeAfterObj","dragMoveHelper","container","deltaX","deltaY","LinkDragMoveHelper","dom","map","cb","e","$d","findEle","instance","resizeNode","widthControll","tpc","anotherWidthControll","eDown","startX","width","eMove","endX","eUp","_a","shapeTpc","nodeObj","widthControllRight","widthControllLeft","imgContainer","linkContainer","content","remarkContainer","delayTask","iconsContainer","icon","button","moveToNode","tagsContainer","tag","toNode","findUnExpandedParent","node","toId","flag","createGroup","omitChildren","grp","top","createExpander","children","smyChild","createSummary","smy","createTop","createTopic","topic","selectText","div","range","getSelection","createInputDiv","_b","_c","_d","_e","_f","_g","origin","key","updateLinkJumpTitle","expanded","expander","createChildren","direction","chldr","smyEle","layout","primaryNodes","lcount","rcount","svgNS","createMainPath","d","path","createLinkSvg","klass","svg","createSvgPath","createLine","x1","y1","x2","y2","line","createPath","createSvgGroup","arrowd","g","arrow","maxTop","maxBottom","maxLeft","maxRight","imgPadding","head","init","generateSvgDom","svgContent","primaryNode","rect","bottom","left","right","PrimaryToSvg","RootToSvg","svgHeight","svgWidth","svgFile","createSvg","getHeightAndWidth","height","root","rootTpc","tpcStyle","tStyle","rootOffsetY","rootOffsetX","topicOffsetLeft","topicOffsetTop","svg2ndEle","tags","tagsEle","tagRect","icons","iconsEle","images","imagesEle","image","svg2nd","topiclinks","topics","primaryNodeOffsetY","primaryNodeOffsetX","svg3rd","tpcRect","topicOffsetTopTop","border","backgroundColor","exportSvg","dlUrl","a","exportSvgDom","fileName","getData","selectNode","targetElement","isNewNode","clickEvent","unselectNode","selectNextSibling","sibling","target","siblingList","selectPrevSibling","selectFirstChild","selectParent","getAllDataString","v","getAllData","autoHide","nodeData","cnt","deep","getAllDataWithAutoHide","expandDeep","getAllDataMd","mdString","writeMd","enableEdit","disableEdit","scale","scaleVal","getRootWidth","getRootHeight","getHeightDistance","b","aHeight","bHeight","getHeightFromRootToChild","childTpc","toCenter","toTopLeft","focusNode","tpcEl","cancelFocus","initLeft","initRight","initSide","setLocale","locale","expandNode","el","isExpand","expandNodeChild","refresh","updateNodeStyle","object","nodeEle","updateNodeTags","oldVal","updateNodeIcons","updateNodeHyperLink","hyperLink","hyperLinkArr","link","updateNodeRemark","remark","insertSibling","newNodeObj","insertBefore","insertParent","grp0","children0","c","addSummaryFunction","newTop","smychildren","addChildFunction","addSummary","parentIndex","selectedArr","value","addChild","copyNode","deepCloneObj","moveUpNode","moveDownNode","removeNode","next","originSiblingId","childrenLength","parentT","prop","moveNode","fromObj","toObj","originParentId","fromTop","fromChilren","toTop","moveNodeBefore","fromGrp","toGrp","moveNodeAfter","beginEdit","setNodeTopic","processPrimaryNode","l","r","createLink","isInitPaint","pfrom","pto","fromCenterX","fromCenterY","toCenterX","toCenterY","p1","p1x","p1y","p4","arrowPoint","newSvgGroup","newLinkObj","removeLink","linkSvg","selectLink","hideLinkController","showLinkController","linkObj","linkDiv","primaryNodeHorizontalGap","primaryNodeVerticalGap","primaryNodeList","totalHeight","shortSide","shortSideGap","currentOffsetL","currentOffsetR","totalHeightL","totalHeightR","base","countL","countR","totalHeightLWithoutGap","totalHeightRWithoutGap","primaryPath","alignRight","alignLeft","elOffsetH","xMiddle","LEFT","svgSMY","smypath","loopChildren","first","parentOT","parentOL","parentOW","parentOH","isSmyChild","child","firstEl","lastEl","rangeMap","xfirst","yfirst","ylast","xlast","childT","childTOT","childTOH","nextChildren","initMouseEvent","mind","element","cn","i18n","contextMenu$1","option","createTips","words","createLi","name","keyname","li","add_child","add_parent","add_sibling","remove_child","focus","unfocus","up","down","nodeLink","summary","menuUl","item","menuContainer","isRoot","tips","img","queryList","updateSidebar","sidebar","curActive","sidebar$1","createButton","timer","debounce","fun","argu","createToolBarRBContainer","toolBarRBContainer","fc","gc","zo","zi","numberSelection","percentage","uploadButton","createUploadButton","viewBTop","mindBTop","offset","createToolBarLTContainer","toolBarLTContainer","menu","viewTop","mindTop","createCloseButton","close","fm","toolBar$1","createDiv","colorList","nodeMenu$1","bgOrFont","styleDiv","tagDiv","iconDiv","remarkDiv","size","color","clearSelect","remove","elems","sizeSelector","bold","buttonContainer","fontBtn","tagInput","iconInput","linkInput","remarkInput","newTags","newIcons","input","state","dataSize","dataWeight","dataColor","preVal","curVal","insertPreview","insertLocation","clearPreview","query","className","insertPreviewEL","queryElement","canPreview","dragged","isContain","nodeDraggable","meet","E","topMeet","bottomMeet","keypress","key2func","mobileMenu$1","edit","Bus","type","handler","payload","handlers","o","n","h","MindElixir","draggable","editable","contextMenu","contextMenuOption","toolBar","nodeMenu","before","newTopicName","allowUndo","primaryLinkStyle","overflowHidden","mobileMenu","closeButton","box","operation","beforeHook"],"mappings":"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"}